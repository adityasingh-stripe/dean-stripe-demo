function getCountryflag(n){function v(n){$(n).val().trim().length<5?($(n).val(""),$(n).val(t+" "+$(n).val())):$(n).val().trim().length>5&&$(n).val().indexOf("+")!=-1?$(n).val($(n).val()):$(n).val(t+" "+$(n).val())}function y(n){$(n).val().trim().length<5?($(n).val(""),$(n).val(i+" "+$(n).val())):$(n).val().trim().length>5&&$(n).val().indexOf("+")!=-1?$(n).val($(n).val()):$(n).val(i+" "+$(n).val())}var f=document.querySelector("#txPhone"),e=document.querySelector("#txMobile"),h,c,r,u,t,i;const o=document.querySelector("#error-msg"),b=document.querySelector("#valid-msg"),s=document.querySelector("#error-msg1"),k=document.querySelector("#valid-msg1"),d=["Invalid number","Invalid country code","Too short","Too long","Invalid number","Invalid Length"];if(h="[a-zA-Z@!#$%&*_~]+|[+]{2,}",c=document.getElementById("cbCountry"),n==""||typeof n=="undefined")var g=window.intlTelInput(f),nt=window.intlTelInput(e),l=g.getSelectedCountryData().iso2,a=nt.getSelectedCountryData().iso2;(n==""||typeof n=="undefined")&&$("#txPhone").val().length<1&&(n=c.options[c.selectedIndex].value);n=="-1"&&(n="US");typeof l!="undefined"&&l!=n&&$("#txPhone").val().length>1&&(n=l);r=window.intlTelInput(f,{initialCountry:n,autoPlaceholder:!1,formatOnDisplay:!1,utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"});n!=""&&typeof n!="undefined"&&r.setCountry(n);typeof a!="undefined"&&a!=n&&$("#txMobile").val().length>1&&(n=a);u=window.intlTelInput(e,{initialCountry:n,autoPlaceholder:!1,formatOnDisplay:!1,utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"});n!=""&&typeof n!="undefined"&&u.setCountry(n);t=r.getSelectedCountryData().dialCode;i=u.getSelectedCountryData().dialCode;typeof t=="undefined"&&(t="");t!=""&&typeof t!="undefined"&&(t="+"+t);i!=""&&typeof i!="undefined"&&(i="+"+i);typeof i=="undefined"&&(i="");window.onload=v("#txPhone");window.onload=y("#txMobile");$("#txPhone").click(function(){typeof r.getSelectedCountryData().dialCode!="undefined"&&(t="+"+r.getSelectedCountryData().dialCode,v("#txPhone"))});$("#txMobile").click(function(){typeof u.getSelectedCountryData().dialCode!="undefined"&&(i="+"+u.getSelectedCountryData().dialCode,y("#txMobile"))});$("#iti-2__country-listbox").click(function(){$("#txPhone").val($("#txPhone").val().replace(t,""));getPhoneFlagDialCode()});$("#iti-3__country-listbox").click(function(){$("#txMobile").val($("#txMobile").val().replace(i,""));getMobileFlagDialCode()});const p=()=>{f.classList.remove("error"),o.innerHTML="",o.classList.add("hide"),b.classList.add("hide")},w=()=>{e.classList.remove("error"),s.innerHTML="",s.classList.add("hide"),k.classList.add("hide")};f.addEventListener("blur",()=>{if(n=r.getSelectedCountryData().iso2,t="+"+r.getSelectedCountryData().dialCode,($("#txPhone").val().trim().length<5||$("#txPhone").val().indexOf("+")!=-1)&&(r=window.intlTelInput(f,{initialCountry:n,formatOnDisplay:!1}),v("#txPhone"),r.setCountry(n)),p(),f.value.trim())if(r.isValidNumber()&&$("#txPhone").val().indexOf("+")!=-1&&!$("#txPhone").val().match(h))b.classList.remove("hide"),$("#buReserve").removeClass("ws-disabled");else{f.classList.add("error");var i=r.getValidationError();(i=="-99"||$("#txPhone").val().match(h))&&(i="0");o.innerHTML=d[i];o.innerHTML!="undefined"&&o.classList.remove("hide");$("#txPhone").val().trim().length<5&&(o.innerHTML="",f.classList.remove("error"));$("#buReserve").addClass("ws-disabled")}});f.addEventListener("change",p);f.addEventListener("keyup",p);e.addEventListener("blur",()=>{if(n=u.getSelectedCountryData().iso2,i="+"+u.getSelectedCountryData().dialCode,($("#txMobile").val().trim().length<5||$("#txMobile").val().indexOf("+")!=-1)&&(u=window.intlTelInput(e,{initialCountry:n,formatOnDisplay:!1}),y("#txMobile"),u.setCountry(n)),w(),e.value.trim())if(u.isValidNumber()&&$("#txMobile").val().indexOf("+")!=-1&&!$("#txMobile").val().match(h))k.classList.remove("hide"),$("#buReserve").removeClass("ws-disabled");else{e.classList.add("error");var t=u.getValidationError();(t=="-99"||$("#txMobile").val().match(h))&&(t="0");s.innerHTML=d[t];s.innerHTML!="undefined"&&s.classList.remove("hide");$("#txMobile").val().trim().length<5&&(s.innerHTML="",e.classList.remove("error"));$("#buReserve").addClass("ws-disabled")}});e.addEventListener("change",w);e.addEventListener("keyup",w)}function getCountryFlagOnChange(){var e=document.querySelector("#txPhone"),o=document.querySelector("#txMobile"),r=document.getElementById("cbCountry"),n=r.options[r.selectedIndex].value;n=="-1"&&(n="US");var u=window.intlTelInput(e,{initialCountry:n,autoPlaceholder:!1,formatOnDisplay:!1}),f=window.intlTelInput(o,{initialCountry:n,autoPlaceholder:!1,formatOnDisplay:!1}),t=u.getSelectedCountryData().dialCode,i=f.getSelectedCountryData().dialCode;typeof t!="undefined"&&$("#txPhone").val().indexOf("+")=="0"&&$("#txPhone").val().indexOf(t)=="1"&&($("#txPhone").val($("#txPhone").val().replace("/^[+]"+t+"/g","")),$("#txPhone").val().trim().length<5&&(document.getElementById("txPhone").value=""));typeof t!="undefined"&&$("#txPhone").val().indexOf("+"+t)==-1&&$("#txPhone").val("+"+t+" "+$("#txPhone").val());typeof i!="undefined"&&$("#txMobile").val().indexOf("+")=="0"&&$("#txMobile").val().indexOf(i)=="1"&&($("#txMobile").val($("#txMobile").val().replace("/^[+]"+i+"/g","")),$("#txMobile").val().trim().length<5&&(document.getElementById("txMobile").value=""));typeof i!="undefined"&&$("#txMobile").val().indexOf("+"+i)==-1&&$("#txMobile").val("+"+i+" "+$("#txMobile").val());u.setCountry(n);f.setCountry(n);getCountryflag(n)}function getPhoneFlagDialCode(){var n;document.getElementById("txPhone").defaultValue="";n=$("#txPhone").val();$("#txPhone").val("");var t=document.querySelector("#txPhone"),i=window.intlTelInput(t),r=i.getSelectedCountryData().dialCode;$("#txPhone").val().indexOf("+")==-1&&$("#txPhone").val("+"+r+n)}function getMobileFlagDialCode(){var n;document.getElementById("txMobile").defaultValue="";n=$("#txMobile").val();$("#txMobile").val("");var t=document.querySelector("#txMobile"),i=window.intlTelInput(t),r=i.getSelectedCountryData().dialCode;$("#txMobile").val().indexOf("+")==-1&&$("#txMobile").val("+"+r+n)}function getBrowserInfo(){var n={browserAcceptHeader:"application/json",browserJavaEnabled:navigator.javaEnabled(),browserJavascriptEnabled:!0,browserLanguage:navigator.userLanguage||navigator.language,browserColorDepth:window.screen.colorDepth,browserScreenHeight:window.screen.height,browserScreenWidth:window.screen.width,browserTZ:(new Date).getTimezoneOffset(),challengeWindowSize:"05"};return JSON.stringify(n)}function removeErrorclass(n){$("#"+n+"+ p.ws-error").html("");$("#buGuestSave").hasClass("ws-disabled")&&!$("#dvActiveGuestPrograms input[type = text]").hasClass("ws-error-form")&&$("#buGuestSave").removeClass("ws-disabled");$("#buReserve2_Paygate").hasClass("ws-disabled")&&!$("#dvActiveGuestPrograms input[type = text]").hasClass("ws-error-form")&&$("#buReserve2_Paygate").removeClass("ws-disabled")}function ValidRegex(n){var t=!0;try{new RegExp(n)}catch(i){t=!1}return t}function CheckVerifyStatus(){var n={hotelID:WsVars.HotelID,chainID:WsVars.ChainID,channelID:WsVars.Chan,crsID:$("#inCrsID").val(),merchantReference:$("#inMerchantReference").val()};$.ajax({type:"POST",url:"xml/getpaygate.aspx?adyenVerifyStatus=1",data:n,dataType:"json",success:function(n){n!=null&&n.Status==="SUCCESS"?ProcessPayment():n!=null&&n.Status==="FAILURE"&&n.Msg.length>0?($("#buModifyResv + p.ws-error").html(n.Msg),$("#buModifyResv").addClass("ws-error-form"),$("#pcPayQrCodeModal").hasClass("compact-modal")&&$.magnificPopup.close()):n!=null&&n.Msg.length>0&&($("#buModifyResv + p.ws-error").html(n.Msg),$("#buModifyResv").addClass("ws-error-form"),$("#pcPayQrCodeModal").hasClass("compact-modal")&&$.magnificPopup.close(),$("#buReserve_Paygate,#buReserve2_Paygate").hasClass("ws-submitting")&&($("#buReserve_Paygate,#buReserve2_Paygate").removeClass("ws-submitting"),$(".ws-reserve-button").removeClass("ws-disabled")));$("body").css({cursor:"auto"})},error:function(){$("#pcPayQrCodeModal").hasClass("compact-modal")&&$.magnificPopup.close();$("#buReserve_Paygate,#buReserve2_Paygate").hasClass("ws-submitting")&&$("#buReserve_Paygate,#buReserve2_Paygate").removeClass("ws-submitting");$("body").css({cursor:"auto"})}})}function ProcessPayment(){var n=Utils.Format("confirm.aspx?ret=1&redirectResult=VerifyResult&hotelID={0}&lang={1}&crsresId={2}&currID={3}&merchantTxId={4}&CartInfo={5}",WsVars.HotelID,WsVars.LangCode,$("#inCrsID").val(),WsVars.CurrencyId,$("#inMerchantReference").val(),$("#inCartInfo").val());$.ajax({type:"POST",url:n,data:"",dataType:"json",success:function(n){console.log(n);n!=null&&n.Status==="SUCCESS"?location.href=n.Url:n!=null&&n.Msg!==""&&n.Msg!==undefined&&n.Msg.length>0&&($("#buModifyResv + p.ws-error").html(n.Msg),$("#buModifyResv").addClass("ws-error-form"),$("#pcPayQrCodeModal").hasClass("compact-modal")&&$.magnificPopup.close())},error:function(n){console.log(n.error);$("#buReserve_Paygate,#buReserve2_Paygate").hasClass("ws-submitting")&&$("#buReserve_Paygate,#buReserve2_Paygate").removeClass("ws-submitting");$("#pcPayQrCodeModal").hasClass("compact-modal")&&$.magnificPopup.close();$("body").css({cursor:"auto"})}})}(function(n){function u(i,r,u,f){var h=i,o=r,c=u,e=n.extend(!0,[],r.Svcs),s=h.find(".dvWsAddons").filter(":first"),l=f,y=Number(WsVars.LangID),v,a;h.data("MySvc",this);this.GetSvcs=function(){return e};this.AddAddon=function(n){l.Page.length!==0&&(e=e.concat(n),a(1))};this.SetSvcs=function(n,t){e=n;l.Page==="CONFIRM"?a(1):l.Page.length===0&&v(t)};this.UpdateDates=function(){for(var r,t,i=h.data("MyCal"),n=0;n<e.length;n++)r=checkAddonOption(e[n].Options)=="None",e[n].Options.search("CheckInOnly")!=-1||r?(t=[],t[0]={Dt:i.GetArrival()},e[n].Dates=t):e[n].Options.search("CheckOutOnly")!=-1?(t=[],t[0]={Dt:i.GetDeparture()},e[n].Dates=t):e[n].Dates!=null&&e[n].Dates!=undefined&&e[n].Dates.length>0&&(t=[],t[0]=e[n].Dates[0].Dt!=undefined?e[n].Dates[0].Tm!=undefined?{Dt:e[n].Dates[0].Dt,Tm:e[n].Dates[0].Tm}:{Dt:e[n].Dates[0].Dt}:{Dt:i.GetArrival()},e[n].Dates=t)};this.IsDiff=function(){if(e.length!=o.Svcs.length)return!0;for(var n=0;n<e.length;n++)if(e[n].SvcID!==o.Svcs[n].SvcID||e[n].Dates.length!==o.Svcs[n].Dates.length||e[n].Dates.length>0&&(e[n].Dates[0]?.Dt||e[n].Dates[0].Tm)&&(e[n].Dates[0].Dt!==o.Svcs[n].Dates[0].Dt||e[n].Dates[0].Tm!==o.Svcs[n].Dates[0].Tm))return!0;return!1};this.ShowMod=function(){l.Page.length!==0&&a(1)};this.ShowOrig=function(){a(0)};v=function(t){for(var p,b,w,u,a,ft,d="",k=0,g=h.data("MyCal"),v=h.data("MyOcc"),r=e,nt=nt=l.Page==="CONFIRM"?WSMAIN.items:WSMAIN.Items,i=0;i<r.length;i++){if(p=CalculateAddOnAmount(r[i],g.GetArrival(),v.GetAdults(),g.GetNights(),v.GetChildren(),!0,nt,v.GetChildAges(),v.GetChild1(),v.GetChild2(),v.GetChild3(),v.GetChild4()),p!=null&&(r[i].Amt=Number(p.amt),r[i].Taxes=Number(p.tax),r[i].TaxVAT=Number(p.taxVat)),k=WsVars.IbeShowTotal==="1"?r[i].Amt+r[i].Taxes:WsVars.IbeShowTotalExclusive==="1"?r[i].Amt-r[i].TaxVAT:r[i].Amt,b="",b=WsVars.Config2Flag=="True"?o.Currency+"~":o.Currency,w="",WsVars.EnableConciergeService=="1"&&l.Page!="CONFIRM"&&t!=null&&t.length>0)for(j=0;j<t.length;j++)if(t[j].ID==r[i].SvcID&&(r[i].Options==="CheckInOnly"||r[i].Options==="CheckOutOnly")&&t[j].TransportSegmentAvail!=null&&t[j].TransportSegmentAvail.length>0){w+=Utils.Format('<div class="ws-cart-addonConciergeMod"><select class="cbAddOnTransServiceMod custom" >');var et=r[i].ConciergeTransportBookingReq&&r[i].ConciergeTransportBookingReq.BookingSegmentIds||[],tt=0,f={},it="";for(u=0;u<t[j].TransportSegmentAvail.length;u++)if(t[j].TransportSegmentAvail[u].Journeys!=null)for(a=0;a<t[j].TransportSegmentAvail[u].Journeys.length;a++){var ot=t[j].TransportSegmentAvail[u].Journeys[a].DisplayDepartureDate,st=t[j].TransportSegmentAvail[u].Journeys[a].FareBrandName,rt=t[j].TransportSegmentAvail[u].Id,ht=r[i].SvcID,ut="";et.includes(rt)&&(ut="selected",it="selected");w+=Utils.Format('<option value="{0}" ix="{3}" sID="{4}" {5}>{2} - {1}<\/option>',rt,ot,st,c,ht,ut);tt===0&&(ft=[t[j].TransportSegmentAvail[u].Id],f.BookingSegmentIds=ft,f.Amount=t[j].TransportSegmentAvail[u].TotalAmount,f.Origin=t[j].TransportSegmentAvail[u].Journeys[a].Origin.Code,f.Destination=t[j].TransportSegmentAvail[u].Journeys[a].Destination.Code,f.Departure=t[j].TransportSegmentAvail[u].Journeys[a].DepartureDate,f.ServiceItemId=t[j].TransportSegmentAvail[u].InclusionID,tt++)}if(w+="<\/select><\/div>",f!=null&&it==""&&WSMAIN.Items[c].Svcs!=null&&WSMAIN.Items[c].Svcs.length>0)for(let n=0;n<WSMAIN.Items[c].Svcs.length;n++)WSMAIN.Items[c].Svcs[n].SvcID==r[i].SvcID&&(WSMAIN.Items[c].Svcs[n].ConciergeTransportBookingReq=f)}d+=Utils.Format('<div class="ws-row-item contain" ixs="{0}"><div class="ws-cart-photo"><img src="{1}" alt="{11}" title="{10}" loading="lazy"/><\/div><div class="ws-cell-item ws-cart-item"><p class="ws-cart-item-title ws-cart-value"><strong>{2}<\/strong><\/p><p class="ws-cart-qty ws-cart-value">{7}<\/p><\/div><div class="ws-cell-item ws-cart-price"><p class="ws-cart-value"><strong class="ws-prices" ref="{3}" curr="{9}" >{4}<\/strong><\/p><p><span><a href="#" class="ws-button-compact wsCartSvcBuDelete" ix="{8}" ixs="{0}"><b><span class="ws-icon" data-icon="&#xf057;" aria-hidden="true"><\/span>{5}<\/b><\/a><\/span><\/p><\/div><div class="ws-cart-desc"><p class="ws-meta">{6}<\/p><\/div>{12}<\/div>',i,r[i].Img,r[i].Name,k,Utils.GetAmount(k,b,WsVars.UseCurrCode),WsMulti.Remove,r[i].Desc,Utils.GetSvcDateTime(y,r[i].Dates),c,b,r[i].Title,r[i].AltText,w)}s.empty().html(d);s.find(".custom").customSelect();s.find(".customSelect").append('<span class="ws-down-arrow" aria-hidden="true"><\/span>');_cbAddOnTransServiceMod=s.find(".cbAddOnTransServiceMod").filter(":first");n(".wsCartSvcBuDelete").click(function(){var t=Number(n(this).attr("ix")),i=Number(n(this).attr("ixs"));return h.trigger("CartRemoveAddon",[t,i]),!1});_cbAddOnTransServiceMod.change(function(){for(var a,l,s,r,f,e=n(this).val(),h=n(this).find('option[value="'+e+'"]'),u=Number(h.attr("ix")),c=Number(h.attr("sID")),i,o=0;o<t.length;o++)if(t[o].ID==c){i=t[o];break}if(WSMAIN.Items[u]!=null){if(a=WSMAIN.Items[u].Svcs,WSMAIN.Items[u].Svcs!=null&&WSMAIN.Items[u].Svcs.length>0)for(let n=0;n<WSMAIN.Items[u].Svcs.length;n++)if(WSMAIN.Items[u].Svcs[n].SvcID==c&&(s=[],typeof e!==undefined&&e!==""&&i.TransportSegmentAvail.length>0)){for(s.push(e),r=0;r<i.TransportSegmentAvail.length;r++)if(i.TransportSegmentAvail[r].Journeys!=null)for(f=0;f<i.TransportSegmentAvail[r].Journeys.length;f++)if(i.TransportSegmentAvail[r].Id==e){l={BookingSegmentIds:s,Amount:i.TransportSegmentAvail[r].TotalAmount,Origin:i.TransportSegmentAvail[r].Journeys[f].Origin.Code,Destination:i.TransportSegmentAvail[r].Journeys[f].Destination.Code,Departure:i.TransportSegmentAvail[r].Journeys[f].DepartureDate,ServiceItemId:i.TransportSegmentAvail[r].InclusionID};break}WSMAIN.Items[u].Svcs[n].ConciergeTransportBookingReq=l}WSMAIN.update()}})};a=function(t){var p="",f=0,k=0,d='<div class="ws-row-item contain" ixs="{0}"><div class="ws-cart-photo"><img src="{1}" alt="{11}" title="{10}" loading="lazy" /><\/div><div class="ws-cell-item ws-cart-item"><p class="ws-cart-item-title ws-cart-value"><strong>{2}<\/strong><\/p><\/div><div class="ws-cell-item ws-cart-price"><p class="ws-cart-value"><strong class="ws-prices" ref="{3}" curr="{7}">{4}<\/strong><\/p><p><span class="ws-odd"><a href="#" class="ws-button-compact wsConfirmSvcBuDelete" ixs="{0}"><b><span class="ws-icon" data-icon="&#xf057;" aria-hidden="true"><\/span>{5}<\/b><\/a><\/span><\/p><\/div><div class="ws-cart-desc"><p class="ws-meta">{6}<\/p><\/div><\/div>',r=o.Svcs,rt=h.data("MyCal"),u=h.data("MyOcc"),w=w=l.Page==="CONFIRM"?WSMAIN.items:WSMAIN.Items,a,c,ut,b,y,v,i;if(t===0){for(i=0;i<r.length;i++)WsVars.IbeShowTotal==="1"?f=r[i].Amt+r[i].Taxes:c=WsVars.IbeShowTotalExclusive==="1"?CalculateAddOnAmount(r[i],o.Dt1,u.GetAdults(),o.Nights,u.GetChildren(),!0,w,u.GetChildAges(),u.GetChild1(),u.GetChild2(),u.GetChild3(),u.GetChild4()):CalculateAddOnAmount(r[i],o.Dt1,u.GetAdults(),o.Nights,u.GetChildren(),!0,w,u.GetChildAges(),u.GetChild1(),u.GetChild2(),u.GetChild3(),u.GetChild4()),c!=null&&(f=Number(c.amt),k=Number(c.taxVat),r[i].Taxes=Number(c.tax)),r[i].Amt=f,v="",v=WsVars.Config2Flag=="True"?o.Currency+"~":o.Currency,p+=Utils.Format(d,i,r[i].Img,r[i].Name,WsVars.IbeShowTotal==="1"?f:f-k,Utils.GetAmount(WsVars.IbeShowTotal==="1"?f:f-k,v,WsVars.UseCurrCode),WsMulti.Remove,r[i].Desc,v,r[i].Title,r[i].AltText);s.empty().html(p);s.find(".custom").customSelect();return}r=e;d='<div class="ws-row-item contain wsConfirmSvcItem" ixs="{0}"><div class="ws-cart-photo"><img src="{1}" alt="{10}" title="{9}" loading="lazy"/><\/div><div class="ws-cell-item ws-cart-item"><p class="ws-cart-item-title ws-cart-value"><strong>{2}<\/strong><\/p><\/div><div class="ws-cell-item ws-cart-price"><p class="ws-cart-value"><strong class="ws-prices" ref="{3}" curr="{8}">{4}<\/strong><\/p><p><span class="ws-odd"><a href="#" class="ws-button-compact wsConfirmSvcBuDelete" ixs="{0}"><b><span class="ws-icon" data-icon="&#xf057;" aria-hidden="true"><\/span>{5}<\/b><\/a><\/span><\/p><\/div><div class="ws-cart-desc"><p class="ws-meta">{6}<\/p><\/div>{7}<\/div>';var g="",nt="",tt=h.data("MyCal"),it=tt.GetArrival(),ft=it+tt.GetNights(),et=tt.GetNights();for(i=0;i<r.length;i++){if(a="",r[i].Formula!==undefined?a=r[i].Formula:r[i].Per!==undefined&&(a=r[i].Per),g="",c=CalculateAddOnAmount(r[i],it,u.GetAdults(),rt.GetNights(),u.GetChildren(),!0,w,u.GetChildAges(),u.GetChild1(),u.GetChild2(),u.GetChild3(),u.GetChild4()),c!=null&&(r[i].Amt=Number(c.amt),r[i].Taxes=Number(c.tax),r[i].TaxVAT=Number(c.taxVat)),f=WsVars.IbeShowTotal==="1"?r[i].Amt+r[i].Taxes:WsVars.IbeShowTotalExclusive==="1"?r[i].Amt-r[i].TaxVAT:r[i].Amt,(rt.IsOpen()||IsAddonPriorModStart)&&r[i].Options.search("CheckInOnly")==-1&&r[i].Options.search("CheckOutOnly")==-1&&a!=""&&a!="5"&&a!="6"&&a!=="8"&&a!="9"&&a!="10"&&(r[i].ScheduledbyDate===!0||r[i].ScheduledbyTime===!0&&r[i].UseInv==!0)){for(nt="",ut='<div class="ws-modify-options"><div class="ws-modify-item ws-several"><div class="ws-form-item">{0}<\/div><div class="ws-form-item">{1}<\/div><\/div><\/div>',b='<select class="custom ws-element wsConfirmSvcCbDate">',y=0;y<r[i].Dates.length;y++)(r[i].Options.search("ExcludeArrivalDate")==-1||r[i].Dates[y].Dt!=it)&&(r[i].Options.search("ExcludeDepartureDate")==-1||r[i].Dates[y].Dt!=ft)&&r[i].ScheduledbyDate===!0&&(b+=Utils.Format('<option value="{0}">{1}<\/option>',r[i].Dates[y].Dt,Utils.ToCustom2(r[i].Dates[y].Dt,0,WsVars.LangID)));b+="<\/select>";r[i].ScheduledbyTime===!0&&(nt='<select class="custom ws-element wsConfirmSvcCbTime"><option value="0000">12:00 AM<\/option><option value="0030">12:30 AM<\/option><option value="0100">1:00 AM<\/option><option value="0130">1:30 AM<\/option><option value="0200">2:00 AM<\/option><option value="0230">2:30 AM<\/option><option value="0300">3:00 AM<\/option><option value="0330">3:30 AM<\/option><option value="0400">4:00 AM<\/option><option value="0430">4:30 AM<\/option><option value="0500">5:00 AM<\/option><option value="0530">5:30 AM<\/option><option value="0600">6:00 AM<\/option><option value="0630">6:30 AM<\/option><option value="0700">7:00 AM<\/option><option value="0730">7:30 AM<\/option><option value="0800">8:00 AM<\/option><option value="0830">8:30 AM<\/option><option value="0900">9:00 AM<\/option><option value="0930">9:30 AM<\/option><option value="1000">10:00 AM<\/option><option value="1030">10:30 AM<\/option><option value="1100">11:00 AM<\/option><option value="1130">11:30 AM<\/option><option value="1200">12:00 PM<\/option><option value="1230">12:30 PM<\/option><option value="1300">1:00 PM<\/option><option value="1330">1:30 PM<\/option><option value="1400">2:00 PM<\/option><option value="1430">2:30 PM<\/option><option value="1500">3:00 PM<\/option><option value="1530">3:30 PM<\/option><option value="1600">4:00 PM<\/option><option value="1630">4:30 PM<\/option><option value="1700">5:00 PM<\/option><option value="1730">5:30 PM<\/option><option value="1800">6:00 PM<\/option><option value="1830">6:30 PM<\/option><option value="1900">7:00 PM<\/option><option value="1930">7:30 PM<\/option><option value="2000">8:00 PM<\/option><option value="2030">8:30 PM<\/option><option value="2100">9:00 PM<\/option><option value="2130">9:30 PM<\/option><option value="2200">10:00 PM<\/option><option value="2230">10:30 PM<\/option><option value="2300">11:00 PM<\/option><option value="2330">11:30 PM<\/option><\/select>');g=Utils.Format(ut,b,nt)}v="";v=WsVars.Config2Flag=="True"?o.Currency+"~":o.Currency;p+=Utils.Format(d,i,r[i].Img,r[i].Name,f,Utils.GetAmount(f,v,WsVars.UseCurrCode),WsMulti.Remove,r[i].Desc,g,v,r[i].Title,r[i].AltText)}for(s.empty().html(p),i=0;i<r.length;i++)r[i].Dates&&r[i].Dates.length>0&&r[i].Dates[0]&&(r[i].Dates[0].Dt&&s.find('.wsConfirmSvcItem[ixs="'+i+'"]').find(".wsConfirmSvcCbDate").val(r[i].Dates[0].Dt),r[i].Dates[0].Tm&&s.find('.wsConfirmSvcItem[ixs="'+i+'"]').find(".wsConfirmSvcCbTime").val(r[i].Dates[0].Tm));s.find(".wsConfirmSvcBuDelete").click(function(){var t=Number(n(this).attr("ixs")),i;return t<0||t>=e.length?!1:(e.splice(t,1),s.find('.wsConfirmSvcItem[ixs="'+t+'"]').remove(),i=0,s.find(".wsConfirmSvcItem").each(function(){n(this).attr("ixs",i);n(this).find(".wsConfirmSvcBuDelete").attr("ixs",i++)}),h.trigger("AddonRemoved",[e]),!1)});s.find(".wsConfirmSvcCbDate").change(function(){var t=Number(n(this).parents(".wsConfirmSvcItem").attr("ixs")),r;if(!(t>=e.length)){if(e[t].Dates[0].Dt!=Number(n(this).val())){for(r=Number(n(this).val()),i=0;i<e[t].Dates.length;i++)e[t].Dates[i].Dt==Number(n(this).val())&&(e[t].Dates[i].Dt=e[t].Dates[0].Dt);e[t].Dates[0].Dt=r}else e[t].Dates[0].Dt=Number(n(this).val());h.trigger("AddonDateModified")}});s.find(".wsConfirmSvcCbTime").change(function(){var t=Number(n(this).parents(".wsConfirmSvcItem").attr("ixs"));t>=e.length||(e[t].Dates[0].Tm=n(this).val(),h.trigger("AddonTimeModified"))});s.find(".custom").customSelect()};n(".viewUgradeRoom").click(function(){var i=Number(n(this).attr("ix"));return i<0||i>=WSMAIN.Items.length?!1:c==i?(n("#dvLoadUpgradeRooms").html(""),n("#dvLoadUpgradeRooms").html(n(this).parent("div").find(".dvLoadUpgradeRoomsHTML").html()),n.magnificPopup.open({items:{src:"#dvLoadUpgradeRooms"},type:"inline",modal:!0},0),t(h,o,c,i),!1):void 0})}function f(i,r,u){var s,e,c;if(n("#IsPopupforUpgradeRooms").val()=="0"||n("#IsPopupforUpgradeRooms").val()=="1")return!1;var l=i,o=r,h=u,f=[];if(n.cookie("IsUpgradePopUpShown")!=null&&(f=JSON.parse(n.cookie("IsUpgradePopUpShown"))),f==null&&(f=[]),s=n.cookie("IsItemAddedToCart"),WSCCONSENT.SetCookie("IsItemAddedToCart",null),e=Number(n(".viewUgradeRoom:first").attr("ix")),e<0||e>=WSMAIN.Items.length)return!1;if(h==e&&(f==null||f==""||!f.includes(o.HotelID)||n("#IsPopupforUpgradeRooms").val()=="3")&&s!=null&&s!="null"){if(c=n("#isMultiCart").val(),c==1||n("#IsPopupforUpgradeRooms").val()=="3"){if(n("#dvLoadUpgradeRooms").html(""),n("#dvLoadUpgradeRooms").html(n(".viewUgradeRoom:first").parent("div").find(".dvLoadUpgradeRoomsHTML").html()),!n.trim(n("#dvLoadUpgradeRooms").html()).length)return!1;n.magnificPopup.open({items:{src:"#dvLoadUpgradeRooms"},type:"inline",modal:!0},0);t(l,o,h,e);n("#IsPopupforUpgradeRooms").val()=="3"||f.includes(o.HotelID)||(f.push(o.HotelID),WSCCONSENT.SetCookie("IsUpgradePopUpShown",JSON.stringify(f)))}n(".buUpgradeClose").click(function(){return n.magnificPopup.close(),!1})}}function t(t,i,r,u){let o=t,p=i,a=r,c=0,l=o.find(".dvUpgrade").filter(":first"),f=o.find(".cbUpgrade").filter(":first"),h=o.find(".txUpgrade").filter(":first"),v=n("#dvLoadUpgradeRooms").find(".buselUpgrade"),y=o.find(".viewUgradeRoom").filter(":first");var s=null;if(o.data("MyUp",this),h.click(function(){return n(this).attr("aria-expanded",!0),f.show(),setTimeout(function(){n(document).on("touchstart click",o.data("MyUp")._outside)},0),!1}),this._outside=function(t){const i=n(t.target);if(!i.parents().is(l)&&!i.is(l))return f.hide(),setTimeout(function(){n(document).off("touchstart click",this._outside)},0),!1},WsVars.IBESkinVer=="3"){h.wrap(`<button class="btnUpgrade ws-select ws-custom-dropdown" type="button" role="combobox" aria-haspopup="listbox" aria-labelledby="${h.attr("id")}" aria-expanded="false" ></button>`);h.removeAttr("role").removeAttr("aria-haspopup").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-expanded").removeAttr("tabindex");h.removeClass("txTower ws-select");s=o.find(".btnUpgrade").filter(":first");s.append('<span class="ws-icon-down" aria-hidden="true"><\/span>');s.click(function(){return n(this).attr("aria-expanded",!0),f.show(),setTimeout(function(){n(document).on("touchstart click",o.data("MyUp")._outside)},0),!1});s.on("keydown",function(t){if(f.removeClass("ws-dropdownHeight"),(t.keyCode===40||t.keyCode===38)&&f.css("display")=="block"&&f.innerHeight()>40)f.find("li").filter(function(){return n(this).css("display")!=="none"}).first().each(function(){n(this).attr("aria-selected",!0).addClass("ws-current");n(this).find("a").focus()});else if((t.keyCode===40||t.keyCode===38)&&f.length>0)f.show(),f.addClass("ws-dropdownHeight"),f.find("li").filter(function(){return n(this).css("display")!=="none"}).first().each(function(){n(this).attr("aria-selected",!0).addClass("ws-current");n(this).find("a").focus()});else if(t.keyCode==13||t.key==="Enter"||t.keyCode===32||t.key==="Space"){t.preventDefault();f.toggle();const i=f.is(":visible");n(this).attr("aria-expanded",i);f.removeClass("ws-dropdownHeight");s.focus();f.css("display")=="block"&&f.innerHeight()>40&&f.find("li").filter(function(){return n(this).css("display")!=="none"}).first().each(function(){n(this).attr("aria-selected",!0).addClass("ws-current");n(this).find("a").focus()})}});n("body").on("click",function(){f.removeClass("ws-dropdownHeight")})}f.find("a").click(function(){f.hide();setTimeout(function(){n(document).off("touchstart click",this._outside)},0);var t=Number(n(this).attr("ref"));return t===0?!1:(c=t,h.html(n(this).html()),f.find("li").removeClass("ws-current"),f.find("li").filter(function(){return Number(n(this).attr("ref"))===c}).addClass("ws-current"),o.trigger("RoomUpgraded"),!1)});v.find("a").click(function(){var t=0,f,r;if(u>0&&(t=u),a==t){if(f=Number(n(this).attr("ref")),f===0)return!1;c=f;h.html(n(this).parent("div").parent("div").find(".rUpgradetxt p").html());o.trigger("RoomUpgraded");var l=n(this).closest("div").prev().find("p").html(),v=n(this).closest("div").prev().find("p").attr("roomCode"),e=n(this).closest("div").prev().find("p.rUpgradetxt").find("span.ws-number").attr("ref"),i="",s="cart_room_rate";try{if(WSMAIN.Items!=null&&WSMAIN.Items.length>0){typeof WSMAIN.Items[t].Promo!="undefined"&&WSMAIN.Items[t].Promo!=""?i=WSMAIN.Items[t].Promo:typeof WSMAIN.Items[t].Voucher!="undefined"&&WSMAIN.Items[t].Voucher!=""?i=WSMAIN.Items[t].Voucher:typeof WSMAIN.Items[t].Access!="undefined"&&WSMAIN.Items[t].Access!=""?i=WSMAIN.Items[t].Access:typeof WSMAIN.Items[t].Iata!="undefined"&&WSMAIN.Items[t].Iata!=""&&(i=WSMAIN.Items[t].Iata);let u=Number(e)*WsVars.Nights,n=0;for(let t=0;t<WSMAIN.Items.length;t++){let i=WSMAIN.Items[t].Amt??0;if(i>0&&WSMAIN.Items[t].TaxVAT>0&&(i-=WSMAIN.Items[t].TaxVAT),n+=i,WSMAIN.Items[t].Svcs!=null&&WSMAIN.Items[t].Svcs.length>0){let i=WSMAIN.Items[t].Svcs;for(let t=0;t<i.length;t++){let r=i[t].Amt-i[t].TaxVAT;n+=r}}}r={index:0,itemListId:s,roomName:l,rateName:WSMAIN.Items[t].RateType,roomCode:v,rateCode:WSMAIN.Items[t].RateCode,hotelCode:WsVars.PCode,hotelId:Number(WsVars.HotelID),hotelName:WsVars.HotelName,nights:WsVars.Nights,dt1:WsVars.DayIn,adults:WsVars.Adults,child1:WsVars.Child1,child2:WsVars.Child2,child3:WsVars.Child3,child4:WsVars.Child4,price:e,coupon:i,category:"Room Rate Upgrade",itemListId:s,currency:WsVars.Currency,totalprice:n,abSetting:WsVars.ABSetting};WsVars.HgID>0&&(r.hgId=WsVars.HgID,WsVars.HotelGroupCode&&(r.hotelGroupCode=WsVars.HotelGroupCode));SHR.TrkLib.AddToCart(r)}}catch(y){console.log(y)}}return!1});n("#dvLoadUpgradeRooms").find(".buUpgradeClose").click(function(){return n.magnificPopup.close(),!1});let e=-1;f.on("keydown",function(n){let t=f.find('li[style!="display: none;"]'),i=f.closest(".ws-select-box").find(".btnUpgrade");if(typeof t!==undefined&&t!==null&&t.length!=0){if(e<0&&(e=t.filter(".ws-current").index()),n.preventDefault(),t.removeAttr("aria-selected"),t.removeClass("ws-current"),t.eq(e).find("a").blur(),n.keyCode===38||n.shiftKey&&n.keyCode===9)e=(e-1+t.length)%t.length;else if(n.keyCode===40||n.keyCode===9)e=(e+1)%t.length;else if(n.keyCode===13)t.eq(e).find("a").focus().click(),t.eq(e).attr("aria-selected",!0),WsVars.IBESkinVer=="3"&&f.removeClass("ws-dropdownHeight"),i.focus();else if(n.shiftKey&&n.keyCode===9)f.hide(),t.removeAttr("aria-selected"),t.filter(".ws-current").attr("aria-selected",!0),WsVars.IBESkinVer=="3"&&(s.focus(),s.attr("aria-expanded",!1),f.removeClass("ws-dropdownHeight"));else if(n.keyCode===9)f.hide(),t.eq(e).find("a").click(),t.removeAttr("aria-selected"),t.filter(".ws-current").attr("aria-selected",!0),WsVars.IBESkinVer=="3"&&(s.attr("aria-expanded",!1),f.removeClass("ws-dropdownHeight"));else if(n.keyCode===27||n.keyCode===32){f.hide();h.focus();t.removeAttr("aria-selected");t.filter(".ws-current").attr("aria-selected",!0);WsVars.IBESkinVer=="3"&&(s.attr("aria-expanded",!1),s.focus(),f.removeClass("ws-dropdownHeight"));return}t.eq(e).attr("aria-selected",!0);t.eq(e).addClass("ws-current");t.eq(e).find("a").focus()}});this.GetRmID=function(){return c};this.Hide=function(){l.hide();y.hide()}}function i(t,i,r){let f=t,c=i,o=r,s=f.find(".ws-inclusions"),e=f.find(".cbDepart"),h=f.find(".txDepart"),u={segmentID:null,amt:0,org:null,dest:null,depart:null,addOnID:0,idx:o};f.data("MyCon",this);h.click(function(){return n("ul.ws-select-options").hide(),n(this).attr("aria-expanded",!0),n(this).next("ul").show(),setTimeout(function(){n(document).on("touchstart click",f.data("MyCon")._outside)},0),!1});this._outside=function(t){const i=n(t.target);if(!i.parents().is(s)&&!i.is(s))return e.hide(),setTimeout(function(){n(document).off("touchstart click",this._outside)},0),!1};e.find("a").click(function(){return e.hide(),setTimeout(function(){n(document).off("touchstart click",this._outside)},0),u.segmentID=n(this).attr("ref"),u.amt=n(this).attr("amt"),u.org=n(this).attr("org"),u.dest=n(this).attr("dest"),u.depart=n(this).attr("depart"),u.addOnID=n(this).attr("incID"),u.idx=o,n(this).parent("li").parent("ul").prev("span").html(n(this).html()),n(this).parent("li").parent("ul").find("li").removeClass("ws-current"),n(this).parent("li").parent("ul").find("li").filter(function(){return n(this).attr("ref")===u.segmentID&&n(this).attr("amt")==u.amt}).addClass("ws-current"),f.trigger("ConciergeChange"),!1});e.on("keydown",function(n){let t=this.find('li[style!="display: none;"]');if(typeof t!==undefined&&t!==null&&t.length!=0){if(currentUpgradeIndex<0&&(currentUpgradeIndex=t.filter(".ws-current").index()),n.preventDefault(),t.eq(currentUpgradeIndex).find("a").blur(),n.keyCode===38||n.shiftKey&&n.keyCode===9)currentUpgradeIndex=(currentUpgradeIndex-1+t.length)%t.length;else if(n.keyCode===40||n.keyCode===9)currentUpgradeIndex=(currentUpgradeIndex+1)%t.length;else if(n.keyCode===13)t.eq(currentUpgradeIndex).find("a").focus().click(),t.eq(currentUpgradeIndex).attr("aria-selected",!0);else if(n.keyCode===27||n.keyCode===32){this.hide();this.parent("div").find("span").focus();t.filter(".ws-current").attr("aria-selected",!0);return}t.eq(currentUpgradeIndex).find("a").focus();t.removeAttr("aria-selected");t.eq(currentUpgradeIndex).attr("aria-selected",!0)}});this.GetConciergeTransportSegment=function(){return u}}function e(t,u,f,e){function dr(t,i){showLoder();n.ajax({type:"POST",url:"xml/getresultd.aspx?refer="+t.Page,data:i,dataType:"json",success:function(r){var e,v,p,c,w,f,b,l,nt;if(hideLoder(),a=r,r.RoomTypes!=null){if(Document.calendarAvaildate1="",n("#IsError").val(""),di(!1),t.Page==="ROOMDETAIL"||t.Page==="RATEDETAIL"){var k="",tt="",it="",d=[],o="",u=JSON.parse(i.wscart);if(typeof u.Promo!="undefined"&&u.Promo!=""?o=u.Promo:typeof u.Voucher!="undefined"&&u.Voucher!=""?o=u.Voucher:typeof u.Access!="undefined"&&u.Access!=""?o=u.Access:typeof u.Iata!="undefined"&&u.Iata!=""&&(o=u.Iata),t.Page==="ROOMDETAIL"){k="details_rates_for_room_"+r.RoomTypes[0].Code;it=r.RoomTypes[0].Name;for(let n in r.RateCodes){e=r.RateCodes[n];let t=0;v=r.RoomStays.find(n=>n.RcID==e.RcID&&n.RmID==r.RoomTypes[0].RmID).Amt;d.push({price:v,coupon:o,roomName:it,rateName:e.Name,roomCode:r.RoomTypes[0].Code,rateCode:e.Code,hotelCode:WsVars.PCode,hotelId:Number(WsVars.HotelID),hotelName:WsVars.HotelName,nights:WsVars.Nights,adults:WsVars.Adults,child1:WsVars.Child1,child2:WsVars.Child2,child3:WsVars.Child3,child4:WsVars.Child4,category:"Room Rate",index:t,dt1:WsVars.DayIn,currency:WsVars.Currency,abSetting:WsVars.ABSetting});t++}}else if(t.Page==="RATEDETAIL"){k="details_rooms_for_rate_"+r.RateCodes[0].Code;tt=r.RateCodes[0].Name;let n=0;for(let t in r.RoomTypes)e=r.RoomTypes[t],v=r.RoomStays.find(n=>n.RcID==r.RateCodes[0].RcID&&n.RmID==e.RmID).Amt,d.push({price:v,coupon:o,roomName:e.Name,rateName:tt,roomCode:e.Code,rateCode:r.RateCodes[0].Code,hotelCode:WsVars.PCode,nights:WsVars.Nights,adults:WsVars.Adults,child1:WsVars.Child1,child2:WsVars.Child2,child3:WsVars.Child3,child4:WsVars.Child4,category:"Room Rate",index:n,dt1:WsVars.DayIn,currency:WsVars.Currency,abSetting:WsVars.ABSetting}),n++}p={itemListId:k,data:d,adults:WsVars.Adults,child1:WsVars.Child1,child2:WsVars.Child2,child3:WsVars.Child3,child4:WsVars.Child4,hotelCode:WsVars.PCode,hotelId:Number(WsVars.HotelID),hotelName:WsVars.HotelName,nights:WsVars.Nights,dt1:WsVars.DayIn,currency:WsVars.Currency,abSetting:WsVars.ABSetting};WsVars.HgID>0&&(p.hgId=WsVars.HgID,WsVars.HotelGroupCode&&(p.hotelGroupCode=WsVars.HotelGroupCode));SHR.TrkLib.ViewItemList(p)}sr(r)}else if(r.Msg!=null)if((t.Page==="RATEDETAIL"||t.Page==="ROOMDETAIL")&&r.RoomTypes==null){var rt=s.HotelID,h=y.data("MyOcc"),ut=y.data("MyRmRc"),ft=y.data("MyCal"),et=Utils.GetDateFromY2K(ft.GetArrival()),ot=Utils.DateFormat(et,WsDtFm[Number(WsVars.LangID)]);typeof pkgid=="undefined"&&(pkgid=0);c=t.RcID;c===0&&(c=ut.GetRcID());w=Utils.GetParam("group");w===null&&(w="");f=Utils.GetParam("showQualifiedRates");typeof f!="undefined"&&f!==null?f.toLowerCase()==="true"&&(f="&showQualifiedRates=true"):(f=JSON.parse(n.cookie("showQualifiedRate_"+WsVars.HotelID)),f=typeof f!="undefined"&&f!==null&&f===!0?"&showQualifiedRates=true":"");b="";WsVars.EnhancedMultiroom.toLowerCase()=="true"?(l=h.GetChildAges(),typeof l!="undefined"&&l!==null&&l.length>0&&(b="&childAges="+l.toString())):b="&children="+h.GetChild1()+","+h.GetChild2()+","+h.GetChild3()+","+h.GetChild4();nt="";typeof WsVars.GuestLoyalty!="undefined"&&WsVars.GuestLoyalty!=null&&WsVars.GuestLoyalty!=""&&(nt="&memberID="+WsVars.GuestLoyalty);showLoder();n.ajax({url:"xml/getratecalendar.aspx?refer=widget&hotelID="+rt+"&hgID="+WsVars.HgID+"&langID="+WsVars.LangID+"&currID="+WsVars.CurrencyId+"&ix=0&rcID="+c+"&adults="+h.GetAdults()+b+"&step="+WsVars.Step+"&pkgID="+pkgid+"&group="+w+"&dt1="+WsVars.DtLocal+"&checkin="+ot+nt+f,dataType:"json",cache:!1,success:function(u){var o,f,p;if(hideLoder(),u.RoomTypes){var v="",s="",e="",w=!1,b=[],l="",h="";for(t.RmID&&(v=t.RmID),l=Number(u.Ix1),o=0;o<u.RoomTypes.length;o++){if(e!="")break;for(Number(u.RoomTypes[o].RmID)===v&&v>0?h=u.RoomTypes[o].Rates.split(","):c>0&&(h=u.RoomTypes[o].Rates.split(",")),f=0;f<h.length;f++)if(s=h[f]===""?"":Number(h[f]),s===""&&(b[f+l]=s),p=u.RoomTypes[o].Avails.split(","),w=p.length>f&&p[f]==="C"?!0:!1,!w&&s!=""){b[f+l]=s;e=f+l;break}}e!=""?(showLoder(),n.ajax({type:"POST",url:"xml/getresultd.aspx?refer="+t.Page+"&availdt1="+e,data:i,dataType:"json",success:function(u){if(hideLoder(),a=u,u.RoomTypes){var f=JSON.parse(i.wscart),o=f.Dt1;e!=t.Items[0].Dt1||e!=o?(Document.calendarAvaildate1=e,y.trigger("AvailError",[r.Msg,""]),di(!0),sr(a)):(Document.calendarAvaildate1="",n("#dvMessage").text(""),di(!1),sr(a))}else u.Msg!=null&&(a=u,Document.calendarAvaildate1="",y.trigger("AvailError",[a.Msg,""]),di(!0),y.trigger("AvailSuccess",[a]))},error:function(){hideLoder()}})):(di(!0),Document.calendarAvaildate1="",y.trigger("AvailSuccess",[r]),y.trigger("AvailError",[r.Msg,""]))}else y.trigger("AvailError",[r.Msg,""]),n("#IsError").val(r.Msg),g.Alert(r.Msg)},error:function(){hideLoder()}})}else y.trigger("AvailError",[r.Msg,""]),n("#IsError").val(r.Msg),g.Alert(r.Msg)},error:function(){hideLoder()}})}function di(t){t?(n(".ws-rate-detail-summary").addClass("ws-hidden"),n(".ws-room-rate-detail").addClass("ws-hidden"),n("#ws-full-terms-conditions").addClass("ws-hidden"),n(".ws-price-from").addClass("ws-hidden"),n(".ws-add-ons").addClass("ws-hidden")):(n(".ws-rate-detail-summary").removeClass("ws-hidden"),n(".ws-room-rate-detail").removeClass("ws-hidden"),n("#ws-full-terms-conditions").removeClass("ws-hidden"),n(".ws-price-from").removeClass("ws-hidden"),n(".ws-add-ons").removeClass("ws-hidden"))}var g=this,hr=!1,o=1,rt=0,gi="",ut=0,et=0,ct=0,ur=0,gr="",cr="",l=0,p=0,tt=0,k=0,pt=0,ti=0,wt=0,ii="",it="",ri="",b=[],ot=0,st=0,a=null,w=null,nr=null,d=null,nt=null,vt=null,dt=null,at=null,gt=null,lr="",ar="",vr="",yr="",yi="",ft=null,yt=null,bt="",ei=null,oi=null,si=null,h,ht,pi,hi,wi,ci,li,bi,v,ni,pr,fr,er,tr,or,ui="GX",fi="",ai=null,kt,lt,y=t,s=u,ir=f,c=e;y.data("MyRmRc",this);var nu=function(){var i,ai,t;if(h=y.find(".txGenAmt").filter(":first"),ht=y.find(".ws-micro").filter(":first"),kt=y.find(".ws-include-resortfee-block").filter(":first"),pi=y.find(".imgRoom").filter(":first"),hi=y.find(".txRateName").filter(":first"),wi=y.find(".txRateDesc").filter(":first"),ci=y.find(".txRoomName").filter(":first"),li=y.find(".txRateRoom-Tower").filter(":first"),bi=y.find(".txRoomDesc").filter(":first"),v=y.find(".txAmt").filter(":first"),ni=y.find(".ws-msg-caution").filter(":first"),pr=y.find(".wsInsChk").filter(":first"),fr=y.find(".dvWsInsurance").filter(":first"),er=y.find(".wsInsPrice").filter(":first"),lt=y.find(".lbFlexPayRate").filter(":first"),d=y.find(".cbRoom").filter(":first"),nt=y.find(".cbRate").filter(":first"),ft=y.find(".cbTower").filter(":first"),vt=y.find(".txRoom").filter(":first"),dt=y.find(".txRate").filter(":first"),yt=y.find(".txTower").filter(":first"),at=y.find(".msgRoom").filter(":first"),gt=y.find(".msgRate").filter(":first"),_msgTower=y.find(".msgTower").filter(":first"),vt.click(function(){return n(this).attr("aria-expanded",!0),d.show(),nt.hide(),y.trigger("RoomDropdownShown"),n(".ws-tip-close").click(),!1}),dt.click(function(){return n(this).attr("aria-expanded",!0),nt.show(),d.hide(),n(".ws-tip-close").click(),!1}),yt.click(function(){return n(this).attr("aria-expanded",!0),ft.show(),nt.hide(),d.hide(),n(".ws-tip-close").click(),!1}),WsVars.IBESkinVer=="3"){_lblRoomId=y.find(".lbRoom").filter(":first").attr("id");_lblRateId=y.find(".lbRate").filter(":first").attr("id");_lblTowerId=y.find(".lbTower").filter(":first").attr("id");vt.wrap(`<button class="btnRoom ws-select ws-custom-dropdown" type="button" role="combobox" aria-haspopup="listbox" aria-labelledby="${_lblRoomId}  ${vt.attr("id")}" aria-expanded="false" ></button>`);dt.wrap(`<button class="btnRate ws-select ws-custom-dropdown" type="button" role="combobox" aria-haspopup="listbox" aria-labelledby="${_lblRateId}  ${dt.attr("id")}" aria-expanded="false" ></button>`);yt.wrap(`<button class="btnTower ws-select ws-custom-dropdown" type="button" role="combobox" aria-haspopup="listbox" aria-labelledby="${_lblTowerId}  ${yt.attr("id")}" aria-expanded="false" ></button>`);vt.removeAttr("role").removeAttr("aria-haspopup").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-expanded").removeAttr("tabindex");dt.removeAttr("role").removeAttr("aria-haspopup").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-expanded").removeAttr("tabindex");yt.removeAttr("role").removeAttr("aria-haspopup").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-expanded").removeAttr("tabindex");vt.removeClass("txRoom ws-select");dt.removeClass("txRate ws-select");yt.removeClass("txTower ws-select");oi=y.find(".btnRoom").filter(":first");ei=y.find(".btnRate").filter(":first");si=y.find(".btnTower").filter(":first");t(oi);t(ei);t(si);oi.click(function(){var t=n(this).attr("aria-expanded")==="true";return n(this).attr("aria-expanded",!t),d.toggle(),nt.hide(),d.find("li.ws-current").find("a").focus(),y.trigger("RoomDropdownShown"),!1});ei.click(function(){var t=n(this).attr("aria-expanded")==="true";return n(this).attr("aria-expanded",!t),nt.toggle(),d.hide(),nt.find("li.ws-current").find("a").focus(),!1});si.click(function(){var t=n(this).attr("aria-expanded")==="true";return n(this).attr("aria-expanded",!t),ft.toggle(),nt.hide(),ft.find("li.ws-current").find("a").focus(),d.hide(),!1});function t(t){n(t).append('<span class="ws-icon-down" aria-hidden="true"><\/span>')}n("body").on("click",function(){ft.removeClass("ws-dropdownHeight");nt.removeClass("ws-dropdownHeight");d.removeClass("ws-dropdownHeight")})}d.on("change",function(){var yt,dt,ei,si,d,t,at,ft,ni,oi,et;n("#dvMessage").text("");nt.find("li").hide();var vt=g.GetRateOL(),a=g.GetRm(),fi=g.GetRc(),ut=!1;if(SHRWindsurfer.Utils.truthy(WsVars.ShowFullCompRoomCostAsComplimentary)&&g.HasCompOnly()&&(ut=!0),yt=kr(),typeof yt!="undefined"&&yt!=null)for(t=0;t<yt.length;t++)c.Page==="ROOMDETAIL"?nt.find("li").filter(function(){return n(this).attr("ref").split("%")[0]==yt[t].RcID}).show():nt.find("li").filter(function(){return n(this).attr("ref")==yt[t].RcID}).show();if(w=vi(),w===null){y.trigger("RoomChange");WsVars.RoomType=a.Name;return}if(dt=!1,ei=WsVars.GuestLoyalty==""?!1:!0,(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL")&&(dt=!ei&&fi!=null&&fi.IsPublicPromo==="True"&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountHiddenForLoyaltyRates),gt.html(""),l=Number(w.Amt),p=Number(w.Taxes),tt=Number(w.TaxVAT),pt=Number(w.Disc),ti=Number(w.Deposit),ii=w.Daily,yi=w.CompDaily,it=w.DiscDaily,ri=w.DiscName,b=w.TaxInfo,ui=w.GUT,wt=0,k=0,si=(l+p)*100,b!=null&&b.length>0)for(t=0;t<b.length;t++)b[t]!=null&&(b[t].AddToDisplayAmount=="True"&&(k+=Number(b[t].Amt)),b[t].ID==="ResortFees"&&(wt=Number(b[t].Amt)));if(pi.attr("src",a.Img).attr("alt",a.Name),ci.html(a.Name),li.html(GetRoomGroupTowerDisp(a)),bi.html(a.Desc),d="",d=WsVars.Config2Flag=="True"?s.Currency+"~":s.Currency,c.Page.length===0)(vt||ut)&&(l+p)*o==0?(h.html(ut?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmountMod((l+p)*o,d,WsVars.UseCurrCode)),h.attr("ref",(l+p)*o));else if(c.Page==="CONFIRM")(vt||ut)&&(l+p)*o==0?(h.html(ut?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmount((l+p)*o,d,WsVars.UseCurrCode)),h.attr("ref",(l+p)*o));else if(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"){var bt=w.Daily.split(","),ct=0,i=0;if(pt===0||it.length===0)for(t=0;t<bt.length;t++)ct=Number(bt[t]),i+=ct;else for(it.indexOf(",")>-1&&(it=it.split(",")),t=0;t<bt.length;t++)ct=Number(bt[t]),i+=ct,ct=Number(bt[t])-Number(it[t])*o;if(at=l*o-i,at>.01&&(i+=at),ft=0,ni=0,b.length>0){for(t=0;t<b.length;t++)ct=Number(b[t].Amt),i+=ct,ft+=ct;at=p*o-ft;at>.01&&(i+=at,ni=at*100);ft*=100}i*=100;dt?(h.html(""),h.attr("ref","")):WsVars.IbeShowTotal=="1"?(ht.html(WsMulti.AvgDailyTotal),h.html(Utils.GetAmountMod(parseInt(i.toFixed(2)/(rt*o))/100,d,WsVars.UseCurrCode)),h.attr("ref",parseInt(i.toFixed(2)/(rt*o))/100)):WsVars.IbeShowTotalExclusive=="1"?(ht.html(WsMulti.AvgDailyRoom),h.html(Utils.GetAmountMod(parseInt((i.toFixed(2)-ft.toFixed(2))/(rt*o))/100,d,WsVars.UseCurrCode)),h.attr("ref",l/(rt*o))):(ht.html(WsMulti.AvgDailyRoom),k!=0?kt.html(WsMulti.AddToDisplayTaxFeeDetails):kt.html(""),h.html(Utils.GetAmountMod(parseInt((i.toFixed(2)-ft.toFixed(2)+tt*100+k*100)/(rt*o))/100,d,WsVars.UseCurrCode)),h.attr("ref",parseInt((i.toFixed(2)-ft.toFixed(2)+tt*100+k*100)/(rt*o))/100))}else(vt||ut)&&ot+st+(l+p)*o==0?(h.html(ut?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmountMod(ot+st+(l+p)*o,d,WsVars.UseCurrCode)),h.attr("ref",ot+st+(l+p)*o));if(WsVars.EnableBNPLProviderID==1&&WsVars.FlexPayUpCode!=""&&WsVars.ShowFlexPayOnCheckoutOnly==0&&h.length>0&&h.attr("ref")!=""&&(lt.html(WsFlexPay.ShowMonthlyRates(h.attr("ref"),!0)),lt.removeClass("hide")),WsVars.IsHiltonPMS=="1"&&c.Page==="CONFIRM"&&g.IsDiff()&&g.AlertRoomTypeChange(!0),dt?(v.html(""),v.attr("ref","")):WsVars.IbeShowTotal==="1"?(vt||ut)&&(l+p)*o==0?(v.html(ut?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"?(v.html(Utils.GetAmount(parseInt(i.toFixed(2))/100,d,WsVars.UseCurrCode)),v.attr("ref",parseInt(i.toFixed(2))/100)):(v.html(Utils.GetAmount((l+p)*o,d,WsVars.UseCurrCode)),v.attr("ref",(l+p)*o)):WsVars.IbeShowTotalExclusive=="1"?(vt||ut)&&(l+k)*o==0?(v.html(ut?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"?(v.html(Utils.GetAmount(parseInt(i.toFixed(2)-ft.toFixed(2))/100,d,WsVars.UseCurrCode)),v.attr("ref",parseInt(i.toFixed(2)-ft.toFixed(2))/100)):(v.html(Utils.GetAmount((l+k)*o,d,WsVars.UseCurrCode)),v.attr("ref",(l+k)*o)):(vt||ut)&&(l+tt+k)*o==0?(v.html(ut?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"?(v.html(Utils.GetAmount((i.toFixed(2)-ft.toFixed(2)+tt*100+k*100-ni.toFixed(2))/100,d,WsVars.UseCurrCode)),v.attr("ref",(i.toFixed(2)-ft.toFixed(2)+tt*100+k*100-ni.toFixed(2))/100)):(v.html(Utils.GetAmount((l+tt+k)*o,d,WsVars.UseCurrCode)),v.attr("ref",(l+tt+k)*o),k!=0?kt.html(WsMulti.AddToDisplayTaxFeeDetails):kt.html("")),WsVars.EnhancedMultiroom.toLowerCase()=="true"){var et=y.data("MyOcc"),hi=et.GetAdults(),ai=et.GetChild1()+et.GetChild2()+et.GetChild3()+et.GetChild4();n(this).parent("div").parent("div").parent("div").find("article").each(function(){n(this).find(".Adults").attr("maxOcc",a.MaxAdult);n(this).find(".Children").attr("maxOcc",a.MaxChild);a.MaxAdult>hi&&n(this).find(".Adults").removeClass("disabled");a.MaxChild>ai&&n(this).find(".Children").removeClass("disabled")});(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL")&&(y.find(".cnAdults,.cnChildren,.cnRooms").hide(),oi=new r(y,u,f,e),oi.Show())}(c.Page!=="RATEDETAIL"||c.Page!=="ROOMDETAIL")&&(et=y.data("MyOcc"),AppendOccupancy(n(this).parent("div").parent("div").parent("div").find("select.cbAdults"),a.MaxAdult),AppendOccupancy(n(this).parent("div").parent("div").parent("div").find("select.cbChild1"),a.MaxChild),AppendOccupancy(n(this).parent("div").parent("div").parent("div").find("select.cbChild2"),a.MaxChild),AppendOccupancy(n(this).parent("div").parent("div").parent("div").find("select.cbChild3"),a.MaxChild),AppendOccupancy(n(this).parent("div").parent("div").parent("div").find("select.cbChild4"),a.MaxChild),n(this).parent("div").parent("div").parent("div").find("select.cbAdults").val(et.GetAdults()),n(this).parent("div").parent("div").parent("div").find("select.cbChild1").val(et.GetChild1()),n(this).parent("div").parent("div").parent("div").find("select.cbChild2").val(et.GetChild2()),n(this).parent("div").parent("div").parent("div").find("select.cbChild3").val(et.GetChild3()),n(this).parent("div").parent("div").parent("div").find("select.cbChild4").val(et.GetChild4()));y.trigger("RoomChange");WsVars.RoomType=a.Name});nt.on("change",function(){var e,nt,et,oi,ci,r,vt,u,t,yt,f,ft,ei,si,gt,ni;if(n("#dvMessage").text(""),WsVars.IBESkinVer==="3"&&d.find("li").removeClass("ws-current").removeAttr("aria-selected"),d.find("li").hide(),e=null,nt=null,c.Page==="ROOMDETAIL"?(e=g.GetRcRoomDetail(),nt=tu()):(e=g.GetRc(),nt=rr()),WsVars.IsRoomGroupTowerEnabled=="1"&&wr(),et=!1,oi=WsVars.GuestLoyalty==""?!1:!0,(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL")&&(et=!oi&&e!=null&&e.IsPublicPromo==="True"&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountHiddenForLoyaltyRates),typeof nt!="undefined"&&nt!=null)for(t=0;t<nt.length;t++)d.find("li").filter(function(){return WsVars.IsRoomGroupTowerEnabled=="1"?n(this).attr("ref")==nt[t].RmID&&n(this).attr("towercode")==bt:n(this).attr("ref")==nt[t].RmID}).show();if(w=c.Page==="ROOMDETAIL"?ki():vi(),w==null){y.trigger("RateChange");WsVars.rateCode=e.Name;return}if(d.find("li").each(function(){if(n(this).css("display")!=="none"&&n(this).attr("ref")==w.RmID)return n(this).addClass("ws-current").attr("aria-selected",!0),!1}),at.html(""),l=Number(w.Amt),p=Number(w.Taxes),tt=Number(w.TaxVAT),pt=Number(w.Disc),ti=Number(w.Deposit),ii=w.Daily,yi=w.CompDaily,it=w.DiscDaily,ri=w.DiscName,b=w.TaxInfo,ui=w.GUT,wt=0,k=0,ct=w.PkgID,ci=(l+p)*100,b!=null&&b.length>0)for(t=0;t<b.length;t++)b[t]!=null&&(b[t].AddToDisplayAmount=="True"&&(k+=Number(b[t].Amt)),b[t].ID==="ResortFees"&&(wt=Number(b[t].Amt)));if(et&&(l=0,p=0),hi.html(e.Name),wi.html(e.Desc),r="",r=WsVars.Config2Flag=="True"?s.Currency+"~":s.Currency,vt=g.GetRateOL(),u=!1,SHRWindsurfer.Utils.truthy(WsVars.ShowFullCompRoomCostAsComplimentary)&&g.HasCompOnly()&&(u=!0),c.Page.length===0)(vt||u)&&(l+p)*o==0?(h.html(u?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmountMod((l+p)*o,r,WsVars.UseCurrCode)),h.attr("ref",(l+p)*o));else if(c.Page==="CONFIRM")(vt||u)&&(l+p)*o==0?(h.html(u?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmount((l+p)*o,r,WsVars.UseCurrCode)),h.attr("ref",(l+p)*o));else if(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"){var dt=w.Daily.split(","),ut=0,i=0;if(pt===0||it.length===0)for(t=0;t<dt.length;t++)ut=et?0:Number(dt[t]),i+=ut;else for(it.indexOf(",")>-1&&(it=it.split(",")),t=0;t<dt.length;t++)ut=et?0:Number(dt[t]),i+=ut,ut=Number(dt[t])-Number(it[t])*o;if(yt=l*o-i,yt>.01&&(i+=yt),f=0,ft=0,b.length>0){for(t=0;t<b.length;t++)ut=Number(b[t].Amt),i+=ut,f+=ut;yt=p*o-f;yt>.01&&(i+=yt,ft=yt*100);f*=100}i*=100;et?(ht.html(""),h.html(""),h.attr("ref","")):WsVars.IbeShowTotal=="1"?(ht.html(WsMulti.AvgDailyTotal),h.html(Utils.GetAmountMod(parseInt(i.toFixed(2)/(rt*o))/100,r,WsVars.UseCurrCode)),h.attr("ref",parseInt(i.toFixed(2)/(rt*o))/100)):WsVars.IbeShowTotalExclusive=="1"?(ht.html(WsMulti.AvgDailyRoom),h.html(Utils.GetAmountMod(parseInt((i.toFixed(2)-f.toFixed(2)-ft.toFixed(2))/(rt*o))/100,r,WsVars.UseCurrCode)),h.attr("ref",parseInt((i.toFixed(2)-f.toFixed(2)-ft.toFixed(2))/(rt*o))/100)):(ht.html(WsMulti.AvgDailyRoom),k!=0?kt.html(WsMulti.AddToDisplayTaxFeeDetails):kt.html(""),h.html(Utils.GetAmountMod(parseInt((i.toFixed(2)-f.toFixed(2)+tt*100+k*100)/(rt*o))/100,r,WsVars.UseCurrCode)),h.attr("ref",parseInt((i.toFixed(2)-f.toFixed(2)+tt*100+k*100)/(rt*o))/100))}else(vt||u)&&ot+st+(l+p)*o==0?(h.html(u?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmountMod(ot+st+(l+p)*o,r,WsVars.UseCurrCode)),h.attr("ref",ot+st+(l+p)*o));if(WsVars.EnableBNPLProviderID==1&&WsVars.FlexPayUpCode!=""&&WsVars.ShowFlexPayOnCheckoutOnly==0&&h.length>0&&h.attr("ref")!=""&&(lt.html(WsFlexPay.ShowMonthlyRates(h.attr("ref"),!0)),lt.removeClass("hide")),WsVars.IbeShowTotal==="1"?(vt||u)&&(l+p)*o==0?(v.html(u?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"?(v.html(Utils.GetAmount(parseInt(i.toFixed(2))/100,r,WsVars.UseCurrCode)),v.attr("ref",parseInt(i.toFixed(2))/100)):(v.html(Utils.GetAmount((l+p)*o,r,WsVars.UseCurrCode)),v.attr("ref",(l+p)*o)):WsVars.IbeShowTotalExclusive=="1"?(vt||u)&&l*o==0?(v.html(u?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"?(v.html(Utils.GetAmount(parseInt(i.toFixed(2)-f.toFixed(2)-ft.toFixed(2))/100,r,WsVars.UseCurrCode)),v.attr("ref",parseInt(i.toFixed(2)-f.toFixed(2)-ft.toFixed(2))/100)):(v.html(Utils.GetAmount(l*o,r,WsVars.UseCurrCode)),v.attr("ref",l*o)):(vt||u)&&(l+tt+k)*o==0?(v.html(u?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"?et?(v.html(""),v.attr("ref","")):(v.html(Utils.GetAmount((i.toFixed(2)-f.toFixed(2)+tt*100+k*100-ft.toFixed(2))/100,r,WsVars.UseCurrCode)),v.attr("ref",(i.toFixed(2)-f.toFixed(2)+tt*100+k*100-ft.toFixed(2))/100)):(v.html(Utils.GetAmount((l+tt+k)*o,r,WsVars.UseCurrCode)),v.attr("ref",(l+tt+k)*o)),ei=fi,fi=g.GetGutPolicy()+g.GetCanPolicy(),ei.length>0)if(ei!=fi){var li=y.data("MyCal"),ai=y.data("MyOcc"),pi=y.data("MySvc");c.Page!=="CONFIRM"||li.IsDiff()||ai.IsDiff()||g.IsDiff()||pi.IsDiff()?g.AlertPolicy(!0):g.AlertPolicy(!1)}else g.AlertPolicy(!1);si=SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig===SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountDisplayedForLoyaltyRates||SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig===SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountHiddenForLoyaltyRates;e.IsMember==!0&&a.IsLoggedIn==!1&&si?n("#buCheckout, #buAddToCart").addClass("ws-shouldlogin").removeClass("ws-nologin").html(WsMulti.BuSignUpIn).attr("href","#ws-modal-loyalty"):(n("#buCheckout, #buAddToCart").removeClass("ws-shouldlogin").addClass("ws-nologin").attr("href","#"),n("#buCheckout").html(WsMulti.BuCheckoutCart),n("#buAddToCart").html(WsMulti.BuAddToCart),WsVars.EnhancedMultiroom.toLowerCase()=="true"&&(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL")&&(gt=GetMultiRoomFromCookie(),typeof gt!="undefined"&&gt!=null&&gt.length>1&&(ni=Number(gt.map(function(n){return n.current}).indexOf(!0))+1,typeof ni!="undefined"&&ni>0&&(n("#buCheckout").html(Utils.Format(SHR.__("BookThisForRoom"),ni)),n("#buAddToCart").html(Utils.Format(SHR.__("BookThisForRoom"),ni))))));e.IsMember=="1"&&n("#buCheckout, #buAddToCart").addClass("ws-loyalty");y.trigger("RateChange");WsVars.rateCode=e.Name});ft.on("change",function(){var t=null,i,r;if(t=rr(),WsVars.IBESkinVer==="3"&&d.find("li").removeClass("ws-current").removeAttr("aria-selected"),d.find("li").hide(),typeof t!="undefined"&&t!=null)for(i=0;i<t.length;i++)d.find("li").filter(function(){return n(this).attr("ref")==t[i].RmID&&n(this).attr("towercode")==bt}).show();n("html").hasClass("WsIbeComboCheckout")?vt.html(""):(d.find("li").each(function(){if(n(this).css("display")!=="none"&&n(this).attr("towercode")==bt)return n(this).addClass("ws-current").attr("aria-selected",!0),vt.html(n(this).text()),ut=Number(n(this).attr("ref")),!1}),r=d.find("li").filter(function(){return n(this).hasClass("ws-current")&&n(this).css("display")!="none"}).length,r===0?(at.html(WsMulti.MsgSelectedRoomNotAvailable),n("#IsError").val(WsMulti.MsgSelectedRoomNotAvailable),ut=0,vt.html("")):(at.html(""),n("#IsError").val("")),d.change(),y.trigger("TowerChange"))});if(y.find(".cbRooms span").click(function(){var u,i,r,t;n(this).addClass("selected");n(this).siblings().removeClass("selected");u=Number(n(this).text());i="";i=WsVars.Config2Flag=="True"?s.Currency+"~":s.Currency;o!==u&&(o=u,r=g.GetRateOL(),t=!1,SHRWindsurfer.Utils.truthy(WsVars.ShowFullCompRoomCostAsComplimentary)&&g.HasCompOnly()&&(t=!0),c.Page.length===0?(r||t)&&(l+p)*o==0?(h.html(t?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmountMod((l+p)*o,i,WsVars.UseCurrCode)),h.attr("ref",(l+p)*o)):c.Page==="CONFIRM"?(r||t)&&(l+p)*o==0?(h.html(t?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmount((l+p)*o,i,WsVars.UseCurrCode)),h.attr("ref",(l+p)*o)):c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"||((r||t)&&ot+st+(l+p)*o==0?(h.html(t?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmountMod(ot+st+(l+p)*o,i,WsVars.UseCurrCode)),h.attr("ref",ot+st+(l+p)*o))),WsVars.EnableBNPLProviderID==1&&WsVars.FlexPayUpCode!=""&&WsVars.ShowFlexPayOnCheckoutOnly==0&&h.length>0&&h.attr("ref")!=""&&(lt.html(WsFlexPay.ShowMonthlyRates(h.attr("ref"),!0)),lt.removeClass("hide")),WsVars.IbeShowTotal==="1"?(r||t)&&(l+p)*o==0?(v.html(t?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):(v.html(Utils.GetAmount((l+p)*o,i,WsVars.UseCurrCode)),v.attr("ref",(l+p)*o)):WsVars.IbeShowTotalExclusive=="1"?(r||t)&&l*o==0?(v.html(t?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):(v.html(Utils.GetAmount(l*o,i,WsVars.UseCurrCode)),v.attr("ref",l*o)):(r||t)&&(l+tt+k)*o==0?(v.html(t?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):(v.html(Utils.GetAmount((l+tt+k)*o,i,WsVars.UseCurrCode)),v.attr("ref",(l+tt+k)*o)),y.trigger("RoomsChanged"),WsVars.Rooms=u,UpdateUrlParams());n(".ws-tip-close").click()}),pr.change(function(){tr="N";n(this).prop("checked")==!0&&(tr="Y");y.trigger("InsuranceChanged")}),s!=null){for(s.CrsID!=null&&(gi=s.CrsID),ut=s.RmID,et=s.RcID,ct=s.PkgID,ur=s.GrpID,gr=s.Group,cr=s.Promo,l=s.Amt,p=s.Taxes,tt=s.TaxVAT,pt=s.Disc,ti=s.Deposit,wt=s.ResortFee,s.hasOwnProperty("Rooms")&&(o=s.Rooms),s.hasOwnProperty("Daily")&&(ii=s.Daily.join()),s.hasOwnProperty("DiscDaily")&&(it=s.DiscDaily.join()),b=s.TaxInfo,ui=s.Guar,fi=s.Policy+s.Cancel,tr=s.GetIns,or=s.InsToken,(c.Page==="CART"||c.Page==="CONFIRM")&&(s.RoomImg=pi.attr("src"),s.RoomName=ci.html(),s.RoomDesc=encodeURIComponent(bi.html()),s.RateName=hi.html(),s.RateDesc=encodeURIComponent(wi.html())),i=0,ai=0,t=0;t<s.Svcs.length;t++)i+=s.Svcs[t].Amt*s.Svcs[t].Qty,ai+=s.Svcs[t].Taxes*s.Svcs[t].Qty;if(ot=i,st=ai,y.find(".cbRooms span").filter(function(){return Number(n(this).text())===o}).addClass("selected"),WsVars.IBESkinVer=="3")y.find(".cbRooms span").on("keydown",function(t){(t.keyCode==13||t.key==="Enter")&&n(this).click()})}},sr=function(t){var du="",kf="",gu="",or,tu=!1,au=a.IsLoggedIn==="1",ve=SHRWindsurfer.WsLoyaltyHandler.hasActiveLoyaltyProgram(),df=!1,gf=!1,ur,nf,tf,ne,ru,vu,rf,uf,uu,ff,ef,yu,sf,fr,pe,pu,wu,hf,eu,bu,e,ku,ni,af,ce,ai,dr,di,r,gr,tr,er,su,hu,vf,nu,iu,pr,wf,ae,bf,cu,lu;for(ve&&(df=SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig!==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.LoginRequiredForLoyaltyRates&&gi.length==0,gf=SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig===SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.DontShowSignInSignUpForLoyaltyRates&&gi.length==0),ur=Utils.GetParam("showQualifiedRates"),typeof ur!==undefined&&ur!=null?ur=ur.toLowerCase()==="true":(ur=JSON.parse(n.cookie("showQualifiedRate_"+s.HotelID)),(typeof ur=="undefined"||ur==null)&&(ur=!1)),WSCCONSENT.SetCookie("showQualifiedRate_"+WsVars.HotelID,ur),r=0;r<a.RateCodes.length;r++)(nf=a.RateCodes[r].IsMember==="0",tf=a.RateCodes[r].RcID==s.RcID&&gi.length>0,ur||a.RateCodes[r].PkgID!="0"||typeof a.RateCodes[r].IsQualifiedRate=="undefined"||a.RateCodes[r].IsQualifiedRate==null||a.RateCodes[r].IsQualifiedRate.toLowerCase()!="true")&&(nf||au||tf||df)&&(c.Page==="ROOMDETAIL"?du+=Utils.Format('<li ref="{1}" role="option" id="rate_{1}"><a href="#" ref="{1}">{0}<\/a><\/li>',a.RateCodes[r].Name,a.RateCodes[r].RcID+"%"+a.RateCodes[r].PkgID):(nf||au||tf||gf)&&(du+=Utils.Format('<li ref="{1}" role="option" id="rate_{1}"><a href="#" ref="{1}">{0}<\/a><\/li>',a.RateCodes[r].Name,a.RateCodes[r].RcID)));for(r=0;r<a.RoomTypes.length;r++)kf+=WsVars.IsRoomGroupTowerEnabled=="1"?Utils.Format('<li ref="{1}" role="option" id="room_{1}" towercode="{2}"><a href="#" ref="{1}">{0}<\/a><\/li>',a.RoomTypes[r].Name,a.RoomTypes[r].RmID,a.RoomTypes[r].RmGroupTowerCode):Utils.Format('<li ref="{1}" role="option" id="room_{1}"><a href="#" ref="{1}">{0}<\/a><\/li>',a.RoomTypes[r].Name,a.RoomTypes[r].RmID);if(lr=a.CheckInTime,ar=a.CheckOutTime,vr=a.GenPolicy,yr=a.PetPolicy,vt.show(),dt.show(),d.hide().html(kf),nt.hide().html(du),d.find("li").filter(function(){return Number(n(this).attr("ref"))===ut}).addClass("ws-current").attr("aria-selected",!0),WsVars.IsRoomGroupTowerEnabled=="1"){ne=s.HotelID;let t=[];if(n.ajax({"async":!1,type:"POST",url:"xml/GetRoomGroups.aspx?hotelID="+ne+"&langID="+WsVars.LangID,dataType:"json",cache:!1,success:function(n){if(typeof n.requestInfo!="undefined"&&n.roomGroups!=null&&n.roomGroups.length>0)for(let i=0;i<n.roomGroups.length;i++)n.roomGroups[i].purpose.replace(/\s/g,"").split(",").indexOf("tower")>-1&&t.push({code:n.roomGroups[i].code,name:n.roomGroups[i].name})},error:function(n){console.log(n)}}),gu+=Utils.Format('<li ref="{1}" role="option" id="notower"><a href="#" ref="{1}" class="ws-towername-blank">{0}<\/a><\/li>',"",""),typeof t!="undefined"&&t!=null)for(r=0;r<t.length;r++)ru=t[r],gu+=Utils.Format('<li ref="{1}" role="option" id="tower_{1}"><a href="#" ref="{1}">{0}<\/a><\/li>',ru.name,ru.code),typeof yt!="undefined"&&yt!=null&&yt.attr("ref")!=""&&bt==""&&ru.code==yt.attr("ref")&&(bt=ru.code);yt.show();ft.hide().html(gu);wr();ft.find("li").filter(function(){return n(this).attr("ref")===bt}).addClass("ws-current").attr("aria-selected",!0)}for(c.Page==="ROOMDETAIL"?(vu=0,nt.find("li").filter(function(){return vu==0&&(vu=n(this).attr("ref").split("%")[1]),n(this).attr("ref").split("%")[1]==vu&&n(this).hasClass("ws-current")?n(this).attr("ref").split("%")[0]==et:void 0}).addClass("ws-current").attr("aria-selected",!0)):nt.find("li").filter(function(){return n(this).attr("ref")==et}).addClass("ws-current").attr("aria-selected",!0),d.find("li").hide(),nt.find("li").hide(),or=rr(),r=0;r<or.length;r++)d.find("li").filter(function(){return WsVars.IsRoomGroupTowerEnabled=="1"&&c.Page!=="RATEDETAIL"?n(this).attr("ref")==or[r].RmID&&n(this).attr("towercode")==bt:n(this).attr("ref")==or[r].RmID}).show();if(c.Page.length===0||c.Page==="CONFIRM"||c.Page==="ROOMDETAIL"){for(or=kr(),r=0;r<or.length;r++)c.Page==="ROOMDETAIL"?nt.find("li").filter(function(){return n(this).attr("ref").split("%")[0]==or[r].RcID}).show():nt.find("li").filter(function(){return n(this).attr("ref")==or[r].RcID}).show();if(rf=d.find("li").filter(function(){return n(this).hasClass("ws-current")&&n(this).css("display")!="none"}).length,uf=nt.find("li").filter(function(){return n(this).hasClass("ws-current")}).length,rf===0){if(uu=!1,t.TmpRooms!=null){var fu=y.data("MyOcc"),te=fu.GetAdults(),ie=fu.GetChild1()+fu.GetChild2()+fu.GetChild3()+fu.GetChild4(),ye=te+ie;for(r=0;r<t.TmpRooms.length;r++)if(t.TmpRooms[r].RmID===ut){te>t.TmpRooms[r].MaxAd?(at.html(WsMulti.MsgAdOcc),uu=!0):ie>t.TmpRooms[r].MaxCh?(at.html(WsMulti.MsgChOcc),uu=!0):ye>t.TmpRooms[r].MaxOc&&(at.html(WsMulti.MsgMxOcc),uu=!0);break}}uu||at.html(WsMulti.MsgSelectedRoomNotAvailable);n("#IsError").val(WsMulti.MsgSelectedRoomNotAvailable)}else at.html(""),n("#IsError").val("");uf===0?(gt.html(WsMulti.MsgSelectedRateNotAvailable),n("#IsError").val(WsMulti.MsgSelectedRateNotAvailable)):(gt.html(""),n("#IsError").val(""));c.Page.length===0&&uf>0&&rf===0&&d.find("li").each(function(){if(n(this).css("display")!=="none"){if(n(this).addClass("ws-current").attr("aria-selected",!0),vt.html(n(this).text()),ut=Number(n(this).attr("ref")),at.html(""),WsVars.EnhancedMultiroom.toLowerCase()=="true"){let f={MaxAd:WsVars.AdultOccupancyAllowed,MaxCh:WsVars.ChildrenOccupancyAllowed},e=t.TmpRooms.filter(function(n){return n.RmID==ut});typeof e!="undefined"&&e!=null&&e.length>0&&(f=e[0]);var i=y.data("MyOcc"),r=i.GetAdults(),u=i.GetChild1()+i.GetChild2()+i.GetChild3()+i.GetChild4();n(this).parent("ul").parent("div").parent("div").parent("div").find("article").each(function(){n(this).find(".Adults").attr("maxOcc",f.MaxAd);n(this).find(".Children").attr("maxOcc",f.MaxCh);f.MaxAd>r&&n(this).find(".Adults").removeClass("disabled");f.MaxCh>u&&n(this).find(".Children").removeClass("disabled")})}return tu=!0,!1}})}else ut===0?d.find("li").each(function(){if(n(this).css("display")!=="none")return n(this).addClass("ws-current").attr("aria-selected",!0),vt.html(n(this).text()),ut=Number(n(this).attr("ref")),!1}):(ff=0,ef=!1,d.find("li").each(function(){if(n(this).css("display")!=="none"&&(ff=Number(n(this).attr("ref")),ff===ut))return n(this).addClass("ws-current").attr("aria-selected",!0),ef=!0,!1}),ef===!1&&d.find("li").each(function(){if(n(this).css("display")!=="none")return n(this).addClass("ws-current").attr("aria-selected",!0),vt.html(n(this).text()),ut=Number(n(this).attr("ref")),tu=!0,!1}));if(c.Page==="ROOMDETAIL"){var re=0,ue=!1,fe=0,sr=[];nt.find("li").each(function(){if(n(this).css("display")!=="none"&&(sr=n(this).attr("ref").split("%"),re=Number(sr[0]),fe=Number(sr[1]),re==et&&fe==ct))return n(this).addClass("ws-current").attr("aria-selected",!0),ue=!0,!1});ue===!1&&(yu=[],nt.find("li").each(function(){if(n(this).css("display")!=="none")return n(this).addClass("ws-current").attr("aria-selected",!0),dt.html(n(this).text()),yu=n(this).attr("ref").split("%"),et=Number(yu[0]),ct=Number(yu[1]),tu=c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"?!1:!0,!1}))}if(w=c.Page==="ROOMDETAIL"?ki():vi(),nr=c.Page==="ROOMDETAIL"?g.GetRcRoomDetail():g.GetRc(),sf=WsVars.GuestLoyalty==""?!1:!0,fr=!1,(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL")&&(fr=!sf&&nr!=null&&nr.IsPublicPromo==="True"&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountHiddenForLoyaltyRates),w===null)l=0,p=0,tt=0,pt=0,ti=0,wt=0,ii="",it="",ri="",b=[],ui="GX",yi="",h.html("&nbsp;"),v.html(""),h.attr("ref",""),v.attr("ref",""),lt.html("");else{if(l=Number(w.Amt),p=Number(w.Taxes),tt=Number(w.TaxVAT),pt=Number(w.Disc),ti=Number(w.Deposit),ii=w.Daily,yi=w.CompDaily,it=w.DiscDaily,ri=w.DiscName,b=w.TaxInfo,ui=w.GUT,wt=0,k=0,pe=(l+p)*100,b!=null&&b.length>0)for(r=0;r<b.length;r++)b[r]!=null&&(b[r].AddToDisplayAmount=="True"&&(k+=Number(b[r].Amt)),b[r].ID==="ResortFees"&&(wt=Number(b[r].Amt)));if(w.PkgInc!=null&&w.PkgInc.length>0){for(n(".ws-inclusions").show(),pu=Utils.Format('<h2 class="emphasis">{0}<\/h2>',WsMulti.IncludedAddons),wu=[],r=0;r<w.PkgInc.length;r++)if(pu+=Utils.Format('<h3>{0}<\/h3><p class="ws-inclusion-summary">{1}<\/p>',w.PkgInc[r].Name,w.PkgInc[r].Desc),WsVars.EnableConciergeService=="1"&&w.PkgInc[r].ConciergeTransportSegment!=""){if(hf="",eu=WSMAIN.Items[ir].ConciergeTransportBookingRequests,tripInfo=jQuery.parseJSON(w.PkgInc[r].ConciergeTransportSegment),tripInfo!=null&&tripInfo.length>0){var ee="",oe="",hr={},se=0,cf="",lf="",he="";for(bu=0;bu<tripInfo.length;bu++)if(e=tripInfo[bu],e.Journeys!=null&&e.Journeys.length>0)for(ku=0;ku<e.Journeys.length;ku++)ni=e.Journeys[ku],eu!=null&&eu.length>0&&(af=eu.find(n=>n.ServiceItemId===e.InclusionID),af&&af.BookingSegmentIds.includes(e.Id)&&(lf=ni.FareBrandName,cf=ni.DisplayDepartureDate,he="selected")),se===0&&(ce=[e.Id],hr.BookingSegmentIds=ce,hr.Amount=e.TotalAmount,hr.Origin=ni.Origin.Code,hr.Destination=ni.Destination.Code,hr.Departure=ni.DepartureDate,hr.ServiceItemId=e.InclusionID,cf=ni.DisplayDepartureDate,lf=ni.FareBrandName),oe+='<li role="option" ref="'+e.Id+'"><a href="#" ref="'+e.Id+'" amt="'+e.TotalAmount+'" org="'+ni.Origin.Code+'" dest="'+ni.Destination.Code+'" displayDepart="'+ni.DisplayDepartureDate+'" incID="'+e.InclusionID+'" depart="'+ni.DepartureDate+'">'+ni.FareBrandName+" - "+ni.DisplayDepartureDate+"<\/a><\/li>",se++;(eu==null||he=="")&&hr!=null&&wu.push(hr);ee='<div class="ws-select-box"><span id="txDepart" class="txDepart ws-select" aria-haspopup="listbox">'+lf+" - "+cf+'<\/span><ul class="cbDepart ws-select-options" role="listbox" aria-labelledby="txDepart">'+oe+"<\/ul><\/div>";hf+=ee}pu+=hf}n(".ws-inclusions").html(pu);WsVars.EnableConciergeService=="1"&&(wu.length>0&&(WSMAIN.Items[ir].ConciergeTransportBookingRequests=wu),i(y,s,ir))}else n(".ws-inclusions").html(""),n(".ws-inclusions").hide();if(ai="",ai=WsVars.Config2Flag=="True"?s.Currency+"~":s.Currency,dr=g.GetRateOL(),di=!1,SHRWindsurfer.Utils.truthy(WsVars.ShowFullCompRoomCostAsComplimentary)&&g.HasCompOnly()&&(di=!0),c.Page.length===0)(dr||di)&&(l+p)*o==0?(h.html(di?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmountMod((l+p)*o,ai,WsVars.UseCurrCode)),h.attr("ref",(l+p)*o));else if(c.Page==="CONFIRM")(dr||di)&&(l+p)*o==0?(h.html(di?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmount((l+p)*o,ai,WsVars.UseCurrCode)),h.attr("ref",(l+p)*o));else if(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"){var ou=w.Daily.split(","),cr=0,f=0;if(pt===0||it.length===0)for(r=0;r<ou.length;r++)cr=Number(ou[r]),f+=cr;else for(it.indexOf(",")>-1&&(it=it.split(",")),r=0;r<ou.length;r++)cr=Number(ou[r]),f+=cr,cr=Number(ou[r])-Number(it[r])*o;if(gr=l*o-f,gr>.01&&(f+=gr),tr=0,er=0,b.length>0){for(r=0;r<b.length;r++)cr=Number(b[r].Amt),f+=cr,tr+=cr;gr=p*o-tr;gr>.01&&(f+=gr,er=gr*100);tr*=100}f*=100;fr?(ht.html(""),h.html(""),h.attr("ref","")):WsVars.IbeShowTotal=="1"?(ht.html(WsMulti.AvgDailyTotal),h.html(Utils.GetAmountMod(parseInt(f.toFixed(2)/(rt*o))/100,ai,WsVars.UseCurrCode)),h.attr("ref",parseInt(f.toFixed(2)/(rt*o))/100)):WsVars.IbeShowTotalExclusive=="1"?(ht.html(WsMulti.AvgDailyRoom),h.html(Utils.GetAmountMod(parseInt((f.toFixed(2)-tr.toFixed(2)-er.toFixed(2))/(rt*o))/100,ai,WsVars.UseCurrCode)),h.attr("ref",parseInt((f.toFixed(2)-tr.toFixed(2)-er.toFixed(2))/(rt*o))/100)):(ht.html(WsMulti.AvgDailyRoom),k!=0?kt.html(WsMulti.AddToDisplayTaxFeeDetails):kt.html(""),h.html(Utils.GetAmountMod(parseInt((f.toFixed(2)-tr.toFixed(2)+tt*100+k*100-er.toFixed(2))/(rt*o))/100,ai,WsVars.UseCurrCode)),h.attr("ref",parseInt((f.toFixed(2)-tr.toFixed(2)+tt*100+k*100-er.toFixed(2))/(rt*o))/100))}else fr?(h.html(""),h.attr("ref","")):(dr||di)&&ot+st+(l+p)*o==0?(h.html(di?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmountMod(ot+st+(l+p)*o,ai,WsVars.UseCurrCode)),h.attr("ref",ot+st+(l+p)*o));if(WsVars.EnableBNPLProviderID==1&&WsVars.FlexPayUpCode!=""&&WsVars.ShowFlexPayOnCheckoutOnly==0&&h.length>0&&h.attr("ref")!=""&&(lt.html(WsFlexPay.ShowMonthlyRates(h.attr("ref"),!0)),lt.removeClass("hide")),WsVars.IbeShowTotal==="1"?fr?(v.html(""),v.attr("ref","")):(dr||di)&&(l+p)*o==0?(v.html(di?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"?(v.html(Utils.GetAmount(parseInt(f.toFixed(2))/100,ai,WsVars.UseCurrCode)),v.attr("ref",parseInt(f.toFixed(2))/100)):(v.html(Utils.GetAmount((l+p)*o,ai,WsVars.UseCurrCode)),v.attr("ref",(l+p)*o)):WsVars.IbeShowTotalExclusive=="1"?fr?(v.html(""),v.attr("ref","")):(dr||di)&&l*o==0?(v.html(di?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"?(v.html(Utils.GetAmount(parseInt(f.toFixed(2)-tr.toFixed(2)-er.toFixed(2))/100,ai,WsVars.UseCurrCode)),v.attr("ref",parseInt(f.toFixed(2)-tr.toFixed(2)-er.toFixed(2))/100)):(v.html(Utils.GetAmount(l*o,ai,WsVars.UseCurrCode)),v.attr("ref",l*o)):fr?(v.html(""),v.attr("ref","")):(dr||di)&&(l+tt+k)*o==0?(v.html(di?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"?(v.html(Utils.GetAmount((f.toFixed(2)-tr.toFixed(2)+tt*100+k*100-er.toFixed(2))/100,ai,WsVars.UseCurrCode)),v.attr("ref",(f.toFixed(2)-tr.toFixed(2)+tt*100+k*100-er.toFixed(2))/100)):(v.html(Utils.GetAmount((l+tt+k)*o,ai,WsVars.UseCurrCode)),v.attr("ref",(l+tt+k)*o)),su=null,hu=g.GetRm(),su=c.Page==="ROOMDETAIL"?g.GetRcRoomDetail():g.GetRc(),fr&&(ht.html(""),h.html(""),h.attr("ref",""),lt.html("")),pi.attr("src",hu.Img),ci.html(hu.Name),li.html(GetRoomGroupTowerDisp(hu)),bi.html(hu.Desc),hi.html(su.Name),wi.html(su.Desc),vf=fi,fi=g.GetGutPolicy()+g.GetCanPolicy(),vf.length>0)if(vf!=fi){var we=y.data("MyCal"),be=y.data("MyOcc"),ke=y.data("MySvc");c.Page!=="CONFIRM"||we.IsDiff()||be.IsDiff()||g.IsDiff()||ke.IsDiff()?g.AlertPolicy(!0):g.AlertPolicy(!1);y.trigger("PolicyChanged")}else g.AlertPolicy(!1)}var yf=document.getElementById("IsDateChange"),pf=document.getElementById("IsOccChange"),u=Number(n(".ws-modifying:first").attr("ix"));if(yf&&yf.value==="true"||pf&&pf.value==="true")try{nu="";let n="",t="",i="",r="",f="",e="";if(iu="cart_room_rate",WSMAIN.Items!=null&&WsVars.CartItems!=null&&WSMAIN.Items.length>0&&WsVars.CartItems.length>0){let s=0,h=0,o=0;for(let n=0;n<WSMAIN.Items.length;n++)if(o=WSMAIN.Items[n].Amt??0,s+=o,WSMAIN.Items[n].Svcs!=null&&WSMAIN.Items[n].Svcs.length>0){let t=WSMAIN.Items[n].Svcs;for(let i=0;i<t.length;i++){n==WSMAIN.Ix&&(h+=t[i].Amt-t[i].TaxVAT);let r=t[i].Amt-t[i].TaxVAT;s+=r}}typeof WSMAIN.Items[u].Promo!="undefined"&&WSMAIN.Items[u].Promo!=""?nu=WSMAIN.Items[u].Promo:typeof WSMAIN.Items[u].Voucher!="undefined"&&WSMAIN.Items[u].Voucher!=""?nu=WSMAIN.Items[u].Voucher:typeof WSMAIN.Items[u].Access!="undefined"&&WSMAIN.Items[u].Access!=""?nu=WSMAIN.Items[u].Access:typeof WSMAIN.Items[u].Iata!="undefined"&&WSMAIN.Items[u].Iata!=""&&(nu=WSMAIN.Items[u].Iata);WSMAIN.Items[u].PkgID>0?(i=WSMAIN.Items[u].PkgCode,r=WSMAIN.Items[u].PkgName):WSMAIN.Items[u].GrpID>0?(f=WSMAIN.Items[u].GrpCode,e=WSMAIN.Items[u].GrpName):(n=WSMAIN.Items[u].RateCode,t=WSMAIN.Items[u].RateType);iu="cart_room_rate";pr={index:0,itemListId:iu,roomName:WSMAIN.Items[u].RoomType,rateName:t,roomCode:WSMAIN.Items[u].RoomCode,rateCode:n,pkgCode:i,pkgName:r,grpCode:f,grpName:e,hotelCode:WsVars.PCode,hotelId:Number(WsVars.HotelID),hotelName:WsVars.HotelName,nights:WSMAIN.Items[u].Nights,dt1:WsVars.DayIn,adults:WSMAIN.Items[u].Adults,child1:WSMAIN.Items[u].Child1,child2:WSMAIN.Items[u].Child2,child3:WSMAIN.Items[u].Child3,child4:WSMAIN.Items[u].Child4,price:o,addonAmt:h,coupon:nu,category:"Room Rate",itemListId:iu,currency:WsVars.Currency,abSetting:WsVars.ABSetting};WsVars.HgID>0&&(pr.hgId=WsVars.HgID,WsVars.HotelGroupCode&&(pr.hotelGroupCode=WsVars.HotelGroupCode));SHR.TrkLib.RemoveFromCart(pr);var de=Utils.GetDateFromY2K(mycal.GetArrival()),le=Utils.DateFormat(de,WsDtFm[Number(WsVars.LangID)]),ge=Utils.GetDateFromY2K(mycal.GetDeparture()),no=Utils.DateFormat(ge,WsDtFm[Number(WsVars.LangID)]);if(WSMAIN.Items!=null&&WSMAIN.Items.length>0){WSMAIN.Items[u].Amt=l;WSMAIN.Items[u].Taxes=p;let o=0,s=0;for(let n=0;n<WSMAIN.Items.length;n++){let t=WSMAIN.Items[n].Amt??0;if(o+=t,WSMAIN.Items[n].Svcs!=null&&WSMAIN.Items[n].Svcs.length>0){let t=WSMAIN.Items[n].Svcs;for(let i=0;i<t.length;i++){n==WSMAIN.Ix&&(s+=t[i].Amt-t[i].TaxVAT);let r=t[i].Amt-t[i].TaxVAT;o+=r}}}n="";t="";i="";r="";f="";e="";WSMAIN.Items[u].PkgID>0?(i=WSMAIN.Items[u].PkgCode,r=WSMAIN.Items[u].PkgName):WSMAIN.Items[u].GrpID>0?(f=WSMAIN.Items[u].GrpCode,e=WSMAIN.Items[u].GrpName):(n=WSMAIN.Items[u].RateCode,t=WSMAIN.Items[u].RateType);pr={index:0,itemListId:iu,roomName:WSMAIN.Items[u].RoomType,rateName:t,roomCode:WSMAIN.Items[u].RoomCode,rateCode:n,pkgCode:i,pkgName:r,grpCode:f,grpName:e,hotelCode:WsVars.PCode,hotelId:Number(WsVars.HotelID),hotelName:WsVars.HotelName,nights:rt,dt1:le,adults:WsVars.Adults,child1:WsVars.Child1,child2:WsVars.Child2,child3:WsVars.Child3,child4:WsVars.Child4,price:l,addonAmt:s,tax:p,coupon:nu,category:"Room Rate",itemListId:iu,currency:WsVars.Currency,totalprice:o,abSetting:WsVars.ABSetting};WsVars.HgID>0&&(pr.hgId=WsVars.HgID,WsVars.HotelGroupCode&&(pr.hotelGroupCode=WsVars.HotelGroupCode));SHR.TrkLib.AddToCart(pr)}WsVars.DayIn=GetDateFormatByLangID(le,Number(WsVars.LangID));WsVars.DayOut=GetDateFormatByLangID(no,Number(WsVars.LangID));pf.value="false";yf.value="false"}}catch(to){console.log(to)}if(d.find("a").click(function(){var t=Number(n(this).attr("ref"));return(d.hide(),ut===t)?!1:(at.html(""),vt.html(n(this).text()),ut=t,d.find("li").removeClass("ws-current"),d.find("li").removeAttr("aria-selected"),d.removeAttr("aria-activedescendant"),d.find("li").filter(function(){return Number(n(this).attr("ref"))===ut}).addClass("ws-current").attr("aria-selected",!0),d.attr("aria-activedescendant","room_"+ut),WsVars.IBESkinVer=="3"&&(oi.removeAttr("aria-activedescendant"),oi.attr("aria-activedescendant","room_"+ut),oi.focus(),d.removeClass("ws-dropdownHeight")),d.trigger("change"),!1)}),nt.find("a").click(function(){var t=Number(n(this).attr("ref")),i="0";if(c.Page==="ROOMDETAIL"?(sr=n(this).attr("ref").split("%"),t=Number(sr[0]),i=Number(sr[1])):t=Number(n(this).attr("ref")),nt.hide(),et===t)if(c.Page==="ROOMDETAIL"){if(ct===i)return!1;ct=Number(sr[1])}else return!1;else c.Page==="ROOMDETAIL"&&(ct=Number(sr[1]));return gt.html(""),dt.html(n(this).text()),et=t,nt.find("li").removeClass("ws-current"),nt.find("li").removeAttr("aria-selected"),nt.removeAttr("aria-activedescendant"),c.Page==="ROOMDETAIL"?nt.find("li").filter(function(){if(n(this).attr("ref").split("%")[1]==ct)return n(this).attr("ref").split("%")[0]==et}).addClass("ws-current").attr("aria-selected",!0):nt.find("li").filter(function(){return Number(n(this).attr("ref"))===et}).addClass("ws-current").attr("aria-selected",!0),nt.attr("aria-activedescendant","rate_"+et),WsVars.IBESkinVer=="3"&&(ei.removeAttr("aria-activedescendant"),ei.attr("aria-activedescendant","rate_"+et),ei.focus(),nt.removeClass("ws-dropdownHeight")),nt.trigger("change"),!1}),ft.find("a").click(function(){var t=n(this).attr("ref");return ft.hide(),_msgTower.html(""),yt.html(n(this).text()),yt.attr("ref",t),bt=t,ft.find("li").removeClass("ws-current"),ft.find("li").removeAttr("aria-selected"),ft.removeAttr("aria-activedescendant"),ft.find("li").filter(function(){return n(this).attr("ref")===bt}).addClass("ws-current").attr("aria-selected",!0),ft.attr("aria-activedescendant","tower_"+bt),WsVars.IBESkinVer=="3"&&(si.removeAttr("aria-activedescendant"),si.attr("aria-activedescendant","tower_"+bt),si.focus(),ft.removeClass("ws-dropdownHeight")),ft.trigger("change"),!1}),c.Page==="CONFIRM"&&IsAddonPriorModStart&&(wf=this.dvs=n(".ws-product-item"),wf.addClass("ws-modifying"),n("#buModifyResv").removeClass("ws-disabled"),ae=wf.find(".ws-modify-options").filter(":first"),ae.addClass("ws-show-this"),_isOpen=!0),c.Page==="PROMO"||c.Page==="RATEDETAIL"){if(or.length===0){br("");y.trigger("AvailError",["","PROMO"]);return}tu===!0&&y.trigger("Preselect")}else w===null?y.trigger("AvailError",["",c.Page]):tu===!0&&y.trigger("Preselect");bf=SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig===SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountDisplayedForLoyaltyRates||SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig===SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountHiddenForLoyaltyRates;(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL")&&(fr=!sf&&a!=null&&a.RateCodes!=null&&a.RateCodes[0]!=null&&a.RateCodes[0].IsPublicPromo=="True"&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountHiddenForLoyaltyRates);a.RateCodes[0].IsMember!=="1"||au||!bf||fr?(n("#buCheckout, #buAddToCart").removeClass("ws-shouldlogin").addClass("ws-nologin").attr("href","#"),n("#buCheckout").html(WsMulti.BuCheckoutCart),n("#buAddToCart").html(WsMulti.BuAddToCart),WsVars.EnhancedMultiroom.toLowerCase()=="true"&&(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL")&&(cu=GetMultiRoomFromCookie(),typeof cu!="undefined"&&cu!=null&&cu.length>1&&(lu=Number(cu.map(function(n){return n.current}).indexOf(!0))+1,typeof lu!="undefined"&&lu>0&&(su.IsMember!=="1"||au||!bf||fr?(n("#buCheckout, #buAddToCart").removeClass("ws-shouldlogin").addClass("ws-nologin").attr("href","#"),n("#buCheckout").html(Utils.Format(SHR.__("BookThisForRoom"),lu)),n("#buAddToCart").html(Utils.Format(SHR.__("BookThisForRoom"),lu))):n("#buCheckout, #buAddToCart").addClass("ws-shouldlogin ws-loyalty").removeClass("ws-nologin").html(WsMulti.BuSignUpIn).attr("href","#ws-modal-loyalty"))))):n("#buCheckout, #buAddToCart").addClass("ws-shouldlogin").removeClass("ws-nologin").html(WsMulti.BuSignUpIn).attr("href","#ws-modal-loyalty");a.RateCodes[0].IsMember==="1"&&n("#buCheckout, #buAddToCart").addClass("ws-loyalty");y.trigger("AvailSuccess",[a])},wr=function(){var t=[],i=null,r;if(i=rr(),typeof i!="undefined"&&i!=null&&typeof ft!="undefined"&&ft!=null)for(r=0;r<i.length;r++)ft.find("li").filter(function(){var u=n(this).attr("ref");!t.includes(u)&&d.find("li").filter(function(){return n(this).attr("ref")==i[r].RmID&&n(this).attr("towercode")==u}).length>0&&t.push(u)});if(ft.find("li").hide(),typeof t!="undefined"&&t!=null)for(j=0;j<t.length;j++)ft.find("li").filter(function(){return n(this).attr("ref")==t[j]}).show()},br=function(n){l=0;p=0;pt=0;ti=0;wt=0;ii="";it="";ri="";b=[];(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL")&&ht.html("");h.html("&nbsp;");v.html("");h.attr("ref","");v.attr("ref","");d.hide().html("");nt.hide().html("");at.html(n);gt.html("");lt.html("")},rr=function(){for(var t=[],n=0;n<a.RoomStays.length;n++)Number(a.RoomStays[n].RcID)===et&&t.push(a.RoomStays[n]);return t},tu=function(){var t,n;if(a===null||a.RoomStays==null)return null;for(t=[],n=0;n<a.RoomStays.length;n++)if(a.RoomStays[n].PkgID>0)if(a.RoomStays[n].PkgID==ct)t.push(a.RoomStays[n]);else continue;else a.RoomStays[n].RcID==et&&t.push(a.RoomStays[n]);return t},kr=function(){var t,n;if(a===null||a.RoomStays==null)return null;for(t=[],n=0;n<a.RoomStays.length;n++)Number(a.RoomStays[n].RmID)===ut&&t.push(a.RoomStays[n]);return t},vi=function(){if(a===null||a.RoomStays==null)return null;for(var n=0;n<a.RoomStays.length;n++)if(Number(a.RoomStays[n].RmID)===ut&&Number(a.RoomStays[n].RcID)===et)return a.RoomStays[n];return null},ki=function(){if(a===null||a.RoomStays==null)return null;for(var n=0;n<a.RoomStays.length;n++){if(a.RoomStays[n].PkgID>0){if(a.RoomStays[n].RmID==ut&&a.RoomStays[n].PkgID==ct)return a.RoomStays[n];continue}if(typeof ct=="undefined"&&(ct=0),a.RoomStays[n].RmID==ut&&a.RoomStays[n].RcID==et&&a.RoomStays[n].PkgID==ct)return a.RoomStays[n]}return null};this.GetRm=function(){if(a===null||a.RoomTypes==null)return null;for(var n=0;n<a.RoomTypes.length;n++)if(Number(a.RoomTypes[n].RmID)===ut)return a.RoomTypes[n];return null};this.GetRc=function(){if(a===null||a.RateCodes==null)return null;for(var n=0;n<a.RateCodes.length;n++)if(Number(a.RateCodes[n].RcID)===et)return a.RateCodes[n];return null};this.GetRcRoomDetail=function(){if(a===null||a.RateCodes==null)return null;for(var n=0;n<a.RateCodes.length;n++)if(a.RateCodes[n].RcID==et&&a.RateCodes[n].PkgID==ct)return a.RateCodes[n];return null};this.GetData=function(){return s};this.GetCrsID=function(){return s.CrsID};this.GetResvID=function(){return s.ResvID};this.GetHotelID=function(){return s.HotelID};this.GetRooms=function(){return o};this.GetRmID=function(){return ut};this.GetRcID=function(){return et};this.GetPkgID=function(){return ct};this.GetGrpID=function(){return ur};this.GetAmt=function(){return l};this.GetTax=function(){return p};this.GetDisc=function(){return pt};this.GetDeposit=function(){return ti};this.GetGuar=function(){return ui};this.GetResortFee=function(){return wt};this.GetRoomStay=function(){return w};this.GetGroupTowerCode=function(){return bt};this.GetSelectedRoomStay=function(){if(a===null||a.RoomStays==null)return null;for(var n=0;n<a.RoomStays.length;n++)if(Number(a.RoomStays[n].RmID)===ut&&Number(a.RoomStays[n].RcID)===et)return a.RoomStays[n];return null};this.GetDaily=function(){return ii};this.GetCompDaily=function(){return yi};this.GetDiscDaily=function(){return it};this.GetDiscName=function(){return ri};this.GetTaxInfo=function(){return b};this.GetRoomName=function(){return ci.html()};this.GetRateName=function(){return hi.html()};this.GetTowerName=function(){return typeof li!="undefined"&&li.length>0?li.html():""};this.GetRoomCode=function(){var n=this.GetRm();return n!==null?n.Code:""};this.GetRateCode=function(){var n=this.GetRc();return n!==null?n.Code:""};this.Truthy=function(n){return n===!1?!1:n===!0?!0:typeof n=="undefined"||n===null?!1:(n=new String(n).toLowerCase(),n==="false"||n==="0"||n==="")?!1:!0};this.GetRateOL=function(){var n=this.GetRc();return n!==null?this.Truthy(n.IsOL):this.Truthy(s.IsOL)};this.HasCompOnly=function(){var n=vi();return typeof n!="undefined"&&n!=null&&/^(true,)*true$/i.test(n.CompDaily)?!0:!1};this.GetIsOLResVal=function(){var n=this.GetRc();return n!==null?SHRWindsurfer.Utils.truthy(n.IsOLResVal):SHRWindsurfer.Utils.truthy(s.IsOLResVal)};this.GetOLMaxCompNights=function(){var n=this.GetRc();return n!==null?n.MaxCompNights:s.MaxCompNights};this.GetOLOfferMinLOS=function(){var n=this.GetRc();return n!==null?n.OfferMinLOS:s.OfferMinLOS};this.GetOLIncentiveMinLOS=function(){var n=this.GetRc();return n!==null?n.IncentiveMinLOS:s.IncentiveMinLOS};this.GetCSymbol=function(){return s.CSymbol};this.GetCurrency=function(){return s.Currency};this.GetCheckIn=function(){return lr};this.GetCheckOut=function(){return ar};this.GetGenPolicy=function(){return vr};this.GetPetPolicy=function(){return yr};this.GetGetIns=function(){return tr};this.GetInsToken=function(){return or};this.SetInsToken=function(n){or=n;n==null||Math.round(n.rp_price)==0?fr.hide():(fr.show(),er.attr("ref",n.rp_price),er.html(Utils.GetAmount(n.rp_price,s.Currency,WsVars.UseCurrCode)))};this.SetSvcsAmt=function(n){for(var i=0,r=0,t=0;t<n.length;t++)i+=n[t].Amt,r+=n[t].Taxes;ot=i;st=r};this.SetSvcs=function(n){var d,r,t,a,u,v;if(s.Svcs=n,d=g.GetRateOL(),n.length===0)y.find(".cbRooms").show(),y.find(".lbRooms").show(),ot=0,st=0;else{for(y.find(".cbRooms").hide(),y.find(".lbRooms").hide(),r=0,u=0,t=0;t<n.length;t++)r+=n[t].Amt*n[t].Qty,u+=n[t].Taxes*n[t].Qty;ot=r;st=u}if(c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"){if(w=ki(),w!=null){l=Number(w.Amt);p=Number(w.Taxes);tt=Number(w.TaxVAT);pt=Number(w.Disc);ti=Number(w.Deposit);ii=w.Daily;it=w.DiscDaily;ri=w.DiscName;b=w.TaxInfo;ui=w.GUT;wt=0;k=0;var nt=WsVars.GuestLoyalty==""?!1:!0,f=!nt&&rc!=null&&rc.IsPublicPromo=="True"&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountHiddenForLoyaltyRates,ut=(l+p)*100;if(b!=null&&b.length>0)for(t=0;t<b.length;t++)b[t]!=null&&(b[t].AddToDisplayAmount=="True"&&(k+=Number(b[t].Amt)),b[t].ID==="ResortFees"&&(wt=Number(b[t].Amt)));var e=w.Daily.split(","),r=0,i=0;if(pt===0||it.length===0)for(t=0;t<e.length;t++)r=f&&Number(e[t]==0)?0:Number(e[t]),i+=r;else for(it.indexOf(",")>-1&&(it=it.split(",")),t=0;t<e.length;t++)r=f&&Number(e[t]==0)?0:Number(e[t]),i+=r,r=Number(e[t])-Number(it[t])*o;if(a=l*o-i,a>.01&&(i+=a),u=0,v=0,b.length>0){for(t=0;t<b.length;t++)r=f&&Number(b[t].Amt)>0?"":Number(b[t].Amt),i+=r,u+=r;a=p*o-u;a>.01&&(i+=a,v=a*100);u*=100}i*=100;f?(ht.html(""),h.html(""),h.attr("ref","")):WsVars.IbeShowTotal=="1"?(ht.html(WsMulti.AvgDailyTotal),h.html(f&&i==0?"":Utils.GetAmountMod(parseInt(i.toFixed(2)/(rt*o))/100,s.Currency,WsVars.UseCurrCode)),h.attr("ref",f?"":parseInt(i.toFixed(2)/(rt*o))/100)):WsVars.IbeShowTotalExclusive=="1"?(ht.html(WsMulti.AvgDailyRoom),h.html(f&&i==0?"":Utils.GetAmountMod(parseInt((i.toFixed(2)-u.toFixed(2)-v.toFixed(2))/(rt*o))/100,s.Currency,WsVars.UseCurrCode)),h.attr("ref",f&&i==0?"":parseInt((i.toFixed(2)-u.toFixed(2)-v.toFixed(2))/(rt*o))/100)):(ht.html(WsMulti.AvgDailyRoom),k!=0?kt.html(WsMulti.AddToDisplayTaxFeeDetails):kt.html(""),h.html(f&&i==0?"":Utils.GetAmountMod(parseInt((i.toFixed(2)-u.toFixed(2)+tt*100+k*100-v.toFixed(2))/(rt*o))/100,s.Currency,WsVars.UseCurrCode)),h.attr("ref",f&&i==0?0:parseInt((i.toFixed(2)-u.toFixed(2)+tt*100+k*100-v.toFixed(2))/(rt*o))/100))}}else(d||ShowFullCompAsComplimentary)&&ot+st+l+p==0?(h.html(ShowFullCompAsComplimentary?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmountMod(ot+st+(l+p)*o,s.Currency,WsVars.UseCurrCode)),h.attr("ref",ot+st+(l+p)*o));WsVars.EnableBNPLProviderID==1&&WsVars.FlexPayUpCode!=""&&WsVars.ShowFlexPayOnCheckoutOnly==0&&(lt.html(WsFlexPay.ShowMonthlyRates(h.attr("ref"),!0)),lt.removeClass("hide"))};this.GetGutPolicy=function(){var n=null;return(rc=null,c.Page==="ROOMDETAIL"?(n=ki(),rc=this.GetRcRoomDetail()):(n=vi(),rc=this.GetRc()),n!==null&&n.GutPolicy.length>0)?n.GutPolicy:rc!==null&&rc.GutPolicy.length>0?rc.GutPolicy:""};this.GetCanPolicy=function(){var n=null;return(rc=null,c.Page==="ROOMDETAIL"?(n=ki(),rc=this.GetRcRoomDetail()):(n=vi(),rc=this.GetRc()),n!==null&&n.CanPolicy.length>0)?n.CanPolicy:rc!==null&&rc.CanPolicy.length>0?rc.CanPolicy:""};this.GetAvail=function(){var r,t,f,i,e,u,o,n;if(d.hide(),nt.hide(),r=y.data("MyCal"),t=y.data("MyOcc"),rt=r.GetNights(),f={CartID:s.CrsID,ResvID:s.ResvID,LName:"",Dt1:r.GetArrival(),Nights:r.GetNights(),Rooms:this.GetRooms(),Adults:t.GetAdults(),Child1:t.GetChild1(),Child2:t.GetChild2(),Child3:t.GetChild3(),Child4:t.GetChild4(),ChildrenAges:t.GetChildAges(),Promo:cr,Group:"",Iata:"",Ix:-1},c.Page==="CONFIRM"||c.Page==="RATEDETAIL"||c.Page==="ROOMDETAIL"){if(i={HotelID:s.HotelID,LangID:WsVars.LangID,CrsID:s.CrsID,ResvID:s.ResvID,Dt1:r.GetArrival(),Nights:r.GetNights(),Adults:t.GetAdults(),Child1:t.GetChild1(),Child2:t.GetChild2(),Child3:t.GetChild3(),Child4:t.GetChild4(),ChildrenAges:t.GetChildAges()},i.RmID=this.GetRmID(),i.RcID=this.GetRcID(),c.Page==="CONFIRM")for(e=y.data("MySvc"),i.Svcs=e.GetSvcs(),u=0;u<i.Svcs.length;u++)i.Svcs[u].Policy="",i.Svcs[u].CanPolicy="",i.Svcs[u].Name="",i.Svcs[u].Desc="";f.Items=[i]}o=s.Rest==""?s.RateCode:s.Rest;n={hotelID:s.HotelID,hgID:WsVars.HgID,langID:WsVars.LangID,currID:WsVars.CurrencyId,corp:s.Corp,rest:o,access:s.Access,pkgID:ct,grpID:ur,stepNo:WsVars.Step,wscart:JSON.stringify(f)};c.Page.length===0?(n.ix=ir,s.Rest.length>0&&(n.restID=this.GetRcID())):c.Page==="CONFIRM"?(s.Rest.length>0&&(n.restID=this.GetRcID()),s.Corp.length>0&&(n.rcID=this.GetRcID()),n.rmID=this.GetRmID(),n.IsResvMod=r.IsOpen()):c.RcID>0?(n.RcID=c.RcID,(c.Page==="PROMO"||c.Page==="RATEDETAIL")&&(n.rooms=this.GetRooms())):c.RmID>0&&c.Page==="ROOMDETAIL"&&(s.Rest.length>0&&(n.restID=this.GetRcID()),n.RmID=this.GetRmID(),n.rooms=this.GetRooms(),n.pkgID=0);c.Page!="CONFIRM"?setSearchCriteria(c,n).then(function(){dr(c,n)}):dr(c,n)};this.Show=function(){hr!==!0&&(nu(),hr=!0)};this.ShowOrig=function(){var t="",i=g.GetRateOL(),n=!1;SHRWindsurfer.Utils.truthy(WsVars.ShowFullCompRoomCostAsComplimentary)&&g.HasCompOnly()&&(n=!0);t=WsVars.Config2Flag=="True"?s.Currency+"~":s.Currency;(i||n)&&(s.Amt+s.Taxes)*o==0?(h.html(n?WsMulti.Complimentary:WsMulti.COMP),h.attr("ref","")):(h.html(Utils.GetAmount((s.Amt+s.Taxes)*o,t,WsVars.UseCurrCode)),h.attr("ref",(Number(s.Amt)+Number(s.Taxes))*o));WsVars.EnableBNPLProviderID==1&&WsVars.FlexPayUpCode!=""&&WsVars.ShowFlexPayOnCheckoutOnly==0&&(lt.html(WsFlexPay.ShowMonthlyRates(h.attr("ref"),!0)),lt.removeClass("hide"));WsVars.IbeShowTotal==="1"?(i||n)&&s.Amt+s.Taxes==0?(v.html(n?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):(v.html(Utils.GetAmount(s.Amt+s.Taxes,t,WsVars.UseCurrCode)),v.attr("ref",Number(s.Amt)+Number(s.Taxes))):WsVars.IbeShowTotalExclusive=="1"?(i||n)&&s.Amt==0?(v.html(n?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):(v.html(Utils.GetAmount(s.Amt,t,WsVars.UseCurrCode)),v.attr("ref",s.Amt)):(i||n)&&s.Amt+s.TaxVAT==0?(v.html(n?WsMulti.Complimentary:WsMulti.COMP),v.attr("ref","")):(v.html(Utils.GetAmount(s.Amt+s.TaxVAT,t,WsVars.UseCurrCode)),v.attr("ref",s.Amt+s.TaxVAT));pi.attr("src",s.RoomImg).attr("alt",s.RoomName);ci.html(s.RoomName);bi.html(decodeURIComponent(s.RoomDesc));hi.html(s.RateName);wi.html(decodeURIComponent(s.RateDesc))};this.HideRoomRates=function(){br("")};this.IsDiff=function(){return ut>0&&ut!=s.RmID||et>0&&et!=s.RcID?!0:!1};this.Alert=function(n){ni.addClass("ws-messages ws-show-this").html(n);clearTimeout(ai);ai=setTimeout(function(){ni.removeClass("ws-messages ws-show-this")},1e4)};this.AlertPolicy=function(t){var i,u,r,f;t?(i=this.GetRc(),u="",i!=null&&i.Link.length>4&&(u=i.Link.substr(0,4).toLowerCase()==="http"?i.Link:"http://"+i.Link),WsMulti.MsgPolicyChanged!=null&&WsMulti.MsgPolicyChanged.length>0&&(r=n("<span>"+WsMulti.MsgPolicyChanged+"<\/span>"),u.length>0&&(f=r.find(".msgPolicyChanged").filter(":first"),f.attr("href",u)),r=r.html(),gt.html(r),ni.addClass("ws-messages ws-show-this").html(r),clearTimeout(ai),ai=setTimeout(function(){gt.html("");ni.removeClass("ws-messages ws-show-this")},15e3))):(gt.html(""),ni.removeClass("ws-messages ws-show-this"))};this.AlertRoomTypeChange=function(t){var i;if(t){var f=this.GetRm(),r="",u=f.Name;s!=null&&s.RoomName!=""&&(r=s.RoomName);u.indexOf(":")>0&&r.indexOf(":")>0&&WsMulti.RoomTypeTowerChanged!=null&&WsMulti.RoomTypeTowerChanged.length>0&&u.split(":")[0].trim()!=r.split(":")[0].trim()&&(i=n("<span>"+WsMulti.RoomTypeTowerChanged+"<\/span>"),i=i.html(),at.html(i),ni.addClass("ws-messages ws-show-this").html(i),clearTimeout(ai),ai=setTimeout(function(){at.html("");ni.removeClass("ws-messages ws-show-this")},15e3))}else at.html(""),ni.removeClass("ws-messages ws-show-this")}}function r(t,i,r,u){var g=!1,l=1,h=0,v=0,y=0,p=0,o=[],c=[],f=[],e=t,a=i,w=r,s=u;if(typeof e!="undefined"){e.data("MyOcc",this);var ut=function(){var r,i;if(a!=null){if(l=a.Adults,h=a.Child1,v=a.Child2,y=a.Child3,p=a.Child4,r=h+v+y+p,r>4&&(r=4),typeof a.ChildrenAges!="undefined"&&a.ChildrenAges!=null&&(o=a.ChildrenAges.slice(0)),s.Page==="ROOMDETAIL"||s.Page==="RATEDETAIL"){if(e.find(".cbAdults span").click(function(){n(this).addClass("selected");n(this).siblings().removeClass("selected");n(this).attr("aria-checked",!0);n(this).siblings().attr("aria-checked",!1);var t=Number(n(this).text());l!==t&&(l=t,e.trigger("OccChanged"),WsVars.Adults=t,UpdateUrlParams());n(".ws-tip-close").click()}),e.find(".cbChild1 span").click(function(){var c,f,l,o,a;if(n(this).addClass("selected"),n(this).siblings().removeClass("selected"),n(this).attr("aria-checked",!0),n(this).siblings().attr("aria-checked",!1),c=Number(n(this).text()),h!==c){if(h=c,c===0){var p=n(this).parents(".ws-product-item"),y=p.attr("ix"),u=0,r="",v=!1,i=[];if(s.Page==="CONFIRM"){if(i=WSMAIN.items[y],f=t.data("MySvc").GetSvcs(),f.length>0){for(l=f.length-1;l>=0;l--)if(r=f[l],o="",typeof r.Formula!="undefined"?o=r.Formula:typeof r.Per!="undefined"&&(o=r.Per),o==="2"||o==="10"||o===2||o===10){if(u=l,u<0||u>=f.length)return!1;f.splice(u,1);v=!0}v&&t.trigger("AddonUpdated",[f])}}else if((s.Page==="ROOMDETAIL"||s.Page==="RATEDETAIL")&&WSMAIN.MyItem!=null)i=WSMAIN.MyItem;else if(WSMAIN.Items!=null&&WSMAIN.Items!=undefined&&WSMAIN.Items.length>0&&(i=WSMAIN.Items[y],i!=null&&i.Svcs!=null&&i.Svcs.length>0)){for(a=i.Svcs.length-1;a>=0;a--)if(r=i.Svcs[a],r.Formula===2||r.Formula===10){if(u=a,y<0||i===null||u>=i.Svcs.length)return!1;i.Svcs.splice(u,1);v=!0}v&&WSMAIN.UpdateCart()}}e.trigger("OccChanged");WsVars.Child1=c;UpdateUrlParams()}n(".ws-tip-close").click()}),e.find(".cbAdults span").attr("aria-checked",!1),e.find(".cbChild1 span").attr("aria-checked",!1),e.find(".cbAdults span").filter(function(){return Number(n(this).text())===l}).addClass("selected").attr("aria-checked",!0),e.find(".cbChild1 span").filter(function(){return Number(n(this).text())===r}).addClass("selected").attr("aria-checked",!0),WsVars.IBESkinVer=="3"){e.find(".cbAdults span").on("keydown",function(t){(t.keyCode==13||t.key==="Enter")&&n(this).click()});e.find(".cbChild1 span").on("keydown",function(t){(t.keyCode==13||t.key==="Enter")&&n(this).click()})}}else{if(e.find(".cbAdults").change(function(){l=Number(n(this).val());e.trigger("OccChanged");WsVars.Adults=l;UpdateUrlParams()}),e.find(".cbChild1").change(function(){h=Number(n(this).val());WsVars.Child1=h;b()}),e.find(".cbChild2").change(function(){v=Number(n(this).val());WsVars.Child2=v;b()}),e.find(".cbChild3").change(function(){y=Number(n(this).val());WsVars.Child3=y;b()}),e.find(".cbChild4").change(function(){p=Number(n(this).val());WsVars.Child4=p;b()}),i=e.find(".lblMaxOccpuancy").text(),i!=null&&typeof i!="undefined"&&(i=i.split("|")),i!=null&&i.length>0?(AppendOccupancy(e.find("#cbAdults"),i[0]),AppendOccupancy(e.find("#cbChild1"),i[1]),AppendOccupancy(e.find("#cbChild2"),i[1]),AppendOccupancy(e.find("#cbChild3"),i[1]),AppendOccupancy(e.find("#cbChild4"),i[1])):(AppendOccupancy(e.find("#cbAdults"),WsVars.AdultOccupancyAllowed),AppendOccupancy(e.find("#cbChild1"),WsVars.ChildrenOccupancyAllowed),AppendOccupancy(e.find("#cbChild2"),WsVars.ChildrenOccupancyAllowed),AppendOccupancy(e.find("#cbChild3"),WsVars.ChildrenOccupancyAllowed),AppendOccupancy(e.find("#cbChild4"),WsVars.ChildrenOccupancyAllowed)),e.find("#cbAdults").val(l),e.find("#cbChild1").val(h),e.find("#cbChild2").val(v),e.find("#cbChild3").val(y),e.find("#cbChild4").val(p),WsVars.IBESkinVer=="3"){e.find(".cbAdults").on("keydown",function(t){(t.keyCode==13||t.key==="Enter")&&n(this).change()});e.find(".cbChild1,.cbChild2,.cbChild3,.cbChild4").on("keydown",function(t){(t.keyCode==13||t.key==="Enter")&&n(this).change()})}e.find(".customOcc").customSelect()}if(WsVars.EnhancedMultiroom.toLowerCase()=="true"){e.find(".plus").click(function(t){var b,c,i,u,r;t.preventDefault();n(this).parent("div").find("input.mLchildNo").length==1&&(b=!0);c=parseInt(this.attributes.maxOcc.value,10);i=0;f=GetMultiRoomFromCookie();u=n(this).parents("div").parents("article").attr("roomIndex");s.Page==="CONFIRM"&&(u=0);let k=`MultiRoom_${WsVars.HotelID}`;if(b){if(i=Number(n(this).parent("div").find(".mLchildNo").val())+1,i<=c){e.find(".mLchildNo").val(i);o.push(0);var it="selectChildAge_"+w,rt=document.getElementById(it),d="";if(d=CreateChildAgeDropdown(o,w,0),rt.innerHTML=d,h=i,WsVars.Child1=i,f[u].children=i,f[u].childAges=o,WSCCONSENT.SetCookie(k,JSON.stringify(f)),o!=null&&o.length>0){var a=0,g=0,nt=0,tt=0;for(r=0;r<o.length;r++)Number(WsVars.ChildAgeGroup1)>0&&o[r]<=Number(WsVars.ChildAgeGroup1)?a++:Number(WsVars.ChildAgeGroup2)>0&&o[r]<=Number(WsVars.ChildAgeGroup2)?g++:Number(WsVars.ChildAgeGroup3)>0&&o[r]<=Number(WsVars.ChildAgeGroup3)?nt++:Number(WsVars.ChildAgeGroup4)>0&&o[r]<=Number(WsVars.ChildAgeGroup4)?tt++:a++;h=a;v=g;y=nt;p=tt}i==0&&(h=0,v=0,y=0,p=0)}}else i=Number(n(this).parent("div").find(".mLAdultNo").val())+1,i<=c&&(e.find(".mLAdultNo").val(i),l=i,WsVars.Adults=i,f[u].adults=i,WSCCONSENT.SetCookie(k,JSON.stringify(f)));n(this).parent("div").find(".minus, .disabled").removeClass("disabled");WsMultiRoomCTABannerCart(!0);e.trigger("OccChanged");i>=c&&n(this).addClass("disabled")});e.find(".minus").click(function(t){var nt,i,d,rt,u,b,g,k,r;if(t.preventDefault(),n(this).parent("div").find("input.mLchildNo").length==1&&(nt=!0),f=GetMultiRoomFromCookie(),d=n(this).parents("div").parents("article").attr("roomIndex"),s.Page==="CONFIRM"&&(d=0),nt){if(i=Number(n(this).parent("div").find(".mLchildNo").val())-1,i>=0){e.find(".mLchildNo").val(i);rt="childSelectDiv_"+w+Number(i+1);const t=document.getElementsByClassName(rt);while(t.length>0)t[0].remove();o=[];for(let n=1;n<=i;n++)o.push(Number(e.find(".childSelectDiv_"+w+n).find(".child-ddl").val()));if(h=i,WsVars.Child1=i,f[d].children=i,f[d].childAges=o,WSCCONSENT.SetCookie(multiRoomKey,JSON.stringify(f)),o!=null&&o.length>0){var tt=0,ut=0,ft=0,et=0;for(r=0;r<o.length;r++)Number(WsVars.ChildAgeGroup1)>0&&o[r]<=Number(WsVars.ChildAgeGroup1)?tt++:Number(WsVars.ChildAgeGroup2)>0&&o[r]<=Number(WsVars.ChildAgeGroup2)?ut++:Number(WsVars.ChildAgeGroup3)>0&&o[r]<=Number(WsVars.ChildAgeGroup3)?ft++:Number(WsVars.ChildAgeGroup4)>0&&o[r]<=Number(WsVars.ChildAgeGroup4)?et++:tt++;h=tt;v=ut;y=ft;p=et}if(i==0){h=0;v=0;y=0;p=0;var ot=n(this).parents(".ws-product-item"),it=ot.attr("ix"),a=0,c="";let t=!1;if(u=[],s.Page==="CONFIRM"){if(u=WSMAIN.items[it],b=e.data("MySvc").GetSvcs(),b.length>0){for(g=b.length-1;g>=0;g--)if(c=b[g],k="",typeof c.Formula!="undefined"?k=c.Formula:typeof c.Per!="undefined"&&(k=c.Per),k==="2"||k==="10"||k===2||k===10){if(a=g,a<0||a>=b.length)return!1;b.splice(a,1);t=!0}t&&e.trigger("AddonUpdated",[b])}}else if(u=WSMAIN.Items[it],u.Svcs.length>0){for(r=u.Svcs.length-1;r>=0;r--)if(c=u.Svcs[r],c.Formula===2||c.Formula===10){if(a=r,it<0||u===null||a>=u.Svcs.length)return!1;u.Svcs.splice(a,1);t=!0}t&&WSMAIN.UpdateCart()}}}}else i=Number(n(this).parent("div").find(".mLAdultNo").val())-1,i>=1&&(e.find(".mLAdultNo").val(i),l=i,WsVars.Adults=i,f[d].adults=i,WSCCONSENT.SetCookie(multiRoomKey,JSON.stringify(f)));n(this).parent("div").find(".plus, .disabled").removeClass("disabled");WsMultiRoomCTABannerCart(!0);e.trigger("OccChanged");nt?i<=0&&n(this).addClass("disabled"):i<=1&&n(this).addClass("disabled")});e.find('input[type="number"]').change(function(){var r,v,y,p,c;f=GetMultiRoomFromCookie();n(this).hasClass("mLchildNo")&&(r=!0);var u=parseInt(this.attributes.maxOcc.value,10),t=Number(n(this).val()),i=n(this).parents("div").parents("article").attr("roomIndex"),a=null;if(s.Page==="CONFIRM"&&(i=0,a=o),t<=0?(r?(n(this).val(0),t=0):(n(this).val(1),t=1),n(this).parent("div").parent("div").find(".minus").addClass("disabled"),n(this).parent("div").parent("div").find(".plus").removeClass("disabled")):t>=u?(n(this).val(u),t=u,n(this).parent("div").parent("div").find(".plus").addClass("disabled"),n(this).parent("div").parent("div").find(".minus").removeClass("disabled")):(n(this).parent("div").parent("div").find(".plus").removeClass("disabled"),n(this).parent("div").parent("div").find(".minus").removeClass("disabled")),r){if(t>=0){h=t;o=[];v="selectChildAge_"+w;y=document.getElementById(v);s.Page==="CONFIRM"&&(f[i].childAges=a);t<0?t=0:t>WsVars.ChildrenOccupancyAllowed&&(t=WsVars.ChildrenOccupancyAllowed);f[i].children=t;f[i].childAges.length<t?(p=Array(t-f[i].childAges.length).fill(0),f[i].childAges.splice(f[i].childAges.length,0,...p)):f[i].childAges.splice(t,f[i].childAges.length-t);c="";c=CreateChildAgeDropdown(f[i].childAges,i,t);y.innerHTML=c;for(let n=1;n<=t;n++)o.push(Number(e.find(".childSelectDiv_"+w+n).find(".child-ddl").val()));WsVars.Child1=t;f[i].children=t;f[i].childAges=o;WSCCONSENT.SetCookie(multiRoomKey,JSON.stringify(f));WsMultiRoomCTABannerCart(!0);e.trigger("OccChanged")}}else t>=1&&(l=t,WsVars.Adults=t,f[i].adults=t,WSCCONSENT.SetCookie(multiRoomKey,JSON.stringify(f)),WsMultiRoomCTABannerCart(!0),e.trigger("OccChanged"))});e.on("change",".child-ddl",function(){var i,u,r,l,t;if(s.Page==="ROOMDETAIL"||s.Page==="RATEDETAIL")i=parseInt(this.attributes.roomIndex.value,10),typeof i!="undefined"&&i!=null&&(u=parseInt(this.attributes.cacIndex.value,10),f[i].childAges[u]=Number(this.value),f[i].children=u+1);else if(r=n(this).parents("div").parents("article").attr("roomIndex"),typeof r!="undefined"&&r!=null){if(f=GetMultiRoomFromCookie(),s.Page==="CONFIRM"&&(r=0),l=parseInt(this.attributes.childNo.value,10)-1,o[l]=Number(this.value),f[r].childAges=o,o!=null&&o.length>0){var c=0,a=0,w=0,b=0;for(t=0;t<o.length;t++)Number(WsVars.ChildAgeGroup1)>0&&o[t]<=Number(WsVars.ChildAgeGroup1)?c++:Number(WsVars.ChildAgeGroup2)>0&&o[t]<=Number(WsVars.ChildAgeGroup2)?a++:Number(WsVars.ChildAgeGroup3)>0&&o[t]<=Number(WsVars.ChildAgeGroup3)?w++:Number(WsVars.ChildAgeGroup4)>0&&o[t]<=Number(WsVars.ChildAgeGroup4)?b++:c++;h=c;v=a;y=w;p=b}e.trigger("OccChanged")}WSCCONSENT.SetCookie(multiRoomKey,JSON.stringify(f))});e.find(".cnAdults,.cnChildren,.cnChild1,.cnChild2,.cnChild3,.cnChild4").hide()}}},b=function(){var b=Number(h+v+y+p),f,c,o,l;if(b===0){var k=n(this).parents(".ws-product-item"),w=k.attr("ix"),u=0,r="",a=!1,i=[];if(s.Page==="CONFIRM"){if(i=WSMAIN.items[w],f=t.data("MySvc").GetSvcs(),f.length>0){for(c=f.length-1;c>=0;c--)if(r=f[c],o="",typeof r.Formula!="undefined"?o=r.Formula:typeof r.Per!="undefined"&&(o=r.Per),o==="2"||o==="10"||o===2||o===10){if(u=c,u<0||u>=f.length)return!1;f.splice(u,1);a=!0}a&&t.trigger("AddonUpdated",[f])}}else if(WSMAIN.Items!=null&&WSMAIN.Items!=undefined&&WSMAIN.Items.length>0&&(i=WSMAIN.Items[w],i!=null&&i.Svcs!=null&&i.Svcs.length>0)){for(l=i.Svcs.length-1;l>=0;l--)if(r=i.Svcs[l],r.Formula===2||r.Formula===10){if(u=l,w<0||i===null||u>=i.Svcs.length)return!1;i.Svcs.splice(u,1);a=!0}a&&WSMAIN.UpdateCart()}}e.trigger("OccChanged");UpdateUrlParams()},nt=function(){var i,t;if(WsVars.EnhancedMultiroom.toLowerCase()=="true"){if(n(".mLOccupancy").attr("style","display:block"),multiRoomKey=`MultiRoom_${WsVars.HotelID}`,et(),typeof c=="undefined"||c==null||c.length==0)c.push({adults:1,children:0,childAges:[],current:!0,addedToCart:!1});else if((typeof WsVars.CartItems=="undefined"||WsVars.CartItems.length==0)&&c!=null&&c.length>0)for(let n=0;n<c.length;n++)c[n].addedToCart=!1;f=c;i=f.filter(function(n){return n.addedToCart==!1});f.length<WsVars.MaxRoomsPerRes&&(i.length==0?(c.push({adults:1,children:0,childAges:[],current:!0,addedToCart:!1}),f=c,WSCCONSENT.SetCookie(multiRoomKey,JSON.stringify(c))):i.length>0&&(t=f.filter(function(n){return n.current==!0}),typeof t!="undefined"&&t!=null&&t.length>0&&WSCCONSENT.SetCookie(multiRoomKey,JSON.stringify(c))));k()}},k=function(){let t="",u="",a=f.filter(function(n){return n.addedToCart==!0}).length,v=f.length-1==a,o={MaxAd:WsVars.AdultOccupancyAllowed,MaxCh:WsVars.ChildrenOccupancyAllowed},h;if(h=s.Page==="ROOMDETAIL"?Utils.GetParam("rmID"):n("#cbRoomtype").find(".ws-current").attr("ref"),typeof MyWsRooms!="undefined"&&MyWsRooms!=null&&MyWsRooms.length>=0){let n=MyWsRooms.filter(function(n){return n.RmID==h});typeof n!="undefined"&&n!=null&&n.length>0&&(o=n[0])}if(f!==null&&f.length>0)for(let n=0;n<f.length;n++){var i=f[n],r="room-"+n,y="childAgeInfo"+n,c="btnAdult"+n,l="btnChild"+n;t=`<article id="${r}" class="${i.current?"ws-occupancy-room-current":""}">`;t+=`<div class="ws-occupancy-room-title"><h4 id="lbOccupancyRoomundefined">${Utils.Format(SHR.__("RoomNum"),n+1)} ${i.addedToCart?SHR.__("AddedToCart"):""} </h4></div>`;t+=`    <div class="num-plusminus">`;t+=`        <label id="${r}-adults-label" class="label" >${SHR.__("Adults")}</label>`;t+=`        <button id="${c}-minus" class="mpbtn minus ${i.adults==1?"disabled":""}" ${i.addedToCart?"disabled":""} aria-label="${SHR.__("Decrease")} ${SHR.__("Adults")}" for="${r}_adults-${n}" aria-disabled="${i.adults==1?"true":"false"}" roomIndex="${n}"><span> - </span></button>`;t+=`        <div id="field_container">`;t+=`            <input type="number" ${i.addedToCart?"disabled":""} name="${r}_adults-${n}" id="${r}_adults-${n}" roomIndex="${n}" aria-labelledby="${r}-adults-label"  value="${i.adults}"/>`;t+=`        </div>`;t+=`        <button id="${c}-plus" class="mpbtn plus ${i.adults>=o.MaxAd?"disabled":""}" ${i.addedToCart?"disabled":""} aria-label="${SHR.__("Increase")} ${SHR.__("Adults")}" for="${r}_adults-${n}" aria-disabled="${i.adults>=o.MaxAd?"true":"false"}" roomIndex="${n}"><span> + </span></button>`;t+=`    </div>`;t+=`    <div class="num-plusminus">`;t+=`        <label id="${r}-childen-label" class="label" >${SHR.__("Children")}</label>`;t+=`        <button id="${l}-minus" class="mpbtn minus ${i.children==0?"disabled":""}" ${i.addedToCart?"disabled":""} aria-label="${SHR.__("Decrease")} ${SHR.__("Children")}" for="${r}_children-${n}" aria-disabled="${i.children==0?"true":"false"}" roomIndex="${n}"><span> - </span></button>`;t+=`        <div id="field_container">`;t+=`            <input type="number" ${i.addedToCart?"disabled":""} name="${r}_children-${n}" id="${r}_children-${n}" roomIndex="${n}"  aria-labelledby="${r}-childen-label" value="${i.children}"/>`;t+=`        </div>`;t+=`        <button id="${l}-plus" class="mpbtn plus ${i.children>=o.MaxCh?"disabled":""}" ${i.addedToCart?"disabled":""} aria-label="${SHR.__("Increase")} ${SHR.__("Children")}" for="${r}_children-${n}" aria-disabled="${i.children>=o.MaxCh?"true":"false"}" roomIndex="${n}"><span> + </span></button>`;t+=`    </div>`;t+=`    <div id="${y}">`;t+=d(i.childAges,n);t+=`    </div>`;t+=`<div class="ws-occupancy-room-button ${i.addedToCart?"":v||f.length==1?"ws-hide":""}"><button class="ws-occupancy-room-remove ws-button-small ws-primary  removeRoom" roomIndex="${n}"><span>${SHR.__("RemoveRoom")}</span></button></div>`;t+=`</article>`;u+=t}u+='<div class="ws-occupancy-rooms">';u+=`<button class="ws-button-small ws-secondary addRoomBlock ${f.length==WsVars.MaxRoomsPerRes?"ws-hide":""}">${SHR.__("AddRoom")}</button><button id="update" class="ws-button-small ws-primary">${SHR.__("Update")}</button></div>`;u+=`<p class="ws-close"><a href="#" id="buOccClose"><b class="ws-icon" data-icon="">${SHR.__("Cancel")}</b></a></p>`;e.find("#ws-occupants").show();e.find("#ws-occupancy-select").find(".ws-inner").html("<div class='num-plusminus-wrapper'>"+u+"<\/div>");e.find(".cnAdults,.cnChildren,.cnRooms,.cnChild1,.cnChild2,.cnChild3,.cnChild4").hide();n("#ws-main").addClass("ws-multiroom");WSMAIN.ShowDates();WsVars.IBESkinVer!="3"&&(n("#spCheckIn").attr("readonly",!0),n("#spCheckOut").attr("readonly",!0));n("#buOccClose").on("click",function(){return WSMAIN.ResetItin("occCancel"),nt(),!1});ft();tt(f)},d=function(n,t){let u=Number(WsVars.MaxChildAge);u==0&&(u=18);let i="";var f="childAgeInfo"+t,r=document.getElementById(f);r!=null&&(r.innerHTML="");for(let r=0;r<n.length;r++){i+=`    <div class="num-plusminus" ><label class="label">`+Utils.Format(SHR.__("ChildAge"),Number(r+1))+`</label>`;i+=`        <select name="childAge" roomindex= ${t} cacIndex=${r} class="child-ddl">`;let f=n[r];i+=`<option value="0" ${f!==null&&f==0?"selected":""} >${SHR.__("ChildAgeLessThanOneYear")}</option>`;for(let n=1;n<=u;n++)i+=`<option value="${n}" ${f!==null&&f==n?"selected":""} >${n}</option>`;i+=`        </select>`;i+=`    </div>`}return r!=null&&(r.innerHTML+=i),i},ft=function(){e.find(".plus").click(function(t){var i,v,c,r,p,u,e;t.preventDefault();let a={MaxAd:WsVars.AdultOccupancyAllowed,MaxCh:WsVars.ChildrenOccupancyAllowed},y;if(y=s.Page==="ROOMDETAIL"?Utils.GetParam("rmID"):n("#cbRoomtype").find(".ws-current").attr("ref"),typeof MyWsRooms!="undefined"&&MyWsRooms!=null&&MyWsRooms.length>=0){let n=MyWsRooms.filter(function(n){return n.RmID==y});typeof n!="undefined"&&n!=null&&n.length>0&&(a=n[0])}if(i=n("#"+this.attributes.for.value)[0].value==undefined?0:n("#"+this.attributes.for.value)[0].value==""?0:Number(n("#"+this.attributes.for.value)[0].value),v=this.attributes.for.value.includes("_child"),c=v?a.MaxCh:a.MaxAd,i<c)if(n("#"+this.attributes.for.value)[0].value=i+1,r=parseInt(this.attributes.roomIndex.value,10),v){s.Page!="ROOMDETAIL"&&s.Page!="RATEDETAIL"&&(h=i+1,o.push(0));f[r].children=i+1;f[r].childAges.push(0);for(let n=0;n<f.length;n++)p=f[n],d(p.childAges,n);u="btnChild"+r+"-minus";n(document.getElementById(u)).removeClass("disabled");n(document.getElementById(u)).attr("aria-disabled","false");i+1==c&&(u="btnChild"+r+"-plus",n(document.getElementById(u)).addClass("disabled"),n(document.getElementById(u)).attr("aria-disabled","true"))}else f[r].adults=i+1,l=i+1,e="btnAdult"+r+"-minus",n(document.getElementById(e)).removeClass("disabled"),n(document.getElementById(e)).attr("aria-disabled","false"),i+1==c&&(e="btnAdult"+r+"-plus",n(document.getElementById(e)).addClass("disabled"),n(document.getElementById(e)).attr("aria-disabled","true"))});e.find(".minus").click(function(t){var r,c,a,i,v,u,e;if(t.preventDefault(),r=n("#"+this.attributes.for.value)[0]==undefined?0:parseInt(n("#"+this.attributes.for.value)[0].value,10),c=1,a=this.attributes.for.value.includes("_child"),a&&(c=0),r>c)if(n("#"+this.attributes.for.value)[0].value=r-1,i=parseInt(this.attributes.roomIndex.value,10),a){s.Page!="ROOMDETAIL"&&s.Page!="RATEDETAIL"&&(h=r-1,o.pop());f[i].children=r-1;f[i].childAges.pop();for(let n=0;n<f.length;n++)v=f[n],d(v.childAges,n);u="btnChild"+i+"-plus";n(document.getElementById(u)).removeClass("disabled");n(document.getElementById(u)).attr("aria-disabled","false");r-1==c&&(u="btnChild"+i+"-minus",n(document.getElementById(u)).addClass("disabled"),n(document.getElementById(u)).attr("aria-disabled","true"))}else f[i].adults=r-1,l=r-1,e="btnAdult"+i+"-plus",n(document.getElementById(e)).removeClass("disabled"),n(document.getElementById(e)).attr("aria-disabled","false"),f[i].adults==1&&(e="btnAdult"+i+"-minus",n(document.getElementById(e)).addClass("disabled"),n(document.getElementById(e)).attr("aria-disabled","true"))});e.find('input[type="number"]').change(function(){var c,t,a,v,i,r;let u={MaxAd:WsVars.AdultOccupancyAllowed,MaxCh:WsVars.ChildrenOccupancyAllowed},e;if(e=s.Page==="ROOMDETAIL"?Utils.GetParam("rmID"):n("#cbRoomtype").find(".ws-current").attr("ref"),typeof MyWsRooms!="undefined"&&MyWsRooms!=null&&MyWsRooms.length>=0){let n=MyWsRooms.filter(function(n){return n.RmID==e});typeof n!="undefined"&&n!=null&&n.length>0&&(u=n[0])}if(c=this.attributes.id.value.includes("_child"),t=parseInt(this.attributes.roomIndex.value,10),c){this.valueAsNumber<0?this.valueAsNumber=0:this.valueAsNumber>u.MaxCh&&(this.valueAsNumber=u.MaxCh);f[t].children=this.valueAsNumber;f[t].childAges.length<this.valueAsNumber?(a=Array(this.valueAsNumber-f[t].childAges.length).fill(0),f[t].childAges.splice(f[t].childAges.length,0,...a)):f[t].childAges.splice(this.valueAsNumber,f[t].childAges.length-this.valueAsNumber);h=f[t].children;o=f[t].childAges.slice(0);for(let n=0;n<f.length;n++)v=f[n],d(v.childAges,n);i="btnChild"+t+"-minus";n(document.getElementById(i)).removeClass("disabled");n(document.getElementById(i)).attr("aria-disabled","false");this.valueAsNumber==u.MaxCh?(i="btnChild"+t+"-plus",n(document.getElementById(i)).addClass("disabled"),n(document.getElementById(i)).attr("aria-disabled","true")):(i="btnChild"+t+"-plus",n(document.getElementById(i)).removeClass("disabled"),n(document.getElementById(i)).attr("aria-disabled","false"))}else this.valueAsNumber<1?this.valueAsNumber=1:this.valueAsNumber>u.MaxAd&&(this.valueAsNumber=u.MaxAd),f[t].adults=this.valueAsNumber,l=this.valueAsNumber,r="btnAdult"+t+"-minus",n(document.getElementById(r)).removeClass("disabled"),n(document.getElementById(r)).attr("aria-disabled","false"),this.valueAsNumber==u.MaxAd?(r="btnAdult"+t+"-plus",n(document.getElementById(r)).addClass("disabled"),n(document.getElementById(r)).attr("aria-disabled","true")):(r="btnAdult"+t+"-plus",n(document.getElementById(r)).removeClass("disabled"),n(document.getElementById(r)).attr("aria-disabled","false"))});e.find(".removeRoom").click(function(){var n=parseInt(this.attributes.roomIndex.value,10),t,i;if(n+1==f.length){let n=f.map(function(n){return n.addedToCart}).indexOf(!1);f[n].current=!0}else f[n].current&&(f[n+1].current=!0);t=f[n];i=WSMAIN.Items.findIndex(t=>t.RoomIndex===n);typeof t!==undefined&&t!==null&&t.addedToCart&&ot(i,n);f.splice(n,1);k();rt(f);it(f)});e.find(".addRoomBlock").click(function(){if(f.length<WsVars.MaxRoomsPerRes)return f.push({adults:1,children:0,childAges:[],current:!1,addedToCart:!1}),k(),!1});e.find("#update").click(function(){var t,u,i,g,a;if(c=f,WSCCONSENT.SetCookie(multiRoomKey,JSON.stringify(f)),t=f.filter(function(n){return n.current==!0}),u=0,typeof t!==undefined&&t!==null&&t.length>0){if(l=t[0].adults,h=t[0].children,u=t[0].children,typeof t[0].childAges!="undefined"&&t[0].childAges!=null&&(o=t[0].childAges.slice(0)),o!=null&&o.length>0){var w=0,nt=0,rt=0,ut=0;for(i=0;i<o.length;i++)Number(WsVars.ChildAgeGroup1)>0&&o[i]<=Number(WsVars.ChildAgeGroup1)?w++:Number(WsVars.ChildAgeGroup2)>0&&o[i]<=Number(WsVars.ChildAgeGroup2)?nt++:Number(WsVars.ChildAgeGroup3)>0&&o[i]<=Number(WsVars.ChildAgeGroup3)?rt++:Number(WsVars.ChildAgeGroup4)>0&&o[i]<=Number(WsVars.ChildAgeGroup4)?ut++:w++;h=w;v=nt;y=rt;p=ut}if((s.Page==="ROOMDETAIL"||s.Page==="RATEDETAIL")&&u==0&&(h=0,v=0,y=0,p=0),e.trigger("OccChanged"),it(c),WsMultiRoomCTABanner(),tt(c),WSMAIN.ResetItin("occCancel"),(s.Page==="ROOMDETAIL"||s.Page==="RATEDETAIL")&&WSMAIN.MyItem!=null&&WSMAIN.MyItem.Svcs!=null&&WSMAIN.MyItem.Svcs.length>0&&u==0){var b=WSMAIN.GetResvDiv("0"),k=b.data("MyRmRc"),ft=b.data("MyCal"),r=b.data("MyOcc"),et=jQuery.extend(!0,[],WSMAIN.MyItem.Svcs),d={HotelID:k.GetHotelID(),RmID:k.GetRmID(),RcID:k.GetRcID(),Dt1:ft.GetArrival(),Nights:ft.GetNights(),Adults:r.GetAdults(),Child1:r.GetChild1(),Child2:r.GetChild2(),Child3:r.GetChild3(),Child4:r.GetChild4(),ChildrenAges:r.GetChildAges(),Svcs:et};WsVars.EnhancedMultiroom.toLowerCase()=="true"&&typeof c!="undefined"&&c!=null&&c.length>0&&(g=Number(c.map(function(n){return n.current}).indexOf(!0)),a=c[g],typeof a!="undefined"&&a!=null&&(d.RoomIndex=g,d.ChildrenAges=a.childAges));n(".dvHotelAddon").trigger("ReInit",[d])}}return!1})},tt=function(t){var i="",u=0,f=t.filter(function(n){return n.current==!0}),r,e;typeof f!==undefined&&f!==null&&f.length>0&&(l=f[0].adults);r=l;e=1;typeof t!==undefined&&t!==null&&t.length>0&&(r=t.reduce((n,t)=>n+(Number(t.adults)||0),0),u=t.reduce((n,t)=>n+t.children,0),e=t.length);r>1?i=r+" "+WsMulti.Adults:r===1&&(i=r+" "+WsMulti.Adult);u===1?i=i+", "+u+" "+WsMulti.Child:u>1&&(i=i+", "+u+" "+WsMulti.Children);i=e+" "+WsMulti.Room+", "+i;n("#spOccupants").html(i)},it=function(n){let i="",t="";for(let r=0;r<n.length;r++)i+=n[r].adults+",",t+=n[r].childAges.length>0?n[r].childAges.join("|")+",":",";i=i.substring(0,i.length-1);t=t.substring(0,t.length-1);UpdateUrlParams({adults:i,childAges:t})},et=function(){n.cookie(multiRoomKey)==="undefined"||n.cookie(multiRoomKey)===null?c.push({adults:1,children:0,childAges:[],current:!0,addedToCart:!1}):c=JSON.parse(n.cookie(multiRoomKey))},rt=function(n){if(WSMAIN.Items.length>0){var t=WSMAIN.Items.reverse(),i=0;for(let r=0;r<n.length;r++)n[r].addedToCart?i==0?r<t.length&&(t[r].RoomIndex=r):r-i<t.length&&(t[r-i].RoomIndex=r):i++;WSMAIN.Items=t.reverse();UpdateCart()}},ot=function(t,i){var u,e;try{if(WSMAIN.Items!=null&&WSMAIN.Items.length>0){if(t<0||t>=WSMAIN.Items.length)return!1;var r="",o="",s="",h="",c="",l="",a="",v="cart_room_rate";typeof WSMAIN.Items[t].Promo!="undefined"&&WSMAIN.Items[t].Promo!=""?r=WSMAIN.Items[t].Promo:typeof WSMAIN.Items[t].Voucher!="undefined"&&WSMAIN.Items[t].Voucher!=""?r=WSMAIN.Items[t].Voucher:typeof WSMAIN.Items[t].Access!="undefined"&&WSMAIN.Items[t].Access!=""?r=WSMAIN.Items[t].Access:typeof WSMAIN.Items[t].Iata!="undefined"&&WSMAIN.Items[t].Iata!=""&&(r=WSMAIN.Items[t].Iata);WSMAIN.Items[t].PkgID>0?(h=WSMAIN.Items[t].RateCode,c=WSMAIN.Items[t].RateType):WSMAIN.Items[t].Group!=""?(l=WSMAIN.Items[t].Group,a=WSMAIN.Items[t].RateType):(o=WSMAIN.Items[t].RateCode,s=WSMAIN.Items[t].RateType);let n=0;for(let t=0;t<WSMAIN.Items.length;t++){let i=WSMAIN.Items[t].Amt??0;if(n+=i,WSMAIN.Items[t].Svcs!=null&&WSMAIN.Items[t].Svcs.length>0){let i=WSMAIN.Items[t].Svcs;for(let t=0;t<i.length;t++){let r=i[t].Amt-i[t].TaxVAT;n+=r}}}let i=WSMAIN.Items[t].Amt;u={index:0,itemListId:v,roomName:WSMAIN.Items[t].RoomType,rateName:s,roomCode:WSMAIN.Items[t].RoomCode,rateCode:o,pkgCode:h,pkgName:c,grpCode:l,grpName:a,hotelCode:WsVars.PCode,hotelId:WsVars.HotelID,hotelName:WsVars.HotelName,nights:WsVars.Nights,dt1:WsVars.DayIn,adults:WsVars.Adults,child1:WsVars.Child1,child2:WsVars.Child2,child3:WsVars.Child3,child4:WsVars.Child4,price:n-i,coupon:r,category:"Room Rate",itemListId:v,currency:WsVars.Currency,quantity:1,abSetting:WsVars.ABSetting};WsVars.HgID>0&&(u.hgId=WsVars.HgID,WsVars.HotelGroupCode&&(u.hotelGroupCode=WsVars.HotelGroupCode));SHR.TrkLib.RemoveFromCart(u)}if(WsVars.EnhancedMultiroom.toLowerCase()=="true"&&(WSMAIN.MultiRoom=JSON.parse(n.cookie(`MultiRoom_${WsVars.HotelID}`)),WSMAIN.MultiRoom!=null&&WSMAIN.MultiRoom.length>0)){e=WSMAIN.MultiRoom[i];typeof e!==undefined&&e!==null&&(e.addedToCart=!1);let n=!1;for(let t=0;t<WSMAIN.MultiRoom.length;t++)WSMAIN.MultiRoom[t].addedToCart||(n?WSMAIN.MultiRoom[t].current=!1:(WSMAIN.MultiRoom[t].current=!0,n=!0));WSCCONSENT.SetCookie(`MultiRoom_${WsVars.HotelID}`,JSON.stringify(WSMAIN.MultiRoom));WsMultiRoomCTABannerCart()}WSMAIN.Items.splice(t,1);k();rt(f);st(CartTypeEnum.Removed)}catch(y){console.log(y)}return!1},st=function(t=null){var i,r,u,e;for(this.dvs=null,i=jQuery.extend(!0,{},WSMAIN),i.Msg="",r=0;r<i.Items.length;r++)for(i.Items[r].Cancel="",i.Items[r].Policy="",u=0;u<i.Items[r].Svcs.length;u++)i.Items[r].Svcs[u].Policy="",i.Items[r].Svcs[u].CanPolicy="",i.Items[r].Svcs[u].Name=n(n.parseHTML(i.Items[r].Svcs[u].Name)).text(),i.Items[r].Svcs[u].Desc=n(n.parseHTML(i.Items[r].Svcs[u].Desc)).text(),i.Items[r].Svcs[u].Desc="";i.Saved=WsVars.CartID;delete i.window;e={hgID:WsVars.HgID,hotelID:WsVars.HotelID,langID:WsVars.LangID,currID:WsVars.CurrencyId,wscart:JSON.stringify(i),CartType:t,wsmultiroom:JSON.stringify(f)};n("body").css({cursor:"wait"});n.ajax({type:"POST",url:"xml/setcart.aspx",data:e,dataType:"json",success:function(n){if(n.Msg!=null&&n.Msg.length>0&&WsVars.CurrencyId=="900"&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WSMAIN.IsLoggedIn()&&WsVars.EnablePayByPoints=="1")return WSMAIN.AlertAlt(n.Msg),!1;location.reload()},error:function(){n("body").css({cursor:"auto"})}})};this.GetAdults=function(){return l};this.GetChild1=function(){return h};this.GetChild2=function(){return v};this.GetChild3=function(){return y};this.GetChild4=function(){return p};this.GetChildren=function(){return h+v+y+p};this.GetChildAges=function(){return o};this.GetOccupancy=function(){return l+h+v+y+p};this.Show=function(){g!==!0&&(ut(),WsVars.EnhancedMultiroom.toLowerCase()=="true"&&(s.Page==="ROOMDETAIL"||s.Page==="RATEDETAIL")&&(e.find(".cnAdults,.cnChildren,.cnRooms,.cnChild1,.cnChild2,.cnChild3,.cnChild4").hide(),nt()),g=!0)};this.IsDiff=function(){let n=[],t=[];return(typeof o!="undefined"&&o!=null&&o!=""&&(n=o.slice(0)),typeof a.ChildrenAges!="undefined"&&a.ChildrenAges!=null&&a.ChildrenAges!=""&&(t=a.ChildrenAges.slice(0)),l!=a.Adults||h!=a.Child1||v!=a.Child2||y!=a.Child3||p!=a.Child4||!Utils.IsArrayEqual(n,t))?!0:!1}}}function o(t,i,r,u){var b=this,fi=!1,dt=!1,gt=!1,k=0,d=10,e=-1,a=-1,v=0,at=[],f=[],h=[],vt=[],l=[],g,yt=null,pt=null,ni=null,ti=null,nt=null,y=[],w=[],ot=!1,p=[],ei=null,oi=null,si=null,hi=null,ci=null,li=null,tt=null,st=null,ut=null,ai=null,vi=null,ui;_rtTaxFeeAmt=[];var c=t,it=i,bi=it.HotelID,yi=Number(WsVars.LangID),ft=r,o=u,ht=i.PkgID;WsVars.MaxLeadTime!=null&&(d=Math.round(WsVars.MaxLeadTime/30.42)-1,d<0&&(d=0));var rt=Utils.GetDate(WsVars.DtLocal,"M/d/yyyy"),ct=Utils.GetIndexFromY2K(rt),ki=Utils.GetIndexFromY2K(new Date(rt.getFullYear(),rt.getMonth(),1)),pi=Utils.GetIndexFromY2K(new Date(rt.getFullYear(),rt.getMonth()+d+2,0));c.data("MyCal",this);var di=function(){var r,i="",t;for(g=c.find(".dvCalMonths").filter(":first"),yt=c.find(".calprev a").filter(":first"),pt=c.find(".calnext a").filter(":first"),ni=c.find(".txNights").filter(":first"),ti=c.find(".ws-cart-dates").filter(":first"),ei=c.find(".buClearDates").filter(":first"),oi=c.find(".ws-start-mod").filter(":first"),si=c.find(".ws-cancel-mod").filter(":first"),hi=c.find(".ws-close-mod").filter(":first"),ci=c.find(".ws-mod-date-go").filter(":first"),li=c.find(".ws-mod-date-close").filter(":first"),tt=c.find(".ws-mod-dates").filter(":first"),st=c.find(".dvWsOpenClose").filter(":first"),ut=c.find(".ws-modify-options").filter(":first"),vi=c.find(".ws-input-text").filter(":first"),yt.click(function(){return k>0&&(n("#hdCalPrevNext").val("true"),k--,bt()),n(".ws-tip-close").click(),!1}),pt.click(function(){return k<=d&&(n("#hdCalPrevNext").val("true"),k++,bt()),n(".ws-tip-close").click(),!1}),ei.click(function(){return nr(),!1}),oi.click(function(){var t=c.find(".ws-hdDuettoGuest").filter(":first").val();return t!=""&&t=="True"?n.magnificPopup.open({items:{src:"#divloyaltyMsg",type:"inline"},callbacks:{close:function(){return n.magnificPopup.proto.close.call(this),!1}},midClick:!0}):(ut.addClass("ws-show-this"),WsVars.IBESkinVer=="3"&&ut.removeClass("ws-hide-action"),c.addClass("ws-modifying"),c.find(".ws-cart-addonConciergeMod").filter(":first").removeClass("ws-hide-action"),gt=!0,c.trigger("ModStart")),!1}),si.click(function(){return b.ShowModCancelState(),c.trigger("ModCancel"),!1}),hi.click(function(){return ut.removeClass("ws-show-this"),c.removeClass("ws-modifying"),tt.removeClass("ws-show-this"),st.removeClass("ws-open"),WsVars.IBESkinVer=="3"&&(ut.addClass("ws-hide-action"),tt.addClass("ws-hide-action")),c.find(".ws-cart-addonConciergeMod").filter(":first").addClass("ws-hide-action"),!1}),ci.click(function(){if(tt.addClass("ws-show-this"),st.addClass("ws-open"),WsVars.IBESkinVer=="3"){var i=n(this).parents(".ws-product-item"),t=i.attr("ix");n(".lbItinCheckIn,.lbItinCheckIn2").html(WsMulti.CheckIn);n(".lbItinCheckOut,.lbItinCheckOut2").html(WsMulti.CheckOut);i.find("#spCheckIn").attr("id","spCheckIn_"+t);i.find("#spCheckOut").attr("id","spCheckOut_"+t);i.find("#lbItinCheckIn").attr("id","lbItinCheckIn_"+t);i.find("#lbItinCheckOut").attr("id","lbItinCheckOut_"+t);i.find("#lbItinCheckIn_"+t).attr("for","spCheckIn_"+t);i.find("#lbItinCheckOut_"+t).attr("for","spCheckOut_"+t);tt.removeClass("ws-hide-action");vi.removeClass("ws-hide").addClass("ws-show-this");b.ShowDates(it,t)}return!1}),li.click(function(){return tt.removeClass("ws-show-this"),st.removeClass("ws-open"),WsVars.IBESkinVer=="3"&&tt.addClass("ws-hide-action"),!1}),k=Utils.MonthDiff(rt,Utils.GetDateFromY2K(e)),k<0&&(k=0),k>d&&(k=d),t=0;t<d+2;t++)r=new s(rt,t,yi,ft,it.Currency),i+=r.GetHtml();for(i+='<p class="rateMsg"><\/p>',i+='<p class="ws-includeResortFeeMsg"><\/p>',(WsVars.IsWynnProperty=="1"||WsVars.EnableCalendar=="1")&&(i+=WsVars.IsWynnProperty=="0"?'<p class="ws-legend"><span class="ws-legend-item"><span class="ws-legend-color wsclosed"><\/span>'+WsMulti.LbLegendClosed+'<\/span><span class="ws-legend-item"><span class="ws-legend-color wsclosed wsoutonly"><\/span>'+WsMulti.LbLegendOutOnly+'<\/span><span class="ws-legend-item"><span class="ws-legend-color wscta"><\/span>'+WsMulti.LbLegendCta+"<\/span><\/p>":'<p class="ws-legend"><span class="ws-legend-item"><span class="ws-legend-color wspromo"><\/span>'+WsMulti.LbLegendAvail+'<\/span><span class="ws-legend-item"><span class="ws-legend-color wsclosed"><\/span>'+WsMulti.LbLegendClosed+'<\/span><span class="ws-legend-item"><span class="ws-legend-color wsclosed wsoutonly"><\/span>'+WsMulti.LbLegendOutOnly+'<\/span><span class="ws-legend-item"><span class="ws-legend-color wscta"><\/span>'+WsMulti.LbLegendCta+"<\/span><\/p>"),g.append(i),ai=c.find(".rateMsg").filter(":first"),ai.html(Utils.Format(WsMulti.RateCalendarMeta,WsVars.Currency)),t=0;t<d+2;t++)at[t]=n("#dvMonth_"+ft+"_"+t);for(t=ki;t<ct;t++)f[t]=n("#dv_"+ft+"_"+t),f[t].addClass("blocked");for(t=ct;t<=pi;t++){if(f[t]=n("#dv_"+ft+"_"+t),f[t].addClass("pointer"),WsVars.IBESkinVer=="3"){let i=new moment(Utils.GetDateFromY2K(t));const r=new Date(i).toDateString();f[t].attr("tabindex",0);f[t].attr("aria-label",r);f[t].attr("aria-selected",!1);n(".dtCheckout").attr("aria-selected",!0);n(".dtSelected").attr("aria-selected",!0);f[t].keydown(function(t){b.KeyboardNavigation(t,Number(n(this).attr("ref")))});n(".calMonth").hasClass=="visible"&&n(".calMonth.visible").find(".pointer").attr("tabindex",0)}f[t].click(function(){return wi(Number(n(this).attr("ref"))),!1});f[t].mouseover(function(){return gi(Number(n(this).attr("ref"))),!1});f[t].on("setCheckOut",function(){return wt(Number(n(this).attr("ref"))),!1});f[t].on("setCheckIn",function(){return et(Number(n(this).attr("ref"))),!1});l[t]=n("#dv_"+ft+"_"+t+" span:not(.ws-incl-taxfee)");_rtTaxFeeAmt[t]=n("#dv_"+ft+"_"+t+" span.ws-incl-taxfee");w[t]=n("#dv_"+ft+"_"+t+" span.ws-strikeEnable");w[t].css("display","none")}(f[ct].addClass("today"),it!=null)&&(e=it.Dt1,v=it.Nights,a=e+v,k=Utils.MonthDiff(rt,Utils.GetDateFromY2K(e)))},lt=function(t,i){e=t;a=i;WsVars.RefreshCalendarOnLOSChange=="1"&&a-e!=0&&v!=a-e&&bt();v=a-e;ui();var r=document.getElementById("IsDateChange");t!=i&&i>t&&r&&(r.value="true");e!=Document.calendarAvaildate1&&n("#dvMessage").text()!=""&&(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&n("#dvMessage").addClass("ws-show-this")},et=function(n){return lt(n,a)},wt=function(n){return lt(e,n)},wi=function(t){return((o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&n("#dvMessage").length>0&&n("#dvMessage").text()!=""&&n("#dvMessage").text(""),v>0&&(t<e-2||t>a+2))?lt(t,t):e<=0?lt(t,t):t===e?e===a?et(a-1):et(e+1):t===a?wt(a-1):t<e?et(t):t>a||a>t&&o.Page==="CONFIRM"?wt(t):t>e&&a>t?et(t):t-e>=a-t?wt(t):et(t)},gi=function(t){var r=0,i=0;WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"&&WsVars.HoveredAddToDisplayTaxesForCalendar=="1"&&(r+=h[t],i+=p[t],isNaN(i)||i==0||n("#dv_"+t).hasClass("dtCheckout")||calendarTooltip(f[t],t,Math.round(Number(r)),Math.round(Number(i)),Math.round(Number(r+i))))},nr=function(){(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&n("#dvMessage").length>0&&n("#dvMessage").text()!=""&&n("#dvMessage").text("");lt(0,0);n(".ws-tip-destroy").click()},bt=function(){k<=0?yt.css({visibility:"hidden"}):yt.css({visibility:"visible"});k>d?pt.css({visibility:"hidden"}):pt.css({visibility:"visible"});for(var n=0;n<d+2;n++)at[n].removeClass("visible secondmonth");at[k].addClass("visible");k<=d&&at[k+1].addClass("visible secondmonth");v>0&&kt()},kt=function(){var y=null,e=null,i,r,u,t,h,f,l,a;if(o.Items!=null&&o.Items.length>0&&o.Items[0]!=null&&(y=o.Items[0].CrsID,e=o.Items[0].Group),typeof e=="undefined"&&(e=""),dt!==!1){i=c.data("MyOcc");r=c.data("MyRmRc");mycal=c.data("MyCal");var p=Utils.GetDateFromY2K(mycal.GetArrival()),w=Utils.DateFormat(p,WsDtFm[Number(WsVars.LangID)]),s=o.RcID;s===0&&(s=r.GetRcID());u=o.RmID;(WsVars.IsHiltonPMS==1&&typeof u=="undefined"||u===0)&&(u=r.GetRmID());typeof ht=="undefined"&&(ht=0);(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&(ht=r.GetPkgID());ht>0&&(s=0);t=Utils.GetParam("showQualifiedRates");typeof t!="undefined"&&t!==null?t.toLowerCase()==="true"&&(t="&showQualifiedRates=true"):(t=JSON.parse(n.cookie("showQualifiedRate_"+WsVars.HotelID)),t=typeof t!="undefined"&&t!==null&&t===!0?"&showQualifiedRates=true":"");h="";WsVars.EnhancedMultiroom.toLowerCase()=="true"?(f=i.GetChildAges(),typeof f!="undefined"&&f!==null&&f.length>0&&(h="&childAges="+f.toString())):h="&children="+i.GetChild1()+","+i.GetChild2()+","+i.GetChild3()+","+i.GetChild4();l="";typeof WsVars.GuestLoyalty!="undefined"&&WsVars.GuestLoyalty!=null&&WsVars.GuestLoyalty!=""&&(l="&memberID="+WsVars.GuestLoyalty);a="";WsVars.IsRoomGroupTowerEnabled=="1"&&(a="&reqRoomGroups="+r.GetGroupTowerCode());n.ajax({url:"xml/getratecalendar.aspx?refer=widget&rateReturnType=All&hotelID="+bi+"&hgID="+WsVars.HgID+"&langID="+WsVars.LangID+"&currID="+WsVars.CurrencyId+"&ix="+k+"&rcID="+s+"&adults="+i.GetAdults()+h+"&step="+WsVars.Step+"&pkgID="+ht+"&nights="+v+"&rmID="+u+"&dt1="+WsVars.DtLocal+"&checkin="+w+l+t+"&crsid="+y+"&group="+e+a,dataType:"json",cache:!1,success:function(n){var t,i;n.requestInfo!==undefined?(nt=null,k<=0&&n.rates!==undefined&&n.rates.length>0&&(t=Utils.GetDate(WsVars.DtLocal,"M/d/yyyy"),n.rates=n.rates.filter(function(n){return Utils.GetDate(n.date,"yyyy-MM-dd")>=t}),n.rates.length>0?n.dateRange.startDate=n.rates[0].date+"T00:00:00":(i=new Date,n.dateRange.startDate=Utils.DateFormat(i,"yyyy-MM-dd")+"T00:00:00")),ii(n)):ri(n)},error:function(){}})}},tr=function(n,t,i){return t===null||t.length===0?n:t.length>i&&t[i].length>0&&t[i]!=="0"?Number(t[i]):n},ir=function(n,t){var i=n.split(",");return i.length>t&&i[t]==="C"?!0:!1},ii=function(t){var lt,at,rt,ri,dt,gt,ct,i,wt,bt;if((t===null||n.isEmptyObject(t)?t=nt:nt=t,t!==null&&!n.isEmptyObject(t))&&t.rates!==undefined){ot=!0;var ni=c.data("MyRmRc"),ui=ni.GetRcID(),ti=ni.GetRmID(),s=[],ii=new Date(t.dateRange.startDate),fi=new Date(t.dateRange.endDate),ut=0,ft=0;for(lt=ii;lt<=fi;lt=Utils.DateAdd(lt,1))at=Utils.DateFormat(lt,"yyyy-MM-dd"),rt=null,t.rates!==undefined&&t.rates.length>0&&(rt=t.rates.filter(function(n){return n.date===at&&n.roomTypeID==ti&&n.rateCodeID==ui})),rt!=null&&rt.length>0?s.push(rt[0]):(t.rates!==undefined&&t.rates.length>0&&(rt=t.rates.filter(function(n){return n.date===at&&n.roomTypeID==0&&n.rateCodeID==0})),rt!=null&&rt.length>0?s.push(rt[0]):(ri={date:at,roomTypeID:0,roomTypeCode:"",rateCodeID:0,rateCode:"",amount:-999,strikeRateAmount:-999,compNight:!1,avalStatus:"C",invCount:0,loyaltyPublicPromo:!1,addToDisplayTaxFees:0,addToDisplayStrikeTaxFees:0},s.push(ri)));var ei=!1,d,it,et,i,st,tt,r=Utils.GetIndexFromY2K(ii),k,yt,ht=s.length,kt=SHRWindsurfer.WsLoyaltyHandler.hasActiveLoyaltyProgram(),pt=WsVars.GuestLoyalty==""?!1:!0;(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&(ei=!pt&&rc!=null&&rc.IsPublicPromo=="True"&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountHiddenForLoyaltyRates);dt=!1;try{for(gt=0,i=r;i<r+ht;i++)i<e||i>a?(h[i]=0,y[i]=0,p[i]=0,vt[i]=!1,f[i].removeClass("wspromo wsclosed wscta wsctd wsthru wsmin wsmax wsmnld wsmxld wsoutonly").attr("wsmin",0).attr("wsmax",0).attr("wsmnld",0).attr("wsmxld",0).attr("wsmina",0).attr("wsmaxa",0)):f[i].hasClass("wspromo")&&f[i].removeClass("wsclosed wscta wsctd wsthru wsmin wsmax wsmnld wsmxld wsoutonly").attr("wsmin",0).attr("wsmax",0).attr("wsmnld",0).attr("wsmxld",0).attr("wsmina",0).attr("wsmaxa",0),s.length>0&&s[gt].strikeRateAmount>0&&(dt=!0),gt++;dt===!0&&n(".calDays div").each(function(){n(this).addClass("calStrike")});WsVars.EnableCompRate=="1"?SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1?kt&&pt?g.addClass("wscomp"):g.removeClass("wscomp"):g.addClass("wscomp"):g.removeClass("wscomp")}catch(oi){}if(this.View===0||ti===0){for(i=0;i<ht;i++)if(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL"||i+r<e||i+r>a){if(d=s[i].amount,tt=s[i].strikeRateAmount,st=s[i].avalStatus,k=s[i].addToDisplayTaxFees,yt=s[i].addToDisplayStrikeTaxFees,it=Number(d),WsVars.IsWynnProperty=="1"||WsVars.EnableCalendar=="1"){if(st=="C"){h[r+i].addClass("wsclosed");continue}switch(st){case"A":f[r+i].addClass("wscta");break;case"D":f[r+i].addClass("wsctd");break;case"S":f[r+i].addClass("wsthru")}}ct=r+i;(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"&&ct>=e&&ct<a&&(ut=ut+it,ft=ft+k,k=0);it>.09&&(h[i+r]===0||it<h[i+r])&&s[i].compNight==!1?(h[i+r]=(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"?it:it+Number(k),Number(k)!=0&&(p[i+r]=Number(k)),SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.SHRSS&&it>6e3&&WsVars.EnableCalendar=="1"?f[i+r].addClass("wsclosed"):f[i+r].removeClass("wspromo")):it>=0&&s[i].compNight==!0&&WsVars.EnableCompRate=="1"?(h[i+r]=it,Number(k)!=0&&(p[i+r]=Number(k)),SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1?kt&&pt?f[i+r].addClass("wspromo"):f[i+r].removeClass("wspromo"):f[i+r].addClass("wspromo")):tmpRT==0&&s[i].hideRate==!0&&(vt[i+r]=!0);tt!=null&&tt!=""&&tt>0&&(et=Number(tt),et>9&&(y[i+r]===0||et<y[i+r])?y[i+r]=et:et>=0&&s[i].compNight==!0&&WsVars.EnableCompRate=="1"&&(y[i+r]=et))}}else for(i=0;i<ht;i++)if(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL"||i+r<e||i+r>a){if(d=s[i].amount,tt=s[i].strikeRateAmount,st=s[i].avalStatus,k=s[i].addToDisplayTaxFees,yt=s[i].addToDisplayStrikeTaxFees,it=Number(d),WsVars.IsWynnProperty=="1"||WsVars.EnableCalendar=="1"){if(st=="C"){f[r+i].addClass("wsclosed");continue}switch(st){case"A":f[r+i].addClass("wscta");break;case"D":f[r+i].addClass("wsctd");break;case"S":f[r+i].addClass("wsthru")}}ct=r+i;(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"&&ct>=e&&ct<a&&(ut=ut+it,ft=ft+k,k=0);Number(d)>.09?(h[i+r]=(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"?Number(d):Number(d)+Number(k),p[i+r]=Number(k),SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.SHRSS&&d>6e3&&WsVars.EnableCalendar=="1"&&f[i+r].addClass("wsclosed")):s[i].compNight==!0&&WsVars.EnableCompRate=="1"&&(d>=0?(p[i+r]=Number(k),h[i+r]=Number(d)):d==-999&&(WsVars.IsWynnProperty=="1"?f[i+r].addClass("wsclosed"):WsVars.EnableCalendar=="1"&&f[i+r].addClass("wsclosed")));WsVars.EnableCompRate=="1"&&s[i].compNight==!0&&d>=0?(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.SHRSS||(i+r<e||i+r>a)&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1)&&(kt&&pt?f[i+r].addClass("wspromo"):f[i+r].removeClass("wspromo")):d==0&&s[i].hideRate==!0&&(vt[i+r]=!0);tt!=null&&tt!=-999&&tt>0&&(Number(tt)>.09?y[i+r]=Number(tt)+Number(yt):s[i].compNight==!0&&WsVars.EnableCompRate=="1"&&tt>=0&&(y[i+r]=Number(tt)+Number(yt)))}try{if(s.length>0&&WsVars.EnableCalendar=="1")for(i=r;i<r+ht;i++)(i<e||i>a)&&(s[i-r].compNight==!0&&WsVars.EnableCompRate=="1"?h[i]>=0?(l[i].html(Math.round(h[i])),l[i].attr("amt",Math.round(h[i])),y[i]>0&&y[i]!=""&&b.ShowStrikeRates(Math.round(h[i]),Math.round(y[i]),i,!1),p[i]>0?(_rtTaxFeeAmt[i].html(Math.round(p[i])),_rtTaxFeeAmt[i].attr("amt",Math.round(p[i])),_rtTaxFeeAmt[i].hide()):(_rtTaxFeeAmt[i].html(""),_rtTaxFeeAmt[i].attr("amt",""))):(l[i].html(""),l[i].attr("amt",""),_rtTaxFeeAmt[i].html(""),_rtTaxFeeAmt[i].attr("amt",""),this.View===2&&(WsVars.IsWynnProperty=="1"?f[i].addClass("wsclosed"):WsVars.EnableCalendar=="1"&&f[i].addClass("wsclosed"))):(h[i]>0?(l[i].html(Math.round(h[i])),l[i].attr("amt",Math.round(h[i]))):(l[i].html(""),l[i].attr("amt",""),this.View===2&&(WsVars.IsWynnProperty=="1"?f[i].addClass("wsclosed"):h[i]==0&&vt[i]==!0?(l[i].html(""),l[i].attr("amt","")):WsVars.EnableCalendar=="1"&&f[i].addClass("wsclosed"))),p[i]!=0?(_rtTaxFeeAmt[i].html(Math.round(p[i])),_rtTaxFeeAmt[i].attr("amt",Math.round(p[i])),_rtTaxFeeAmt[i].hide()):(_rtTaxFeeAmt[i].html(""),_rtTaxFeeAmt[i].attr("amt","")),h[i]!==""&&h[i]>=0&&y[i]!=""&&y[i]>0?b.ShowStrikeRates(Math.round(h[i]),Math.round(y[i]),i,!1):w[i].css("display","none")));else for(i=0;i<h.length;i++)h[i]>0&&(h[i]=0,l[i].html(""),l[i].attr("amt",""))}catch(oi){}for(i=r;i<r+ht;i++)try{f[i].hasClass("wsclosed")&&!f[i-1].hasClass("wsclosed")&&(f[i].addClass("wsoutonly"),w[i].css("display","none"),_rtTaxFeeAmt[i].css("display","none"));f[i].hasClass("wspromo")&&h[i]==0&&l[i].attr("amt")==0&&(l[i].html(""),l[i].attr("amt",""),p[i]>0?(_rtTaxFeeAmt[i].html(Math.round(p[i])),_rtTaxFeeAmt[i].attr("amt",Math.round(p[i])),_rtTaxFeeAmt[i].css("display","block")):(_rtTaxFeeAmt[i].html(""),_rtTaxFeeAmt[i].attr("amt","")));ft!=0&&(wt=0,bt=0,ut>0&&(wt=ut/v),bt=ft/v,calendarTooltip(f[a],a,Math.round(Number(wt)),Math.round(Number(bt)),Math.round(Number(wt+bt))))}catch(oi){}try{WsVars.CartItems.length>0&&WsVars.CartItems.forEach(function(t){var e=0,h,i,s,f;if(u.Page==="CONFIRM"?(h=Number(n(".ws-modifying:first").attr("ix")),e=h):e=t.RoomIndex,i=n('span[roomindex="'+e+'"]'),s=!1,t.TaxInfo&&Array.isArray(t.TaxInfo))for(f=0;f<t.TaxInfo.length;f++)if(t.TaxInfo[f].AddToDisplayAmount===!0){s=!0;break}if(s){if(i.show(),i.html(WsMulti.AddToDisplayTaxFeeDetails),n(".ws-includeResortFeeMsg").show(),WsVars.SplitOutAddToDisplayTaxesForCalendar!=="1"||WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"&&o.Page!=="RATEDETAIL"&&o.Page!=="ROOMDETAIL"){let n=Utils.Format('<span class="ws-number" ref="{0}">{0}<span class="ws-csymbol"> {1}<\/span><\/span>',Math.round(p[r]),WsVars.Currency),t=b.CheckIncludeResortFee(p,r,ht)?n:SHR.__("Appropriate");g.find(".ws-includeResortFeeMsg").filter(":first").html(Utils.Format(SHR.__("CalendarAllDatesIncludeResortFee"),t))}}else i.hide(),i.html("")})}catch(oi){console.error(oi)}typeof WsShowRates!="undefined"?WsShowRates():WsVars.UseCurrCode==="0"&&WsVars.CSymbol==="$"&&n(".calDays span").each(function(){var t=n(this).attr("amt");if(t==null||t.length===0)return!0;n(this).text("$"+Math.round(Number(t)))})}},ri=function(t){var ct,k,fi,dt,tt,ut,rt,bt,oi,gt,s,it,d,ei,i,ni,ti;if(t===null||n.isEmptyObject(t)?t=nt:nt=t,ct=SHRWindsurfer.WsLoyaltyHandler.hasActiveLoyaltyProgram(),t!==null&&!n.isEmptyObject(t)){var lt=t.IsLoggedIn==="1",et,si=null,ht=null,ft,r,ii,ri,st,hi,w=Number(t.Ix1),vt=Utils.GetDaysInTwoMonths(w),yt=!1,ot,pt=0,wt=0;(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&(yt=!lt&&rc!=null&&rc.IsPublicPromo==="True"&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfigEnum.ShowSignInSignUpWithAmountHiddenForLoyaltyRates);try{for(i=w;i<w+vt;i++)WsVars.EnableCalendar!="1"?(h[i]="",y[i]=""):(h[i]=0,y[i]=0),p[i]=0,f[i].removeClass("wspromo wsclosed wscta wsctd wsthru wsmin wsmax wsmnld wsmxld wsoutonly").attr("wsmin",0).attr("wsmax",0).attr("wsmnld",0).attr("wsmxld",0).attr("wsmina",0).attr("wsmaxa",0);typeof t.IsStrikeEnable!="undefined"&&t.IsStrikeEnable==="True"&&n(".calDays div").each(function(){n(this).addClass("calStrike")});ct&&lt&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1&&(t.CompOL==="1"||WsVars.EnableCompRate=="1"?this.Tgt.addClass("wscomp"):this.Tgt.removeClass("wscomp"))}catch(li){}k=c.data("MyRmRc");k!==undefined&&k||(k=function(){return},k.GetRmID=function(){return},k.GetRcID=function(){return},k.GetRateOL=function(){return});var at=k.GetRmID(),ci=k.GetRcID(),kt=k.GetRateOL(),ui="0",ai=n("#dvMessage").hasClass("ws-show-this");if(at===0&&(o.Page==="ROOMDETAIL"?at=o.RmID:o.Page==="RATEDETAIL"&&t.RoomTypes.length>0&&(at=t.RoomTypes[0].RmID)),n("#dvMessage").text()!=""&&!ai&&at>0&&n("#dvMessage").addClass("ws-show-this"),rc!==undefined&&rc||(rc=function(){return}),at>0){if(t.CompOL==="1"||WsVars.EnableCompRate=="1"?g.addClass("wscomp"):g.removeClass("wscomp"),typeof t.RoomTypes!="undefined")for(i=0;i<t.RoomTypes.length;i++)if(Number(t.RoomTypes[i].RmID)===at){for(et=t.RoomTypes[i].Rates.split(","),st=t.RoomTypes[i].StrikeThroughRates.split(","),hi=t.RoomTypes[i].Avails.split(","),ot=t.RoomTypes[i].AddToDisplayTaxFee.split(","),s=0;s<et.length;s++){if(hi[s]==="C"){f[s+w].addClass("wsclosed");continue}rc.IsCompRate=="True"&&WsVars.EnableCompRate=="1"?et[s]===""?(ft="",ui="1"):(ft=Number(et[s]),Number(ot[s])!=0&&(p[s+w]=Number(ot[s])),ui="2"):ct&&lt&&WsVars.EnableCompRate=="1"&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1?et[s]===""?ft="":(ft=Number(et[s]),Number(ot[s])!=0&&(p[s+w]=Number(ot[s]))):(ft=Number(et[s]),Number(ot[s])!=0&&(p[s+w]=Number(ot[s])));ft===""&&(h[s+w]=ft,Number(ot[s])!=0&&(p[s+w]=Number(ot[s])));ri=ir(t.RoomTypes[i].Avails,s);ft>9&&!ri?(h[s+w]=(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"?ft:ft+Number(ot[s]),Number(ot[s])!=0&&(p[s+w]=Number(ot[s])),SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.SHRSS&&ft>6e5&&f[s+w].addClass("wsclosed")):ft>=0&&ri?h[s+w]="-0.01":ft<0&&(h[s+w]="-0.01")}if(st!=null&&st!=""&&st.length>0){for(s=0;s<st.length;s++)y[s+w]=Number(st[s]);if(it=k.GetRoomStay(),it!==null&&(d=it.Daily.split(","),fi=it.DailyAddAmtToDisplayTaxAndResortFee.split(","),d.length===v))for(i=0;i<v;i++)d[i]=Math.round(Number(d[i])+Number(fi[i])),y[e+i]>0&&y[e+i]!=""&&b.ShowStrikeRates(Math.round(d[i]),Math.round(y[e+i]/100),e+i,!0)}try{if(si=t.RoomTypes[i].Blends.length>0?t.RoomTypes[i].Blends.split(","):null,t.RoomTypes[i].Bases.length>0)if(ht=t.RoomTypes[i].Bases.split(","),t.CompOL==="0"){for(rt=0;rt<et.length;rt++)h[rt+w]>9&&(ht[rt].length===0||Number(ht[rt])>h[rt+w])&&f[rt+w].addClass("wspromo");if(it=k.GetRoomStay(),it!==null&&(d=it.Daily.split(","),d.length===v))for(ut=0;ut<ht.length;ut++)tt=w+ut,tt>=e&&tt<a&&(ht[ut].length===0||Number(ht[ut])/100>Number(d[tt-e])?f[tt].addClass("wspromo"):Number(ht[ut])/100<Number(d[tt-e])&&f[tt].removeClass("wspromo"))}else{for(rt=0;rt<et.length;rt++)h[rt+w]>9&&Number(ht[rt])==h[rt+w]&&Math.floor(Number(ht[rt]))%1e3==100&&f[rt+w].addClass("wspromo");if(dt=0,it=k.GetRoomStay(),it!==null&&(d=it.Daily.split(","),d.length===v)){for(ut=0;ut<ht.length;ut++)tt=w+ut,tt>=e&&tt<a&&(Number(d[tt-e])==0&&Math.floor(Number(ht[ut]))%1e3==100?(f[tt].addClass("wspromo"),dt=dt+1):f[tt].removeClass("wspromo"));if(WSMAIN.IsLoggedIn()&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.MavrickCRM&&WsVars.EnablePayByPoints=="1"&&WsVars.CurrencyId==900&&it.Amt>WSMAIN.LoyaltyPoints)return k.Alert(WsMulti.MsgIternaryAmountExceedsAvailablePoints),n("#buCheckout").addClass("ws-disabled"),n("#dvMessage").length>0&&c.trigger("AvailError",n("#dvMessage"),WsMulti.MsgIternaryAmountExceedsAvailablePoints),!1}if(d.length===v&&n("#hdCalPrevNext").val()==="false")if(kt&&k.GetIsOLResVal()&&v>0)if(o.Page==="CONFIRM")n("#buModifyResv").addClass("ws-disabled"),k.Alert(WsMulti.COMP7dayValidation);else if(o.Page==="PROMO")c.trigger("AvailError",[WsMulti.COMP7dayValidation,"PROMO"]);else return n("#buCheckout").addClass("ws-disabled"),c.trigger("AvailError",n('div[ix="'+i+'"]'),WsMulti.COMP7dayValidation),!1;else if(kt&&k.GetOLMaxCompNights()>0&&dt>k.GetOLMaxCompNights())if(o.Page==="CONFIRM")n("#buModifyResv").addClass("ws-disabled"),k.Alert(WsMulti.MaxCompNightsPerRoom);else if(o.Page==="PROMO")c.trigger("AvailError",[WsMulti.MaxCompNightsPerRoom,"PROMO"]);else return n("#buCheckout").addClass("ws-disabled"),c.trigger("AvailError",n('div[ix="'+i+'"]'),WsMulti.MaxCompNightsPerRoom),!1;else if(kt&&k.GetOLOfferMinLOS()>0&&v>0&&v<k.GetOLOfferMinLOS())if(o.Page==="CONFIRM")n("#buModifyResv").addClass("ws-disabled"),k.Alert(WsMulti.CompOfferMinLOS);else if(o.Page==="PROMO"||o.Page==="RATEDETAIL")c.trigger("AvailError",[WsMulti.CompOfferMinLOS,"PROMO"]);else return n("#buCheckout").addClass("ws-disabled"),c.trigger("AvailError",n("#dvMessage"),WsMulti.CompOfferMinLOS),!1;else kt&&k.GetOLIncentiveMinLOS()>0&&v>0&&v<k.GetOLIncentiveMinLOS()&&(o.Page==="CONFIRM"?k.Alert(WsMulti.CompIncentiveMinLOS):o.Page==="PROMO"||o.Page==="RATEDETAIL"?WSMAIN.Rooms<=WSMAIN.AvailRooms&&c.trigger("AvailError",[WsMulti.CompIncentiveMinLOS,"PROMO"]):c.trigger("AvailError",n("#dvMessage"),WsMulti.CompIncentiveMinLOS))}else if(WsVars.EnableCompRate=="1"){if(it=k.GetRoomStay(),it!==null){var d=it.Daily.split(","),ei=it.CompDaily.split(","),fi=it.DailyAddAmtToDisplayTaxAndResortFee.split(",");if(v>0&&d.length===v){for(ut=0;ut<d.length;ut++)tt=e+ut,d[ut]=Math.round(Number(d[ut])+Number(fi[ut])),tt>=e&&tt<a&&(Number(d[tt-e])==0&&ei[ut]==="True"?f[tt].addClass("wspromo"):f[tt].removeClass("wspromo")),Number(d[tt-e])>=0&&y[tt]!==""&&y[tt]>=0&&b.ShowStrikeRates(Math.round(Number(d[tt-e])),Math.round(y[tt]/100),tt,!1);if(WSMAIN.IsLoggedIn()&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.MavrickCRM&&WsVars.EnablePayByPoints=="1"&&WsVars.CurrencyId==900&&it.Amt>WSMAIN.LoyaltyPoints)return k.Alert(WsMulti.MsgIternaryAmountExceedsAvailablePoints),n("#buCheckout").addClass("ws-disabled"),n("#dvMessage").length>0&&c.trigger("AvailError",n("#dvMessage"),WsMulti.MsgIternaryAmountExceedsAvailablePoints),!1}}}else if(t.CompOL==="0")for(rt=0;rt<et.length;rt++)h[rt+w]>9&&f[rt+w].addClass("wspromo")}catch(li){}break}if(ui=="0"&&rc.IsCompRate=="True"&&WsVars.EnableCompRate=="1")for(i=w;i<w+vt;i++)h[i]="",f[i].removeClass("wspromo wsclosed wscta wsctd wsthru wsmin wsmax wsmnld wsmxld wsoutonly").attr("wsmin",0).attr("wsmax",0).attr("wsmnld",0).attr("wsmxld",0).attr("wsmina",0).attr("wsmaxa",0);try{if(WsVars.IsWynnProperty=="1"||WsVars.EnableCalendar=="1")for(s=0;s<t.Avails.length;s++)(r=t.Avails[s],v>0&&r.Dt>=e&&r.Dt<a)||(ii=tr(ci,si,r.Dt-w),r.Entity==="Hotel"||r.Entity==="Channel"&&r.ID===30?r.Cls==="Close"?f[r.Dt].addClass("wsclosed"):r.Cls==="CloseToArrival"?f[r.Dt].addClass("wscta"):r.Cls==="CloseToDeparture"?f[r.Dt].addClass("wsctd"):r.Cls==="StayThroughOnly"?f[r.Dt].addClass("wsthru"):r.Cls==="Min_S_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmin",r.Days)):r.Cls==="Max_S_LOS"?(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmax",r.Days)):r.Cls==="MinLeadTime"?(f[r.Dt].addClass("wsmnld"),f[r.Dt].attr("wsmnld",r.Days)):r.Cls==="MaxLeadTime"?(f[r.Dt].addClass("wsmxld"),f[r.Dt].attr("wsmxld",r.Days)):r.Cls==="Min_A_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmina",r.Days)):r.Cls==="Max_A_LOS"&&(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmaxa",r.Days)):r.Entity==="Roomtype"&&r.ID===at?r.Cls==="Close"?f[r.Dt].addClass("wsclosed"):r.Cls==="CloseToArrival"?f[r.Dt].addClass("wscta"):r.Cls==="CloseToDeparture"?f[r.Dt].addClass("wsctd"):r.Cls==="StayThroughOnly"?f[r.Dt].addClass("wsthru"):r.Cls==="Min_S_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmin",r.Days)):r.Cls==="Max_S_LOS"?(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmax",r.Days)):r.Cls==="MinLeadTime"?(f[r.Dt].addClass("wsmnld"),f[r.Dt].attr("wsmnld",r.Days)):r.Cls==="MaxLeadTime"?(f[r.Dt].addClass("wsmxld"),f[r.Dt].attr("wsmxld",r.Days)):r.Cls==="Min_A_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmina",r.Days)):r.Cls==="Max_A_LOS"&&(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmaxa",r.Days)):r.Entity==="Ratecode"&&r.ID===ii?r.Cls==="Close"?f[r.Dt].addClass("wsclosed"):r.Cls==="CloseToArrival"?f[r.Dt].addClass("wscta"):r.Cls==="CloseToDeparture"?f[r.Dt].addClass("wsctd"):r.Cls==="StayThroughOnly"?f[r.Dt].addClass("wsthru"):r.Cls==="Min_S_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmin",r.Days)):r.Cls==="Max_S_LOS"?(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmax",r.Days)):r.Cls==="MinLeadTime"?(f[r.Dt].addClass("wsmnld"),f[r.Dt].attr("wsmnld",r.Days)):r.Cls==="MaxLeadTime"?(f[r.Dt].addClass("wsmxld"),f[r.Dt].attr("wsmxld",r.Days)):r.Cls==="Min_A_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmina",r.Days)):r.Cls==="Max_A_LOS"&&(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmaxa",r.Days)):r.Entity==="RoomRate"&&r.ID===at&&r.ID2===ii&&(r.Cls==="Close"?f[r.Dt].addClass("wsclosed"):r.Cls==="CloseToArrival"?f[r.Dt].addClass("wscta"):r.Cls==="CloseToDeparture"?f[r.Dt].addClass("wsctd"):r.Cls==="StayThroughOnly"?f[r.Dt].addClass("wsthru"):r.Cls==="Min_S_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmin",r.Days)):r.Cls==="Max_S_LOS"?(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmax",r.Days)):r.Cls==="MinLeadTime"?(f[r.Dt].addClass("wsmnld"),f[r.Dt].attr("wsmnld",r.Days)):r.Cls==="MaxLeadTime"?(f[r.Dt].addClass("wsmxld"),f[r.Dt].attr("wsmxld",r.Days)):r.Cls==="Min_A_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmina",r.Days)):r.Cls==="Max_A_LOS"&&(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmaxa",r.Days))),yt&&f[r.Dt].removeClass("wsclosed"))}catch(li){}}else{if(t.RoomTypes.length>0){for(bt=-1,oi=1e7,i=0;i<t.RoomTypes.length;i++)et=t.RoomTypes[i].Rates.split(","),ot=t.RoomTypes[i].AddToDisplayTaxFee.split(","),gt=Number(et[0]),gt>9&&gt<oi&&(oi=gt,bt=i);if(bt>-1){for(et=t.RoomTypes[bt].Rates.split(","),st=t.RoomTypes[bt].StrikeThroughRates.split(","),s=0;s<et.length;s++)ft=Number(et[s]),ft>9&&(h[s+w]=ft,Number(ot[s])!=0&&(p[s+w]=Number(ot[s])),SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.SHRSS&&ft>6e5&&f[s+w].addClass("wsclosed")),yt&&f[s+w].removeClass("wsclosed");if(st!=null&&st!=""&&st.length>0)for(s=0;s<st.length;s++)y[s+w]=Number(st[s])}}try{if(WsVars.IsWynnProperty=="1"||WsVars.EnableCalendar=="1")for(s=0;s<t.Avails.length;s++)r=t.Avails[s],r.Entity==="Hotel"||r.Entity==="Channel"&&r.ID===30?r.Cls==="Close"?f[r.Dt].addClass("wsclosed"):r.Cls==="CloseToArrival"?f[r.Dt].addClass("wscta"):r.Cls==="CloseToDeparture"?f[r.Dt].addClass("wsctd"):r.Cls==="StayThroughOnly"?f[r.Dt].addClass("wsthru"):r.Cls==="Min_S_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmin",r.Days)):r.Cls==="Max_S_LOS"?(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmax",r.Days)):r.Cls==="MinLeadTime"?(f[r.Dt].addClass("wsmnld"),f[r.Dt].attr("wsmnld",r.Days)):r.Cls==="MaxLeadTime"?(f[r.Dt].addClass("wsmxld"),f[r.Dt].attr("wsmxld",r.Days)):r.Cls==="Min_A_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmina",r.Days)):r.Cls==="Max_A_LOS"&&(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmaxa",r.Days)):r.Entity==="Ratecode"&&r.ID===ci&&(r.Cls==="Close"?f[r.Dt].addClass("wsclosed"):r.Cls==="CloseToArrival"?f[r.Dt].addClass("wscta"):r.Cls==="CloseToDeparture"?f[r.Dt].addClass("wsctd"):r.Cls==="StayThroughOnly"?f[r.Dt].addClass("wsthru"):r.Cls==="Min_S_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmin",r.Days)):r.Cls==="Max_S_LOS"?(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmax",r.Days)):r.Cls==="MinLeadTime"?(f[r.Dt].addClass("wsmnld"),f[r.Dt].attr("wsmnld",r.Days)):r.Cls==="MaxLeadTime"?(f[r.Dt].addClass("wsmxld"),f[r.Dt].attr("wsmxld",r.Days)):r.Cls==="Min_A_LOS"?(f[r.Dt].addClass("wsmin"),f[r.Dt].attr("wsmina",r.Days)):r.Cls==="Max_A_LOS"&&(f[r.Dt].addClass("wsmax"),f[r.Dt].attr("wsmaxa",r.Days))),yt&&f[r.Dt].removeClass("wsclosed")}catch(li){}}if(e<=0)try{for(i=w;i<w+vt;i++)typeof l[i]!="undefined"&&l[i]!=null&&l[i]!=""&&((o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"&&i>=this.Ix1&&i<this.Ix2&&(pt=pt+h[i]/100,wt=wt+this._dailyTaxFeeToDisplay[i]/100),rc.IsCompRate=="True"&&WsVars.EnableCompRate=="1"?h[i]>=0&&h[i]!==""?(l[i].html(Math.round(h[i]/100)),l[i].attr("amt",Math.round(h[i]/100)),ct&&lt&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1&&(WsVars.EnableCompRate!="1"||f[i].hasClass("wsclosed")||Number(h[i])!==0||h[i]===""||(f[i].addClass("wspromo"),p[i]>0&&(_rtTaxFeeAmt[i].html(Math.round(p[i]/100)),_rtTaxFeeAmt[i].attr("amt",Math.round(p[i]/100)),_rtTaxFeeAmt[i].css("display","block")))),y[i]>0&&y[i]!=""&&b.ShowStrikeRates(Math.round(h[i]/100),Math.round(y[i]/100),i,!1)):(l[i].html(""),l[i].attr("amt",""),WsVars.IsWynnProperty=="1"?f[i].addClass("wsclosed"):WsVars.EnableCalendar=="1"&&f[i].addClass("wsclosed")):rc.IsHideRate=="True"?(l[i].html("0"),l[i].attr("amt","0")):(h[i]>0?(l[i].html(Math.round(h[i]/100)),l[i].attr("amt",Math.round(h[i]/100))):(l[i].html(""),l[i].attr("amt",""),WsVars.IsWynnProperty=="1"?f[i].addClass("wsclosed"):ct&&lt&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1?WsVars.EnableCompRate!="1"||f[i].hasClass("wsclosed")||Number(h[i])!==0||h[i]===""?WsVars.EnableCalendar=="1"&&f[i].addClass("wsclosed"):(f[i].addClass("wspromo"),p[i]>0&&(_rtTaxFeeAmt[i].html(Math.round(p[i]/100)),_rtTaxFeeAmt[i].attr("amt",Math.round(p[i]/100)),_rtTaxFeeAmt[i].css("display","block"))):WsVars.EnableCalendar=="1"&&f[i].addClass("wsclosed")),h[i]!==""&&h[i]>=0&&y[i]!=""&&y[i]>0&&b.ShowStrikeRates(Math.round(h[i]/100),Math.round(y[i]/100),i,!1)),yt&&f[i].removeClass("wsclosed"))}catch(li){}else try{for(i=w;i<w+vt;i++)if(typeof l[i]!="undefined"&&l[i]!=null&&l[i]!=""){if((o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"&&i>=e&&i<a&&(pt=pt+h[i]/100,wt=wt+p[i]/100),i<e||i>a)rc.IsCompRate=="True"&&WsVars.EnableCompRate=="1"?h[i]>=0&&h[i]!==""?(l[i].html(Math.round(h[i]/100)),l[i].attr("amt",Math.round(h[i]/100)),ct&&lt&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1&&(WsVars.EnableCompRate!="1"||f[i].hasClass("wsclosed")||Number(h[i])!==0||h[i]===""||(f[i].addClass("wspromo"),p[i]>0&&(_rtTaxFeeAmt[i].html(Math.round(p[i]/100)),_rtTaxFeeAmt[i].attr("amt",Math.round(p[i]/100)),_rtTaxFeeAmt[i].css("display","block")))),y[i]>0&&y[i]!=""&&b.ShowStrikeRates(Math.round(h[i]/100),Math.round(y[i]/100),i,!1)):(l[i].html(""),l[i].attr("amt",""),WsVars.IsWynnProperty=="1"?f[i].addClass("wsclosed"):ct&&lt&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1?WsVars.EnableCompRate!="1"||f[i].hasClass("wsclosed")||Number(h[i])!==0||h[i]===""?WsVars.EnableCalendar=="1"&&f[i].addClass("wsclosed"):(f[i].addClass("wspromo"),p[i]>0&&(_rtTaxFeeAmt[i].html(Math.round(p[i]/100)),_rtTaxFeeAmt[i].attr("amt",Math.round(p[i]/100)),_rtTaxFeeAmt[i].css("display","block"))):WsVars.EnableCalendar=="1"&&f[i].addClass("wsclosed")):rc.IsHideRate=="True"?(l[i].html("0"),l[i].attr("amt","0")):(h[i]>0?(l[i].html(Math.round(h[i]/100)),l[i].attr("amt",Math.round(h[i]/100))):(l[i].html(""),l[i].attr("amt",""),WsVars.IsWynnProperty=="1"?f[i].addClass("wsclosed"):ct&&lt&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1?WsVars.EnableCompRate!="1"||f[i].hasClass("wsclosed")||Number(h[i])!==0||h[i]===""?WsVars.EnableCalendar=="1"&&f[i].addClass("wsclosed"):(f[i].addClass("wspromo"),p[i]>0&&(_rtTaxFeeAmt[i].html(Math.round(p[i]/100)),_rtTaxFeeAmt[i].attr("amt",Math.round(p[i]/100)),_rtTaxFeeAmt[i].css("display","block"))):WsVars.EnableCalendar=="1"&&f[i].addClass("wsclosed")),h[i]!==""&&h[i]>=0&&y[i]!==""&&y[i]>=0&&b.ShowStrikeRates(Math.round(h[i]/100),Math.round(y[i]/100),i,!1));else if(WsVars.EnableCompRate=="1"&&WsVars.EnableCalendar=="0"&&(it=k.GetRoomStay(),it!==null&&(d=it.Daily.split(","),ei=it.CompDaily.split(","),v>0&&d.length===v&&(i>=e&&i<a&&(d[i]=Math.round(Number(d[i])+Number(p[i])),Number(d[i-e])==0&&ei[i-e]==="True"?(f[i].addClass("wspromo"),p[i]>0&&(_rtTaxFeeAmt[i].html(Math.round(p[i]/100)),_rtTaxFeeAmt[i].attr("amt",Math.round(p[i]/100)),_rtTaxFeeAmt[i].css("display","block"))):f[i].removeClass("wspromo"),Number(d[i-e])>=0&&y[i]!==""&&y[i]>=0&&b.ShowStrikeRates(Math.round(Number(d[i-e])),Math.round(y[i]/100),i,!1)),WSMAIN.IsLoggedIn()&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.MavrickCRM&&WsVars.EnablePayByPoints=="1"&&WsVars.CurrencyId==900&&it.Amt>WSMAIN.LoyaltyPoints))))return k.Alert(WsMulti.MsgIternaryAmountExceedsAvailablePoints),n("#buCheckout").addClass("ws-disabled"),n("#dvMessage").length>0&&c.trigger("AvailError",n("#dvMessage"),WsMulti.MsgIternaryAmountExceedsAvailablePoints),!1;yt&&f[i].removeClass("wsclosed")}h[a]===0&&(WsVars.IsWynnProperty=="1"?f[a].addClass("wsclosed"):WsVars.EnableCalendar=="1"&&rc.IsCompRate!="True"&&WsVars.EnableCompRate!="1"&&f[a].addClass("wsclosed"),yt&&f[a].removeClass("wsclosed"))}catch(li){}for(i=w;i<w+vt;i++)try{!f[i].hasClass("wsclosed")||f[i-1].hasClass("wsclosed")||f[i-1].hasClass("blocked")||f[i].addClass("wsoutonly")}catch(li){}for(i=w;i<w+vt;i++)try{f[i].hasClass("wsoutonly")&&h[i]===0&&!f[i-1].hasClass("wspromo")&&f[i].removeClass("wspromo")}catch(li){}try{WsVars.CartItems.length>0&&WsVars.CartItems.forEach(function(t){var f=0,s,i,e,r;if(u.Page==="CONFIRM"?(s=Number(n(".ws-modifying:first").attr("ix")),f=s):f=t.RoomIndex,i=n('span[roomindex="'+f+'"]'),e=!1,t.TaxInfo&&Array.isArray(t.TaxInfo))for(r=0;r<t.TaxInfo.length;r++)if(t.TaxInfo[r].AddToDisplayAmount===!0){e=!0;break}if(e){if(i.show(),i.html(WsMulti.AddToDisplayTaxFeeDetails),n(".ws-includeResortFeeMsg").show(),WsVars.SplitOutAddToDisplayTaxesForCalendar!=="1"||WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"&&o.Page!=="RATEDETAIL"&&o.Page!=="ROOMDETAIL"){let n=Utils.Format('<span class="ws-number" ref="{0}">{0}<span class="ws-csymbol"> {1}<\/span><\/span>',Number(p[w])/100,WsVars.Currency),t=b.CheckIncludeResortFee(p,w,vt)?n:SHR.__("Appropriate");g.find(".ws-includeResortFeeMsg").filter(":first").html(Utils.Format(SHR.__("CalendarAllDatesIncludeResortFee"),t))}}else i.hide(),i.html("")})}catch(li){console.error(li)}typeof WsShowRates!="undefined"?WsShowRates():WsVars.UseCurrCode==="0"&&WsVars.CSymbol==="$"&&(n(".calDays span").each(function(){var t=n(this).attr("amt");if(t==null||t.length===0)return!0;n(this).text("$"+Math.round(Number(t)))}),n(".rateMsg").hide());n("#hdCalPrevNext").val()==="true"&&n("#hdCalPrevNext").val("false");wt!=0&&(ni=0,ti=0,pt>0&&(ni=pt/v),ti=wt/v,calendarTooltip(f[a],a,Math.round(Number(ni)),Math.round(Number(ti)),Math.round(Number(ni+ti))))}};this.CheckIncludeResortFee=function(n,t,i){var f=Math.round(Number(n[t])),r;let u=!1,e=0;for(r=t;r<t+i;r++)if(typeof n[r]!="undefined"){if(e=Math.round(Number(n[r])),e!==f){u=!1;break}u=!0}return f==0&&(u=!1),u};ui=function(n){for(var t=ct;t<=pi;t++)f[t].removeClass("dtSelected dtCheckout dtCheckin"),WsVars.IBESkinVer=="3"&&f[t].attr("aria-selected",!1);if(e>0&&e>=ct){for(t=e;t<a;t++)f[t].addClass("dtSelected"),WsVars.IBESkinVer=="3"&&f[t].attr("aria-selected",!0);v>0&&(f[a].addClass("dtCheckout"),WsVars.IBESkinVer=="3"&&f[t].attr("aria-selected",!0));f[e].addClass("dtCheckin");WsVars.IBESkinVer=="3"&&f[e].attr("aria-selected",!0)}v===0&&(ot==!0?ii(null):ri(null));b.ShowNights();n==null&&c.trigger("CalChanged")};this.GetDaily=function(){kt()};this.GetArrival=function(){return e};this.GetDeparture=function(){return e+v};this.GetNights=function(){return v};this.IsOpen=function(){return gt};this.ShowAvail=function(t,i=false,r=null){var k,ct,yt,pt,ut,st,lt,ht,at,h,s,et,tt;if(dt===!1||WsVars.IsHiltonPMS==1?(dt=!0,kt()):ot!=!0?ri(null):nt===null||nt.requestInfo==undefined||nt.requestInfo.lengthOfStay!=v||WsVars.IsEnableFlexibleRateBlendingBeginEndDate==1&&WsVars.IsIntegrateLoyaltyRateBlendingWithOMS==1?kt():ii(nt),k=c.data("MyRmRc"),(u.Page==="CONFIRM"||u.Page.length===0)&&i){if(ct=!1,WsVars.CartItems.length>1&&r!=null&&r!=""&&r!=undefined)for(s=0;s<WsVars.CartItems.length;s++)if(WsVars.CartItems[s].Iata!=null&&WsVars.CartItems[s].Iata!=""&&WsVars.CartItems[s].Iata!=undefined&&WsVars.CartItems[s].CrsID!=r){ct=!0;break}if(ct==!0)n("#dvWsTAIataNumber").show();else if(yt=k.GetRc(),yt.IsIataRequired=="True"){if(n("#dvWsTAIataNumber").show(),n("#txTAIataNumber").val()==""||n("#txTAIataNumber").val()==null||n("#txTAIataNumber").val()==undefined)return n("#lbTAIataNumber").find("span.ws-required").length==0&&(pt=' <span class="ws-required">*<\/span>',n("#lbTAIataNumber").append(pt)),rqWsTAIataNumber=!0,n("#txTAIataNumber").attr("readonly",!1),n(".ws-open-close a#buGuestModify").click(),n("#buGuestSave").addClass("ws-disabled"),n("#txTAIataNumber + p.ws-error").html(WsMsgFmIataNumber),n("#txTAIataNumber").addClass("ws-error-form"),"txTAIataNumber"}else n("#dvWsTAIataNumber").hide(),n("#lbTAIataNumber").children().remove(),n("#txTAIataNumber").removeClass("ws-error-form"),n("#txTAIataNumber").attr("readonly",!0),rqWsTAIataNumber=!1,n("a.ws-cancel-edits#buGuestCancel").click(),n("#buGuestSave").removeClass("ws-disabled")}if(ut=k.GetRoomStay(),st=k.GetRateOL(),ut!==null){var p=ut.DailyForCalendar.split(","),d=ut.DailyAddAmtToDisplayTaxAndResortFee.split(","),ft=k.GetCompDaily().split(","),it=Document.calendarAvaildate1;if(p.length===v)try{if(lt=!1,ht=null,ut.GuarPolicyInfo!=null&&(ht=jQuery.parseJSON(ut.GuarPolicyInfo)),lt=ht!=null&&ht.IsDepositAllowedToPayLater,WSMAIN.CheckPolicy!=undefined&&(at=WSMAIN.CheckPolicy(WSMAIN.Items),(at=="DX"||at=="PP")&&WsVars.IsAdyenV2==1&&BuildWsPaymentMethods(WsPaymentOptions,WSMAIN.Items,lt)),it&&(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&it!=""&&(it!=o.Items[0].Dt1||it!=e)&&(Document._tmpIx1=e,Document._tmpIx2=a,e=it,a=e+v),WsVars.UseCurrCode==="0"&&WsVars.CSymbol==="$")for(s=0;s<=v;s++){if(f[s+e].removeClass("wspromo wsclosed wscta wsctd wsthru wsmin wsmax wsmnld wsmxld wsoutonly").attr("wsmin",0).attr("wsmax",0).attr("wsmnld",0).attr("wsmxld",0).attr("wsmina",0).attr("wsmaxa",0),s==v)break;p[s]>0&&ft[s]==="False"&&(WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"&&(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")?(l[e+s].html("$"+Math.round(Number(p[s]))),l[e+s].attr("amt",Math.round(Number(p[s])))):(l[e+s].html("$"+Math.round(Number(p[s])+Number(d[s]))),l[e+s].attr("amt",Math.round(Number(p[s])+Number(d[s]))),p[s]=Math.round(Number(p[s])+Number(d[s]))));w[e+s].html("");w[e+s].attr("amt","");w[e+s].css("display","none");y[e+s]=0;SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.SHRSS&&Math.round(p[s])>6e3&&f[s+e].addClass("wsclosed");WsVars.EnableCompRate=="1"&&(h=e+s,WsVars.EnableCalendar=="1"&&SHRWindsurfer.WsLoyaltyHandler.hasActiveLoyaltyProgram()?SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID>1&&(h>=e&&h<a?Number(p[h-e])==0&&ft[s]==="True"?(g.addClass("wscomp"),f[e+s].addClass("wspromo"),l[e+s].html(""),l[e+s].attr("amt",""),d[s]>0?(_rtTaxFeeAmt[h].html(Math.round(d[s])),_rtTaxFeeAmt[h].attr("amt",Math.round(d[s])),_rtTaxFeeAmt[h].css("display","block")):(_rtTaxFeeAmt[h].html(""),_rtTaxFeeAmt[h].attr("amt",""),_rtTaxFeeAmt[h].css("display","none")),SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.ResortWorld&&(w[h].html(""),w[h].attr("amt",""),w[h].css("display","none"))):(f[e+s].removeClass("wspromo"),_rtTaxFeeAmt[h].html(""),_rtTaxFeeAmt[h].attr("amt",""),_rtTaxFeeAmt[h].css("display","none")):g.removeClass("wscomp")):WsVars.EnableCalendar=="0"&&h>=e&&h<a&&(Number(p[h-e])==0&&ft[s]==="True"?f[h].addClass("wspromo"):f[h].removeClass("wspromo")));ft[s]==="False"&&y[e]>0&&y[e]!=""&&(ot!=!0?b.ShowStrikeRates(Math.round(p[s]),Math.round(y[e+s]/100),e+s,!0):b.ShowStrikeRates(Math.round(p[s]),Math.round(y[e+s]),e+s,!0))}else for(s=0;s<=v;s++){if(f[s+e].removeClass("wspromo wsclosed wscta wsctd wsthru wsmin wsmax wsmnld wsmxld wsoutonly").attr("wsmin",0).attr("wsmax",0).attr("wsmnld",0).attr("wsmxld",0).attr("wsmina",0).attr("wsmaxa",0),s==v)break;p[s]>0&&ft[s]==="False"&&(WsVars.SplitOutAddToDisplayTaxesForCalendar=="1"&&(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")?(l[e+s].html(WsVars.CSymbol+Math.round(Number(p[s]))),l[e+s].attr("amt",Math.round(Number(p[s])))):(l[e+s].html(WsVars.CSymbol+Math.round(Number(p[s])+Number(d[s]))),l[e+s].attr("amt",Math.round(Number(p[s])+Number(d[s]))),p[s]=Math.round(Number(p[s])+Number(d[s]))));w[e+s].html("");w[e+s].attr("amt","");w[e+s].css("display","none");WsVars.EnableCompRate=="1"&&WsVars.EnableCalendar=="1"&&(h=e+s,h>=e&&h<a&&(Number(p[h-e])==0&&ft[s]==="True"?(f[h].addClass("wspromo"),d[s]>0?(_rtTaxFeeAmt[h].html(Math.round(d[s])),_rtTaxFeeAmt[h].attr("amt",Math.round(d[s])),_rtTaxFeeAmt[h].css("display","block")):(_rtTaxFeeAmt[h].html(""),_rtTaxFeeAmt[h].attr("amt",""),_rtTaxFeeAmt[h].css("display","none"))):(_rtTaxFeeAmt[h].html(""),_rtTaxFeeAmt[h].attr("amt",""),_rtTaxFeeAmt[h].css("display","none"))));ft[s]==="False"&&y[e]>0&&y[e]!=""&&(ot!=!0?b.ShowStrikeRates(Math.round(p[s]),Math.round(y[e+s]/100),e+s,!0):b.ShowStrikeRates(Math.round(p[s]),Math.round(y[e+s]),e+s,!0))}if(it&&(o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL")&&it!=""&&(it!=o.Items[0].Dt1||it!=Document._tmpIx1)&&(e=Document._tmpIx1,a=Document._tmpIx2,Document.calendarAvaildate1="",Document._tmpIx1="",Document._tmpIx2=""),l[e+v].html(""),l[e+v].attr("amt",""),_rtTaxFeeAmt[e+v].html(""),_rtTaxFeeAmt[e+v].attr("amt",""),t){var rt=nt,h,wt=Number(rt.Ix1),k=c.data("MyRmRc"),bt=k.GetRmID(),vt=0;if(rt.RoomTypes!=null&&rt.RoomTypes.length>0)for(s=0;s<rt.RoomTypes.length;s++)if(Number(rt.RoomTypes[s].RmID)===bt){if(rt.RoomTypes[s].Bases.length>0)if(et=rt.RoomTypes[s].Bases.split(","),rt.CompOL==="0"){for(tt=0;tt<et.length;tt++)if((h=wt+tt,!(h<e))&&((et[tt].length===0||Number(et[tt])/100>Math.round(p[h-e]))&&f[h].addClass("wspromo"),h>=a-1))break}else for(tt=0;tt<et.length;tt++)if((h=wt+tt,!(h<e))&&(Number(et[tt])/100==Number(p[h-e])&&Math.floor(Number(et[tt]))%1e3==100&&(f[h].addClass("wspromo"),vt=vt+1),h>=a-1))break;break}if(WSMAIN.IsLoggedIn()&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.MavrickCRM&&WsVars.EnablePayByPoints=="1"&&WsVars.CurrencyId==900&&ut.Amt>WSMAIN.LoyaltyPoints)return k.Alert(WsMulti.MsgIternaryAmountExceedsAvailablePoints),n("#buCheckout").addClass("ws-disabled"),n("#dvMessage").length>0&&c.trigger("AvailError",n("#dvMessage"),WsMulti.MsgIternaryAmountExceedsAvailablePoints),!1;if(st&&k.GetIsOLResVal()&&v>0)if(o.Page==="CONFIRM")n("#buModifyResv").addClass("ws-disabled"),k.Alert(WsMulti.COMP7dayValidation);else if(o.Page==="PROMO")c.trigger("AvailError",[WsMulti.COMP7dayValidation,"PROMO"]);else return n("#buCheckout").addClass("ws-disabled"),c.trigger("AvailError",n('div[ix="'+s+'"]'),WsMulti.COMP7dayValidation),!1;else if(st&&k.GetOLMaxCompNights()>0&&vt>k.GetOLMaxCompNights())if(o.Page==="CONFIRM")n("#buModifyResv").addClass("ws-disabled"),k.Alert(WsMulti.MaxCompNightsPerRoom);else if(o.Page==="PROMO"||o.Page==="RATEDETAIL")c.trigger("AvailError",[WsMulti.MaxCompNightsPerRoom,"PROMO"]);else return n("#buCheckout").addClass("ws-disabled"),c.trigger("AvailError",n("#dvMessage"),WsMulti.MaxCompNightsPerRoom),!1;else if(st&&k.GetOLOfferMinLOS()>0&&v>0&&v<k.GetOLOfferMinLOS())if(o.Page==="CONFIRM")n("#buModifyResv").addClass("ws-disabled"),k.Alert(WsMulti.CompOfferMinLOS);else if(o.Page==="PROMO"||o.Page==="RATEDETAIL")c.trigger("AvailError",[WsMulti.CompOfferMinLOS,"PROMO"]);else return n("#buCheckout").addClass("ws-disabled"),c.trigger("AvailError",n("#dvMessage"),WsMulti.CompOfferMinLOS),!1;else st&&k.GetOLIncentiveMinLOS()>0&&v>0&&v<k.GetOLIncentiveMinLOS()&&(o.Page==="CONFIRM"?k.Alert(WsMulti.CompIncentiveMinLOS):o.Page==="PROMO"||o.Page==="RATEDETAIL"?WSMAIN.Rooms<=WSMAIN.AvailRooms&&c.trigger("AvailError",[WsMulti.CompIncentiveMinLOS,"PROMO"]):c.trigger("AvailError",n("#dvMessage"),WsMulti.CompIncentiveMinLOS))}}catch(gt){}}};this.Show=function(){fi!==!0&&(di(),ui(!0),bt(),fi=!0)};this.ShowOrig=function(){this.ShowNights({dt1:it.Dt1,nights:Number(it.Nights)})};this.ShowModCancelState=function(){tt!==null&&(tt.removeClass("ws-show-this"),st.removeClass("ws-open"),ut.removeClass("ws-show-this"),WsVars.IBESkinVer=="3"&&(ut.addClass("ws-hide-action"),tt.addClass("ws-hide-action")),c.find(".ws-cart-addonConciergeMod").filter(":first").addClass("ws-hide-action"),c.removeClass("ws-modifying"));gt=!1};this.ShowNights=function(n){var f=e,i=v,r=c.data("MyOcc"),o=r.GetAdults(),u=r.GetChild1()+r.GetChild2()+r.GetChild3()+r.GetChild4(),t;n!=null&&(f=n.dt1,i=n.nights);i===0?(ni.html("&nbsp;"),ti.html("&nbsp;")):(t=WsMulti.OneNight,i>1&&(t=i+" "+WsMulti.Nights),t+=o>1?", "+o+" "+WsMulti.Adults:", 1 "+WsMulti.Adult,u>1?t+=", "+u+" "+WsMulti.Children:u===1&&(t+=", 1 "+WsMulti.Child),ni.html(t),ti.html(Utils.ToCustom1(f,i,yi)))};this.ShowDates=function(t,i){t==null&&(t={},t.Nights=this.Nights,t.Dt1=this.Dt1,t.Dt2=this.Dt1+this.Nights,t.IsOut=!0);t.Dt1m=t.Dt1<=0?(new moment).add(1,"d"):new moment(Utils.GetDateFromY2K(t.Dt1));t.Dt2m=t.Dt2<=0?t.Dt1m.add(1,"d"):new moment(Utils.GetDateFromY2K(t.Dt1+t.Nights));n("#spCheckIn_"+i).val(t.Dt1m.format(Utils.GetDateFormat(WsVars.LangCode)));n("#spCheckOut_"+i).val(t.Dt2m.format(Utils.GetDateFormat(WsVars.LangCode)));n("#spCheckIn_"+i).unbind("change");n("#spCheckOut_"+i).unbind("change");n("#spCheckOut_"+i).unbind("blur");n("#spCheckIn_"+i).bind("change",function(){var t=!1,i=!1,r=this.id;t&&clearTimeout(t);t=setTimeout(function(){var f;t=!1;i=!0;var u=r.split("_")[1],o=c.data("MyCal"),s=o.GetArrival();WSMAIN.Dt1m=GetValidMoment(n("#"+r).val());WSMAIN.Dt2m=GetValidMoment(n("#spCheckOut_"+u).val());WSMAIN.Dt1=Utils.GetIndexFromY2K(WSMAIN.Dt1m.toDate());WSMAIN.Dt2=Utils.GetIndexFromY2K(WSMAIN.Dt2m.toDate());WSMAIN.Nights=WSMAIN.Dt2-WSMAIN.Dt1;i=!0;WSMAIN.Nights>0&&(e=s,a=WSMAIN.Dt2,f=n("#dv_"+u+"_"+WSMAIN.Dt1),n(f).click());i=!1},200)});n("#spCheckOut_"+i).bind("change",function(){var t=!1,i=!1,r=this.id;t&&clearTimeout(t);t=setTimeout(function(){var o;t=!1;i=!0;var u=r.split("_")[1],f=c.data("MyCal"),s=f.GetArrival(),h=f.GetNights(),l=s+h;WSMAIN.Dt1m=GetValidMoment(n("#spCheckIn_"+u).val());WSMAIN.Dt2m=GetValidMoment(n("#"+r).val());WSMAIN.Dt1=Utils.GetIndexFromY2K(WSMAIN.Dt1m.toDate());WSMAIN.Dt2=Utils.GetIndexFromY2K(WSMAIN.Dt2m.toDate());WSMAIN.Nights=WSMAIN.Dt2-WSMAIN.Dt1;i=!0;e=WSMAIN.Dt1;a=l;o=n("#dv_"+u+"_"+WSMAIN.Dt2);n(o).click();i=!1},200)});n("#spCheckOut_"+i).bind("blur",function(){if(WSMAIN.Nights<=0){var t=!1,i=!1,r=this.id;t&&clearTimeout(t);t=setTimeout(function(){t=!1;i=!0;var s=r.split("_")[1],f=c.data("MyCal"),u=f.GetArrival(),e=f.GetNights(),o=u+e;WSMAIN.Dt1=u;WSMAIN.Dt2=o;WSMAIN.Nights=WSMAIN.Dt2-WSMAIN.Dt1;WSMAIN.ShowDates(u,o,e);WSMAIN.Dt1m=GetValidMoment(n("#spCheckIn_"+s).val());WSMAIN.Dt2m=GetValidMoment(n("#"+r).val());i=!1},200)}})};this.ShowStrikeRates=function(n,t,i,r){w[i].hide();o.Page==="RATEDETAIL"||o.Page==="ROOMDETAIL"?r&&Math.round(n)<Math.round(t*WSMAIN.Rooms)?(w[i].html(Math.round(t*WSMAIN.Rooms)),w[i].attr("amt",Math.round(t*WSMAIN.Rooms)),w[i].addClass("ws-strike ws-strikenumber"),f[i].hasClass("wsclosed")||w[i].css("display","block"),n!=0||f[i].hasClass("wspromo")||w[i].css("display","none")):Math.round(n)<Math.round(t)?(w[i].html(Math.round(t)),w[i].attr("amt",Math.round(t)),w[i].addClass("ws-strike ws-strikenumber"),f[i].hasClass("wsclosed")||w[i].css("display","block"),n!=0||f[i].hasClass("wspromo")||w[i].css("display","none")):(w[i].html(""),w[i].attr("amt",""),w[i].css("display","none")):Math.round(n)<Math.round(t)?(w[i].html(Math.round(t)),w[i].attr("amt",Math.round(t)),w[i].addClass("ws-strike ws-strikenumber"),f[i].hasClass("wsclosed")||w[i].css("display","block"),n!=0||f[i].hasClass("wspromo")||w[i].css("display","none")):(w[i].html(""),w[i].attr("amt",""),w[i].css("display","none"))};this.IsDiff=function(){return v>0&&(e!=it.Dt1||v!=it.Nights)?!0:!1};this.KeyboardNavigation=function(t,i){var s=n(".calMonth.visible").not(".secondmonth").find(":visible").find(".pointer").length,h=n(".calMonth.visible").not(".secondmonth").find(":visible").find(".pointer")[s-1],c=Number(h.attributes[1].value),l=Number(n(".calMonth.visible").not(".secondmonth").find(":visible").find(".pointer")[0].attributes[1].value),r=0,u,e;if(t.keyCode==37||t.keyCode==38||t.keyCode==39||t.keyCode==40||t.keyCode==13||t.keyCode==9){switch(t.keyCode){case 37:r=Number(i-1);break;case 38:r=Number(i-7);break;case 39:r=Number(i+1);break;case 40:r=Number(i+7);break;case 13:f[Number(i)].hasClass("wsdatedisable")||f[Number(i)].hasClass("wsclosed")&&!f[Number(i)].hasClass("wsoutonly")||wi(Number(i));return;case 9:u=Number(n("#"+t.currentTarget.id+"").parents("div.calMonth")[0].id.split("_")[1]);e=0;n(".dvCalMonths div.pointer").removeClass("dtSelected");t.shiftKey?(e=Number(u-1),Number(n(".calMonth:visible:first")[0].attributes[0].value.split("_")[1])==u&&(n(".calnext a").css("visibility")=="hidden"?(n(".calprev a").focus(),t.preventDefault()):n(".calprev a").css("visibility")=="visible"?(n(".calprev a").focus(),t.preventDefault()):(n(".calnext a").focus(),t.preventDefault()))):(e=Number(u+1),Number(n(".calMonth:visible:last")[0].attributes[0].value.split("_")[1])==u&&(o.Page==="PROMO"&&n("[id*='buClearDates']").hasClass("ws-disabled")&&n("#buAddToCart").hasClass("ws-disabled")?(n("#txBookingArrival").focus(),t.preventDefault()):(n("#MyCalendar_buCalClear, #MyAvailability_MyCalendar_buCalClear").focus(),n("[id*='buClearDates']").focus(),t.preventDefault())));return}f[Number(r)]==undefined||f[Number(r)].hasClass("wsdatedisable")||f[Number(r)].hasClass("blocked")||(l>r&&k>0?n(".calprev a").click():r>c&&n(".calnext a").click(),n(".ws-cart-details .calMonth").find(".calDays div.pointer").attr("tabindex","-1"),f[Number(i)].removeClass("cal-dt-highlight").attr("tabindex","-1"),f[Number(r)].addClass("cal-dt-highlight").attr("tabindex","0").focus(),f[Number(r)].attr("aria-selected",!0),f[Number(i)].not(".dtCheckout").not(".dtSelected").not(".dtCheckin").attr("aria-selected",!1),n(".ws-cart-details .calMonth.visible").find(".calDays div.pointer").attr("tabindex","0"));t.preventDefault()}}}function s(n,t,i,r,u){var f=Utils.MonthAdd(n,t),o=Utils.GetIndexFromY2K(f),s=[],e=r,c=u;this.GetHtml=function(){var a=WsVars.LangCode,u=f.getDay(),n=Utils.Format('<div id="dvMonth_{0}_{1}" class="calMonth">',e,t),k,l,r,v,g,p;if(n+=Utils.Format('<div class="calHead">{0}<\/div>',Utils.ToMMMMYYYY(f,i)),typeof Intl!="undefined"&&typeof Intl.Locale!="undefined"&&typeof Intl.DateTimeFormat!="undefined"&&Utils.IsLangSupportFormat(f)){r=0;document.dir=="rtl"?(r=6,u=u+2):a!="en-us"&&a!="ja"&&a!="pt"&&a!="ar"?(r=1,u===0&&(u=7)):u=f.getDay()+1;var l=[1,2,3,4,5,6,7].map(function(n){return new Intl.DateTimeFormat(a,{weekday:document.dir!="rtl"?"narrow":"short",timeZone:"UTC"}).format(new Date("2017-01-0"+n+"T00:00:00+00:00"))}),w=l.slice(0,r),b=l.slice(r+1,l.length),y=[l[r]].concat(b).concat(w);n+='<div class="calDay">';y.forEach(function(t){return n+="<div>"+t+"<\/div>"});WsVars.IBESkinVer=="3"&&(k=[1,2,3,4,5,6,7].map(function(n){return new Intl.DateTimeFormat(a,{weekday:"long",timeZone:"UTC"}).format(new Date("2017-01-0"+n+"T00:00:00+00:00"))}),y.forEach(function(t,i){return n+='<div class="weekCalDay"><span class="sr-only">'+k[i]+'<\/span><span aria-hidden="true">'+t+"<\/span><\/div>"}));n+='<\/div><div class="calDays">'}else{l=SHR.__("WeekdaysNarrow").split(",");r=0;i!==1&&i!==9&&i!==11&&i!==14?(r=1,u===0&&(u=7)):u=f.getDay()+1;var w=l.slice(0,r),b=l.slice(r+1,l.length),y=[l[r]].concat(b).concat(w);n+='<div class="calDay">';y.forEach(function(t){return n+="<div>"+t+"<\/div>"});n+='<\/div><div class="calDays">'}var nt=Utils.MonthAdd(f,1),d=Math.round(u+(nt-f)/864e5-1),tt=Math.ceil(d/7)*7;for(v=1,g=1;v<=tt;v++)v>=u&&v<=d?(p=new h(o++,e,c),s.push(p),n+=p.GetHtml(),g++):n+="<div>&nbsp;<\/div>";return n+="<\/div><\/div>"}}function h(n,t,i){var r=n,u=Utils.GetDateFromY2K(n),f=t,e=i;this.GetHtml=function(){return Utils.Format('<div id="dv_{0}_{1}" ref="{1}">{2}<span class="ws-strikeEnable" curr="{3}" amt="" style="display:none;"><\/span><span curr="{3}" amt=""><\/span><b comp>{4}<\/b><span curr="{3}" class="ws-incl-taxfee" amt=""><\/div>',f,r,u.getDate(),e,WsMulti.COMP)}}n.fn.wsformibemod=function(s){if(this.length){var h=n.extend({Items:[],Page:"",RcID:0},s);return this.each(function(){var s=n(this),y=null,v=Number(n(this).attr("ix")),b,a;h.Items.length>v&&(y=n.extend(!0,{},h.Items[v]));var c=new o(s,y,v,h),p=new r(s,y,v,h),l=new e(s,y,v,h),w=new t(s,y,v,0),k=new i(s,y,v);h.Page!=="CONFIRM"&&(b=new f(s,y,v));a=null;l.Show();p.Show();c.Show();(h.Page==="CONFIRM"||h.Page.length===0)&&(a=new u(s,y,v,h));(h.Page==="PROMO"||h.Page==="RATEDETAIL")&&c.GetNights()>0&&l.GetAvail();h.Page==="ROOMDETAIL"&&l.GetAvail();s.on("ModStart",function(n){if(h.onModStart!==undefined)h.onModStart(n,s);l.GetAvail();c.ShowNights();w.Hide();a!==null&&a.ShowMod()});s.on("ModCancel",function(n){if(l.ShowOrig(),c.ShowOrig(),a!==null&&a.ShowOrig(),IsAddonPriorModStart=!1,h.onModCancel!==undefined)h.onModCancel(n,s)});s.on("ModCancelOthers",function(){l.ShowOrig();c.ShowOrig();c.ShowModCancelState();a!==null&&a.ShowOrig()});s.on("OccChanged",function(n){if(c.ShowNights(),c.GetDaily(),c.GetNights()>0?(WsVars.ApplyMostRestrictivePolicyForAll=="1"&&sessionStorage!==undefined&&(sessionStorage.needRefreshPostAvailSuccess=!0),l.GetAvail()):l.HideRoomRates(),h.onCalOccChanged!==undefined)h.onCalOccChanged(n,s);if(h.onOccChanged!==undefined)h.onOccChanged(n,s)});s.on("CalChanged",function(n){if(c.GetNights()>0){if(a!==null&&(a.UpdateDates(),a.ShowMod()),l.GetAvail(),h.Page==="ROOMDETAIL")setTimeout(function(){c.GetDaily()},2e3)}else l.HideRoomRates();if(h.onCalOccChanged!==undefined)h.onCalOccChanged(n,s);if(h.onCalChanged!==undefined&&c.GetNights()>0)h.onCalChanged(n,s)});s.on("RoomChange",function(n){if(c.ShowAvail(!0),h.onRmRcChanged!==undefined)h.onRmRcChanged(n,s);else if(h.onRoomChanged!==undefined)h.onRoomChanged(n,s)});s.on("RateChange",function(n){var t=s.attr("ref");if(c.ShowAvail(!1,h.Page==="CONFIRM"?!0:!1,t),c.GetDaily(),h.onRmRcChanged!==undefined)h.onRmRcChanged(n,s);else if(h.onRateChanged!==undefined)h.onRateChanged(n,s)});s.on("RoomsChanged",function(n){if(c.GetNights()>0?l.GetAvail():l.HideRoomRates(),h.onRoomsChanged!==undefined)h.onRoomsChanged(n,s)});s.on("TowerChange",function(){c.GetDaily()});s.on("AvailSuccess",function(n,t){if(c.ShowAvail(!0),h.Page==="ROOMDETAIL"&&WSMAIN.MyItem!=null){var r=0,i=s.data("MyRmRc");typeof i!==undefined&&i!=null&&(r=i.GetRcID());WSMAIN.MyItem.RcID!=r&&c.GetDaily()}if(h.onAvailSuccess!==undefined)h.onAvailSuccess(n,s,t);h.onUpdatePostAvailSuccess!==undefined&&sessionStorage!==undefined&&sessionStorage.needRefreshPostAvailSuccess=="true"&&(sessionStorage.removeItem("needRefreshPostAvailSuccess"),h.onUpdatePostAvailSuccess())});s.on("AvailError",function(n,t,i){if(h.onAvailError!==undefined)h.onAvailError(n,s,t,i)});s.on("Preselect",function(n){if(h.onPreselect!==undefined)h.onPreselect(n,s)});s.on("AddonUpdated",function(n,t){l.SetSvcs(t)});s.on("RoomUpgraded",function(n){if(h.onRoomUpgraded!==undefined)h.onRoomUpgraded(n,s)});s.on("AddonRemoved",function(n,t){if(l.SetSvcsAmt(t),h.onAddonRemoved!==undefined)h.onAddonRemoved(n,s)});s.on("AddonDateModified",function(n){if(h.onAddonModified!==undefined)h.onAddonModified(n,s,!0)});s.on("AddonTimeModified",function(n){if(h.onAddonModified!==undefined)h.onAddonModified(n,s,!1)});s.on("AddonAdded",function(n,t){a!==null&&a.AddAddon(t)});s.on("AddonVerified",function(n,t,i){a!==null&&a.SetSvcs(t,i)});s.on("CartRemoveAddon",function(n,t,i){if(h.onCartRemoveAddon!==undefined)h.onCartRemoveAddon(n,s,t,i)});s.on("InsuranceChanged",function(n){if(h.onInsuranceChanged!==undefined)h.onInsuranceChanged(n,s)});s.on("RoomDropdownShown",function(n){if(h.onRoomDropdownShown!==undefined)h.onRoomDropdownShown(n,s)});s.on("Alert",function(n,t){l.Alert(t)});s.on("PolicyChanged",function(n){if(h.onPolicyChanged!==undefined)h.onPolicyChanged(n,s)});s.on("ConciergeChange",function(n){if(h.onConceirgeChange!==undefined)h.onConceirgeChange(n,s)})})}};n(document).ready(function(){n(".ws-modify-options div.ws-select-box").on("keydown",function(t){let f=n(this).find("button"),r=n(this).find("ul.ws-select-options"),o=r.find("li"),i=o.filter('[style!="display: none;"]'),s=o.filter('[style="display: none;"]'),h=r.attr("aria-activedescendant"),e=i.filter("#"+h).index();s.length>0&&i.last().after(s);let u=i.filter(".ws-current").index();if(u<0&&(u=i.filter(".ws-current").index()),t.keyCode===40||t.keyCode===38){t.preventDefault();r.css("display")=="block"&&r.innerHeight()>40?t.keyCode===40?u=(u+1)%i.length:t.keyCode===38&&(u=(u-1+i.length)%i.length):r.length>0&&(r.show(),r.addClass("ws-dropdownHeight"),t.keyCode===40?u=(u+1)%i.length:t.keyCode===38&&(u=(u-1+i.length)%i.length));let n=i.eq(u);f.attr("aria-activedescendant",n.attr("id"));i.removeClass("ws-current").removeAttr("aria-selected");n.addClass("ws-current").attr("aria-selected",!0)}else if(t.keyCode==13||t.key==="Enter"||t.keyCode===32||t.key==="Space"){r.removeClass("ws-dropdownHeight");const n=r.is(":visible");if(n)if(t.keyCode==13&&n){let n=i.eq(u);n.find("a").focus().click();i.removeClass("ws-current").removeAttr("aria-selected");n.addClass("ws-current").attr("aria-selected",!0);f.attr("aria-activedescendant",n.attr("id"));r.hide();f.attr("aria-expanded",!1);f.focus();t.preventDefault()}else t.keyCode===32&&n&&(r.hide(),f.attr("aria-expanded",!1),f.focus(),i.removeAttr("aria-selected").removeClass("ws-current"),i.eq(e).addClass("ws-current").attr("aria-selected",!0),f.attr("aria-activedescendant",i.eq(e).attr("id")),t.preventDefault());else r.show(),f.attr("aria-expanded",!0),t.preventDefault()}else if(t.keyCode===9)r.trigger("keydown",t,t.keyCode);else if(t.keyCode===27||t.keyCode===32){r.hide();f.attr("aria-expanded",!1);f.focus();i.removeAttr("aria-selected").removeClass("ws-current");i.eq(e).addClass("ws-current").attr("aria-selected",!0);f.attr("aria-activedescendant",i.eq(e).attr("id"));return}});n(".ws-modify-options .ws-select-box ul.ws-select-options").on("keydown",function(t,i){let u=n(this).closest(".ws-select-box").find("button"),r=n(this).find('li[style != "display: none;"]'),f=r.filter(".ws-current").index(),o=n(this).attr("aria-activedescendant"),e=r.filter("#"+o).index();if(t.shiftKey&&t.keyCode===9)n(this).css("display")=="block"&&(n(this).hide(),r.removeAttr("aria-selected").removeClass("ws-current"),r.eq(f).addClass("ws-current").attr("aria-selected",!0),u.attr("aria-activedescendant",r.eq(f).attr("id")),u.attr("aria-expanded",!1),u.focus());else if(t.keyCode===9||i.keyCode===9)n(this).css("display")=="block"&&(r.eq(f).find("a").focus().click(),r.removeAttr("aria-selected").removeClass("ws-current"),r.eq(f).addClass("ws-current").attr("aria-selected",!0),u.attr("aria-activedescendant",r.eq(f).attr("id")),u.attr("aria-expanded",!1));else if(t.keyCode===27||t.keyCode===32){n(this).hide();u.focus();u.attr("aria-expanded",!1);r.removeAttr("aria-selected").removeClass("ws-current");r.eq(e).addClass("ws-current").attr("aria-selected",!0);u.attr("aria-activedescendant",r.eq(e).attr("id"));return}})});n(document).bind("mouseup",function(t){n(t.target).hasClass("txRoom txRate")||(n(".cbRoom,.cbRate,.cbTower").hide(),n(".txRoom,.txRate,.txTower,.txUpgrade").attr("aria-expanded",!1),WsVars.IBESkinVer=="3"&&(n(".btnRoom,.btnRate,.btnTower,.btnUpgrade").attr("aria-expanded",!1),n(".txRoom,.txRate,.txTower,.txUpgrade").removeAttr("aria-expanded")))});n(document).ajaxComplete(function(){if(WsVars.IBESkinVer=="3"){var t=n(".dvCalMonths .calMonth"),i=t.find(".calHead");i.attr("id","monthHeading");t.attr("aria-labelledby","monthHeading");n(".calDay").find("div").not(".weekCalDay").remove();n("#lblPrevMonth").text(`${SHR.__("PrevMonth")}`);n("#lblNextMonth").text(`${SHR.__("NextMonth")}`)}})})(jQuery),function(n){function i(t,i,u){for(var l,v=this,f=t,e=[],o=u,s=Number(f.attr("ref")),a=null,h=[],c=0;c<i.length;c++)i[c].HotelID==s&&e.push(i[c]);this.Init=function(t,i){var h,v,u,r,c,a,y;try{for(h=0;h<t.Svcs.length;h++)t.Svcs[h].Policy="",t.Svcs[h].CanPolicy="",t.Svcs[h].Desc=""}catch(p){}if(v=!0,u={hgID:WsVars.HgID,hotelID:s,langID:WsVars.LangID,currID:WsVars.CurrencyId},o.Page==="PROMO"||o.Page==="RATEDETAIL"){if(e.length===0)return;r=e[0];r.RmID=t.RmID;r.Dt1=t.Dt1;r.Nights=t.Nights;r.Adults=t.Adults;r.Child1=t.Child1;r.Child2=t.Child2;r.Child3=t.Child3;r.Child4=t.Child4;r.Svcs=t.Svcs;r.ChildrenAges=t.ChildrenAges;u.wsitem=JSON.stringify(r);u.refer="PROMO"}else if(o.Page==="ROOMDETAIL"){if(e.length===0)return;r=e[0];r.RcID=t.RcID;r.Dt1=t.Dt1;r.Nights=t.Nights;r.Adults=t.Adults;r.Child1=t.Child1;r.Child2=t.Child2;r.Child3=t.Child3;r.Child4=t.Child4;r.Svcs=t.Svcs;r.ChildrenAges=t.ChildrenAges;u.wsitem=JSON.stringify(r);u.refer="ROOMDETAIL"}else if(o.Page==="INDEX"){if(e.length===0)return;for(c=n.extend(!0,{},e[0]),a=0;a<c.Svcs.length;a++)c.Svcs[a].Desc="",c.Svcs[a].Policy="",c.Svcs[a].CanPolicy="";u.wsitem=JSON.stringify(c);u.wsmultiroom=JSON.stringify(WSMLROOMS.MultiRoom);u.refer="INDEX"}else o.Page==="CONFIRM"?(e=[t],s=t.HotelID,u.hotelID=t.HotelID,u.wsitem=JSON.stringify(t),y=this.dvs=n(".ws-product-item"),y.find(".ws-start-mod").filter(":first").length==0&&(v=!1),t.IsResvMod=t.IsResvMod!=undefined&&t.IsResvMod!="undefined"&&t.IsResvMod||IsAddonPriorModStart?!0:!1,u.IsResvMod=t.IsResvMod):o.Page.length===0&&t!==null&&(u.wscart=JSON.stringify(t),u.ix=i);v&&(showLoder(),n.ajax({type:"POST",url:"xml/getaddonlist.aspx?json=1",data:u,dataType:"json",success:function(t){hideLoder();o.Page==="CONFIRM"&&t.AddOns!=null&&t.AddOns.length>0&&n(".ws-add-ons").show();l(t);f.trigger("SvcAvailSuccess",[t])},error:function(){hideLoder()}}))};this.InitWithData=function(n,t,i){var u,r;if(o.Page==="CONFIRM")for(e=[t],l(i),r=0;r<h.length;r++)h[r].SetIx(0);else if(o.Page.length===0){for(u=[],r=0;r<t.Items.length;r++)t.Items[r].HotelID==s&&u.push(t.Items[r]);e=u;l(i)}};l=function(t){var s,i,u;if(a=t,h=[],f.empty(),t.AddOns!=null&&t.AddOns.length!==0){for(WsVars.IBESkinVer=="3"&&(n('a[href]:visible, button:visible, input[type="text"]:visible, input[type="checkbox"]:visible, select:visible').last().off("keydown"),n('a[href]:visible, button:visible, input[type="text"]:visible, input[type="checkbox"]:visible, select:visible').first().off("keydown")),f.parents(".ws-add-ons").show(),s=Number(t.HotelID),i=0;i<t.AddOns.length;i++)if(h[i]=new r(f,t.AddOns[i],e,s,t.HotelName,t.Currency,t.ShowTotal,t.ShowTotalExclusive),o.Page==="INDEX"&&i>=3)break;WsVars.IBESkinVer=="3"&&(f.find(".ws-related-data").addClass("ws-hide-action"),BypassAddressBarFocus());f.find("article a").click(function(t){return f.find("article").removeClass("ws-open"),f.find(".ws-related-data").removeClass("ws-show-this"),WsVars.IBESkinVer=="3"&&(f.find(".ws-related-data").addClass("ws-hide-action"),f.find("article a").attr("aria-expanded",!1),f.find(".ws-related-wrap h3").attr("tabindex","0")),f.find(".ws-related-wrap h1").attr("tabindex","0"),n(this).parents("article").hasClass("ws-open")==!1&&n(this).parents("article").next(".ws-related-data").length&&(n(this).parents("article").addClass("ws-open"),n(this).parents("article").next(".ws-related-data").addClass("ws-show-this"),WsVars.IBESkinVer=="3"&&(n(this).parents("article").next(".ws-related-data").removeClass("ws-hide-action"),n(this).attr("aria-expanded",!0),n(this).parents("article").next(".ws-related-data").find("h3").focus()),n(this).parents("article").next(".ws-related-data").find("h1").focus()),t.stopPropagation(),!1});f.find("a.ws-close").click(function(){return f.find("article").removeClass("ws-open"),f.find(".ws-related-data").removeClass("ws-show-this"),WsVars.IBESkinVer=="3"&&(f.find(".ws-related-data").addClass("ws-hide-action"),n(this).parents(".ws-related-data").prev("article").find("a").focus(),n(this).parents(".ws-related-data").prev("article").find("a").attr("aria-expanded",!1),n("article div.ws-drawer-item").attr("aria-expanded",!1)),!1});try{u="";u=WsVars.Config2Flag=="True"?WsVars.Currency+"~":WsVars.Currency;WsCurrencies&&WsDispCurr&&WsBaseCurr&&f.find(".ws-number2").each(function(){var t=n(this).attr("ref"),f=n(this).attr("curr"),i,r;if(t==null||t.length==0)return!0;n(this).is("[curr]")&&(i=f.indexOf("~")>-1?WsCurrencies[n(this).attr("curr").replace(/~/g,"")]:WsCurrencies[n(this).attr("curr")],r=WsCurrencies[WsDispCurr]/i,n(this).html(Utils.GetAmountMod(Number(t)*r,u,WsVars.UseCurrCode)))})}catch(c){}typeof WsShowRates!="undefined"&&WsShowRates()}}}function r(i,r,u,f,e,o,s,h){var hi=i,l=r,a=u,bi=f,sr=e,kt="",ut;kt=WsVars.Config2Flag=="True"?WsVars.Currency+"~":WsVars.Currency;var c,d,ci,ii,ni,fi,y=-1,li=!1,dt=(r.Per==="1"||r.Per==="2"||r.Per==="3"||r.Per==="4"||r.Per==="7")&&r.Options.search("CheckOutOnly")===-1&&r.Options.search("CheckInOnly")===-1,ft,et,ot,st,ht,ct,lt,at,vt,yt,ai,v="0",p,w,b,k,g,nt,tt,wt,gt,ri,it,pt,bt,rt,ti,ui,ei,oi,vi,ki,si,di,gi,nr,tr,ir,rr,ur,fr,er,yi;this.SetIx=function(n){y=n};var hr=function(){var e=0,br="",o,vr,ar,pr,nu,dr,u,sr,yr,tu,iu,f,lr,hr,fu,eu,wr,gr;y=0;var i=a[y],kr=CalculateAddOnAmount(r,i.Dt1,i.Adults,i.Nights,i.Child1+i.Child2+i.Child3+i.Child4,!1,a,i.ChildrenAges,i.Child1,i.Child2,i.Child3,i.Child4);if(e=Number(kr.amt),s==="1"?e=e+Number(kr.unitTax):h=="1"&&(e=e-Number(kr.unitTaxVat)),o="",o=WsVars.Config2Flag=="True"?WsVars.Currency+"~":WsVars.Currency,vr=WsMulti.Add,WsVars.EnhancedMultiroom.toLowerCase()=="true"&&(ar=GetMultiRoomFromCookie(),typeof ar!="undefined"&&ar!=null&&ar.length>1))if(pr=Number(ar.map(function(n){return n.current}).indexOf(!0)),nu=ar.filter(function(n){return n.addedToCart==!0}),typeof pr!="undefined"&&pr>0)vr=Utils.Format(SHR.__("AddThisForRoom"),pr);else if(nu.length==ar.length){for(dr=0,f=0;f<a.length;f++)Utils.ArrayFind(r.Idx,f)>-1&&pi(a[f],r,!0,[])===0&&(vr=Utils.Format(SHR.__("AddThisForRoom"),a[f].RoomIndex+1),dr++);dr>=2&&(vr=Utils.Format(SHR.__("Add")))}if(u=Utils.Format('<article><a href="#" {0}><hgroup><div class="ws-photo"><span class="ws-photocrop">',WsVars.IBESkinVer=="3"?'aria-expanded="false"':""),u+=Utils.Format('<img class="coverme" src="{0}" style="{1}" alt="{4}" title="{3}" loading="lazy" /><\/span><\/div><h1>{2}<\/h1><\/hgroup>',r.Img,r.ImgStyle,r.Name,r.Title,r.AltText),u+=Utils.Format('<p class="ws-price-from">{4} <span class="ws-number2" curr="{2}" ref="{0}">{1}<\/span> {3}<\/p><\/a>',e,Utils.GetAmountMod(e,o,WsVars.UseCurrCode),kt,WsMulti["PerAddon"+r.Per],br),u+=Utils.Format('<\/article><div class="ws-related-data ws-list"><div class="ws-related-wrap"><h1>{0}<\/h1><a href="#" class="ws-close">Close <b><span class="ws-icon" data-icon="&#xe608;" aria-hidden=""true""><\/span><\/b><\/a>',r.Name),u+='<p class="ws-persuade"><\/p>',u+='<div class="ws-related-data-table"> <table class="ws-related-add-on-table" role="presentation"><tr class="ws-rate-data"><td class="ws-add-on-option">',u+=Utils.Format('<select {0} class="custom cbQty"><option value="0">0<\/option><option value="1">1<\/option><option value="2">2<\/option><option value="3">3<\/option><option value="4">4<\/option><option value="5">5<\/option><option value="6">6<\/option><option value="7">7<\/option><option value="8">8<\/option><option value="9">9<\/option><option value="10">10<\/option><\/select>',WsVars.IBESkinVer=="3"?Utils.Format('id="quantity_'+r.ID+'"'):""),WsVars.EnableConciergeService=="1"&&(l.Options.search("CheckInOnly")!=-1||l.Options.search("CheckOutOnly")!=-1)){if(l.TransportSegmentAvail!=null&&l.TransportSegmentAvail.length>0){for(u+=Utils.Format('<select class="cbTransSer custom" >'),sr=0;sr<l.TransportSegmentAvail.length;sr++)if(l.TransportSegmentAvail[sr].Journeys!=null)for(yr=0;yr<l.TransportSegmentAvail[sr].Journeys.length;yr++)tu=l.TransportSegmentAvail[sr].Journeys[yr].DisplayDepartureDate,iu=l.TransportSegmentAvail[sr].Journeys[yr].FareBrandName,u+=Utils.Format('<option value="{0}">{2} - {1}<\/option>',l.TransportSegmentAvail[sr].Id,tu,iu),sr==0&&(yi=l.TransportSegmentAvail[sr].Id);u+="<\/select>"}l.LimitTotime!=""&&(u+=Utils.Format('<select class="custom cbTransferTime" ref="{0}"><option value="{0}">{0}<\/option><\/select>',l.LimitTotime))}for(u+=r.SchedDate=="1"||a.length>1?Utils.Format('<label class="lbQty" {6}>{4}<\/label><\/td><td class="ws-price-from startsvcAmt'+r.ID+'">{5} {3}<span class="ws-number2" curr="{2}" ref="{0}">{1}<\/span> <\/td>',e,Utils.GetAmountMod(e,o,WsVars.UseCurrCode),kt,WsMulti.StartingAddonAmount,WsMulti.Quantity,br,WsVars.IBESkinVer=="3"?Utils.Format('for="quantity_'+r.ID+'"'):"",r.ID,Utils.Format('for="startsvcAmt_'+r.ID+'"')):Utils.Format('<label class="lbQty" {6}>{4}<\/label><\/td><td class="ws-price-from">{5} <span class="ws-number2" curr="{2}" ref="{0}">{1}<\/span> {3}<\/td>',e,Utils.GetAmountMod(e,o,WsVars.UseCurrCode),kt,WsMulti["PerAddon"+r.Per],WsMulti.Quantity,br,WsVars.IBESkinVer=="3"?Utils.Format('for="quantity_'+r.ID+'"'):""),u+=WsVars.IBESkinVer=="3"?Utils.Format('<td class="ws-cta"><button class="buAdd ws-button-small ws-tag ws-primary ws-disabled" disabled>{0}<\/button><\/td><\/tr><\/table>',vr):Utils.Format('<td class="ws-cta"><a href="#" class="buAdd ws-button-small ws-tag ws-primary ws-disabled">{0}<\/a><\/td><\/tr><\/table>',vr),u+='<div class="ws-add-on-meta ws-collapsible"><div class="ws-add-on-stay"><div class="ws-select-box">',u+=Utils.Format('<span class="txStay ws-select">{0}<\/span><ul class="cbStay ws-select-options"><li><a href="#" data-value="-1">{0}<\/a><\/li>',WsMulti.SelectStay),f=0;f<a.length;f++)if(Utils.ArrayFind(r.Idx,f)>-1){if(pi(a[f],r,!0,[])===0){if(li=!0,r.SchedDate=="1"){var ru=i.Dt1,uu=i.Dt1+a[0].Nights,i=a[f];for(lr=0;lr<=i.Nights;lr++){if(r.Options.search("ExcludeArrivalDate")!=-1&&r.Options.search("ExcludeDepartureDate")!=-1){if(i.Dt1+lr==ru||i.Dt1+lr==uu)continue}else if(l.Options.search("ExcludeArrivalDate")!=-1||l.Options.search("CheckOutOnly")!=-1){if(i.Dt1+lr==ru)continue}else if((l.Options.search("ExcludeDepartureDate")!=-1||l.Options.search("CheckInOnly")!=-1)&&i.Dt1+lr==uu)continue;if(hr=r.ExtServiceItemPrice.filter(function(n){return n.DtNumber==i.Dt1+lr&&n.InvAvail}),hr==null||hr.length==0)continue;else break}hr!=null&&hr.length>0&&hr[0]!=null&&(e=hr[0].DailyUnitPrice,e=Utils.GetActualAmount(e,o,WsVars.UseCurrCode),fu=Utils.GetActualAmount(hr[0].DailyUnitTax,o,WsVars.UseCurrCode),s==="1"?e=Number(e)+Number(fu):h=="1"&&(eu=Utils.GetActualAmount(hr[0].DailyUnitTaxVat,o,WsVars.UseCurrCode),e=Number(e)-Number(eu)))}wr=0;gr=[];gr.push(a[f]);wr=CalculateAddOnAmount(r,i.Dt1,i.Adults,i.Nights,i.Child1+i.Child2+i.Child3+i.Child4,!1,gr,i.ChildrenAges,i.Child1,i.Child2,i.Child3,i.Child4);u+=Utils.Format('<li><a href="#" data-value="{0}" startsvcAmt="{2}" svcID="{3}" perItem="{4}">{1}<\/a><\/li>',f,cr(a[f],wr.amt,o,r.Per),wr.amt,r.ID," "+WsMulti["PerAddon"+r.Per])}(r.Per==="1"||r.Per==="2"||r.Per==="3"||r.Per==="4"||r.Per==="7")&&a[f].Nights==1&&r.Options.search("ExcludeArrivalDate")!=-1&&r.Options.search("ExcludeDepartureDate")!=-1&&(li=!1)}if(li!==!1){for(u+="<\/ul><\/div><\/div>",f=1;f<=10;f++)u+=Utils.Format('<div class="ws-add-on-sched ws-collapsible ws-hide-action" ref="{0}"><span class="ws-together spAddonSchedDate"><select class="custom wsAddonSchedDate" ref="{0}"><\/select><\/span><span class="ws-together spAddonSchedTime"><select class="custom wsAddonSchedTime" ref="{0}"><option value="0000">12:00 AM<\/option><option value="0030">12:30 AM<\/option><option value="0100">1:00 AM<\/option><option value="0130">1:30 AM<\/option><option value="0200">2:00 AM<\/option><option value="0230">2:30 AM<\/option><option value="0300">3:00 AM<\/option><option value="0330">3:30 AM<\/option><option value="0400">4:00 AM<\/option><option value="0430">4:30 AM<\/option><option value="0500">5:00 AM<\/option><option value="0530">5:30 AM<\/option><option value="0600">6:00 AM<\/option><option value="0630">6:30 AM<\/option><option value="0700">7:00 AM<\/option><option value="0730">7:30 AM<\/option><option value="0800">8:00 AM<\/option><option value="0830">8:30 AM<\/option><option value="0900">9:00 AM<\/option><option value="0930">9:30 AM<\/option><option value="1000">10:00 AM<\/option><option value="1030">10:30 AM<\/option><option value="1100">11:00 AM<\/option><option value="1130">11:30 AM<\/option><option value="1200">12:00 PM<\/option><option value="1230">12:30 PM<\/option><option value="1300">1:00 PM<\/option><option value="1330">1:30 PM<\/option><option value="1400">2:00 PM<\/option><option value="1430">2:30 PM<\/option><option value="1500">3:00 PM<\/option><option value="1530">3:30 PM<\/option><option value="1600">4:00 PM<\/option><option value="1630">4:30 PM<\/option><option value="1700">5:00 PM<\/option><option value="1730">5:30 PM<\/option><option value="1800">6:00 PM<\/option><option value="1830">6:30 PM<\/option><option value="1900">7:00 PM<\/option><option value="1930">7:30 PM<\/option><option value="2000">8:00 PM<\/option><option value="2030">8:30 PM<\/option><option value="2100">9:00 PM<\/option><option value="2130">9:30 PM<\/option><option value="2200">10:00 PM<\/option><option value="2230">10:30 PM<\/option><option value="2300">11:00 PM<\/option><option value="2330">11:30 PM<\/option><\/select><\/span>',f),u+=Utils.Format('<span class="spAddonSchedPrice" id="{3}"><span class="ws-together wsAddonSchedPrice ws-number2" id="{3}" curr={1} ref="{0}">{2}<\/span><\/span><\/div>',e,kt,Utils.GetAmountMod(e,o,WsVars.UseCurrCode),f);u+="<\/div><\/div>";u+=Utils.Format('<div class="ws-related-desc"><p class="ws-room-rate-desc">{0}<\/p><p class="ws-room-rate-desc ws-pre-break">{1}<\/p><\/div>',r.Desc,r.Policy);WsVars.IBESkinVer=="3"&&(u=u.replace(/\h1/g,"h3"));c=n(u);hi.append(c);n("#cnWsHotelAddon article:gt(3)").addClass("ws-hidden");WsVars.IBESkinVer=="3"&&n("#cnWsHotelAddon article:gt(3)").addClass("ws-hide-action");n("#cnWsHotelAddon .ws-show-all").removeClass("ws-showing");n("#cnWsHotelAddon article").length<=4?n("#cnWsHotelAddon .ws-show-all").hide():n("#cnWsHotelAddon .ws-show-all").show();d=c.find(".buAdd").filter(":first");ci=c.find("select.cbQty").filter(":first");ii=c.find(".ws-add-on-meta").filter(":first");fi=c.find(".txStay").filter(":first");ni=c.find(".cbStay").filter(":first");ai=c.find(".ws-add-on-sched");ft=c.find('.ws-add-on-sched[ref="1"]').filter(":first");et=c.find('.ws-add-on-sched[ref="2"]').filter(":first");ot=c.find('.ws-add-on-sched[ref="3"]').filter(":first");st=c.find('.ws-add-on-sched[ref="4"]').filter(":first");ht=c.find('.ws-add-on-sched[ref="5"]').filter(":first");ct=c.find('.ws-add-on-sched[ref="6"]').filter(":first");lt=c.find('.ws-add-on-sched[ref="7"]').filter(":first");at=c.find('.ws-add-on-sched[ref="8"]').filter(":first");vt=c.find('.ws-add-on-sched[ref="9"]').filter(":first");yt=c.find('.ws-add-on-sched[ref="10"]').filter(":first");p=c.find('.wsAddonSchedDate[ref="1"]').filter(":first");w=c.find('.wsAddonSchedDate[ref="2"]').filter(":first");b=c.find('.wsAddonSchedDate[ref="3"]').filter(":first");k=c.find('.wsAddonSchedDate[ref="4"]').filter(":first");g=c.find('.wsAddonSchedDate[ref="5"]').filter(":first");nt=c.find('.wsAddonSchedDate[ref="6"]').filter(":first");tt=c.find('.wsAddonSchedDate[ref="7"]').filter(":first");wt=c.find('.wsAddonSchedDate[ref="8"]').filter(":first");gt=c.find('.wsAddonSchedDate[ref="9"]').filter(":first");ri=c.find('.wsAddonSchedDate[ref="10"]').filter(":first");it=c.find('.wsAddonSchedTime[ref="1"]').filter(":first");pt=c.find('.wsAddonSchedTime[ref="2"]').filter(":first");bt=c.find('.wsAddonSchedTime[ref="3"]').filter(":first");rt=c.find('.wsAddonSchedTime[ref="4"]').filter(":first");ti=c.find('.wsAddonSchedTime[ref="5"]').filter(":first");ui=c.find('.wsAddonSchedTime[ref="6"]').filter(":first");ei=c.find('.wsAddonSchedTime[ref="7"]').filter(":first");oi=c.find('.wsAddonSchedTime[ref="8"]').filter(":first");vi=c.find('.wsAddonSchedTime[ref="9"]').filter(":first");ki=c.find('.wsAddonSchedTime[ref="10"]').filter(":first");si=c.find('.spAddonSchedPrice[id="1"]').filter(":first");di=c.find('.spAddonSchedPrice[id="2"]').filter(":first");gi=c.find('.spAddonSchedPrice[id="3"]').filter(":first");nr=c.find('.spAddonSchedPrice[id="4"]').filter(":first");tr=c.find('.spAddonSchedPrice[id="5"]').filter(":first");ir=c.find('.spAddonSchedPrice[id="6"]').filter(":first");rr=c.find('.spAddonSchedPrice[id="7"]').filter(":first");ur=c.find('.spAddonSchedPrice[id="8"]').filter(":first");fr=c.find('.spAddonSchedPrice[id="9"]').filter(":first");er=c.find('.spAddonSchedPrice[id="10"]').filter(":first");_cbTransSer=c.find(".cbTransSer").filter(":first");_cbTransTime=c.find(".cbTransferTime").filter(":first");c.find(".custom").customSelect();c.find(".customSelect").append('<span class="ws-down-arrow" aria-hidden="true"><\/span>');fi.click(function(){return ni.show(),!1});ni.find("a").click(function(){var i=Number(n(this).attr("data-value")),r=Number(n(this).attr("startsvcAmt")),t=Number(n(this).attr("svcID")),u=n(this).attr("perItem");return(document.getElementsByClassName("ws-price-from startsvcAmt"+t)[0]!=undefined&&(document.getElementsByClassName("ws-price-from startsvcAmt"+t)[0].innerHTML=Utils.Format('<span class="ws-number2 startsvcAmt{2}" curr="{1}" ref="{0}">{3}<\/span>{4}',r,o,t,Utils.GetAmount(r,o,WsVars.UseCurrCode),u)),ni.hide(),y==i)?!1:(y=i,y<0?d.addClass("ws-disabled"):(d.removeClass("ws-disabled"),WsVars.IBESkinVer=="3"&&d.removeAttr("disabled"),dt&&l.SchedDate==="1"&&v!="0"&&(wi(),or())),fi.html(n(this).html()),ni.find("li").removeClass("ws-current"),ni.find("li").filter(function(){return Number(n(this).attr("data-value"))===y}).addClass("ws-current"),!1)});_cbTransSer.hide();_cbTransTime.hide();c.find("span.cbTransSer").filter(":first").hide();dt===!1&&(v="1",ci.val("1").hide(),c.find(".lbQty").filter(":first").hide(),c.find("span.cbQty").filter(":first").hide(),WsVars.EnableConciergeService=="1"&&(l.TransportSegmentAvail!=null&&l.TransportSegmentAvail.length>0&&(_cbTransSer.show(),c.find("span.cbTransSer").filter(":first").show()),l.LimitTotime!=""&&(_cbTransTime.show(),c.find("span.cbTransferTime").filter(":first").show())));a.length===1?(y=0,ii.addClass("ws-show-this"),fi.hide(),or(),dt===!1&&(d.removeClass("ws-disabled"),d.removeAttr("disabled"))):a.length>1&&(y=-1,dt===!1&&ii.addClass("ws-show-this"));l.SchedDate==="1"&&l.SchedTime==="1"?c.find(".spAddonSchedTime").show():c.find(".spAddonSchedTime").hide();ci.change(function(){v=n(this).val();a.length===1?(v==="0"?(d.addClass("ws-disabled"),WsVars.IBESkinVer=="3"&&d.attr("disabled","disabled")):(d.removeClass("ws-disabled"),WsVars.IBESkinVer=="3"&&d.removeAttr("disabled")),dt&&l.SchedDate==="1"&&wi()):v==="0"?(ii.removeClass("ws-show-this"),d.addClass("ws-disabled"),WsVars.IBESkinVer=="3"&&d.attr("disabled","disabled")):(ii.addClass("ws-show-this"),y>=0&&(d.removeClass("ws-disabled"),WsVars.IBESkinVer=="3"&&d.removeAttr("disabled"),dt&&l.SchedDate==="1"&&wi()))});_cbTransSer.change(function(){yi=n(this).val()});p.change(function(){var t=n(this).val();si.html(ut(t)).change();typeof WsShowRates!="undefined"&&WsShowRates()});w.change(function(){var t=n(this).val();di.html(ut(t)).change();typeof WsShowRates!="undefined"&&WsShowRates()});b.change(function(){var t=n(this).val();gi.html(ut(t)).change();typeof WsShowRates!="undefined"&&WsShowRates()});k.change(function(){var t=n(this).val();nr.html(ut(t)).change();typeof WsShowRates!="undefined"&&WsShowRates()});g.change(function(){var t=n(this).val();tr.html(ut(t)).change();typeof WsShowRates!="undefined"&&WsShowRates()});nt.change(function(){var t=n(this).val();ir.html(ut(t)).change();typeof WsShowRates!="undefined"&&WsShowRates()});tt.change(function(){var t=n(this).val();rr.html(ut(t)).change();typeof WsShowRates!="undefined"&&WsShowRates()});wt.change(function(){var t=n(this).val();ur.html(ut(t)).change();typeof WsShowRates!="undefined"&&WsShowRates()});gt.change(function(){var t=n(this).val();fr.html(ut(t)).change();typeof WsShowRates!="undefined"&&WsShowRates()});ri.change(function(){var t=n(this).val();er.html(ut(t)).change();typeof WsShowRates!="undefined"&&WsShowRates()});d.click(function(){var d,i,ut,r,et,f,u,ft;if(v==="0"||y<0)return!1;if(i=[],dt&&l.SchedDate==="1"&&l.SchedTime==="1"?v==="10"?(i[0]={Dt:Number(p.val()),Tm:it.val()},i[1]={Dt:Number(w.val()),Tm:pt.val()},i[2]={Dt:Number(b.val()),Tm:bt.val()},i[3]={Dt:Number(k.val()),Tm:rt.val()},i[4]={Dt:Number(g.val()),Tm:ti.val()},i[5]={Dt:Number(nt.val()),Tm:ui.val()},i[6]={Dt:Number(tt.val()),Tm:ei.val()},i[7]={Dt:Number(wt.val()),Tm:oi.val()},i[8]={Dt:Number(gt.val()),Tm:vi.val()},i[9]={Dt:Number(ri.val()),Tm:ki.val()}):v==="9"?(i[0]={Dt:Number(p.val()),Tm:it.val()},i[1]={Dt:Number(w.val()),Tm:pt.val()},i[2]={Dt:Number(b.val()),Tm:bt.val()},i[3]={Dt:Number(k.val()),Tm:rt.val()},i[4]={Dt:Number(g.val()),Tm:ti.val()},i[5]={Dt:Number(nt.val()),Tm:ui.val()},i[6]={Dt:Number(tt.val()),Tm:ei.val()},i[7]={Dt:Number(wt.val()),Tm:oi.val()},i[8]={Dt:Number(gt.val()),Tm:vi.val()}):v==="8"?(i[0]={Dt:Number(p.val()),Tm:it.val()},i[1]={Dt:Number(w.val()),Tm:pt.val()},i[2]={Dt:Number(b.val()),Tm:bt.val()},i[3]={Dt:Number(k.val()),Tm:rt.val()},i[4]={Dt:Number(g.val()),Tm:ti.val()},i[5]={Dt:Number(nt.val()),Tm:ui.val()},i[6]={Dt:Number(tt.val()),Tm:ei.val()},i[7]={Dt:Number(wt.val()),Tm:oi.val()}):v==="7"?(i[0]={Dt:Number(p.val()),Tm:it.val()},i[1]={Dt:Number(w.val()),Tm:pt.val()},i[2]={Dt:Number(b.val()),Tm:bt.val()},i[3]={Dt:Number(k.val()),Tm:rt.val()},i[4]={Dt:Number(g.val()),Tm:rt.val()},i[5]={Dt:Number(nt.val()),Tm:rt.val()},i[6]={Dt:Number(tt.val()),Tm:rt.val()}):v==="6"?(i[0]={Dt:Number(p.val()),Tm:it.val()},i[1]={Dt:Number(w.val()),Tm:pt.val()},i[2]={Dt:Number(b.val()),Tm:bt.val()},i[3]={Dt:Number(k.val()),Tm:rt.val()},i[4]={Dt:Number(g.val()),Tm:ti.val()},i[5]={Dt:Number(nt.val()),Tm:ui.val()}):v==="5"?(i[0]={Dt:Number(p.val()),Tm:it.val()},i[1]={Dt:Number(w.val()),Tm:pt.val()},i[2]={Dt:Number(b.val()),Tm:bt.val()},i[3]={Dt:Number(k.val()),Tm:rt.val()},i[4]={Dt:Number(g.val()),Tm:ti.val()}):v==="4"?(i[0]={Dt:Number(p.val()),Tm:it.val()},i[1]={Dt:Number(w.val()),Tm:pt.val()},i[2]={Dt:Number(b.val()),Tm:bt.val()},i[3]={Dt:Number(k.val()),Tm:rt.val()}):v==="3"?(i[0]={Dt:Number(p.val()),Tm:it.val()},i[1]={Dt:Number(w.val()),Tm:pt.val()},i[2]={Dt:Number(b.val()),Tm:bt.val()}):v==="2"?(i[0]={Dt:Number(p.val()),Tm:it.val()},i[1]={Dt:Number(w.val()),Tm:pt.val()}):i[0]={Dt:Number(p.val()),Tm:it.val()}:dt&&l.SchedDate==="1"&&(v==="10"?(i[0]={Dt:Number(p.val())},i[1]={Dt:Number(w.val())},i[2]={Dt:Number(b.val())},i[3]={Dt:Number(k.val())},i[4]={Dt:Number(g.val())},i[5]={Dt:Number(nt.val())},i[6]={Dt:Number(tt.val())},i[7]={Dt:Number(wt.val())},i[8]={Dt:Number(gt.val())},i[9]={Dt:Number(ri.val())}):v==="9"?(i[0]={Dt:Number(p.val())},i[1]={Dt:Number(w.val())},i[2]={Dt:Number(b.val())},i[3]={Dt:Number(k.val())},i[4]={Dt:Number(g.val())},i[5]={Dt:Number(nt.val())},i[6]={Dt:Number(tt.val())},i[7]={Dt:Number(wt.val())},i[8]={Dt:Number(gt.val())}):v==="8"?(i[0]={Dt:Number(p.val())},i[1]={Dt:Number(w.val())},i[2]={Dt:Number(b.val())},i[3]={Dt:Number(k.val())},i[4]={Dt:Number(g.val())},i[5]={Dt:Number(nt.val())},i[6]={Dt:Number(tt.val())},i[7]={Dt:Number(wt.val())}):v==="7"?(i[0]={Dt:Number(p.val())},i[1]={Dt:Number(w.val())},i[2]={Dt:Number(b.val())},i[3]={Dt:Number(k.val())},i[4]={Dt:Number(g.val())},i[5]={Dt:Number(nt.val())},i[6]={Dt:Number(tt.val())}):v==="6"?(i[0]={Dt:Number(p.val())},i[1]={Dt:Number(w.val())},i[2]={Dt:Number(b.val())},i[3]={Dt:Number(k.val())},i[4]={Dt:Number(g.val())},i[5]={Dt:Number(nt.val())}):v==="5"?(i[0]={Dt:Number(p.val())},i[1]={Dt:Number(w.val())},i[2]={Dt:Number(b.val())},i[3]={Dt:Number(k.val())},i[4]={Dt:Number(g.val())}):v==="4"?(i[0]={Dt:Number(p.val())},i[1]={Dt:Number(w.val())},i[2]={Dt:Number(b.val())},i[3]={Dt:Number(k.val())}):v==="3"?(i[0]={Dt:Number(p.val())},i[1]={Dt:Number(w.val())},i[2]={Dt:Number(b.val())}):v==="2"?(i[0]={Dt:Number(p.val())},i[1]={Dt:Number(w.val())}):i[0]={Dt:Number(p.val())}),ut=pi(a[y],l,!1,i),ut>0)return hi.trigger("AddonAddedFailed",[bi,l,y,Number(v),i,ut]),!1;hi.trigger("AddonAdded",[bi,l,y,Number(v),i,yi]);var e="",h="",c="",o="";svcCode="";typeof a[y].Promo!="undefined"&&a[y].Promo!=""?e=a[y].Promo:typeof a[y].Voucher!="undefined"&&a[y].Voucher!=""?e=a[y].Voucher:typeof a[y].Access!="undefined"&&a[y].Access!=""?e=a[y].Access:typeof a[y].Iata!="undefined"&&a[y].Iata!=""&&(e=a[y].Iata);t==="CONFIRM"?(h=WsVars.CartItems[y].RoomType,c=WsVars.CartItems[y].RoomCode,o=l.Name,svcCode=l.Name.replace(/\s/g,"")):(h=a[y].RoomType,c=a[y].RoomCode,typeof l.Name!="undefined"?(o=l.Name,svcCode=l.Name.replace(/\s/g,"")):(o=l.SvcName,svcCode=l.SvcName.replace(/\s/g,"")));r=a[y];let s=0;for(let n=0;n<a.length;n++){let t=a[n].Amt??0;if(t>0&&a[n].TaxVAT>0&&(t-=a[n].TaxVAT),s+=t,a[n].Svcs!=null&&a[n].Svcs.length>0){let i=CalculateAddOnAmount(l,r.Dt1,r.Adults,r.Nights,r.Child1+r.Child2+r.Child3+r.Child4,!0,a,r.ChildrenAges,r.Child1,r.Child2,r.Child3,r.Child4);s+=Number(i.amt-i.taxVat)/v;let t=a[n].Svcs;for(let n=0;n<t.length-1;n++){let i=(t[n].Amt??0)-(t[n].TaxVAT??0);s+=i}}}if(v>1&&(l.SchedDate==="1"||l.SchedTime==="1")&&i!=null&&i.length>1)for(let n=0;n<i.length;n++)et=l.ExtServiceItemPrice.find(function(t){return t.DtNumber==i[n].Dt&&t.InvAvail}),f={itemListId:"cart_AddOn",coupon:e,category:"AddOn",roomName:h,roomCode:c,svcCode:svcCode,svcName:o,hotelCode:WsVars.PCode,hotelId:Number(WsVars.HotelID),hotelName:WsVars.HotelName,nights:WsVars.Nights,dt1:WsVars.DayIn,adults:WsVars.Adults,child1:WsVars.Child1,child2:WsVars.Child2,child3:WsVars.Child3,child4:WsVars.Child4,price:Utils.GetActualAmount(et.DailyUnitPrice,WsVars.Currency),quantity:1,index:0,currency:WsVars.Currency,dt1:WsVars.DayIn,totalprice:s,abSetting:WsVars.ABSetting},WsVars.HgID>0&&(f.hgId=WsVars.HgID,WsVars.HotelGroupCode&&(f.hotelGroupCode=WsVars.HotelGroupCode)),SHR.TrkLib.AddToCart(f);else{l.Qty=v;let n=CalculateAddOnAmount(l,r.Dt1,r.Adults,r.Nights,r.Child1+r.Child2+r.Child3+r.Child4,!0,a,r.ChildrenAges,r.Child1,r.Child2,r.Child3,r.Child4);f={itemListId:"cart_AddOn",coupon:e,category:"AddOn",roomName:h,roomCode:c,svcCode:svcCode,svcName:o,hotelCode:WsVars.PCode,hotelId:Number(WsVars.HotelID),hotelName:WsVars.HotelName,nights:WsVars.Nights,dt1:WsVars.DayIn,adults:WsVars.Adults,child1:WsVars.Child1,child2:WsVars.Child2,child3:WsVars.Child3,child4:WsVars.Child4,price:Utils.GetActualAmount((n.amt-n.taxVat)/v*100,WsVars.Currency),quantity:Number(v),index:0,currency:WsVars.Currency,dt1:WsVars.DayIn,totalprice:s,abSetting:WsVars.ABSetting};WsVars.HgID>0&&(f.hgId=WsVars.HgID,WsVars.HotelGroupCode&&(f.hotelGroupCode=WsVars.HotelGroupCode));SHR.TrkLib.AddToCart(f)}return u=this.dvs=n(".ws-product-item.ws-modifying"),t=="CONFIRM"&&(u==null||u.length==0)&&(u=this.dvs=WSMAIN.GetCurrDiv()),u!=null&&u.length>0&&(d=u.data("MyCal")),d!=undefined&&!d.IsOpen()&&t=="CONFIRM"&&IsAddonPriorModStart!=undefined&&IsAddonPriorModStart&&(u.addClass("ws-modifying"),ft=u.find(".ws-modify-options").filter(":first"),ft.addClass("ws-show-this"),WsVars.IBESkinVer=="3"&&ft.removeClass("ws-hide-action"),_isOpen=!0,u.trigger("ModStart")),!1})}},pi=function(n,t,i,r){var l,o,a,s,g,y,e,u;if(t.Invs.length===0)return 0;var p=0,c=0,f=1,h=0,w=0,b=0,k=0,d=0;if(n.Child2==undefined&&(n.Child2=0),n.Child3==undefined&&(n.Child3=0),n.Child4==undefined&&(n.Child4=0),h=n.Child1+n.Child2+n.Child3+n.Child4,WsVars.EnhancedMultiroom.toLowerCase()=="true"&&n.ChildrenAges!=null&&n.ChildrenAges.length>0)for(o=0;o<n.ChildrenAges.length;o++)WsVars.ChildAgeGroup1>0&&n.ChildrenAges[o]<=WsVars.ChildAgeGroup1?w++:WsVars.ChildAgeGroup2>0&&n.ChildrenAges[o]<=WsVars.ChildAgeGroup2?b++:WsVars.ChildAgeGroup3>0&&n.ChildrenAges[o]<=WsVars.ChildAgeGroup3?k++:WsVars.ChildAgeGroup4>0&&n.ChildrenAges[o]<=WsVars.ChildAgeGroup4&&d++;if(t.ChildOccupancyOptions!=""&&t.ChildOccupancyOptions!=undefined&&t.ChildOccupancyOptions!="undefined"&&(t.Per==="2"||t.Formula===2||t.Per==="10"||t.Formula===10)&&(l=t.ChildOccupancyOptions.split(","),l!=null&&l.length>0&&(w>0||b>0||k>0||d>0)))for(h=0,o=0;o<l.length;o++)w>0&&l[o].trim()=="ChildAgeGroup1"&&(h+=w),b>0&&l[o].trim()=="ChildAgeGroup2"&&(h+=b),k>0&&l[o].trim()=="ChildAgeGroup3"&&(h+=k),d>0&&l[o].trim()=="ChildAgeGroup4"&&(h+=d);if(t.Per==="1"||t.Per==="2"||t.Per==="3"||t.Per==="4"||t.Per==="7"){if(t.Per==="1"?f=n.Adults:t.Per==="2"?f=h:t.Per==="3"&&(f=n.Adults+h),i===!0){if(a=!1,t.Options==="CheckInOnly"){for(u=0;u<t.Invs.length;u++)if(t.Invs[u].Dt===n.Dt1){t.Invs[u].Inv>=f&&(a=!0);break}}else if(t.Options==="CheckOutOnly"){for(u=0;u<t.Invs.length;u++)if(t.Invs[u].Dt===n.Dt1+n.Nights){t.Invs[u].Inv>=f&&(a=!0);break}}else if(t.Options==="ExcludeArrivalDate"){for(u=0;u<t.Invs.length;u++)if(t.Invs[u].Dt!==n.Dt1){t.Invs[u].Inv>=f&&(a=!0);break}}else if(t.Options==="ExcludeDepartureDate"){for(u=0;u<t.Invs.length;u++)if(t.Invs[u].Dt!==n.Dt1+n.Nights){t.Invs[u].Inv>=f&&(a=!0);break}}else if(t.Options==="ExcludeArrivalDate,ExcludeDepartureDate"){for(u=0;u<t.Invs.length;u++)if(t.Invs[u].Dt!==n.Dt1&&t.Invs[u].Dt!==n.Dt1+n.Nights){t.Invs[u].Inv>=f&&(a=!0);break}}else for(u=0;u<t.Invs.length;u++)if(t.Invs[u].Inv>=f){a=!0;break}return a?0:n.Dt1}if(r.length===0){if(t.Options==="CheckOutOnly"){for(u=0;u<t.Invs.length;u++)if(t.Invs[u].Dt===n.Dt1+n.Nights){t.Invs[u].Inv<f*Number(v)&&(c=n.Dt1+n.Nights);break}}else for(u=0;u<t.Invs.length;u++)if(t.Invs[u].Dt===n.Dt1){t.Invs[u].Inv<f*Number(v)&&(c=n.Dt1);break}}else{for(s=[],g=!1,s[0]={Dt:r[0].Dt,Qty:f},e=1;e<r.length;e++){for(g=!1,u=0;u<s.length;u++)if(s[u].Dt===r[e].Dt){s[u].Qty+=f;g=!0;break}g===!1&&s.push({Dt:r[e].Dt,Qty:f})}for(y=!1,e=0;e<s.length;e++){for(y=!1,u=0;u<t.Invs.length;u++)if(t.Invs[u].Dt===s[e].Dt){y=!0;t.Invs[u].Inv<s[e].Qty&&(c=s[e].Dt);break}if(y===!1)return s[e].Dt;if(c>0)return c}}return c}if(t.Per==="5"||t.Per==="6"||t.Per==="8"||t.Per==="9"||t.Per==="10"){for(t.Per==="8"?f=n.Adults+h:t.Per==="9"?f=n.Adults:t.Per==="10"&&(f=h),y=!1,e=0;e<n.Nights;e++){for(y=!1,p=n.Dt1+e,u=0;u<t.Invs.length;u++)if(t.Invs[u].Dt===p){y=!0;t.Invs[u].Inv<f&&(c=p);break}if(y===!1)return p;if(c>0)return c}return 0}return 0},or=function(){var i,e,f;if(!(y<0)&&!(y>=a.length)){var n=a[y],t="",o,s=n.Dt1,h=n.Dt1+n.Nights,u=!1;for(i=0;i<=n.Nights;i++){if(u=!1,r.Options.search("ExcludeArrivalDate")!=-1&&r.Options.search("ExcludeDepartureDate")!=-1){if(n.Dt1+i==s||n.Dt1+i==h)continue;u=!0}else if(l.Options.search("ExcludeArrivalDate")!=-1){if(n.Dt1+i==s)continue;u=!0}else if(l.Options.search("ExcludeDepartureDate")!=-1){if(n.Dt1+i==h)continue;u=!0}else u=!0;if(u==!0)for(o=Utils.ToCustom1(n.Dt1+i,0,WsVars.LangID),e=[],f=0;f<l.Invs.length;f++)e.indexOf(l.Invs[f].Dt)==-1&&l.Invs[f].Dt===n.Dt1+i&&(e.push(l.Invs[f].Dt),t+=Utils.Format('<option value="{1}">{0}<\/option>',o,n.Dt1+i))}p.html(t).change();w.html(t).change();b.html(t).change();k.html(t).change();g.html(t).change();nt.html(t).change();tt.html(t).change();wt.html(t).change();gt.html(t).change();ri.html(t).change()}},wi=function(){v==="10"?ai.addClass("ws-show-this").removeClass("ws-hide-action"):v==="9"?(ft.addClass("ws-show-this").removeClass("ws-hide-action"),et.addClass("ws-show-this").removeClass("ws-hide-action"),ot.addClass("ws-show-this").removeClass("ws-hide-action"),st.addClass("ws-show-this").removeClass("ws-hide-action"),ht.addClass("ws-show-this").removeClass("ws-hide-action"),ct.addClass("ws-show-this").removeClass("ws-hide-action"),lt.addClass("ws-show-this").removeClass("ws-hide-action"),at.addClass("ws-show-this").removeClass("ws-hide-action"),vt.addClass("ws-show-this").removeClass("ws-hide-action"),yt.removeClass("ws-show-this").addClass("ws-hide-action")):v==="8"?(ft.addClass("ws-show-this").removeClass("ws-hide-action"),et.addClass("ws-show-this").removeClass("ws-hide-action"),ot.addClass("ws-show-this").removeClass("ws-hide-action"),st.addClass("ws-show-this").removeClass("ws-hide-action"),ht.addClass("ws-show-this").removeClass("ws-hide-action"),ct.addClass("ws-show-this").removeClass("ws-hide-action"),lt.addClass("ws-show-this").removeClass("ws-hide-action"),at.addClass("ws-show-this").removeClass("ws-hide-action"),vt.removeClass("ws-show-this").addClass("ws-hide-action"),yt.removeClass("ws-show-this").addClass("ws-hide-action")):v==="7"?(ft.addClass("ws-show-this").removeClass("ws-hide-action"),et.addClass("ws-show-this").removeClass("ws-hide-action"),ot.addClass("ws-show-this").removeClass("ws-hide-action"),st.addClass("ws-show-this").removeClass("ws-hide-action"),ht.addClass("ws-show-this").removeClass("ws-hide-action"),ct.addClass("ws-show-this").removeClass("ws-hide-action"),lt.addClass("ws-show-this").removeClass("ws-hide-action"),at.removeClass("ws-show-this").addClass("ws-hide-action"),vt.removeClass("ws-show-this").addClass("ws-hide-action"),yt.removeClass("ws-show-this").addClass("ws-hide-action")):v==="6"?(ft.addClass("ws-show-this").removeClass("ws-hide-action"),et.addClass("ws-show-this").removeClass("ws-hide-action"),ot.addClass("ws-show-this").removeClass("ws-hide-action"),st.addClass("ws-show-this").removeClass("ws-hide-action"),ht.addClass("ws-show-this").removeClass("ws-hide-action"),ct.addClass("ws-show-this").removeClass("ws-hide-action"),lt.removeClass("ws-show-this").addClass("ws-hide-action"),at.removeClass("ws-show-this").addClass("ws-hide-action"),vt.removeClass("ws-show-this").addClass("ws-hide-action"),yt.removeClass("ws-show-this").addClass("ws-hide-action")):v==="5"?(ft.addClass("ws-show-this").removeClass("ws-hide-action"),et.addClass("ws-show-this").removeClass("ws-hide-action"),ot.addClass("ws-show-this").removeClass("ws-hide-action"),st.addClass("ws-show-this").removeClass("ws-hide-action"),ht.addClass("ws-show-this").removeClass("ws-hide-action"),ct.removeClass("ws-show-this").addClass("ws-hide-action"),lt.removeClass("ws-show-this").addClass("ws-hide-action"),at.removeClass("ws-show-this").addClass("ws-hide-action"),vt.removeClass("ws-show-this").addClass("ws-hide-action"),yt.removeClass("ws-show-this").addClass("ws-hide-action")):v==="4"?(ft.addClass("ws-show-this").removeClass("ws-hide-action"),et.addClass("ws-show-this").removeClass("ws-hide-action"),ot.addClass("ws-show-this").removeClass("ws-hide-action"),st.addClass("ws-show-this").removeClass("ws-hide-action"),ht.removeClass("ws-show-this").addClass("ws-hide-action"),ct.removeClass("ws-show-this").addClass("ws-hide-action"),lt.removeClass("ws-show-this").addClass("ws-hide-action"),at.removeClass("ws-show-this").addClass("ws-hide-action"),vt.removeClass("ws-show-this").addClass("ws-hide-action"),yt.removeClass("ws-show-this").addClass("ws-hide-action")):v==="3"?(ft.addClass("ws-show-this").removeClass("ws-hide-action"),et.addClass("ws-show-this").removeClass("ws-hide-action"),ot.addClass("ws-show-this").removeClass("ws-hide-action"),st.removeClass("ws-show-this").addClass("ws-hide-action"),ht.removeClass("ws-show-this").addClass("ws-hide-action"),ct.removeClass("ws-show-this").addClass("ws-hide-action"),lt.removeClass("ws-show-this").addClass("ws-hide-action"),at.removeClass("ws-show-this").addClass("ws-hide-action"),vt.removeClass("ws-show-this").addClass("ws-hide-action"),yt.removeClass("ws-show-this").addClass("ws-hide-action")):v==="2"?(ft.addClass("ws-show-this").removeClass("ws-hide-action"),et.addClass("ws-show-this").removeClass("ws-hide-action"),ot.removeClass("ws-show-this").addClass("ws-hide-action"),st.removeClass("ws-show-this").addClass("ws-hide-action"),ht.removeClass("ws-show-this").addClass("ws-hide-action"),ct.removeClass("ws-show-this").addClass("ws-hide-action"),lt.removeClass("ws-show-this").addClass("ws-hide-action"),at.removeClass("ws-show-this").addClass("ws-hide-action"),vt.removeClass("ws-show-this").addClass("ws-hide-action"),yt.removeClass("ws-show-this").addClass("ws-hide-action")):v==="1"?(ft.addClass("ws-show-this").removeClass("ws-hide-action"),et.removeClass("ws-show-this").addClass("ws-hide-action"),ot.removeClass("ws-show-this").addClass("ws-hide-action"),st.removeClass("ws-show-this").addClass("ws-hide-action"),ht.removeClass("ws-show-this").addClass("ws-hide-action"),ct.removeClass("ws-show-this").addClass("ws-hide-action"),lt.removeClass("ws-show-this").addClass("ws-hide-action"),at.removeClass("ws-show-this").addClass("ws-hide-action"),vt.removeClass("ws-show-this").addClass("ws-hide-action"),yt.removeClass("ws-show-this").addClass("ws-hide-action")):ai.removeClass("ws-show-this").addClass("ws-hide-action")},cr=function(n,t,i,r){var u=Utils.Format('<label><\/label><\/td><td class="ws-price-from" svcAmt={0}><span class="ws-number2" curr="{2}" ref="{0}">{1}<\/span> {3}<\/td>',t,Utils.GetAmountMod(t,i,WsVars.UseCurrCode),kt,WsMulti["PerAddon"+r]);return Utils.ToCustom1(n.Dt1,n.Nights,WsVars.LangID)+"<br/>"+sr+"<br/>"+n.RoomType+"<br/>"+u};hr();ut=function(n){var f="",u="",i,t;if(u=WsVars.Config2Flag=="True"?WsVars.Currency+"~":WsVars.Currency,r!=null&&r.ExtServiceItemPrice!=null&&r.ExtServiceItemPrice.length>0){for(i=0;i<r.ExtServiceItemPrice.length;++i)if(t="",n==r.ExtServiceItemPrice[i].DtNumber){t=Utils.GetActualAmount(r.ExtServiceItemPrice[i].DailyUnitPrice,u,WsVars.UseCurrCode);WsVars.IbeShowTotal==="1"?t=Number(t)+Number(Utils.GetActualAmount(r.ExtServiceItemPrice[i].DailyUnitTax,u,WsVars.UseCurrCode)):WsVars.IbeShowTotalExclusive==="1"&&(t=t>Number(Utils.GetActualAmount(r.ExtServiceItemPrice[i].DailyUnitTaxVat,u,WsVars.UseCurrCode))?Number(t)-Number(Utils.GetActualAmount(r.ExtServiceItemPrice[i].DailyUnitTaxVat,u,WsVars.UseCurrCode)):"0");f+=Utils.Format('<span class="ws-together wsAddonSchedPrice ws-number2" id="{3}" curr={1} ref="{0}">{2}<\/span>',t,kt,Utils.GetAmountMod(t,u,WsVars.UseCurrCode),si[0].id);break}}else f+=Utils.Format('<span class="ws-together wsAddonSchedPrice ws-number2" id="{3}" curr={1} ref="{0}">{2}<\/span>',r.Price,kt,Utils.GetAmount(r.Price,u,WsVars.UseCurrCode),si[0].id);return f}}var t="";n.fn.wsibesvc=function(r){if(this.length){var u=n.extend({Items:[],Page:""},r);return t=u.Page,this.each(function(){var t=n(this),r=new i(t,u.Items,u);u.Page.length===0?r.Init(null,null):(u.Page==="INDEX"||u.Page==="CONFIRM")&&u.Items.length===1&&r.Init(u.Items[0],null);t.on("AddonAdded",function(n,t,i,r,f,e,o){if(u.onAddonAdded!==undefined)u.onAddonAdded(n,t,i,r,f,e,o)});t.on("AddonAddedFailed",function(n,t,i,r,f,e,o){if(u.onAddonAddedFailed!==undefined)u.onAddonAddedFailed(n,t,i,r,f,e,o)});t.on("SvcAvailSuccess",function(n,t){if(u.onSvcAvailSuccess!==undefined)u.onSvcAvailSuccess(n,t)});t.on("ReInit",function(n,t,i){r.Init(t,i)});t.on("ReInitWithData",function(n,t,i,u){r.InitWithData(t,i,u)})})}};jQuery(document).ready(function(n){n("#cnWsHotelAddon .ws-show-all a.ws-show-more").click(function(){return n("#cnWsHotelAddon .ws-results article:gt(3)").removeClass("ws-hidden"),n("#cnWsHotelAddon .ws-show-all").addClass("ws-showing"),WsVars.IBESkinVer=="3"&&(n("#cnWsHotelAddon .ws-results article:gt(3)").removeClass("ws-hide-action"),n("#cnWsHotelAddon .ws-results article:eq(4) a").focus()),!1});n("#cnWsHotelAddon .ws-show-all a.ws-show-less").click(function(){return n("#cnWsHotelAddon .ws-results article:gt(3)").addClass("ws-hidden"),n("#cnWsHotelAddon .ws-show-all").removeClass("ws-showing"),n("#cnWsHotelAddon div.ws-related-data").removeClass("ws-show-this"),n("#cnWsHotelAddon .ws-results article").removeClass("ws-open"),WsVars.IBESkinVer=="3"&&n("#cnWsHotelAddon .ws-results article:gt(3)").addClass("ws-hide-action"),!1})})}(jQuery);var WsMulti=WsMulti||{},WsIbeTracking={},compCounts=0;let autocomplete;WsIbeTracking.TrackCancellation=function(){};WsIbeTracking.TrackModification=function(){};var WsLoyaltyPointsInfo=[],WsItemLoyaltyPointsInfo={LoyaltyPoints:0,LoyaltyAmount:0,ItemUsedLoyaltyAmount:0,ItemUsedLoyaltyPoints:0,TotalUsedLoyaltyAmount:0,TotalUsedLoyaltyPoints:0,IsAllowReductionLoyaltyPoint:0,RedeemAmount:0,RedeemPoints:0,TotalRedeemAmount:0,TotalRedeemPoints:0,TotalAmount:0,TotalRemainingAmount:0,RemainingPoints:0,EquivalentItemAmount:0,EqRemainAmount:0,MaxLoyaltyRedeemPoints:0,ItemPayableAmount:0,ItemPayablePoints:0,ItemTotalAmount:0,ItemDepositAmount:0,ItemPayableDepositAmount:0,ItemRemainingAmount:0,CrsID:"",RemainingCashback:0,MaxLoyaltyRedeemAmount:0,ConversionPtAmt:0},WsPaymentOptions={},IsAddonPriorModStart=!1,WSMAIN={items:[],dvs:[],isChanged:!1,IxCurr:"0",selectedRs:null,newGuarPl:"",payOption:"",paygateWalletTransToken:"",Init:function(n){var i,r,e,t,u,f;for(this.items=n,WSMAIN.IsVisibleBillingInfo(n),WSMAIN.LoadAdditionalGuestsField(),WSMAIN.IsVisibleLoyaltyRedeemPointsSection(this.items,""),WsVars.IsAdyenV2=="1"&&GetAdyenV2PaymentMethod(WSMAIN.items),this.dvs=$(".ws-product-item").wsformibemod({Page:"CONFIRM",Items:n,onModStart:function(n,t){var i=t.attr("ref"),r=t.attr("pmsresvid");$("#ws-main").addClass("ws-modify-main");$("#wsform a").removeClass("ws-error-form");WsVars.IsDisplayPmsResvId!="1"||WSMAIN.IsEmpty(r)?$("#txModifyResv").addClass("ws-show-this").html(Utils.Format(WsMulti.ModifyingResv,i)):$("#txModifyResv").addClass("ws-show-this").html(Utils.Format(WsMulti.ModifyingResv,r));$('.ws-product-item[ref!="'+i+'"]').trigger("ModCancelOthers");WSMAIN.IxCurr=t.attr("ix");WSMAIN.VerifyDiff(t);WSMAIN.ShowSummary();$("#dvDepositPaygate").hide();$("#dvDepositPaygateDetails").hide()},onModCancel:function(){showLoder();reloadPage()},onCalOccChanged:function(n,t){if(WSMAIN.VerifyDiff(t),WsVars.IBESkinVer=="3"){var r=t.data("MyCal"),u=r.GetArrival(),f=r.GetDeparture(),e=r.GetNights();WSMAIN.ShowDates(u,f,e)}var i=t.data("MyRmRc"),o=t.data("MyOcc").GetChildren(),s=t.data("MyOcc").GetAdults(),h=t.data("MyRmRc").GetCrsID(),c=i.GetRmID(),l=i.GetRoomName(),a=i.GetRateName();WSMAIN.IsVisibleBillingSection(i)},onOccChanged:function(n,t){WSMAIN.CheckOccupancy(t)},onRoomChanged:function(n,t){WSMAIN.VerifyDiff(t);WSMAIN.ShowSummary();WSMAIN.UpdateDetails(t);WsVars.EnableRoomTypePolicy=="1"&&WSMAIN.UpdateTerms(t);var r=t.data("MyRmRc"),u=t.data("MyCal"),i=t.data("MyOcc"),f=t.data("MySvc"),e={HotelID:r.GetHotelID(),CrsID:r.GetCrsID(),ResvID:r.GetResvID(),RmID:r.GetRmID(),RcID:r.GetRcID(),Dt1:u.GetArrival(),Nights:u.GetNights(),Adults:i.GetAdults(),Child1:i.GetChild1(),Child2:i.GetChild2(),Child3:i.GetChild3(),Child4:i.GetChild4(),ChildrenAges:i.GetChildAges(),Svcs:f.GetSvcs(),IsResvMod:u.IsOpen()};$(".dvHotelAddon").trigger("ReInit",[e]);(WsVars.IsAdyenV2==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsPaymentGatewayV1==1)&&(WSMAIN.SetPayOption(),WSMAIN.ChangePaymentOption(!1))},onRateChanged:function(n,t){WSMAIN.VerifyDiff(t);WSMAIN.ShowSummary();WSMAIN.UpdateDetails(t);WSMAIN.UpdateTerms(t);var i=t.data("MyRmRc"),u=t.data("MyCal"),r=t.data("MyOcc"),f=t.data("MySvc"),e={HotelID:i.GetHotelID(),CrsID:i.GetCrsID(),ResvID:i.GetResvID(),RmID:i.GetRmID(),RcID:i.GetRcID(),Dt1:u.GetArrival(),Nights:u.GetNights(),Adults:r.GetAdults(),Child1:r.GetChild1(),Child2:r.GetChild2(),Child3:r.GetChild3(),Child4:r.GetChild4(),ChildrenAges:r.GetChildAges(),Svcs:f.GetSvcs(),IsResvMod:u.IsOpen()},o=i.GetData();$(".dvHotelAddon").trigger("ReInit",[e])},onAddonRemoved:function(n,t){WSMAIN.VerifyDiff(t);WSMAIN.ShowSummary();WSMAIN.UpdateDetails(t);WSMAIN.UpdateTerms(t);var r=t.data("MyRmRc"),u=t.data("MyCal"),i=t.data("MyOcc"),f=t.data("MySvc"),e={HotelID:r.GetHotelID(),CrsID:r.GetCrsID(),ResvID:r.GetResvID(),RmID:r.GetRmID(),RcID:r.GetRcID(),Dt1:u.GetArrival(),Nights:u.GetNights(),Adults:i.GetAdults(),Child1:i.GetChild1(),Child2:i.GetChild2(),Child3:i.GetChild3(),Child4:i.GetChild4(),ChildrenAges:i.GetChildAges(),Svcs:f.GetSvcs(),IsResvMod:u.IsOpen()};$(".dvHotelAddon").trigger("ReInit",[e])},onAddonModified:function(n,t,i){if(WSMAIN.VerifyDiff(t),i){var u=t.data("MyRmRc"),f=t.data("MyCal"),r=t.data("MyOcc"),e=t.data("MySvc"),o={HotelID:u.GetHotelID(),CrsID:u.GetCrsID(),ResvID:u.GetResvID(),RmID:u.GetRmID(),RcID:u.GetRcID(),Dt1:f.GetArrival(),Nights:f.GetNights(),Adults:r.GetAdults(),Child1:r.GetChild1(),Child2:r.GetChild2(),Child3:r.GetChild3(),Child4:r.GetChild4(),ChildrenAges:r.GetChildAges(),Svcs:e.GetSvcs(),IsResvMod:f.IsOpen()};$(".dvHotelAddon").trigger("ReInit",[o])}},onAvailSuccess:function(n,t,i){var f=WSMAIN.VerifyAddonNew(t,i);t.trigger("AddonVerified",[f,i.AddOns]);WSMAIN.ShowSummary();WSMAIN.UpdateDetails(t);WSMAIN.VerifyDiff(t);WSMAIN.UpdateTerms(t);WSMAIN.CheckOccupancy(t);var e=Number(WSMAIN.IxCurr),o=t.data("MyRmRc"),r=t.data("MyCal"),u=t.data("MyOcc"),s=t.data("MySvc"),h={RmID:o.GetRmID(),Dt1:r.GetArrival(),Nights:r.GetNights(),Adults:u.GetAdults(),Child1:u.GetChildren(),Child2:0,Child3:0,Child4:0,ChildrenAges:u.GetChildAges(),Svcs:s.GetSvcs(),IsResvMod:r.IsOpen()};$(".dvHotelAddon").trigger("ReInitWithData",[e,h,i])},onAvailError:function(n,t,i,r){if(WSMAIN.VerifyDiff(t),r!=="PROMO"){var u=t.find(".buClearDates").attr("id");if(WsMulti.MsgUnavailModal.length<9){document.querySelector("#"+u).scrollIntoView({behavior:"smooth"});return}$("#subGenModal").html(WsMulti.MsgUnavailModal);$.magnificPopup.open({items:{src:$("#dvGenModal")},type:"inline",modal:!0,callbacks:{close:function(){location.href="#"+u}}})}}}),$(".dvHotelAddon").wsibesvc({Page:"CONFIRM",Items:n,onAddonAdded:function(n,t,i,r,u,f){var e,h;if(IsAddonPriorModStart=!0,e=WSMAIN.GetCurrDiv(),h=WSMAIN.GetAddons(t,i,r,u,f),h.length!==0){e.trigger("AddonAdded",[h]);WSMAIN.UpdateDetails(e);WSMAIN.ShowSummary();WSMAIN.VerifyDiff(e);WSMAIN.UpdateTerms(e);var s=e.data("MyRmRc"),c=e.data("MyCal"),o=e.data("MyOcc"),l=e.data("MySvc"),a={HotelID:s.GetHotelID(),CrsID:s.GetCrsID(),ResvID:s.GetResvID(),RmID:s.GetRmID(),RcID:s.GetRcID(),Dt1:c.GetArrival(),Nights:c.GetNights(),Adults:o.GetAdults(),Child1:o.GetChild1(),Child2:o.GetChild2(),Child3:o.GetChild3(),Child4:o.GetChild4(),ChildrenAges:o.GetChildAges(),Svcs:l.GetSvcs()};$(".dvHotelAddon").trigger("ReInit",[a])}},onAddonAddedFailed:function(n,t,i,r,u,f,e){WSMAIN.AddAddonFailed(t,i,r,u,f,e)},onSvcAvailSuccess:function(n,t){var i=WSMAIN.GetCurrDiv(),r=WSMAIN.VerifyAddonNew(i,t);i.trigger("AddonVerified",[r,t.AddOns]);WSMAIN.ShowSummary();WSMAIN.UpdateDetails(i);WSMAIN.VerifyDiff(i)}}),i={},r=[],t=0;t<this.items.length;t++)i[this.items[t].Currency]=this.items[t].Currency;for(t in i)r.push(i[t]);if(r.length<=1?(e=new Yetii({id:"ws-entry"}),$("#ws-entry .tab").show()):($("#ws-entry-nav,#ws-cost-summary").hide(),$("#ws-cost-detail").show()),WsVars.IBESkinVer=="3")for(t=0;t<WSMAIN.items.length;t++)u=$(".ws-product-item[ix="+t+"]").find(".ws-start-mod"),f=$(".ws-product-item[ix="+t+"]").find(".wsCartItemBuDelete"),$(u).attr("aria-label",$(u).text()+" "+WSMAIN.items[t].RoomType),$(f).attr("aria-label",$(f).text()+" "+WSMAIN.items[t].RoomType)},VerifyAddonNew:function(n,t){var r=n.data("MySvc").GetSvcs(),v,s,i,p,h,u,e,f,c,y,l,w,a,o,b;if(r.length===0)return[];if(t.Validated==null)return[];if(r.length!==t.Validated.length)return[];for(v=!1,s=n.data("MyCal"),i=r.length-1;i>=0;i--)if(s.IsOpen()||t.Validated[i].SvcID!=0||this.items==null||!(this.items.length>0)||this.items[0].CrsID==null||this.items[0].CrsID=="")if(t.Validated[i].SvcID!==0){r[i].Amt=t.Validated[i].Amt;r[i].Taxes=t.Validated[i].Taxes;r[i].TaxVAT=t.Validated[i].TaxVAT;r[i].TaxDetail=t.Validated[i].TaxDetail;r[i].Name=t.Validated[i].Name;r[i].Desc=t.Validated[i].Desc;r[i].ExtServiceItemPrice=t.Validated[i].ExtServiceItemPrice;r[i].ChildOccupancyOptions=t.Validated[i].ChildOccupancyOptions;t.Validated[i].Dates.length==0&&(p=checkAddonOption(r[i].Options)=="None",r[i].Options.search("CheckInOnly")!=-1||r[i].Options.search("None")!=-1||p?(h=[],r[i].Dates&&r[i].Dates.length>0&&r[i].Dates[0]&&(h[0]=r[i].Dates[0]),r[i].Options.search("CheckInOnly")!=-1&&(h[0]={Dt:s.GetArrival()}),(r[i].Options.search("None")!=-1||r[i].Options=="")&&r[i].Dates!=null&&r[i].Dates!=undefined&&(r[i].Dates[0]==null||r[i].Dates[0]==undefined)&&(h[0]={Dt:s.GetArrival()}),r[i].Dates[0]=h[0]):r[i].Options.search("CheckOutOnly")!=-1&&(r[i].Dates[0]={Dt:s.GetDeparture()}));try{if(t.AddOns!=undefined&&t.AddOns!=null&&t.AddOns.length>0)for(u=r[i].Dates,e=[],u!=undefined&&u!=null&&u.length>0&&e.push(u[0]),f=0;f<t.AddOns.length;f++)if(t.AddOns[f].ID!=t.Validated[i].SvcID)continue;else if(t.AddOns[f].Invs!=null&&t.AddOns[f].Invs.length>0){for(c=0;c<t.AddOns[f].Invs.length;c++)if(y=!1,t.AddOns[f].Invs[c].Inv>0){if(l=t.AddOns[f].Invs[c].Dt,e.length>0)for(a=0;a<e.length;a++)if(e[a].Dt!=l)continue;else{y=!0;break}if(u!=undefined&&u!=null&&u.length>0)for(o=0;o<u.length;o++)u[o].Dt==l&&u[o].Tm!=undefined&&(w=u[o].Tm);y==!1&&(b={Dt:l,Tm:w},e.push(b))}r[i].Dates=e;break}}catch(k){}}else v=!0,r.splice(i,1);return v&&WSMAIN.Alert(WsMulti.MsgAddonOutOfRange,n),r},AddAddonFailed:function(n,t,i,r,u,f){var e=Utils.ToCustom1(f,0,WsVars.LangID),o=Utils.Format(WsMulti.MsgAddonAddedFailed,e),s=this.GetCurrDiv();this.Alert(o,s)},GetAddons:function(n,t,i,r,u){var d=Number(t.ID),b=Number(t.Price),f=Number(t.Taxes),g=[],p=this.GetCurrDiv(),it=p.data("MySvc").GetSvcs(),o=p.data("MyOcc"),w=p.data("MyCal"),a=w.GetNights(),v=o.GetAdults(),l=o.GetChildren(),nt=o.GetChildAges(),tt,e,s,h,y,c,k;if((t.Per==="2"||t.Per==="10")&&l===0)return this.Alert(Utils.Format(WsMulti.MsgUnavailAddon,t.Name),p),[];if(t.Per!="7"&&t.Per!="4"&&((t.Per==="5"||t.Per==="6"||t.Per==="8"||t.Per==="9"||t.Per==="10")&&(r=1),t.Per==="1"?f=f*v:t.Per==="2"?f=f*l:t.Per==="3"?f=f*(v+l):t.Per==="5"||t.Per==="6"?f=f*a:t.Per==="9"?f=f*a*v:t.Per==="10"?f=f*a*l:t.Per==="8"&&(f=f*a*(v+l))),tt=this.GetExistingSvcIdx(it,d),tt<0)for(t.Options.search("CheckInOnly")!=-1?(u=[],u[0]={Dt:w.GetArrival()}):t.Options.search("CheckOutOnly")!=-1&&(u=[],u[0]={Dt:w.GetDeparture()}),e=[],s=0;s<r;s++){for(e=u.length>s?[u[s]]:[],h=0;h<t.Invs.length;h++){for(y=!1,c=0;c<e.length;c++)if(t.Invs[h].Dt==e[c].Dt){y=!0;break}y||(e[e.length]={Dt:Number(t.Invs[h].Dt)})}k=CalculateAddOnAmount(t,w.GetArrival(),v,a,l,!0,WSMAIN.items,nt,o.GetChild1(),o.GetChild2(),o.GetChild3(),o.GetChild4());b=Number(k.amt);g.push({HotelID:n,SvcID:d,Name:t.Name,Desc:t.Desc,Img:t.Img,Options:t.Options,ScheduledbyDate:t.SchedDate==="1"?!0:!1,ScheduledbyTime:t.SchedTime==="1"?!0:!1,Qty:1,Amt:b,Taxes:f,Policy:t.Policy,CanPolicy:t.CanPolicy,Avail:!0,Dates:e,IsAllowAddOnForPayByPoints:t.IsAllowAddOnForPayByPoints==="1"?!0:!1,ExtServiceItemPrice:t.ExtServiceItemPrice,Per:t.Per,TaxVAT:t.TaxVAT,ChildOccupancyOptions:t.ChildOccupancyOptions,Title:t.Title,AltText:t.AltText})}else if((t.Per==="1"||t.Per==="2"||t.Per==="3"||t.Per==="4"||t.Per==="7")&&(t.Options.length===0||t.Options=="IncludeInDeposit"||t.Options=="ExcludeArrivalDate"||t.Options=="ExcludeDepartureDate"||t.Options=="ExcludeArrivalDate,ExcludeDepartureDate"))for(e=[],s=0;s<r;s++){for(e=u.length>s?[u[s]]:[],h=0;h<t.Invs.length;h++){for(y=!1,c=0;c<e.length;c++)if(t.Invs[h].Dt==e[c].Dt){y=!0;break}y||(e[e.length]={Dt:Number(t.Invs[h].Dt)})}k=CalculateAddOnAmount(t,w.GetArrival(),v,a,l,!0,WSMAIN.items,nt,o.GetChild1(),o.GetChild2(),o.GetChild3(),o.GetChild4());b=Number(k.amt);g.push({HotelID:n,SvcID:d,Name:t.Name,Desc:t.Desc,Img:t.Img,Options:t.Options,ScheduledbyDate:t.SchedDate==="1"?!0:!1,ScheduledbyTime:t.SchedTime==="1"?!0:!1,Qty:1,Amt:b,Taxes:f,Policy:t.Policy,CanPolicy:t.CanPolicy,Avail:!0,Dates:e,IsAllowAddOnForPayByPoints:t.IsAllowAddOnForPayByPoints==="1"?!0:!1,ExtServiceItemPrice:t.ExtServiceItemPrice,Per:t.Per,TaxVAT:t.TaxVAT,ChildOccupancyOptions:t.ChildOccupancyOptions,Title:t.Title,AltText:t.AltText})}else return this.Alert(WsMulti.MsgAddonAddedAlready,p),[];return g},ShowOriginal:function(n){var e=n.attr("ix"),it=$('.ws-cart-stay[ix="'+e+'"]'),f=WsItemLoyaltyPointsInfo,l=!1,ct=0,k=0,lt=it.find(".ws-cart-dates").filter(":first"),at=it.find(".txRateRoom").filter(":first"),vt=it.find(".dvStuff").filter(":first"),rt=WsVars.LangID,v=n.data("MyRmRc"),et=n.data("MyCal"),yt=et.GetArrival(),pt=et.GetNights(),y=n.data("MyOcc"),s="",u,o,ut,p,nt,w,ft,tt,t;s=WsVars.Config2Flag=="True"?v.GetCurrency()+"~":v.GetCurrency();var h=v.GetCurrency(),i=v.GetData(),a=i.Svcs,wt=i.TaxInfo,ni=i.Disc,r=0,ot=0,st=0,d=0;at.html(Utils.Format('<h3 class="txRateRoom-Rate">{0}<\/h3><p>{2}{1}<\/p>',i.RateName,i.RoomType,v.GetTowerName()));lt.html(Utils.Format(Utils.ToCustom0(i.Dt1,i.Nights,rt)));u="<table>"+Utils.Format('<thead><tr><th scope="col" class="sr-only">{0}<\/th><th scope="col" class="sr-only">{1}<\/th><\/tr><\/thead><tbody>',WsMulti.PricingDetails,WsMulti.Amount);var b=i.Daily,ht=i.OriDaily,c=Number(i.Deposit),bt=c,g=v.GetRateOL(),kt=Number(i.Taxes),dt=Number(i.Amt),gt=v.GetGuar();for(t=0;t<b.length;t++)u+=Number(b[t])==0&&(g||ht[t]===1)?Utils.Format('<tr class="ws-detail-room"><td>{0}<\/td><td class="ws-prices ws-price-detail-room">{1}<\/td><\/tr>',Utils.ToMMMDFromIndex(i.Dt1+t,rt),ht[t]===1?WsMulti.Complimentary:WsMulti.COMP):Utils.Format('<tr class="ws-detail-room"><td>{0}<\/td><td class="ws-prices ws-price-detail-room" curr="{3}" ref="{2}">{1}<\/td><\/tr>',Utils.ToMMMDFromIndex(i.Dt1+t,rt),Utils.GetAmount(Number(b[t]),s,WsVars.UseCurrCode),b[t],h),r+=Number(b[t]);if(e>=0&&this.IsLoggedIn()&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"&&(l=i.IsEnablePayByPoints,l)){if(WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0)for(t=0;t<WsLoyaltyPointsInfo.length;t++)if(WsLoyaltyPointsInfo[t].CrsID==i.CrsID){f=WsLoyaltyPointsInfo[t];break}i.LoyaltyPointsInfo!=undefined&&i.LoyaltyPointsInfo!=null&&i.LoyaltyPointsInfo.LoyaltyRedeemAmount>0&&(k=i.LoyaltyPointsInfo.LoyaltyRedeemAmount/100,ct=i.LoyaltyPointsInfo.LoyaltyRedeemPoints)}if(o=dt-r,o>.01&&(r+=o,u+=Utils.Format('<tr class="ws-detail-inclusion"><td>{0}<\/td><td class="ws-prices ws-price-detail-inclusion" curr="{3}" ref="{2}">{1}<\/td><\/tr>',WsMulti.InclusionAmount,Utils.GetAmount(o,s,WsVars.UseCurrCode),o,h)),u+="<\/tbody><\/table>",wt.length>0){for(u+=Utils.Format("<h4>{0}<\/h4><table>",WsMulti.Taxes),u+=Utils.Format('<thead><tr><th scope="col" class="sr-only">{0}<\/th><th scope="col" class="sr-only">{1}<\/th><\/tr><\/thead><tbody>',WsMulti.PricingDetails,WsMulti.Amount),ut=0,t=0;t<i.TaxInfo.length;t++)u+=Utils.Format('<tr class="ws-detail-tax-{4}"><td>{0}<\/td><td class="ws-prices ws-tax-price-{4}" curr="{3}" ref="{2}">{1}<\/td><\/tr>',i.TaxInfo[t].Name,Number(i.TaxInfo[t].Amt)===0&&i.TaxInfo[t].ExcludeForLoyaltyTier===!0?WsMulti.TaxCOMP:Utils.GetAmount(Number(i.TaxInfo[t].Amt),s,WsVars.UseCurrCode),i.TaxInfo[t].Amt,h,i.TaxInfo[t].ID!=null?i.TaxInfo[t].ID.toLowerCase():""),r+=Number(i.TaxInfo[t].Amt),ut+=Number(i.TaxInfo[t].Amt);o=kt-ut;o>.01&&(r+=o,u+=Utils.Format('<tr class="ws-tax-detail-inclusiontaxes"><td>{0}<\/td><td class="ws-prices ws-tax-price-inclusiontaxes" curr="{3}" ref="{2}">{1}<\/td><\/tr>',WsMulti.InclusionTaxes,Utils.GetAmount(o,s,WsVars.UseCurrCode),o,h));u+="<\/tbody><\/table>"}if(a.length>0&&(p={svcs:a,currency:h,currentTotal:r,svcAmt:ot,svcTaxes:st,totalSvcDepositAmt:d},u+=GetSvcsHtml(p,yt,pt,y.GetAdults(),y.GetChildren(),WSMAIN.items,y.GetChildAges(),y.GetChild1(),y.GetChild2(),y.GetChild3(),y.GetChild4(),gt),r=p.currentTotal,st+=p.svcTaxes,ot+=p.svcAmt,d+=p.totalSvcDepositAmt,e>=0&&this.IsLoggedIn()&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1")){for(nt=0,t=0;t<a.length;t++)a[t].IsAllowAddOnForPayByPoints&&(l=!0,a[t].LoyaltyPointsInfo!=null&&a[t].LoyaltyPointsInfo.LoyaltyRedeemPoints>0&&a[t].LoyaltyPointsInfo.LoyaltyRedeemAmount>0&&(nt+=a[t].LoyaltyPointsInfo.LoyaltyRedeemAmount/100));l&&nt>0&&(k+=nt)}if(u+="<table>",u+=Utils.Format('<thead><tr><th scope="col" class="sr-only">{0}<\/th><th scope="col" class="sr-only">{1}<\/th><\/tr><\/thead><tbody>',WsMulti.PricingDetails,WsMulti.Amount),c!=0||i.IsAllowFullPrePayment?(d>0&&c>0&&(c+=d),i.IsAllowFullPrePayment&&(c=r),w=r-c,w<0&&(w=0),u+=g&&r==0?Utils.Format('<tr class="bold ws-detail-subtotal"><td style="padding-bottom:1em;">{0}<\/td><td class="ws-prices ws-price-detail-subtotal" style="padding-bottom:1em;" id="{2}">{1}<\/td><\/tr>',WsMulti.Subtotal,WsMulti.COMP,Utils.Format("{0}_{1}","tdSubtotal",e)):Utils.Format('<tr class="bold ws-detail-subtotal"><td style="padding-bottom:1em;">{0}<\/td><td class="ws-prices ws-price-detail-subtotal" curr="{3}" id="{4}" ref="{2}" style="padding-bottom:1em;">{1}<\/td><\/tr>',WsMulti.Subtotal,Utils.GetAmount(r,s,WsVars.UseCurrCode),r,h,Utils.Format("{0}_{1}","tdSubtotal",e)),g&&r==0||(u+=Utils.Format('<tr class="bold ws-detail-deposit"><td style="padding-bottom:0.25em;">{0}<\/td><td class="ws-prices ws-price-detail-deposit" curr="{3}" ref="{2}" style="padding-bottom:0.25em;" id="{4}">{1}<\/td><\/tr>',WsMulti.Deposit,Utils.GetAmount(c,s,WsVars.UseCurrCode),c,h,Utils.Format("{0}_{1}","tdDeposit",e)),Math.abs(w)>=.01&&(u+=Utils.Format('<tr class="bold ws-detail-remainingamount" id="{4}"><td>{0}<\/td><td class="ws-prices ws-price-detail-remainingamount" curr="{3}" ref="{2}" id="{5}">{1}<\/td><\/tr>',WsMulti.RemainingAmount,Utils.GetAmount(w,s,WsVars.UseCurrCode),w,h,Utils.Format("{0}_{1}","trDepositRemain",e),Utils.Format("{0}_{1}","tdDepositRemain",e))))):u+=g&&r==0?Utils.Format('<tr class="bold ws-detail-subtotal"><td>{0}<\/td><td class="ws-prices ws-price-detail-subtotal" id="{2}">{1}<\/td><\/tr>',WsMulti.Subtotal,WsMulti.COMP,Utils.Format("{0}_{1}","tdSubtotal",e)):Utils.Format('<tr class="bold ws-detail-subtotal"><td>{0}<\/td><td class="ws-prices ws-price-detail-subtotal" curr="{3}" ref="{2}" id="{4}">{1}<\/td><\/tr>',WsMulti.Subtotal,Utils.GetAmount(r,s,WsVars.UseCurrCode),r,h,Utils.Format("{0}_{1}","tdSubtotal",e)),u+="<\/tbody><\/table>",vt.html(u),this.IsLoggedIn()&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"&&e>=0){if(bt==0&&WsVars.LimitPointsToDeposit=="1"&&l&&(l=!1),l?(f==null&&(f={},f.CrsID=i.CrsID),f.ItemTotalAmount=r,f.ItemDepositAmount=c,f.ItemPayableAmount=0,f.EquivalentItemAmount=0,f.RedeemAmount=k,f.ItemRemainingAmount=parseFloat(r)-parseFloat(k)):($('.ws-loyaltyPoints-sliderSection[ix="'+e+'"]').find(".ws-RedeemDetails").addClass("hide"),$("#divslidecontainer").addClass("hide"),$("#divslidecontainer").hide(),$('.ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar[ix="'+e+'"]').addClass("hide")),ft=!1,tt=!1,l&&WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0)for(t=0;t<WsLoyaltyPointsInfo.length;t++)if(WsLoyaltyPointsInfo[t].CrsID==i.CrsID){f!=null&&WsLoyaltyPointsInfo[t].CrsID==f.CrsID&&(WsLoyaltyPointsInfo[t]=f,ft=!0,tt=!0);$('.ws-payByPointsErrorMessage[ix="'+t+'"]').removeClass("hide");break}ft||f==null||f.CrsID==i.CrsID&&(WsLoyaltyPointsInfo.push(f),tt=!0);tt&&(WSMAIN.BuildLoyaltyRedeemPointsHtml(e,i.CrsID),WSMAIN.IsVisibleLoyaltyRedeemPointsSection(WSMAIN.items,i.CrsID),typeof WsShowRates!="undefined"&&$("#MyHeading_dvWsCurrency").length>0&&typeof WsBaseCurr!="undefined"&&typeof WsDispCurr!="undefined"&&WsBaseCurr!=WsDispCurr&&WsShowRates())}},UpdateDetails:function(n){var r=n.attr("ix"),o=$('.ws-cart-stay[ix="'+r+'"]'),s,f,ot,yt,l,pt,nt,tt,it,wt,w,bt,t;if(o!=null){var a=WsItemLoyaltyPointsInfo,k=0,v=!1,st=!1,ti=o.find(".ws-cart-dates").filter(":first"),ii=o.find(".txRateRoom").filter(":first"),ri=o.find(".dvStuff").filter(":first"),ht=WsVars.LangID,i=n.data("MyRmRc"),ct=n.data("MyCal"),ut=ct.GetArrival(),ft=ct.GetNights(),b=n.data("MyOcc"),kt=n.data("MySvc"),d=0;WSMAIN.IsVisibleBillingSection(i);(WsVars.IsElavonFuseboxProp==1||WsVars.IsFreedomPayProp==1||WsVars.IsAdyenV2==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsShift4==!0||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsPaymentGatewayV1==1)&&WsVars.TokenizeChargeRefund==1&&WSMAIN.GetAmountDiff(i,kt);WsVars.IsIPGProp==1&&WsVars.TokenizeChargeRefund==1&&WSMAIN.GetAmountDiff(i,kt);s="";s=WsVars.Config2Flag=="True"?i.GetCurrency()+"~":i.GetCurrency();var y=i.GetCurrency(),rt=i.GetData(),h=n.data("MySvc").GetSvcs(),e=i.GetTaxInfo(),oi=Number(i.GetDisc()),u=0,dt=0,gt=0,et=0;if(r>=0&&this.IsLoggedIn()&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"&&WSMAIN.GetLoyaltyPoints(rt.CrsID,r),!ct.IsOpen()&&!IsAddonPriorModStart){this.ShowOriginal(n);return}if(ft===0){o.hide();return}o.show();ii.html(Utils.Format("<strong>{0}<\/strong><br />{2}{1}",i.GetRateName(),i.GetRoomName(),i.GetTowerName()));ti.html(Utils.Format(Utils.ToCustom0(ut,ft,ht)));f="<table>"+Utils.Format('<thead><tr><th scope="col" class="sr-only">{0}<\/th><th scope="col" class="sr-only">{1}<\/th><\/tr><\/thead><tbody>',WsMulti.PricingDetails,WsMulti.Amount);var p=i.GetDaily().split(","),ni=i.GetCompDaily().split(","),ui=Number(i.GetAmt()),fi=Number(i.GetTax()),c=Number(i.GetDeposit()),g=i.GetRateOL(),ei=i.GetGuar();compCounts=0;var lt=i.GetRoomStay(),at=null,vt=!1;for(lt!=null&&lt.GuarPolicyInfo!=null&&(at=jQuery.parseJSON(lt.GuarPolicyInfo)),(at!=null&&at.IsAllowFullPrePayment==!0||$("#inPaymentOption").val()=="OptFullPrePayment")&&(vt=!0),t=0;t<p.length;t++)Number(p[t])==0&&(g||ni[t]==="True")?(f+=Utils.Format('<tr class="ws-detail-room"><td>{0}<\/td><td class="ws-prices ws-price-detail-room">{1}<\/td><\/tr>',Utils.ToMMMDFromIndex(ut+t,ht),ni[t]==="True"?WsMulti.Complimentary:WsMulti.COMP),compCounts++):f+=Utils.Format('<tr class="ws-detail-room"><td>{0}<\/td><td class="ws-prices ws-price-detail-room" curr="{3}" ref="{2}">{1}<\/td><\/tr>',Utils.ToMMMDFromIndex(ut+t,ht),Utils.GetAmount(Number(p[t]),s,WsVars.UseCurrCode),p[t],y),u+=Number(p[t]);if(r>=0&&this.IsLoggedIn()&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"&&(v=!1,st=!1,ot=null,yt=0,ot=i.GetRc(),ot!=null&&ot.IsAllowPayByPoints==="1"&&(v=!0,st=!0),yt=v?u:0,v&&(k=yt),d=u),l=ui-u,l>.01&&(u+=l,f+=Utils.Format('<tr class="ws-detail-inclusion"><td>{0}<\/td><td class="ws-prices ws-price-detail-inclusion" curr="{3}" ref="{2}">{1}<\/td><\/tr>',WsMulti.InclusionAmount,Utils.GetAmount(l,s,WsVars.UseCurrCode),l,y)),f+="<\/tbody><\/table>",e.length>0){for(f+=Utils.Format("<h4>{0}<\/h4><table>",WsMulti.Taxes),f+=Utils.Format('<thead><tr><th scope="col" class="sr-only">{0}<\/th><th scope="col" class="sr-only">{1}<\/th><\/tr><\/thead><tbody>',WsMulti.PricingDetails,WsMulti.Amount),pt=0,t=0;t<e.length;t++)f+=Utils.Format('<tr class="ws-detail-tax-{4}"><td>{0}<\/td><td class="ws-prices ws-tax-price-{4}" curr="{3}" ref="{2}">{1}<\/td><\/tr>',e[t].Name,Number(e[t].Amt)===0&&(e[t].ExcludeForLoyaltyTier===!0||typeof e[t].ExcludeForLoyaltyTier=="string"&&e[t].ExcludeForLoyaltyTier.toLowerCase()==="true")?WsMulti.TaxCOMP:Utils.GetAmount(Number(e[t].Amt),s,WsVars.UseCurrCode),e[t].Amt,y,e[t].ID!=null?e[t].ID.toLowerCase():""),u+=Number(e[t].Amt),pt+=Number(e[t].Amt);l=fi-pt;l>.01&&(u+=l,f+=Utils.Format('<tr class="ws-tax-detail-inclusiontaxes"><td>{0}<\/td><td class="ws-prices ws-tax-price-inclusiontaxes" curr="{3}" ref="{2}">{1}<\/td><\/tr>',WsMulti.InclusionTaxes,Utils.GetAmount(l,s,WsVars.UseCurrCode),l,y));f+="<\/tbody><\/table>";r>=0&&this.IsLoggedIn()&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"&&WsVars.IncludeTaxesToLoyaltyPoints=="1"&&(d=u,v&&(k=u))}if(h.length>0&&(nt={svcs:h,currency:y,currentTotal:u,svcAmt:dt,svcTaxes:gt,totalSvcDepositAmt:et},f+=GetSvcsHtml(nt,ut,ft,b.GetAdults(),b.GetChildren(),WSMAIN.items,b.GetChildAges(),b.GetChild1(),b.GetChild2(),b.GetChild3(),b.GetChild4(),ei),u=nt.currentTotal,gt+=nt.svcTaxes,dt+=nt.svcAmt,et+=nt.totalSvcDepositAmt),f+="<table>",f+=Utils.Format('<thead><tr><th scope="col" class="sr-only">{0}<\/th><th scope="col" class="sr-only">{1}<\/th><\/tr><\/thead><tbody>',WsMulti.PricingDetails,WsMulti.Amount),tt=c,c!==0||vt?(et>0&&c>0&&(c+=et),$("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()=="OptFullPrePayment"&&(c=u),it=u-c,it<0&&(it=0),f+=g&&u==0?Utils.Format('<tr class="bold ws-detail-subtotal"><td style="padding-bottom:1em;">{0}<\/td><td class="ws-prices ws-price-detail-subtotal" style="padding-bottom:1em;" id="{2}">{1}<\/td><\/tr>',WsMulti.Subtotal,WsMulti.COMP,Utils.Format("{0}_{1}","tdSubtotal",r)):Utils.Format('<tr class="bold ws-detail-subtotal"><td style="padding-bottom:1em;">{0}<\/td><td class="ws-prices ws-price-detail-subtotal" curr="{3}" ref="{2}" id="{4}" style="padding-bottom:1em;">{1}<\/td><\/tr>',WsMulti.Subtotal,Utils.GetAmount(u,s,WsVars.UseCurrCode),u,y,Utils.Format("{0}_{1}","tdSubtotal",r)),g&&u==0||(f+=Utils.Format('<tr class="bold ws-detail-deposit" id="{5}"><td style="padding-bottom:0.25em;">{0}<\/td><td class="ws-prices ws-price-detail-deposit" curr="{3}" ref="{2}" style="padding-bottom:0.25em;" id="{4}">{1}<\/td><\/tr>',WsMulti.Deposit,Utils.GetAmount(c,s,WsVars.UseCurrCode),c,y,Utils.Format("{0}_{1}","tdDeposit",r),Utils.Format("{0}_{1}","trDeposit",r)),Math.abs(it)>=.01&&(f+=Utils.Format('<tr class="bold ws-detail-remainingamount" id="{4}"><td>{0}<\/td><td class="ws-prices ws-price-detail-remainingamount" curr="{3}" ref="{2}" id="{5}">{1}<\/td><\/tr>',WsMulti.RemainingAmount,Utils.GetAmount(it,s,WsVars.UseCurrCode),it,y,Utils.Format("{0}_{1}","trDepositRemain",r),Utils.Format("{0}_{1}","tdDepositRemain",r))))):f+=g&&u==0?Utils.Format('<tr class="bold ws-detail-subtotal"><td>{0}<\/td><td class="ws-prices ws-price-detail-subtotal" id="{2}">{1}<\/td><\/tr>',WsMulti.Subtotal,WsMulti.COMP,Utils.Format("{0}_{1}","tdSubtotal",r)):Utils.Format('<tr class="bold ws-detail-subtotal"><td>{0}<\/td><td class="ws-prices ws-price-detail-subtotal" curr="{3}" ref="{2}" id="{4}">{1}<\/td><\/tr>',WsMulti.Subtotal,Utils.GetAmount(u,s,WsVars.UseCurrCode),u,y,Utils.Format("{0}_{1}","tdSubtotal",r)),f+="<\/tbody><\/table>",ri.html(f),r>=0&&this.IsLoggedIn()&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"){if(WsVars.LimitPointsToDeposit=="1"&&tt>0&&(d=u),wt=0,WsLoyaltyPointsInfo!=undefined&&WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0)for(t=0;t<WsLoyaltyPointsInfo.length;t++)if(WsLoyaltyPointsInfo[t].CrsID==rt.CrsID){a=WsLoyaltyPointsInfo[t];wt=WsLoyaltyPointsInfo[t].LoyaltyPoints;break}if(a!=null&&(a.ItemTotalAmount=u,a.ItemDepositAmount=c),w=0,h.length>0)for(t=0;t<h.length;t++)h[t].IsAllowAddOnForPayByPoints&&(v=!0,w+=h[t].Amt,WsVars.LimitPointsToDeposit=="1"&&WsVars.AddSvcToDeposit=="1"&&tt>0?w+=h[t].Taxes:WsVars.IncludeTaxesToLoyaltyPoints=="1"&&(w+=h[t].Taxes)),WsVars.LimitPointsToDeposit=="0"&&(d+=h[t].Amt,WsVars.IncludeTaxesToLoyaltyPoints=="1"&&(d+=h[t].Taxes));if(tt==0&&WsVars.LimitPointsToDeposit=="1"&&v&&(v=!1),!v||wt<=0){if($("#divslidecontainer").addClass("hide"),$("#divslidecontainer").hide(),$('.ws-payByPointsErrorMessage[ix="'+r+'"]').removeClass("hide"),$('.ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar[ix="'+r+'"]').addClass("hide"),o=$('.ws-loyaltyPoints-sliderSection[ix="'+r+'"]'),o.find(".ws-RedeemDetails").addClass("hide"),o.addClass("hide"),WSMAIN.items!=undefined&&WSMAIN.items!=null&&WSMAIN.items.length==1&&$("#trSumReedemPointPrice").length>0&&$("#trRemaningAmount").length>0&&($("#trSumReedemPointPrice").addClass("hide"),$("#trRemaningAmount").addClass("hide")),WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0){for(bt=[],t=0;t<WsLoyaltyPointsInfo.length;t++)WsLoyaltyPointsInfo[t].CrsID!=rt.CrsID&&bt.push(WsLoyaltyPointsInfo[t]);WsLoyaltyPointsInfo=bt}}else if($("#divslidecontainer").removeClass("hide"),$("#divslidecontainer").show(),$('.ws-payByPointsErrorMessage[ix="'+r+'"]').addClass("hide"),$('.ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar[ix="'+r+'"]').removeClass("hide"),o=$('.ws-loyaltyPoints-sliderSection[ix="'+r+'"]'),o.removeClass("hide"),o.find(".ws-RedeemDetails").removeClass("hide"),$("#trSumReedemPointPrice").length>0&&$("#trRemaningAmount").length>0&&($("#trSumReedemPointPrice").removeClass("hide"),$("#trRemaningAmount").removeClass("hide")),a!=null&&WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0){for(w>0&&WsVars.LimitPointsToDeposit=="0"&&(k+=w),st&&WsVars.LimitPointsToDeposit=="1"&&tt>0&&(k=tt),WsVars.LimitPointsToDeposit=="1"&&w>0&&WsVars.AddSvcToDeposit=="1"&&(k+=w),a.ItemPayableAmount=k,a.EquivalentItemAmount=d,t=0;t<WsLoyaltyPointsInfo.length;t++)if(WsLoyaltyPointsInfo[t].CrsID==rt.CrsID){WsLoyaltyPointsInfo[t]=a;break}WSMAIN.CalculateLoyaltyRedeemPoints(r,rt.CrsID,a.RedeemPoints,!1)}}typeof WsShowRates!="undefined"&&WsShowRates();(WsVars.IsPaymentGateway==="1"||WsVars.GuestLoyalty!=""||$("#MyHeading_buMember").length>0)&&ShowBaseOrSelectedCurrencyPrices();g&&p.length==ft&&p.length>0&&(g&&i.GetIsOLResVal()?($("#buModifyResv").addClass("ws-disabled"),this.Alert(WsMulti.COMP7dayValidation,n)):i.GetOLMaxCompNights()>0&&compCounts>i.GetOLMaxCompNights()?($("#buModifyResv").addClass("ws-disabled"),this.Alert(WsMulti.MaxCompNightsPerRoom,n)):i.GetOLOfferMinLOS()>0&&p.length<i.GetOLOfferMinLOS()?($("#buModifyResv").addClass("ws-disabled"),this.Alert(WsMulti.CompOfferMinLOS,n)):i.GetOLIncentiveMinLOS()>0&&p.length<i.GetOLIncentiveMinLOS()&&this.Alert(WsMulti.CompIncentiveMinLOS,n));vt&&c<=0&&($("#trDeposit_"+r).hide(),$("#trDepositRemain_"+r).hide())}},IsVisibleBillingSection:function(n){var t=n.GetGuar();WSMAIN.newGuarPl=t;var u=n.GetData(),f=u.Guar,e=u.HasCC;WsVars.HideCCSection==1&&(t!="XX"?($("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()!=""&&$("#inPaymentOption").val()!="PayByLink"?showOrHideDvSection($("#field-billing"),!0):showOrHideDvSection($("#field-billing"),!1),(WsVars.IsElavonFuseboxProp==1||WsVars.IsIPGProp==1||WsVars.IsAdyenV2==1||WsVars.IsFreedomPayProp==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsPaymentGatewayV1==1)&&$("#buBillingModify").closest("fieldset").removeClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-hide-action").addClass("ws-show-this")):showOrHideDvSection($("#field-billing"),e));var r=n.GetRoomStay(),i=null,o=!1;if(r!=null&&r.GuarPolicyInfo!=null&&(i=jQuery.parseJSON(r.GuarPolicyInfo)),o=i!=null&&i.IsDepositAllowedToPayLater,i!=null&&i.IsAllowFullPrePayment==!0||WSMAIN.payOption=="OptFullPrePayment")$("#buBillingModify").closest("fieldset").removeClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-hide-action").addClass("ws-show-this"),WSMAIN.BuildPaymentOptionHtml(t),WSMAIN.SetPayOption(),showOrHideDvSection($("#field-billing"),!0),$("#divPayment").show(),WSMAIN.ChangePaymentOption(t!=f);else{if($("#dvPayAtHotelMsg").hide(),$("#divPayment").show(),(WsVars.HideCCSection!=1||t!="XX"||e)&&($("#inPaymentOption").val()==undefined||$("#inPaymentOption").val()==""||$("#inPaymentOption").val()!="PayByLink")){showOrHideDvSection($("#field-billing"),!0);$("#divCCPayment").show();showOrHideDvSection($("#dvPayFullPrePayment"),!1);try{WSMAIN.IsChanged()&&WsVars.IsFreedomPayProp==1&&$("#txCardNumber").length>0&&$("#txCardNumber").val().substr(0,6)!=="******"&&window.wsFreedompay!=undefined&&wsFreedompay.Events!=undefined&&wsFreedompay.Events.DocReady()}catch(s){console.log(s)}}else showOrHideDvSection($("#field-billing"),!1);WSMAIN.payOption==""&&$("#inPaymentOption").val()!="PayByLink"&&$("#inPaymentOption").val("");WsVars.IsAdyenV2==1&&f=="XX"&&WSMAIN.payOption==""&&BuildWsPaymentMethods(WsPaymentOptions,WSMAIN.items,o)}},IsVisibleBillingInfo:function(n){var t,i,r;this.items=n;var u={},f=!1,e=!1,o=!1;for(t=0;t<this.items.length;t++)u[this.items[t].Guar]=this.items[t].Guar,this.items[t].IsAllowFullPrePayment&&(e=!0),this.items[t].HasCC&&(o=this.items[t].HasCC);if(showOrHideDvSection($("#dvPayAtHotelMsg"),!1),showOrHideDvSection($("#divPayAtHotelMessage"),!1),i=WSMAIN.CheckPolicy(this.items),r=!1,(WsVars.IsAdyenV2==1||WsVars.IsFreedomPayProp==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsShift4==1||WsVars.IsPaymentGatewayV1==1)&&(r=!0),WsVars.HideCCSection==1){for(t in u)if(t!="XX"){f=!0;break}f?($("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()!=""&&$("#inPaymentOption").val()=="PayByLink"?showOrHideDvSection($("#field-billing"),!1):showOrHideDvSection($("#field-billing"),!0),(WsVars.IsElavonFuseboxProp==1||WsVars.IsIPGProp==1||WsVars.IsAdyenV2==1||WsVars.IsFreedomPayProp==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsShift4==1||WsVars.IsPaymentGatewayV1==1)&&$("#buBillingModify").closest("fieldset").removeClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-hide-action").addClass("ws-show-this")):showOrHideDvSection($("#field-billing"),o)}e?(WSMAIN.payOption=$("#inPaymentOption").val(),WSMAIN.GetDepositItemsByPayOpt($("#inPaymentOption").val()),showOrHideDvSection($("#field-billing"),!0),$("#buBillingModify").closest("fieldset").addClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-show-this"),i=="XX"?($("#dvPayAtHotelMsg").show(),showOrHideDvSection($("#dvPayFullPrePayment"),!0)):i=="GX"&&showOrHideDvSection($("#dvPayFullPrePayment"),!0)):($("#divPayment").show(),$("#dvPayAtHotelMsg").hide(),$("#buBillingModify").closest("fieldset").addClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-show-this"));$("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()!=""&&$("#inPaymentOption").val()=="PayByLink"&&showOrHideDvSection($("#field-billing"),!1);r&&$("#buBillingSave").hide();WSMAIN.newGuarPl=""},ShowSummary:function(){var u=0,f=0,c=0,e=0,d=0,y=0,o=0,s=0,t,l,n,b,i,h,a=0,r="",v=!1,k=!0,p=0,w="";this.dvs.each(function(){var nt,g,tt,it;if(t=$(this).data("MyRmRc"),l=$(this).data("MyCal"),b=$(this).data("MySvc"),n=t.GetData(),w=t.GetGuar(),h=$(this).data("MyOcc"),n.ResStatus==="C")return!0;if(l.IsOpen()||IsAddonPriorModStart){for(u+=Number(t.GetAmt()),f+=Number(t.GetTax()),c+=Number(t.GetDisc()),y+=Number(t.GetResortFee()),(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"&&WsLoyaltyPointsInfo!=undefined&&WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0&&(p=WsLoyaltyPointsInfo[0].LoyaltyPoints),i=b.GetSvcs(),g=0;g<i.length;g++)nt=CalculateAddOnAmount(i[g],l.GetArrival(),h.GetAdults(),l.GetNights(),h.GetChildren(),!0,WSMAIN.items,h.GetChildAges(),h.GetChild1(),h.GetChild2(),h.GetChild3(),h.GetChild4()),i[g].Amt=Number(nt.amt),i[g].Taxes=Number(nt.tax),i[g].TaxVAT=Number(nt.taxVat),o+=i[g].Amt,s+=i[g].Taxes,i[g].IsAllowAddOnForPayByPoints&&p>0&&(v=!0),(i[g].Options.search("IncludeInDeposit")!="-1"||$("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()=="OptFullPrePayment"||w=="PP")&&(a+=i[g].Qty*(i[g].Amt+i[g].Taxes));e+=$("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()=="OptFullPrePayment"?Number(t.GetAmt())+Number(t.GetTax()):Number(t.GetDeposit())}else for(u+=Number(n.Amt),f+=Number(n.Taxes),c+=Number(n.Disc),e+=Number(n.Deposit),y+=Number(n.ResortFee),g=0;g<n.Svcs.length;g++)o+=n.Svcs[g].Qty*n.Svcs[g].Amt,s+=n.Svcs[g].Qty*n.Svcs[g].Taxes,n.Svcs[g].IsAllowAddOnForPayByPoints&&(v=!0),(n.Svcs[g].Options.search("IncludeInDeposit")!="-1"||$("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()=="OptFullPrePayment"||w=="PP")&&(a+=n.Svcs[g].Qty*(n.Svcs[g].Amt+n.Svcs[g].Taxes));d+=n.PaidDepositBalance;r.length===0&&(r=WsVars.Config2Flag=="True"?t.GetCurrency()+"~":t.GetCurrency());t.GetRateOL()==!1&&(k=!1);(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"&&(tt=null,it=0,l.IsOpen()?(tt=t.GetRc(),tt!=null&&tt.IsAllowPayByPoints==="1"&&p>0&&(v=!0)):n!=null&&n.IsEnablePayByPoints!=undefined&&(v=n.IsEnablePayByPoints))});$("#txTaxes").html(Utils.GetAmount(f+s,r,WsVars.UseCurrCode));$("#txTotal").html(Utils.GetAmount(u+f+o+s,r,WsVars.UseCurrCode));$("#txTaxes").attr("ref",f+s);$("#txTotal").attr("ref",u+f+o+s);$("#txRoomAmt").html(Utils.GetAmount(u,r,WsVars.UseCurrCode));$("#txRoomAmt").attr("ref",u);k&&(u==0&&($("#txRoomAmt").html(WsMulti.COMP),$("#txRoomAmt").attr("ref","")),f+s==0&&($("#txTaxes").html(WsMulti.COMP),$("#txTaxes").attr("ref","")),u+f+o+s==0&&($("#txTotal").html(WsMulti.COMP),$("#txTotal").attr("ref","")));Math.abs(c)>.01?($("#txDiscAmt").html(Utils.GetAmount(-c,r,WsVars.UseCurrCode)),$("#txDiscAmt").attr("ref",-c),$("#dvDiscAmt").show()):$("#dvDiscAmt").hide();e>0?($("#dvDeposit").show(),a>0?($("#txDeposit").html(Utils.GetAmount(e+a,r,WsVars.UseCurrCode)),$("#txDeposit").attr("ref",e+a)):($("#txDeposit").html(Utils.GetAmount(e,r,WsVars.UseCurrCode)),$("#txDeposit").attr("ref",e))):$("#dvDeposit").hide();o>0?($("#dvAddon").show(),$("#txAddonAmt").html(Utils.GetAmount(o,r,WsVars.UseCurrCode)),$("#txAddonAmt").attr("ref",o)):$("#dvAddon").hide();y>0?$("#dvResortFeeText").show():$("#dvResortFeeText").hide();v?$("#trSumReedemPointPrice").length>0&&$("#trRemaningAmount").length>0&&($("#trSumReedemPointPrice").removeClass("hide"),$("#trRemaningAmount").removeClass("hide")):$("#trSumReedemPointPrice").length>0&&$("#trRemaningAmount").length>0&&($("#trSumReedemPointPrice").addClass("hide"),$("#trRemaningAmount").addClass("hide"))},UpdateTerms:function(n){var i=n.data("MyRmRc"),y=n.data("MyCal"),p=n.data("MyOcc"),e=n.data("MySvc"),u=i.GetRc(),r=e.GetSvcs(),s,h,c,l,t;if(u===null||!y.IsDiff()&&!p.IsDiff()&&!i.IsDiff()&&!e.IsDiff()){$("#ws-full-terms-conditions").hide();return}$("#ws-full-terms-conditions").show();var o="",f="",a="",v='<div class="ws-txTerms"><h4>{0}<\/h4><p class="ws-meta">{1}<\/p><\/div><div class="ws-txTerms"><h4>{2}<\/h4><p class="ws-meta">{3}<\/p><\/div> {4} <div class="ws-txTerms txGenPolicy"><h4>{5}<\/h4><p class="ws-meta">{6} - {7}, {8} - {9}. {10}<\/p><\/div>';if(i.GetPetPolicy().length>0&&(v+=Utils.Format('<div class="ws-txTerms"><h4 class="lbPetPolicy">{0}<\/h4><p class="ws-meta txPetPolicy">{1}<\/p><\/div>',WsMulti.PetPolicy,i.GetPetPolicy())),u.Link.length>10&&(o=u.Link.substr(0,4).toLowerCase()==="http"?Utils.Format('<p class="ws-meta"><a href="{0}" target="_blank">{1}<\/a><\/p>',u.Link,WsMulti.TermsLink):Utils.Format('<p class="ws-meta"><a href="http://{0}" target="_blank">{1}<\/a><\/p>',u.Link,WsMulti.TermsLink)),u.Phone.length>0&&(f=Utils.Format(WsMulti.RatePhoneNumber,u.Phone),f=Utils.Format('<p class="ws-meta">{0}<\/p>',f)),(f.length>0||o.length>0)&&(a=Utils.Format('<div class="ws-txTerms">{0}{1}<\/div>',f,o)),s=Utils.Format(v,WsMulti.GuarPolicy,i.GetGutPolicy(),WsMulti.CancelPolicy,i.GetCanPolicy(),a,WsMulti.GenPolicy,WsMulti.CheckIn,i.GetCheckIn(),WsMulti.CheckOut,i.GetCheckOut(),i.GetGenPolicy()),l=[],r.length>0&&e.IsDiff()===!0)for(t=0;t<r.length;t++)Utils.ArrayFind(l,r[t].SvcID)===-1&&(l.push(r[t].SvcID),h=r[t].Policy.length>0?Utils.Format('<h4 class="ws-meta ws-inline">{0}: <\/h4><p class="ws-meta ws-inline">{1}<\/p>',WsMulti.GenPolicy,r[t].Policy):"",c=r[t].CanPolicy.length>0?Utils.Format('<h4 class="ws-meta ws-inline">{0}: <\/h4><p class="ws-meta ws-inline">{1}<\/p>',WsMulti.CancelPolicy,r[t].CanPolicy):"",(h.length>0||c.length>0)&&(s+=Utils.Format('<div class="ws-txTerms"><h4>{0}<\/h4>{1} {2}<\/div>',r[t].Name,h,c)));$("#txTerms").html(s)},CheckOccupancy:function(){var n,t=!1,i=!1;this.dvs.each(function(){n=$(this).data("MyOcc");n.GetOccupancy()>2&&(t=!0)});$("#txTotal").html()===WsMulti.COMP&&(i=!0);t&&!i?$("#dvAddPersonText").show():$("#dvAddPersonText").hide()},VerifyDiff:function(n){var u=!1,t=n.data("MyRmRc"),i=n.data("MyCal"),e=n.data("MyOcc"),o=n.data("MySvc"),r=null,s,f;if((i.IsOpen()||IsAddonPriorModStart)&&(i.IsDiff()||e.IsDiff()||t.IsDiff()||o.IsDiff()))if(u=!0,r=t.GetSelectedRoomStay(),s=t.GetRateOL(),r!==null){if($("#buModifyResv").removeClass("ws-disabled"),(WsVars.IsElavonFuseboxProp==1||WsVars.IsFreedomPayProp==1||WsVars.IsShift4Prop==!0)&&($("#buBillingCancel").hide(),$("#buBillingSave").hide()),WsVars.IsElavonFuseboxProp==1||WsVars.IsIPGProp==1||WsVars.IsAdyenV2==1||WsVars.IsFreedomPayProp==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsShift4==1||WsVars.IsPaymentGatewayV1==1){var h=t.GetData(),c=h.Deposit,l=t.GetDeposit();$("#buBillingCancel").hide();$("#buBillingSave").hide();f=t.GetGuar();f!="XX"&&l>c&&$("#buBillingModify").closest("fieldset").removeClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-hide-action").addClass("ws-show-this")}t.GetIsOLResVal()&&i.GetNights()>0?($("#buModifyResv").addClass("ws-disabled"),r=WsMulti.COMP7dayValidation):t.GetOLMaxCompNights()>0&&compCounts>t.GetOLMaxCompNights()?($("#buModifyResv").addClass("ws-disabled"),r=WsMulti.MaxCompNightsPerRoom):t.GetOLOfferMinLOS()>0&&i.GetNights()>0&&i.GetNights()<t.GetOLOfferMinLOS()?($("#buModifyResv").addClass("ws-disabled"),r=WsMulti.CompOfferMinLOS):t.GetOLIncentiveMinLOS()>0&&i.GetNights()>0&&i.GetNights()<t.GetOLIncentiveMinLOS()&&(r=WsMulti.CompIncentiveMinLOS)}else $("#buModifyResv").addClass("ws-disabled");else(WsVars.IsElavonFuseboxProp==1||WsVars.IsIPGProp==1||WsVars.IsAdyenV2==1||WsVars.IsFreedomPayProp==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsShift4==1||WsVars.IsPaymentGatewayV1==1)&&$("#buBillingModify").closest("fieldset").addClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-show-this"),IsAddonPriorModStart||$("#buModifyResv").addClass("ws-disabled");$("#buModifyResv").removeClass("ws-error-form");this.isChanged=u;this.selectedRs=r},VerifyClose:function(){var n=!0,t;this.dvs.each(function(){return t=$(this).data("MyCal"),t.IsOpen()?(n=!1,!1):void 0});n&&($("#ws-main").removeClass("ws-modify-main"),$(".ws-messages").removeClass("ws-show-this"))},GetUpdates:function(){var o=[],n,u,t,i,e,r,f;return this.dvs.each(function(){var s,h,c,l;if(n=$(this).data("MyRmRc"),u=$(this).data("MyCal"),t=$(this).data("MyOcc"),e=$(this).data("MySvc"),i=n.GetData(),r=n.GetRc(),f=n.GetRoomStay(),(u.IsOpen()||IsAddonPriorModStart)&&(u.IsDiff()||t.IsDiff()||n.IsDiff()||e.IsDiff())){for(s=jQuery.extend(!0,{},i),h=0;h<s.Svcs.length;h++)s.Svcs[h].Policy="",s.Svcs[h].CanPolicy="",s.Svcs[h].Name="",s.Svcs[h].Desc="";for(c={CrsID:n.GetCrsID(),HotelID:n.GetHotelID(),RmID:n.GetRmID(),RcID:n.GetRcID(),PkgID:n.GetPkgID(),GrpID:n.GetGrpID(),Dt1:u.GetArrival(),Nights:u.GetNights(),Amt:n.GetAmt(),AmtOrig:i.Amt,NightsOrig:i.Nights,ItemOrig:s,Promo:i.Promo,Corp:i.Corp,Access:i.Access,Iata:i.Iata,Taxes:n.GetTax(),RateCode:n.GetRateCode(),RateType:n.GetRateName(),RoomCode:n.GetRoomCode(),RoomType:n.GetRoomName(),Adults:t.GetAdults(),Child1:t.GetChild1(),Child2:t.GetChild2(),Child3:t.GetChild3(),Child4:t.GetChild4(),ChildrenAges:t.GetChildAges(),Svcs:e.GetSvcs(),GetIsOLResVal:n.GetIsOLResVal(),OfferId:f.LoyaltyOfferId!=null&&typeof f.LoyaltyOfferId!="undefined"&&f.LoyaltyOfferId!=""?f.LoyaltyOfferId:r.LoyaltyOfferId,LoyaltyPointsInfo:{LoyaltyRedeemAmount:0,LoyaltyRedeemPoints:0},IsTurnDownSvc:r.IsTurnDownSvc,VIPID:r.VIPID,Attention:r.Attention,HotelNote:r.HotelNote,HotelNoteDisplayType:r.HotelNoteDisplayType},l=0;l<c.Svcs.length;l++)c.Svcs[l].Policy="",c.Svcs[l].CanPolicy="",c.Svcs[l].Name="",c.Svcs[l].Desc="";o.push(c)}}),o},GetCurrDiv:function(){var n=null;return this.dvs.each(function(){if($(this).attr("ix")===WSMAIN.IxCurr)return n=$(this),!1}),n},GetExistingSvcIdx:function(n,t){if(n.length>0)for(var i=0;i<n.length;i++)if(n[i].SvcID==t)return i;return-1},IsChanged:function(){return this.isChanged},SelectedRs:function(){return this.selectedRs},IsInput:function(n){return WsVars.EnableMultiByte==="1"?!0:/^[\w\-\s\d\.\'\,#&]+$/.test(n)},Alert:function(n,t){t==null?alert(n):(t.trigger("Alert",[n]),location.href="#"+t.attr("id"))},GetAmountDiff:function(n,t){var u=0,e=0,f=0,h="",o="",c=0,r=n.GetData(),s=t.GetSvcs(),b,p,w,l,a,y,v,i;e=r.Deposit;f=n.GetDeposit();h=r.Guar;o=n.GetGuar();b=n.GetGutPolicy();let k=$("input:radio[name='rdPayMethodType']:checked").val();if(ShowOrHidePaymentIcons(k),$("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()=="OptFullPrePayment"&&(p=e,WSMAIN.payOption=="OptFullPrePayment"&&(p=r.Amt+r.Taxes),w=n.GetAmt()+n.GetTax(),f=w,e=p),(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"&&WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0)for(y=n.GetCrsID(),i=0;i<WsLoyaltyPointsInfo.length;i++)WsLoyaltyPointsInfo[i].CrsID==y&&WsLoyaltyPointsInfo[i].RedeemAmount>0&&(c=WsLoyaltyPointsInfo[i].RedeemAmount);if(r.Svcs.length>0&&e>0){for(l=0,a=0,i=0;i<r.Svcs.length;i++)(r.Svcs[i].Options.search("IncludeInDeposit")!="-1"||$("#inPaymentOption").val()!==undefined&&$("#inPaymentOption").val()==="OptFullPrePayment"||h==="PP")&&(l+=r.Svcs[i].Qty*r.Svcs[i].Amt,a+=r.Svcs[i].Qty*r.Svcs[i].Taxes);e+=l+a}if(s.length>0&&f>0){for(l=0,a=0,i=0;i<s.length;i++)(s[i].Options.search("IncludeInDeposit")!="-1"||$("#inPaymentOption").val()!==undefined&&$("#inPaymentOption").val()==="OptFullPrePayment"||o==="PP")&&(l+=s[i].Qty*s[i].Amt,a+=s[i].Qty*s[i].Taxes);f+=l+a}if(f!=e&&(e=r.PaidDepositBalance),(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"&&WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0)for(y=n.GetCrsID(),i=0;i<WsLoyaltyPointsInfo.length;i++)WsLoyaltyPointsInfo[i].CrsID==y&&(WsLoyaltyPointsInfo[i].ItemDepositAmount=f);if(c>0&&(f>=c?f-=c:f=0),u=f-e,u=Number(u).toFixed(2),o=n.GetGuar(),v="",v=WsVars.Config2Flag=="True"?n.GetCurrency()+"~":n.GetCurrency(),u>0){if($("#dvDepositPaygate").show(),$("#lbDepositPaygate").html(WsMulti.AmountWillBeDebited),$("#txDepositPaygate").html(Utils.GetAmount(u,v,WsVars.UseCurrCode)),$("#txDepositPaygate").attr("ref",u),$("#dvDepositPaygateDetails").show(),$("#lbDepositPaygateDetails").html(WsMulti.AmountWillBeDebited),$("#txDepositPaygateDetails").html(Utils.GetAmount(u,v,WsVars.UseCurrCode)),$("#txDepositPaygateDetails").attr("ref",u),(WsVars.IsIPGProp==1||WsVars.IsAdyenV2==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsPaymentGatewayV1==1)&&o!="XX"&&f>e&&($("#buBillingModify").closest("fieldset").removeClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-hide-action").addClass("ws-show-this"),f>r.Deposit&&o!="GX"&&typeof WsPaymentOptions!=undefined&&WsPaymentOptions!=null&&typeof WsPaymentOptions.PaymentMethods!=undefined&&WsPaymentOptions.PaymentMethods!=null&&WsPaymentOptions.PaymentMethods.length>0))for(i=0;i<WsPaymentOptions.PaymentMethods.length;i++)WsPaymentOptions.PaymentMethods[i].Configurations!=null&&InitializeWalletPay(WsPaymentOptions.PaymentMethods[i].ID)}else u<0?($("#dvDepositPaygate").show(),$("#dvDepositPaygateDetails").show(),u=u*-1,$("#lbDepositPaygate").html(WsMulti.AmountWillBeCredited),$("#lbDepositPaygateDetails").html(WsMulti.AmountWillBeCredited),r.IsPolicyRefundable||WSMAIN.payOption=="OptFullPrePayment"&&(h=="XX"||h=="GX")?($("#txDepositPaygate").html(Utils.GetAmount(u,v,WsVars.UseCurrCode)),$("#txDepositPaygate").attr("ref",u),$("#txDepositPaygateDetails").html(Utils.GetAmount(u,v,WsVars.UseCurrCode)),$("#txDepositPaygateDetails").attr("ref",u),(WsVars.IsElavonFuseboxProp==1||WsVars.IsIPGProp==1||WsVars.IsAdyenV2==1||WsVars.IsFreedomPayProp==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsShift4==1||WsVars.IsPaymentGatewayV1==1)&&o!="XX"&&f>e&&$("#buBillingModify").closest("fieldset").removeClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-hide-action").addClass("ws-show-this")):($("#dvDepositPaygate").hide(),$("#dvDepositPaygateDetails").hide(),WsVars.IsIPGProp==1&&$("#buBillingModify").closest("fieldset").removeClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-hide-action").addClass("ws-show-this"))):($("#dvDepositPaygate").hide(),$("#dvDepositPaygateDetails").hide());h!="XX"||o!="GX"||WSMAIN.payOption=="OptFullPrePayment"||$("#inPaymentOption").val()=="OptFullPrePayment"||($("#dvDepositPaygate").hide(),$("#dvDepositPaygateDetails").hide());c>0&&h=="DX"&&r.IsDepositAllowedToPayLater==!0&&parseFloat(e)+parseFloat(c)>parseFloat(r.Deposit)&&($("#dvDepositPaygate").hide(),$("#dvDepositPaygateDetails").hide())},ShowDates:function(n,t,i){var r="",u="";r=n<=0?(new moment).add(1,"d"):new moment(Utils.GetDateFromY2K(n));u=n<=0?r.add(1,"d"):new moment(Utils.GetDateFromY2K(n+i));$("#spCheckIn_"+WSMAIN.IxCurr).val(r.format(Utils.GetDateFormat(WsVars.LangCode)));$("#spCheckOut_"+WSMAIN.IxCurr).val(u.format(Utils.GetDateFormat(WsVars.LangCode)))},GetLoyaltyPoints:function(n,t){if(this.IsLoggedIn()&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"){if($(".ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar").each(function(){$(this).addClass("hide")}),typeof n=="undefined"&&n=="")return;$("body").css({cursor:"wait"});var i={hotelID:WsVars.HotelID,langID:WsVars.LangID,currID:WsVars.CurrencyId,inHgID:WsVars.HgID,chainID:WsVars.ChainID,CrsID:n};$.ajax({type:"POST",url:"xml/GetLoyaltyPoints.aspx",data:i,dataType:"json","async":!1,success:function(i){var f={LoyaltyPoints:0,LoyaltyAmount:0,ItemUsedLoyaltyAmount:0,ItemUsedLoyaltyPoints:0,TotalUsedLoyaltyAmount:0,TotalUsedLoyaltyPoints:0,IsAllowReductionLoyaltyPoint:0,RedeemAmount:0,RedeemPoints:0,TotalRedeemAmount:0,TotalRedeemPoints:0,TotalAmount:0,TotalRemainingAmount:0,RemainingPoints:0,EquivalentItemAmount:0,EqRemainAmount:0,MaxLoyaltyRedeemPoints:0,ItemPayableAmount:0,ItemPayablePoints:0,ItemTotalAmount:0,ItemDepositAmount:0,ItemRemainingAmount:0,ItemPayableDepositAmount:0,CrsID:"",RemainingCashback:0,MaxLoyaltyRedeemAmount:0,IsTotalUsedCredits:0,ConversionPtAmt:0},h,o,l,b,s;if($("body").css({cursor:"auto"}),h=!1,i!=undefined&&i!=null){if(f.CrsID=n,f.TotalUsedLoyaltyAmount=i.TotalUsedLoyaltyAmount,f.TotalUsedLoyaltyPoints=i.TotalUsedLoyaltyPoints,f.RemainingPoints=i.RemainingPoints,f.IsAllowReductionLoyaltyPoint=i.EnablePointReductionForRedeemedPoints,i.Amount>0&&i.Points>0?(h=!0,$("#divslidecontainer").removeClass("hide"),$("#divslidecontainer").show(),$("#pPointsAvailable").html(i.LoyaltyPointsAvailable),$("#pMsgRedeemPointText").html(i.MessageLoyaltyPointsSlider),WsVars.EnableFractionalCredits=="1"?($("#txtRemainingPoints").html(Utils.GetAmount(i.RemainingCashback,WsVars.Currency,WsVars.UseCurrCode)),$("#txtRemainingPoints").addClass("ws-prices"),$("#txtRemainingPoints").attr("ref",i.RemainingCashback),$("#txtRemainingPoints").attr("curr",WsVars.Currency)):$("#txtRemainingPoints").html(i.RemainingPoints),f.LoyaltyPoints=i.Points,f.LoyaltyAmount=i.Amount,f.ConversionPtAmt=i.ConversionPtAmt,WsVars.EnableFractionalCredits=="1"&&(f.RemainingCashback=i.RemainingCashback),f.IsAllowReductionLoyaltyPoint=="1"&&i.IsTotalUsedCredits=="1"&&(f.IsTotalUsedCredits=i.IsTotalUsedCredits)):($("#divslidecontainer").addClass("hide"),$(".ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar").addClass("hide"),$("#divslidecontainer").hide()),i.WsItems!=null&&i.WsItems!=""){var r=jQuery.parseJSON(i.WsItems),a=$('.ws-cart-stay .ws-loyaltyPoints-sliderSection[ix="'+t+'"]'),u=a.find(".ws-loyaltyPoints-sliderBar").attr("ix");if(r!=null&&r.length>0){var e=0,c=0,v=0,k=0,p=0,y=0,w=0;if(r[0].LoyaltyPointsInfo!=null&&(r[0].LoyaltyPointsInfo.LoyaltyRedeemAmount>0&&(e=r[0].LoyaltyPointsInfo.LoyaltyRedeemAmount),r[0].LoyaltyPointsInfo.LoyaltyRedeemPoints>0&&(c=r[0].LoyaltyPointsInfo.LoyaltyRedeemPoints),r[0].LoyaltyPointsInfo.RemainingAmount>0&&(v=r[0].LoyaltyPointsInfo.RemainingAmount/100),r[0].LoyaltyPointsInfo.EquivalentRemainingAmount>0&&(p=r[0].LoyaltyPointsInfo.EquivalentRemainingAmount/100),r[0].LoyaltyPointsInfo.MaxLoyaltyRedeemPoints>0&&(k=r[0].LoyaltyPointsInfo.MaxLoyaltyRedeemPoints),r[0].LoyaltyPointsInfo.MaxLoyaltyRedeemAmount>0&&(w=r[0].LoyaltyPointsInfo.MaxLoyaltyRedeemAmount),r[0].LoyaltyPointsInfo.DepositAmount>0&&(y=r[0].LoyaltyPointsInfo.DepositAmount)),r[0].Svcs!=null&&r[0].Svcs.length>0)for(o=0;o<r[0].Svcs.length;o++)r[0].Svcs[o].LoyaltyPointsInfo!=null&&(r[0].Svcs[o].LoyaltyPointsInfo.LoyaltyRedeemAmount>0&&(e+=r[0].Svcs[o].LoyaltyPointsInfo.LoyaltyRedeemAmount),r[0].Svcs[o].LoyaltyPointsInfo.LoyaltyRedeemPoints>0&&(c+=r[0].Svcs[o].LoyaltyPointsInfo.LoyaltyRedeemPoints));l=0;e>0&&(l=e/100);f.ItemUsedLoyaltyAmount=l;f.ItemUsedLoyaltyPoints=c;f.ItemRemainingAmount=v;f.ItemPayableDepositAmount=y;a.find(".ws-RedeemDetails").removeClass("hide");$("#txtLpTotalDetailRedeemAmt_"+u).attr("curr",WsVars.Currency);$("#txtLpTotalDetailRedeemAmt_"+u).html(Utils.GetAmount(l,WsVars.Currency,WsVars.UseCurrCode));$("#txtLpTotalDetailRedeemAmt_"+u).attr("ref",Utils.ToNumberFormat(l,WsVars.Currency));$("#txtLpTotalDetailRemainingAmt_"+u).attr("curr",WsVars.Currency);$("#txtLpTotalDetailRemainingAmt_"+u).html(Utils.GetAmount(v,WsVars.Currency,WsVars.UseCurrCode));$("#txtLpTotalDetailRemainingAmt_"+u).attr("ref",Utils.ToNumberFormat(v,WsVars.Currency));WsVars.EnableFractionalCredits=="1"?($("#myRange_"+u).attr({max:Utils.ToNumberFormat(w*100,WsVars.Currency)}),$("#myRange_"+u).val(Utils.ToNumberFormat(e*100,WsVars.Currency)),$("#myRange_"+u).attr({curr:WsVars.Currency}),$("#myRange_"+s).attr({baseMaxAmt:Utils.ToNumberFormat(w*100,WsVars.Currency)}),$("#myRange_"+s).attr({baseAmt:Utils.ToNumberFormat(e*100,WsVars.Currency)}),$("#txtRangePoints_"+u).val(Utils.ToNumberFormat(e/100,WsVars.Currency)),$("#txtRangePoints_"+u).attr({refAmt:Utils.ToNumberFormat(e/100,WsVars.Currency)}),$("#txtRangePoints_"+u).attr({curr:WsVars.Currency})):($("#myRange_"+u).attr({max:Utils.ToNumberFormat(k,WsVars.Currency)}),$("#myRange_"+u).val(Utils.ToNumberFormat(c,WsVars.Currency)),$("#txtRangePoints_"+u).val(parseInt(c)));$("#lbEquivalentAmountValue_"+u).attr("curr",WsVars.Currency);$("#lbEquivalentAmountValue_"+u).html(Utils.GetAmount(p,WsVars.Currency,WsVars.UseCurrCode));$("#lbEquivalentAmountValue_"+u).attr("ref",Utils.ToNumberFormat(p,WsVars.Currency));$("#tdDeposit_"+u).length>0&&($("#trDepositRemain_"+u).length>0&&$("#trDepositRemain_"+u).addClass("hide"),$("#tdDeposit_"+u).attr("curr",WsVars.Currency),$("#tdDeposit_"+u).html(Utils.GetAmount(y,WsVars.Currency,WsVars.UseCurrCode)),$("#tdDeposit_"+u).attr("ref",Utils.ToNumberFormat(y,WsVars.Currency)));WSMAIN.IsVisibleLoyaltyRedeemPointsSection(r,n);h?a.find(".ws-loyaltyPoints-sliderBar").removeClass("hide"):a.find(".ws-loyaltyPoints-sliderBar").addClass("hide")}}if(b=!1,h&&WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0)for(s=0;s<WsLoyaltyPointsInfo.length;s++)WsLoyaltyPointsInfo[s].CrsID==n&&(WsLoyaltyPointsInfo[s]=f,b=!0);h&&!b&&WsLoyaltyPointsInfo.push(f)}},error:function(){$("body").css({cursor:"auto"});$("#divslidecontainer").addClass("hide");$("#divslidecontainer").hide()}})}},IsLoggedIn:function(){return WsVars.GuestLoyalty!=""&&WsVars.GuestLoyalty!="undefined"&&$("#MyHeading_buMember").length>0},IsEmpty:function(n){return typeof n=="undefined"||n.length<=0||n==""||isNaN(n)||n<0?!0:!1},IsVisibleLoyaltyRedeemPointsSection:function(n,t){if($("#trSumReedemPointPrice").length>0&&$("#trRemaningAmount").length>0&&($("#trSumReedemPointPrice").addClass("hide"),$("#trRemaningAmount").addClass("hide")),n!==undefined&&n!=null&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"){var i=!1;$(".ws-loyaltyPoints-sliderSection").each(function(){for(var c,s,l,a,u,v,f,d=$(this).attr("ref"),r=0;r<n.length;r++){var h=0,y=0,p=0,w=0,b=0,k=0;if((t==""||n[r].CrsID==t)&&d==n[r].CrsID){if(y=n[r].Amt,p=n[r].Taxes,w=n[r].ResortFee,n[r].LoyaltyPointsInfo!==undefined&&n[r].LoyaltyPointsInfo!=null&&n[r].LoyaltyPointsInfo.EntityID>0&&(i=!0,h=n[r].LoyaltyPointsInfo.LoyaltyRedeemAmount),n[r].Svcs!=null)for(u=0;u<n[r].Svcs.length;u++)n[r].Svcs[u].LoyaltyPointsInfo!==undefined&&n[r].Svcs[u].LoyaltyPointsInfo!=null&&n[r].Svcs[u].LoyaltyPointsInfo.EntityID>0&&(i=!0,h+=n[r].Svcs[u].LoyaltyPointsInfo.LoyaltyRedeemAmount),b+=n[r].Svcs[u].Amt,k+=n[r].Svcs[u].Taxes;if(c=[],n[r].LoyaltyPointsInfo!==undefined&&n[r].LoyaltyPointsInfo!=null&&(c.push({value:n[r].LoyaltyPointsInfo.LoyaltyRedeemPoints,itemName:WsVars.PCode+":"+n[r].RoomType+":"+n[r].RateType}),SHR.TrkLib.SpendVirtualCurrency(c)),i){if($(this).removeClass("hide"),$(this).find(".ws-loyaltyPoints-sliderBar").addClass("hide"),$(this).find(".ws-RedeemDetails").removeClass("hide"),$("#trSumReedemPointPrice").removeClass("hide"),$("#trRemaningAmount").removeClass("hide"),$("#tdDeposit_"+r).length>0){$("#trDepositRemain_"+r).length>0&&$("#trDepositRemain_"+r).addClass("hide");var e=0,f=0,o=0;if(h>0&&n[r].ResStatus!="C"&&(o=h/100),s=n[r].Deposit,s>0){if(WsVars.AddSvcToDeposit==="1"&&n[r].Svcs!=null&&n[r].Svcs.length>0){for(l=0,a=0,u=0;u<n[r].Svcs.length;u++)l+=n[r].Svcs[u].Qty*n[r].Svcs[u].Amt,a+=n[r].Svcs[u].Qty*n[r].Svcs[u].Taxes;s+=l+a}s>o&&(e=s-o);$("#tdDeposit_"+r).attr("curr",WsVars.Currency);$("#tdDeposit_"+r).html(Utils.GetAmount(e,WsVars.Currency,WsVars.UseCurrCode));$("#tdDeposit_"+r).attr("ref",Utils.ToNumberFormat(e,WsVars.Currency));v=y+p+w+b+k;f=0;v>=o&&(f=v-o);f>=e&&(f-=e)}$("#txtLpTotalDetailRemainingAmt_"+r).attr("curr",WsVars.Currency);$("#txtLpTotalDetailRemainingAmt_"+r).html(Utils.GetAmount(f,WsVars.Currency,WsVars.UseCurrCode));$("#txtLpTotalDetailRemainingAmt_"+r).attr("ref",Utils.ToNumberFormat(f,WsVars.Currency))}ShowBaseOrSelectedCurrencyPrices(i)}else $(this).addClass("hide"),$(this).find(".ws-loyaltyPoints-sliderBar").addClass("hide"),$(this).find(".ws-RedeemDetails").addClass("hide");break}}})}},CalculateLoyaltyRedeemPoints:function(n,t,i,r){var h=0,c=0,o=0,f=0,s=0,l=0,nt=0,g=0,b=0,e=0,k=0,y,u,a,v;if(WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0){for(y=0;y<WsLoyaltyPointsInfo.length;y++)if(WsLoyaltyPointsInfo[y].CrsID==t){u=WsLoyaltyPointsInfo[y];h=u.LoyaltyPoints;c=u.LoyaltyAmount;o=u.ItemUsedLoyaltyAmount;f=u.ItemUsedLoyaltyPoints;l=u.ItemPayableAmount;nt=u.ItemTotalAmount;k=u.ConversionPtAmt;this.IsEmpty(i)&&(i=0);this.IsEmpty(f)&&(f=0);var p=0,d=0,w=0;u.IsTotalUsedCredits=="1"?(p=parseFloat(h),d=parseFloat(f),w=parseFloat(c)):(p=parseFloat(f)+parseFloat(h),d=WSMAIN.GetConvertedRedeemPoints(h,c,l,k),w=parseFloat(o)+parseFloat(c));WsVars.LimitPointsToDeposit=="1"&&$("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()=="OptFullPrePayment"&&(d=WSMAIN.GetConvertedRedeemPoints(h,c,nt,k),l=nt);WsVars.EnableFractionalCredits=="1"?(l=parseFloat(l),WSMAIN.SetMaxLoyaltyRedeemAmount(n,t,l,w)):WSMAIN.SetMaxLoyaltyRedeemPoints(n,t,d,p);a=u.MaxLoyaltyRedeemPoints;v=u.MaxLoyaltyRedeemAmount;u.IsAllowReductionLoyaltyPoint==1?(WsVars.EnableFractionalCredits=="1"&&(parseFloat(i)<=0&&parseFloat(i)<=parseFloat(o)&&(e=u.ItemPayableAmount<parseFloat(o)?u.ItemPayableAmount:u.ItemUsedLoyaltyAmount),r&&parseFloat(i)>=0&&i<=l&&(e=i),r&&parseFloat(i)>0&&parseFloat(i)<=parseFloat(o)&&(e=i),r&&i>0&&i>o&&(e=i),WSMAIN.IsChanged()&&parseFloat(i)<=0&&o>v&&(e=v)),parseFloat(i)<=0&&parseFloat(i)<=parseFloat(f)&&(s=u.ItemUsedLoyaltyPoints),r&&parseFloat(i)>=0&&(i<=d||parseFloat(i)<=parseFloat(f))&&(s=i),r&&i>0&&i>f&&(s=i),WSMAIN.IsChanged()&&parseFloat(i)<=0&&f>a&&(s=a)):(WsVars.EnableFractionalCredits=="1"&&(parseFloat(i)>=parseFloat(o)&&parseFloat(i)<=parseFloat(v)?e=i:parseFloat(i)<parseFloat(o)&&(e=u.ItemUsedLoyaltyAmount)),parseFloat(i)>=parseFloat(f)&&parseFloat(i)<=parseFloat(a)?s=i:parseFloat(i)<parseFloat(f)&&(s=u.ItemUsedLoyaltyPoints));WsVars.EnableFractionalCredits=="1"&&(parseFloat(i)>parseFloat(v)&&(e=v),parseFloat(i)>=parseFloat(w)&&parseFloat(w)<=parseFloat(v)&&(e=w));parseFloat(i)>parseFloat(a)&&(s=a);parseFloat(i)>=parseFloat(p)&&parseFloat(p)<=parseFloat(a)&&(s=p);WsVars.EnableFractionalCredits=="1"?(u.RedeemAmount=e,u.RedeemPoints=WSMAIN.GetConvertedRedeemPoints(h,c,u.RedeemAmount,k)):(u.RedeemPoints=parseInt(s),u.RedeemAmount=WSMAIN.GetConvertedRedeemAmt(h,c,u.RedeemPoints,k));u.ItemTotalAmount>=u.RedeemAmount&&(b=Utils.ToNumberFormat(parseFloat(u.ItemTotalAmount)-parseFloat(u.RedeemAmount),WsVars.Currency),u.ItemDepositAmount>0&&($("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()=="OptFullPrePayment"&&(u.ItemDepositAmount=Utils.ToNumberFormat(u.ItemTotalAmount,WsVars.Currency)),g=u.ItemDepositAmount>u.RedeemAmount?Utils.ToNumberFormat(parseFloat(u.ItemDepositAmount)-parseFloat(u.RedeemAmount),WsVars.Currency):0,u.ItemPayableDepositAmount=g,parseFloat(b)>=parseFloat(g)&&(b=Utils.ToNumberFormat(parseFloat(b)-parseFloat(g),WsVars.Currency))));u.ItemRemainingAmount=b;u.EquivalentItemAmount>=u.RedeemAmount&&(u.EqRemainAmount=Utils.ToNumberFormat(parseFloat(u.EquivalentItemAmount)-parseFloat(u.RedeemAmount),WsVars.Currency));WsLoyaltyPointsInfo[y]=u;break}WSMAIN.BuildLoyaltyRedeemPointsHtml(n,t);typeof WsShowRates!="undefined"&&WsVars.EnableFractionalCredits=="1"&&typeof WsBaseCurr!="undefined"&&typeof WsDispCurr!="undefined"&&WsBaseCurr!=WsDispCurr&&(i>0||r)&&WsShowRates();(WsVars.IsPaymentGateway==="1"||WsVars.GuestLoyalty!=""||$("#MyHeading_buMember").length>0)&&ShowBaseOrSelectedCurrencyPrices()}try{WsVars.IsFreedomPayProp==1&&$("#txCardNumber").length>0&&$("#txCardNumber").val().substr(0,6)!=="******"&&window.wsFreedompay!=undefined&&window.wsFreedompay.Options!=undefined&&window.wsFreedompay.Enabled()&&window.wsFreedompay.Events!=undefined&&window.wsFreedompay.Events.DocReady()}catch(tt){console.log(tt)}},SetMaxLoyaltyRedeemPoints:function(n,t,i,r){var u,f,e;if(WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0){for(u={},f=0;f<WsLoyaltyPointsInfo.length;f++)if(WsLoyaltyPointsInfo[f].CrsID==t){u=WsLoyaltyPointsInfo[f];break}parseFloat(i)>=parseFloat(r)?(u.MaxLoyaltyRedeemPoints=r,u.ItemPayablePoints=r):u.MaxLoyaltyRedeemPoints=i;e=$('.ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar .LoyaltyPointsRange[ix="'+n+'"]');u.IsAllowReductionLoyaltyPoint==0?e.attr({min:Utils.ToNumberFormat(u.ItemUsedLoyaltyPoints,WsVars.Currency)}):e.attr({min:0});u.MaxLoyaltyRedeemPoints>0&&e.attr({max:Utils.ToNumberFormat(u.MaxLoyaltyRedeemPoints,WsVars.Currency)})}},SetMaxLoyaltyRedeemAmount:function(n,t,i,r){var u,f,e;if(WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0){for(u={},f=0;f<WsLoyaltyPointsInfo.length;f++)if(WsLoyaltyPointsInfo[f].CrsID==t){u=WsLoyaltyPointsInfo[f];break}parseFloat(i)>=parseFloat(r)?(u.MaxLoyaltyRedeemAmount=r,u.ItemPayableAmount=r):u.MaxLoyaltyRedeemAmount=i;e=$('.ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar .LoyaltyPointsRange[ix="'+n+'"]');u.IsAllowReductionLoyaltyAmount==0?e.attr({min:Utils.ToNumberFormat(u.ItemUsedLoyaltyAmount*100,WsVars.Currency)}):e.attr({min:0});u.MaxLoyaltyRedeemAmount>0&&e.attr({max:Utils.ToNumberFormat(u.MaxLoyaltyRedeemAmount*100,WsVars.Currency)})}},BuildLoyaltyRedeemPointsHtml:function(n,t){var i,r,c;if(WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0){for(i=0;i<WsLoyaltyPointsInfo.length;i++)if(WsLoyaltyPointsInfo[i].CrsID==t){var u=WsLoyaltyPointsInfo[i],a=$('.ws-loyaltyPoints-sliderSection[ix="'+n+'"]'),o=a.find(".ws-RedeemDetails");o.find("#txtLpTotalDetailRedeemAmt_"+n).attr("ref",Utils.ToNumberFormat(u.RedeemAmount,WsVars.Currency));o.find("#txtLpTotalDetailRemainingAmt_"+n).attr("ref",Utils.ToNumberFormat(u.ItemRemainingAmount,WsVars.Currency));o.find("#txtLpTotalDetailRedeemAmt_"+n).html(Utils.GetAmount(u.RedeemAmount,WsVars.Currency,WsVars.UseCurrCode));o.find("#txtLpTotalDetailRemainingAmt_"+n).html(Utils.GetAmount(u.ItemRemainingAmount,WsVars.Currency,WsVars.UseCurrCode));r=a.find(".ws-loyaltyPoints-sliderBar");WsVars.EnableFractionalCredits=="1"?(r.find("#myRange_"+n).attr({max:Utils.ToNumberFormat(u.MaxLoyaltyRedeemAmount*100,WsVars.Currency)}),r.find("#myRange_"+n).val(Utils.ToNumberFormat(u.RedeemAmount*100,WsVars.Currency)),r.find("#myRange_"+n).attr({curr:WsVars.Currency}),r.find("#myRange_"+n).attr({baseMaxAmt:Utils.ToNumberFormat(u.MaxLoyaltyRedeemAmount*100,WsVars.Currency)}),r.find("#myRange_"+n).attr({baseAmt:Utils.ToNumberFormat(u.RedeemAmount*100,WsVars.Currency)}),r.find("#txtRangePoints_"+n).val(Utils.ToNumberFormat(u.RedeemAmount,WsVars.Currency)),r.find("#txtRangePoints_"+n).attr({refAmt:Utils.ToNumberFormat(u.RedeemAmount,WsVars.Currency)}),r.find("#txtRangePoints_"+n).attr({curr:WsVars.Currency})):(r.find("#myRange_"+n).attr({max:Utils.ToNumberFormat(u.MaxLoyaltyRedeemPoints,WsVars.Currency)}),r.find("#myRange_"+n).val(Utils.ToNumberFormat(u.RedeemPoints,WsVars.Currency)),r.find("#txtRangePoints_"+n).val(parseInt(u.RedeemPoints)));r.find("#lbEquivalentAmountValue_"+n).html(Utils.GetAmount(u.EqRemainAmount,WsVars.Currency,WsVars.UseCurrCode));r.find("#lbEquivalentAmountValue_"+n).attr("ref",Utils.ToNumberFormat(u.EqRemainAmount,WsVars.Currency));$("#tdDeposit_"+n).length>0&&($("#tdDeposit_"+n).attr("curr",WsVars.Currency),$("#tdDeposit_"+n).html(Utils.GetAmount(u.ItemPayableDepositAmount,WsVars.Currency,WsVars.UseCurrCode)),$("#tdDeposit_"+n).attr("ref",Utils.ToNumberFormat(u.ItemPayableDepositAmount,WsVars.Currency)),$("#trDepositRemain_"+n).length>0&&$("#trDepositRemain_"+n).hide())}else{var a=$('.ws-loyaltyPoints-sliderSection[ix="'+i+'"]'),r=a.find(".ws-loyaltyPoints-sliderBar"),ht=r.find("#txtRangePoints_"+i).attr("ref"),o=a.find(".ws-RedeemDetails");WsLoyaltyPointsInfo[i].CrsID==ht&&(o.find("#txtLpTotalDetailRedeemAmt_"+i).attr("ref",Utils.ToNumberFormat(WsLoyaltyPointsInfo[i].RedeemAmount,WsVars.Currency)),o.find("#txtLpTotalDetailRemainingAmt_"+i).attr("ref",Utils.ToNumberFormat(WsLoyaltyPointsInfo[i].ItemRemainingAmount,WsVars.Currency)),o.find("#txtLpTotalDetailRedeemAmt_"+i).html(Utils.GetAmount(WsLoyaltyPointsInfo[i].RedeemAmount,WsVars.Currency,WsVars.UseCurrCode)),o.find("#txtLpTotalDetailRemainingAmt_"+i).html(Utils.GetAmount(WsLoyaltyPointsInfo[i].ItemRemainingAmount,WsVars.Currency,WsVars.UseCurrCode)),WsVars.EnableFractionalCredits=="1"?(r.find("#myRange_"+i).attr({max:Utils.ToNumberFormat(WsLoyaltyPointsInfo[i].MaxLoyaltyRedeemAmount*100,WsVars.Currency)}),r.find("#myRange_"+i).val(Utils.ToNumberFormat(WsLoyaltyPointsInfo[i].RedeemAmount*100,WsVars.Currency)),r.find("#myRange_"+i).attr({curr:WsVars.Currency}),r.find("#myRange_"+i).attr({baseMaxAmt:Utils.ToNumberFormat(WsLoyaltyPointsInfo[i].MaxLoyaltyRedeemAmount*100,WsVars.Currency)}),r.find("#myRange_"+i).attr({baseAmt:Utils.ToNumberFormat(WsLoyaltyPointsInfo[i].RedeemAmount*100,WsVars.Currency)}),r.find("#txtRangePoints_"+i).val(Utils.ToNumberFormat(parseFloat(WsLoyaltyPointsInfo[i].RedeemAmount),WsVars.Currency)),r.find("#txtRangePoints_"+i).attr({refAmt:Utils.ToNumberFormat(parseFloat(WsLoyaltyPointsInfo[i].RedeemAmount),WsVars.Currency)}),r.find("#txtRangePoints_"+i).attr({curr:WsVars.Currency})):(r.find("#myRange_"+i).attr({max:Utils.ToNumberFormat(WsLoyaltyPointsInfo[i].MaxLoyaltyRedeemPoints,WsVars.Currency)}),r.find("#myRange_"+i).val(Utils.ToNumberFormat(WsLoyaltyPointsInfo[i].RedeemPoints,WsVars.Currency)),r.find("#txtRangePoints_"+i).val(parseInt(WsLoyaltyPointsInfo[i].RedeemPoints))),r.find("#lbEquivalentAmountValue_"+i).html(Utils.GetAmount(WsLoyaltyPointsInfo[i].EqRemainAmount,WsVars.Currency,WsVars.UseCurrCode)),r.find("#lbEquivalentAmountValue_"+i).attr("ref",Utils.ToNumberFormat(WsLoyaltyPointsInfo[i].EqRemainAmount,WsVars.Currency)))}var p=0,f=0,s=0,e=0,w=0;if($(".ws-loyaltyPoints-sliderSection .ws-RedeemDetails").each(function(){var n,t;$(this).hasClass("hide")||(n=0,n+=Utils.ToNumberFormat($(this).find("#txtLpTotalDetailRedeemAmt_"+p).attr("ref"),WsVars.Currency),WSMAIN.IsEmpty(n)&&(n=0),f+=parseFloat(n),t=0,t=parseFloat($("#tdDeposit_"+p).attr("ref")),WSMAIN.IsEmpty(t)&&(t=0),parseFloat(t)>0&&(w+=parseFloat(n)));p++}),WSMAIN.IsEmpty(f)&&(f=0),$("#txSumReedemPointPrice").html(Utils.GetAmount(parseFloat(f),WsVars.Currency,WsVars.UseCurrCode)),$("#txSumReedemPointPrice").attr("ref",Utils.ToNumberFormat(parseFloat(f),WsVars.Currency)),c=Utils.ToNumberFormat($("#txTotal").attr("ref"),WsVars.Currency),WSMAIN.IsEmpty(c)&&(c=0),parseFloat(c)>=parseFloat(f)&&(s=parseFloat(c)-parseFloat(f)),$("#txDeposit").length>0){var v=0,b=0,k=0,y,et,h,d,l;this.dvs.each(function(){var n;if(y=$(this).data("MyRmRc"),et=$(this).data("MyCal"),d=$(this).data("MySvc"),h=y.GetData(),et.IsOpen()){if(v+=Number(y.GetDeposit()),l=d.GetSvcs(),l!=null)for(n=0;n<l.length;n++)b+=l[n].Amt,k+=l[n].Taxes}else if(v+=Number(h.Deposit),h.Svcs!=null)for(n=0;n<h.Svcs.length;n++)b+=h.Svcs[n].Qty*h.Svcs[n].Amt,k+=h.Svcs[n].Qty*h.Svcs[n].Taxes});e=WsVars.AddSvcToDeposit==="1"?v+b+k:v;$("#inPaymentOption").val()!=undefined&&$("#inPaymentOption").val()=="OptFullPrePayment"&&(e=c);e>f?e-=w>0?w:f:e=0;WSMAIN.IsEmpty(e)&&(e=0);$("#txDeposit").html(Utils.GetAmount(e,WsVars.Currency,WsVars.UseCurrCode));$("#txDeposit").attr("ref",Utils.ToNumberFormat(e,WsVars.Currency));parseFloat(s)>=parseFloat(e)&&(s=parseFloat(s)-parseFloat(e))}WSMAIN.IsEmpty(s)&&(s=0);$("#txRemaningAmount").html(Utils.GetAmount(parseFloat(s),WsVars.Currency,WsVars.UseCurrCode));$("#txRemaningAmount").attr("ref",Utils.ToNumberFormat(parseFloat(s),WsVars.Currency));var g=WsLoyaltyPointsInfo[0].LoyaltyPoints,nt=WsLoyaltyPointsInfo[0].LoyaltyAmount,ot=WsLoyaltyPointsInfo[0].ConversionPtAmt,tt=WSMAIN.GetConvertedRedeemPoints(g,nt,f,ot),st=0,it=0;if(it=WsLoyaltyPointsInfo[0].IsTotalUsedCredits=="1"?parseFloat(WsLoyaltyPointsInfo[0].TotalUsedLoyaltyPoints):parseFloat(g)+parseFloat(WsLoyaltyPointsInfo[0].TotalUsedLoyaltyPoints),parseFloat(it)>=parseFloat(tt)&&(st=parseFloat(it)-parseFloat(tt)),WsVars.EnableFractionalCredits=="1"){var f=WSMAIN.GetConvertedRedeemAmt(g,nt,tt,ot),rt=0,ut=0;ut=WsLoyaltyPointsInfo[0].IsTotalUsedCredits=="1"?parseFloat(WsLoyaltyPointsInfo[0].TotalUsedLoyaltyAmount):parseFloat(nt)+parseFloat(WsLoyaltyPointsInfo[0].TotalUsedLoyaltyAmount);parseFloat(ut)>=parseFloat(f)&&(rt=parseFloat(ut)-parseFloat(f));$("#txtRemainingPoints").html(Utils.GetAmount(rt,WsVars.Currency,WsVars.UseCurrCode));$("#txtRemainingPoints").addClass("ws-prices");$("#txtRemainingPoints").attr("ref",parseFloat(rt));$("#txtRemainingPoints").attr("curr",WsVars.Currency)}else $("#txtRemainingPoints").html(Utils.ToNumberFormat(st,WsVars.Currency));if((WsVars.IsElavonFuseboxProp==1||WsVars.IsFreedomPayProp==1||WsVars.IsAdyenV2==1||WsVars.IsIPGProp==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsShift4==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsPaymentGatewayV1==1)&&WsVars.TokenizeChargeRefund==1){var ft=WSMAIN.GetCurrDiv(),n=ft.attr("ix"),d=ft.data("MySvc"),y=ft.data("MyRmRc");WSMAIN.GetAmountDiff(y,d)}}},ChangePaymentOption:function(n){for(var t,f,i=WSMAIN.CheckPolicy(WSMAIN.items),u=!1,r=0;r<WSMAIN.items.length;r++)WSMAIN.items[r].HasCC&&(u=WSMAIN.items[r].HasCC);WSMAIN.newGuarPl!=""&&(i=WSMAIN.newGuarPl);t=$("input:radio[name='rblPayFullPrePayment']:checked").val();t=="PayAtHotel"?(HideAllOtherPayMethods(!1,!0),$("#divCCPayment").show(),showOrHideDvSection($("#dvPayAtHotelMsg"),!0),showOrHideDvSection($("#divPayAtHotelMessage"),!0),i=="GX"?(hideCPayMethod(!1),$("#divPayAtHotelMessage").html(WsMulti.PayAtHotelMessageForPolicyGX)):i=="XX"&&($("#divPayAtHotelMessage").html(WsMulti.PayAtHotelMessageForPolicyXX),WsVars.HideCCSection==1&&hideCPayMethod(!u))):t=="OptFullPrePayment"&&hideCPayMethod(!1);n&&($("#inPaymentOption").val(t),WSMAIN.GetDepositByUpdatedRS(t),WsVars.IsAdyenV2=="1"&&t!="PayAtHotel"&&($("input:radio[name='rdPayMethodType']:checked").length>0&&(f=$("input:radio[name='rdPayMethodType']:checked").val(),$("#inPayByMethodType").val(f)),BuildWsPaymentMethods(WsPaymentOptions,WSMAIN.items)),showOrHideDvSection($("#dvPayAtHotelMsg"),t=="PayAtHotel"&&(i=="GX"||i=="XX")),showOrHideDvSection($("#divPayAtHotelMessage"),t=="PayAtHotel"&&(i=="GX"||i=="XX")))},BuildPaymentOptionHtml:function(n){var t=Utils.Format("<fieldset id='dvPayFullPrePayment'><table id='tblPayFullPrePayment'><thead><tr><th scope='col' class='sr-only'>{0}<\/th><th scope='col' class='sr-only'>{1}<\/th><\/tr><\/thead><tbody><tr>",WsMulti.PricingDetails,WsMulti.Amount);$("#inPaymentOption").val()!=undefined&&WSMAIN.payOption!="OptFullPrePayment"&&(n=="DX"||n=="PP"?t+=Utils.Format("<td id='tdPayAtHotel'><input id='rblPayFullPrePayment_pd' type='radio' onclick='WSMAIN.ChangePaymentOption(true);' class='rblPayFullPrePayment' name='rblPayFullPrePayment' value='PayDeposit' checked='checked' /><label for='rblPayFullPrePayment_pd'>{0}<\/label><\/td>",WsMulti.PayDeposit):(n=="GX"||n=="XX")&&(t+=Utils.Format("<td id='tdPayAtHotel'><input id='rblPayFullPrePayment_pah' type='radio' onclick='WSMAIN.ChangePaymentOption(true);' class='rblPayFullPrePayment' name='rblPayFullPrePayment' value='PayAtHotel' checked='checked' /><label for='rblPayFullPrePayment_pah'>{0}<\/label><\/td>",WsMulti.PayAtHotel)));t+=Utils.Format("<td id='tdFullPrePayment'><input id='rblPayFullPrePayment_pfa' type='radio' class='rblPayFullPrePayment' name='rblPayFullPrePayment' onclick='WSMAIN.ChangePaymentOption(true);' value='OptFullPrePayment' /><label for='rblPayFullPrePayment_pfa'>{0}<\/label><\/td>",WsMulti.PayFullAmount);t+="<\/tr><\/tbody><\/table><\/fieldset><fieldset ID='divPayAtHotelMessage' ReadOnly='true' CssClass='ws-element'/>";$("#dvPayFullPrePayment").html(t);$("#divPayAtHotelMessage").length>=0&&$("#divPayAtHotelMessage").hide()},LoadAdditionalGuestsField:function(){var h=Number(WsVars.AdditionalGuestsAllowed),n,t,u,f,r,i,e,o,s;if(h>0)for(n=0;n<WsVars.CartItems.length;n++){if(t=WsVars.CartItems[n],($("#txTAIataNumber").val()==""||$("#txTAIataNumber").val()==null||$("#txTAIataNumber").val()==undefined)&&$("#dvWsTAIataNumber").hide(),u=0,t.Adults>0&&(u=Number(t.Adults)),t.Child1!=undefined&&(u+=Number(t.Child1)),t.Child2!=undefined&&(u+=Number(t.Child2)),t.Child3!=undefined&&(u+=Number(t.Child3)),t.Child4!=undefined&&(u+=Number(t.Child4)),f=$("#dvAdnlGuestInfo_"+n).attr("totalOccupancy"),r=u-1,t.AdditionalGuests!=null&&t.AdditionalGuests.length>r&&(r=t.AdditionalGuests.length),r==0){$("#dvAdnlGuestInfo_"+n).remove();continue}if(i=0,f!=undefined)if(e=Number(f),e==r)continue;else if(e<r)i=e;else{for(o=f;o>r;o--)$("#dvAdnlGuestInfo_"+n+"_"+(o-1)).hide();$("#dvAdnlGuestInfo_"+n).attr("totalOccupancy",r+1);continue}else s="",s=t.PkgID>0?t.RoomType+"/"+t.Access:t.GrpID>0?t.RoomType+"/"+t.Group:t.RoomType+"/"+t.RateType,Number(r)>0&&WsVars.EnableConciergeService!="1"&&$("#dvAdditionalGuests").append("<div id='dvAdnlGuestInfo_"+n+"' CrsResvId='"+t.CrsID+"' idx='"+n+"' class='ws-form-item'><input type='hidden' id='roomTypeID_"+n+"' name='roomTypeID_"+n+"' value='"+t.RmID+"'/><p id='pRoomRateOccu_"+n+"' ><strong> "+s+"<\/strong><\/p><\/div>");for(i;i<r;i++)$("#dvAdnlGuestInfo_"+n).append("<div id='dvAdnlGuestInfo_"+n+"_"+i+"' class='ws-form-item' ><div id='dvAddGuestFirstName' class='ws-form-item ws-medium'><label for='txAddGuestFirstName_"+n+"_"+i+"' id='lbAddGuestFirstName_"+n+"_"+i+"'> "+WsMulti.Guest+" "+(i+2)+" "+WsMulti.FirstName+" <\/label ><input name='txAddGuestFirstName_"+n+"_"+i+"' ref='"+n+"_"+i+"' type='text' maxlength='20' id='txAddGuestFirstName_"+n+"_"+i+"' class='ws-element'/><p class='ws-error' style='display:block'><\/p><\/div><div id='dvAddGuestLastName' class='ws-form-item ws-medium ws-multi'><label for='txAddGuestLastName_"+n+"_"+i+"' id='lbAddGuestLastName"+i+"'>"+WsMulti.Guest+" "+(i+2)+" "+WsMulti.LastName+" <\/label><input name='txAddGuestLastName_"+n+"_"+i+"' ref='"+n+"_"+i+"' type='text' maxlength='20' id='txAddGuestLastName_"+n+"_"+i+"' class='ws-element'/><p class='ws-error' style='display:block'><\/p><\/div ><\/div> "),t.AdditionalGuests.length>=i+1&&($("#txAddGuestFirstName_"+n+"_"+i).val(t.AdditionalGuests[i].FirstName),$("#txAddGuestLastName_"+n+"_"+i).val(t.AdditionalGuests[i].LastName));$("#dvAdnlGuestInfo_"+n).attr("totalOccupancy",r+1)}},ValidateAdditionalGuest:function(n){$("#txAddGuestFirstName_"+n+" + p.ws-error").css("display","none");$("#txAddGuestLastName_"+n+" + p.ws-error").css("display","none");var t=$("#txAddGuestFirstName_"+n).val(),i=$("#txAddGuestLastName_"+n).val();return(t===""||t===undefined)&&(i===""||i===undefined)?!0:t!==""&&i!==""?!0:t===""?($("#txAddGuestFirstName_"+n+" + p.ws-error").html(WsMulti.EnterFirstName),$("#txAddGuestFirstName_"+n+" + p.ws-error").css("display","block"),!1):i===""?($("#txAddGuestLastName_"+n+" + p.ws-error").html(WsMulti.EnterLastName),$("#txAddGuestLastName_"+n+" + p.ws-error").css("display","block"),!1):!0},ManageAdditionalGuestTextBox:function(n,t,i,r,u,f,e){var h=1,o=0,a="",l,s,c;if(a=f!==undefined&&f!==""?r+"/"+f:e!==undefined&&e!==""?r+"/"+e:r+"/"+u,$("[crsresvId="+t+"]")[0]!==undefined?(h=$("[crsresvId="+t+"]")[0].attributes.totaloccupancy.value,o=$("[crsresvId="+t+"]")[0].attributes.idx.value):($("#dvAdditionalGuests").append("<div id='dvAdnlGuestInfo_"+o+"' CrsResvId='"+t+"' idx='"+o+"' class='ws-form-item'><input type='hidden' id='roomTypeID_"+o+"' name='roomTypeID_"+o+"' value='"+i+"'/><p id='pRoomRateOccu_"+o+"_"+o+"' ><strong> "+a+"<\/strong><\/p><\/div>"),$("#dvAdnlGuestInfo_"+o).attr("totalOccupancy",h)),l=Number(WsVars.AdditionalGuestsAllowed),Number(h)!==Number(n))if(Number(h)<Number(n)){for(Number(n-1)<Number(WsVars.AdditionalGuestsAllowed)&&(l=n-1),s=Number(h)-1;s<l;s++)$("#dvAdnlGuestInfo_"+o).append("<div id='dvAdnlGuestInfo_"+o+"_"+s+"' class='ws-form-item' ><div id='dvAddGuestFirstName' class='ws-form-item ws-medium'><label for='txAddGuestFirstName_"+o+"_"+s+"' id='lbAddGuestFirstName_"+o+"_"+s+"'> "+WsMulti.Guest+" "+(s+2)+" "+WsMulti.FirstName+"<\/label ><input name='txAddGuestFirstName_"+o+"_"+s+"' ref='"+o+"_"+s+"' type='text' maxlength='20' id='txAddGuestFirstName_"+o+"_"+s+"' class='ws-element'/><p class='ws-error' style='display:block'><\/p><\/div><div id='dvAddGuestLastName' class='ws-form-item ws-medium ws-multi'><label for='txAddGuestLastName_"+o+"_"+s+"' id='lbAddGuestLastName"+s+"'>"+WsMulti.Guest+" "+(s+2)+" "+WsMulti.LastName+"<\/label><input name='txAddGuestLastName_"+o+"_"+s+"' ref='"+o+"_"+s+"' type='text' maxlength='20' id='txAddGuestLastName_"+o+"_"+s+"' class='ws-element'/><p class='ws-error' style='display:block'><\/p><\/div ><\/div> ");$("#dvAdnlGuestInfo_"+o).attr("totalOccupancy",Number(n))}else{for(c=Number(h)-1;c>Number(n)-1;c--)$("#dvAdnlGuestInfo_"+o+"_"+(c-1)).remove();$("#dvAdnlGuestInfo_"+o).attr("totalOccupancy",Number(n))}},CheckPolicy:function(n){var i,r,t;if(n!=undefined&&n!=null&&n.length>0){for(i=!1,r=!1,t=0;t<n.length;t++)switch(n[t].Guar){case"DX":case"PP":return n[t].Guar;case"GX":r=!0;break;case"XX":i=!0}if(r)return"GX";if(i)return"XX"}},SetPayOption:function(){$("#dvPayFullPrePayment").length>=0&&showOrHideDvSection($("#dvPayFullPrePayment"),!1);$("#dvPayAtHotelMsg").length>=0&&$("#dvPayAtHotelMsg").hide();$("#inPaymentOption").val()!=undefined&&($("#inPaymentOption").val()=="OptFullPrePayment"?$("#rblPayFullPrePayment_pfa").length>0&&(document.getElementById("rblPayFullPrePayment_pfa").checked=!0):($("#rblPayFullPrePayment_pah").length>0&&(document.getElementById("rblPayFullPrePayment_pah").checked=!0,$("#dvPayAtHotelMsg").show()),$("#rblPayFullPrePayment_pd").length>0&&(document.getElementById("rblPayFullPrePayment_pd").checked=!0)),showOrHideDvSection($("#dvPayFullPrePayment"),!0))},GetDepositItemsByPayOpt:function(n){var i=0,u=0,t,f,e,r;if(WSMAIN.items!=null&&WSMAIN.items.length>0)for(t=0;t<WSMAIN.items.length;t++){var o=0,h=WSMAIN.CheckPolicy(WSMAIN.items),s=WSMAIN.GetLoyaltyRedeemAmtFromItm(WSMAIN.items[t]);if(u+=s,i+=WSMAIN.items[t].Deposit,WSMAIN.items[t].Deposit>0){if(WSMAIN.items[t].Svcs!=null&&WSMAIN.items[t].Svcs.length>0){for(f=0,e=0,r=0;r<WSMAIN.items[t].Svcs.length;r++)(WSMAIN.items[t].Svcs[r].Options.search("IncludeInDeposit")!="-1"||n=="OptFullPrePayment"||h==="PP")&&(f+=WSMAIN.items[t].Svcs[r].Amt,e+=WSMAIN.items[t].Svcs[r].Taxes);o=f+e}i+=o}WSMAIN.BuildDepositDetail(t,WSMAIN.items[t].Deposit,n,s)}$("#txDeposit").length>0&&i>0?(showOrHideDvSection($("#dvDeposit"),!0),u>0&&(i=i>u?i-u:0),$("#txDeposit").attr("curr",WsVars.Currency),$("#txDeposit").html(Utils.GetAmount(i,WsVars.Currency,WsVars.UseCurrCode)),$("#txDeposit").attr("ref",Utils.ToNumberFormat(i,WsVars.Currency))):showOrHideDvSection($("#dvDeposit"),!1)},GetDepositByUpdatedRS:function(n){var u=null,f=null,i=null,t=WSMAIN.SelectedRs(),r=WSMAIN.GetCurrDiv();r!=undefined&&(u=r.attr("ix"),f=r.data("MySvc"),i=r.data("MyRmRc"));(t==undefined||t==null)&&i!=undefined&&i!=null&&(t=i.GetRoomStay());t!=undefined&&t!=null?(WSMAIN.ShowSummary(),WSMAIN.GetAmountDiff(i,f),WSMAIN.BuildDepositDetail(u,t.Deposit,n,0),WSMAIN.IsLoggedIn()&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.MavrickCRM&&WsVars.EnablePayByPoints=="1"&&$(".ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar .txtRangePoints").change()):WSMAIN.GetDepositItemsByPayOpt(n)},GetLoyaltyRedeemAmtFromItm:function(n){var i=0,t;if(n.LoyaltyPointsInfo!==undefined&&n.LoyaltyPointsInfo!=null&&n.LoyaltyPointsInfo.EntityID>0&&(i=n.LoyaltyPointsInfo.LoyaltyRedeemAmount/100),n.Svcs!==undefined&&n.Svcs!=null)for(t=0;t<n.Svcs.length;t++)n.Svcs[t].LoyaltyPointsInfo!==undefined&&n.Svcs[t].LoyaltyPointsInfo!=null&&n.Svcs[t].LoyaltyPointsInfo.EntityID>0&&(i+=n.Svcs[t].LoyaltyPointsInfo.LoyaltyRedeemAmount/100);return i},BuildDepositDetail:function(n,t,i,r){var u=0,e=0,f;$("#tdSubtotal_"+n).length>0&&(e=$("#tdSubtotal_"+n).attr("ref"));u=i=="OptFullPrePayment"?e:t;u<=0&&($("#trDeposit_"+n).hide(),$("#trDepositRemain_"+n).hide());(i=="OptFullPrePayment"||i=="PayDeposit")&&e>0&&$("#trDeposit_"+n).show();$("#trDeposit_"+n).length>0&&((i=="OptFullPrePayment"||i=="PayDeposit")&&e>0&&$("#trDeposit_"+n).show(),r>0&&(u=u>r?u-r:0),$("#tdDeposit_"+n).attr("curr",WsVars.Currency),$("#tdDeposit_"+n).html(Utils.GetAmount(u,WsVars.Currency,WsVars.UseCurrCode)),$("#tdDeposit_"+n).attr("ref",Utils.ToNumberFormat(u,WsVars.Currency)));f=e-(u+r);f<0&&(f=0);$("#trDepositRemain_"+n).length>0&&((i=="OptFullPrePayment"||i=="PayDeposit")&&f>0&&$("#trDepositRemain_"+n).show(),$("#tdDepositRemain_"+n).attr("curr",WsVars.Currency),$("#tdDepositRemain_"+n).html(Utils.GetAmount(f,WsVars.Currency,WsVars.UseCurrCode)),$("#tdDepositRemain_"+n).attr("ref",Utils.ToNumberFormat(f,WsVars.Currency)));(WsVars.IsPaymentGateway==="1"||WsVars.GuestLoyalty!=""||$("#MyHeading_buMember").length>0)&&(typeof WsShowRates!="undefined"&&WsShowRates(),ShowBaseOrSelectedCurrencyPrices())},GetConvertedRedeemAmt:function(n,t,i,r){var u=t*i/n;return r>0&&(u=i*r),Utils.ToNumberFormat(u,WsVars.Currency)},GetConvertedRedeemPoints:function(n,t,i,r){var u=n*i/t;return r>0&&(u=i/r),u},LoadGuestsProgramsField:function(){if(WsVars.ActiveMembershipAndRegEx!=undefined&&WsVars.ActiveMembershipAndRegEx!=""&&!$.isEmptyObject(WsVars.ActiveMembershipAndRegEx)){$("#dvWsGuestMerbershipProgram").append("<div id='dvActiveGuestPrograms' class='ws-form-item'><p id='pGuestProgramTitle' ><strong> "+WsMulti.GuestProgramTitle+"<\/strong><\/p><\/div>");for(var n in WsVars.ActiveMembershipAndRegEx)n!=undefined&&n!=""&&$("#dvActiveGuestPrograms").append("<div id='dvActiveGuestPrograms_"+n+"' class='ws-form-item' ><div id='dvFirstGuestProgram' class='ws-form-item'><label for='txGuestProgramName_"+n+"' id='lblGuestMembershipPrograms_"+n+"'>"+WsVars.ActiveMembershipAndRegEx[n].ProgramName+"<\/label ><input name='txGuestProgramName_"+n+"' ref='"+n+"' type='text' id='txGuestProgramName_"+n+"' class='ws-element' value ='"+WsVars.ActiveMembershipAndRegEx[n].GuestProgMemberID+"'><p class='ws-error' style='display:block'><\/p><\/div><\/div>")}},GetRegexFromProgramCode:function(n){var i,t,r,u;return $("#txGuestProgramName_"+n).length>0&&(i=!1,t=$("#txGuestProgramName_"+n).val(),t==undefined||t==""||WsVars.ActiveMembershipAndRegEx==undefined||WsVars.ActiveMembershipAndRegEx==""||$.isEmptyObject(WsVars.ActiveMembershipAndRegEx)||t.length>0&&WsVars.ActiveMembershipAndRegEx.hasOwnProperty(n)&&(r=WsVars.ActiveMembershipAndRegEx[n].MembershipRegEx,u=ValidRegex(r),u==undefined||u!=!0||t.match(r)||$("#lblGuestMembershipPrograms_"+n).length>0&&($("#"+$("#txGuestProgramName_"+n)[0].id+"+ p.ws-error").html(WsMsgFmRegexValidation+" "+$("#lblGuestMembershipPrograms_"+n)[0].innerHTML),$("#txGuestProgramName_"+n).addClass("ws-error-form"),$("#buGuestSave").addClass("ws-disabled"),i=!0)),i||($("#buGuestSave").hasClass("ws-disabled")||$("#"+$("#txGuestProgramName_"+n)[0].id).hasClass("ws-error-form")||$("#"+$("#txGuestProgramName_"+n)[0].id+"+ p.ws-error").hasClass("ws-error"))&&($("#"+$("#txGuestProgramName_"+n)[0].id).removeClass("ws-error-form"),removeErrorclass($("#txGuestProgramName_"+n)[0].id))),!0}};jQuery().ready(function(n){if(rqCountryDialCode&&(n("#txPhone").length>0||n("#txMobile").length>0)){getCountryflag("");n("#txPhone[readonly], #txMobile[readonly]").removeAttr("readonly").on("keydown",function(n){n.preventDefault()})}var t=/^[a-z0-9]+$/i;n(".custom").customSelect();n("#txtCancelReason").css("display","none");n.cookie("IsUpgradePopUpShown")!=null&&WSCCONSENT.SetCookie("IsUpgradePopUpShown",null);n("#cbCancelReasons").change(function(){var t="";t=n(this).children("option:selected").val();t=="1"?n("#txtCancelReason").css("display","block"):n("#txtCancelReason").css("display","none")});document.getElementById("cbCountry").hasAttribute("disabled")&&(n("#cbState").attr("disabled","disabled"),n("#cbState + .customSelect").addClass("customSelectDisabled"));n("#cbState option").length>1?(n("#dvState .customSelect, #dvState .ws-required").show(),n("#cbState").removeClass("ws-hide"),n("#txState").hide()):(n("#dvState .customSelect, #dvState .ws-required").hide(),n("#cbState").addClass("ws-hide"),n("#txState").show());n("#buLoyaltyOk").click(function(){n.magnificPopup.close()});n("#buCreatePwd").click(function(){return(n("#msgSetPwd,#dvMsgSetPwd").html(""),n("#txSetPwd1,#txSetPwd2").removeClass("ws-error-form"),n("#txSetPwd1").val().length===0||n("#txSetPwd2").val().length===0)?(n("#msgSetPwd").html(WsMulti.EnterMatchingPwds),n("#txSetPwd1,#txSetPwd2").addClass("ws-error-form"),!1):n("#txSetPwd1").val()!==n("#txSetPwd2").val()?(n("#msgSetPwd").html(WsMulti.EnterMatchingPwds),n("#txSetPwd1,#txSetPwd2").addClass("ws-error-form"),!1):(n("body").css({cursor:"wait"}),n.ajax({type:"POST",url:"xml/setloyalty.aspx",data:{hotelID:WsVars.HotelID,hgID:WsVars.HgID,langID:WsVars.LangID,currID:WsVars.CurrencyId,crsID:n("#inCrsID").val(),lname:n("#inLname").val(),pwd1:n("#txSetPwd1").val(),pwd2:n("#txSetPwd2").val(),simple:"0"},dataType:"json",success:function(t){n("body").css({cursor:"auto"});t.Status==="1"?(t.Msg.length>0&&n("#dvMsgSetPwd").show().html(t.Msg),n("#dvBuSetPwd").hide()):(t.Msg.length>0&&n("#msgSetPwd").html(t.Msg),n("#txSetPwd1,#txSetPwd2").addClass("ws-error-form"))},error:function(){n("body").css({cursor:"auto"})}}),!1)});n("#buRequestPwd").click(function(){var t=n("#inRequestPwd").val(),i={hotelID:WsVars.HotelID,langID:WsVars.LangID,email:t,welcome:!1};return(n("#paraRequestPwdMsg,#paraRequestPwdMsg2").html(""),n("#inRequestPwd").removeClass("ws-error-form"),t.length===0)?(n("#paraRequestPwdMsg").html(WsMulti.EnterEmailAddress).addClass("ws-error").removeClass("ws-reset-success"),n("#inRequestPwd").addClass("ws-error-form"),!1):SHRWindsurfer.Utils.IsValidEmail(t)?(n("body").css({cursor:"wait"}),n.ajax({type:"POST",url:"xml/GetPwdResetEmail.aspx",data:i,dataType:"json"}).done(function(t){n("body").css({cursor:"auto"});t.Msg.length>0&&n("#paraRequestPwdMsg2").show().html(t.Msg);n("#paraBuRequestPwd").hide()}).fail(function(t){n("body").css({cursor:"auto"});n("#paraRequestPwdMsg").html("Error requesting password reset!").addClass("ws-error").removeClass("ws-reset-success");n("#paraRequestPwdMsg").show();WSEvents&&WSEvents.do_action("RequestPwdResetEmailError",t)}),!1):(n("#paraRequestPwdMsg").html(WsMulti.InvalidEmailAddress).addClass("ws-error").removeClass("ws-reset-success"),n("#inRequestPwd").addClass("ws-error-form"),!1)});n("#cbCountry").change(function(){n("#cbState").load("xml/getStates.aspx?country="+n(this).val()+"&lang="+WsVars.LangCode,function(){n(this).change();n("#cbState option").length>1?(n("#dvState .customSelect, #dvState .ws-required").show(),n("#cbState").removeClass("ws-hide"),n("#txState").hide()):(n("#dvState .customSelect, #dvState .ws-required").hide(),n("#cbState").addClass("ws-hide"),n("#txState").show())});rqCountryDialCode&&(n("#txPhone").val().length>0||n("#txMobile").val().length>0)&&(document.getElementById("txPhone").defaultValue="",document.getElementById("txMobile").defaultValue="",getCountryFlagOnChange(),n("#txPhone").val().trim().length>5&&n("#txPhone").focus(),n("#txMobile").val().trim().length>5&&n("#txMobile").focus())});n(".ws-open-close a").click(function(){WsVars.IBESkinVer=="3"?n(this).closest("fieldset").removeClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-hide-action").addClass("ws-show-this"):n(this).closest("fieldset").removeClass("ws-collapsed").find(".ws-collapsible").addClass("ws-show-this");switch(this.id){case"buGuestModify":n("#hdGuestInfo").attr("aria-expanded",!0);break;case"buGuestPrefModify":n("#hdGuestPrefInfo").attr("aria-expanded",!0);break;case"buBillingModify":n("#hdBillingInfo").attr("aria-expanded",!0)}return(WsVars.IsAdyenV2==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1)&&WSMAIN.ChangePaymentOption(!1),!1});n("a.ws-cancel-edits").click(function(){return WsVars.IBESkinVer=="3"?n(this).closest("fieldset").addClass("ws-collapsed").find(".ws-collapsible").addClass("ws-hide-action").removeClass("ws-show-this"):n(this).closest("fieldset").addClass("ws-collapsed").find(".ws-collapsible").removeClass("ws-show-this"),n("#hdGuestInfo, #hdGuestPrefInfo, #hdBillingInfo").attr("aria-expanded",!1),!1});n("a.ws-cancel-res").click(function(){var l=n(this).attr("ref"),u,f,r,i,s,h,c;n("#ws-cart-view").addClass("ws-show-this");WsVars.IBESkinVer=="3"&&n("#ws-cart-view").removeClass("ws-hide-action");n("#inCancelCrsID").val(l);n("#inCancelHotelID").val(n(this).attr("hotel"));n("#dvCancelMsg").html("");u="";n("#subDeposit").html("");var e="",o="",a=n(this).parents()[3],t=n(a).attr("ix");if(u=WsVars.Config2Flag=="True"?WSMAIN.items[t].Currency+"~":WSMAIN.items[t].Currency,WSMAIN.items[t].IsCancellable&&!WSMAIN.items[t].IsMody?n("#subCancel").html(WsMulti.BookingCancelAlert):n("#subCancel").html(WsMulti.CancelHeader),WsVars.AllowToPointsCreditBackOnCancellation==1&&WSMAIN.IsLoggedIn()&&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramEnum.MavrickCRM&&WsVars.EnablePayByPoints=="1"){if(f=0,r=0,WSMAIN.items[t].LoyaltyPointsInfo!=undefined&&WSMAIN.items[t].LoyaltyPointsInfo!=null&&WSMAIN.items[t].LoyaltyPointsInfo.LoyaltyRedeemPoints>0&&(f=WSMAIN.items[t].LoyaltyPointsInfo.LoyaltyRedeemPoints,r=WSMAIN.items[t].LoyaltyPointsInfo.LoyaltyRedeemAmount),WSMAIN.items[t].Svcs!=undefined&&WSMAIN.items[t].Svcs!=null&&WSMAIN.items[t].Svcs.length>0)for(i=0;i<WSMAIN.items[t].Svcs.length;i++)WSMAIN.items[t].Svcs[i].LoyaltyPointsInfo!=undefined&&WSMAIN.items[t].Svcs[i].LoyaltyPointsInfo!=null&&WSMAIN.items[t].Svcs[i].LoyaltyPointsInfo.LoyaltyRedeemPoints>0&&(f+=WSMAIN.items[t].Svcs[i].LoyaltyPointsInfo.LoyaltyRedeemPoints,r+=WSMAIN.items[t].Svcs[i].LoyaltyPointsInfo.LoyaltyRedeemAmount);f>0&&r>0&&(o=WsVars.EnableFractionalCredits=="1"?Utils.Format('{0} <span ref="{1}" curr="{3}" id="wsCancelCashback">{2}<span>',WsMulti.CashBack,parseFloat(r/100),Utils.GetAmount(parseFloat(r/100),u,WsVars.UseCurrCode),WsVars.Currency):WsMulti.Points+" "+Utils.GetAmount(f,u,"0",!1,!0))}(WSMAIN.items[t].IsPolicyRefundable||WSMAIN.items[t].IsAllowFullPrePayment&&(WSMAIN.items[t].Guar=="XX"||WSMAIN.items[t].Guar=="GX")||(WSMAIN.items[t].Guar=="XX"||WSMAIN.items[t].Guar=="GX")&&WSMAIN.items[t].PaidDepositBalance>0)&&(s=WSMAIN.items[t].PaidDepositBalance,(WsVars.IsElavonFuseboxProp==1||WsVars.IsIPGProp==1||WsVars.IsFreedomPayProp==1||WsVars.IsAdyenV2==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsShift4==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsPaymentGatewayV1==1)&&WsVars.TokenizeChargeRefund==1&&s>0&&(e=Utils.Format('<span id="wsCancelDeposit">{0}<span>',Utils.GetAmount(s,u,WsVars.UseCurrCode))));o.length>0||e.length>0?(h=WsMulti.AmountWillBeCredited+":  ",c=e.length>0&&o.length>0?" + ":"",h+=e+c+o,n("#subDeposit").html(""+h),typeof WsShowRates!="undefined"&&WsShowRates()):n("#subDeposit").html("");window.setTimeout(function(){n("#buCancelNo").focus()},500)});n("#buCancelNo").click(function(){return n("#ws-cart-view").removeClass("ws-show-this"),WsVars.IBESkinVer=="3"&&n("#ws-cart-view").addClass("ws-hide-action"),!1});n("#buCancelYes").click(function(){return n("#inAction").val("buCancelResv"),n("body").css({cursor:"wait"}),n.ajax({type:"POST",url:"confirm.aspx",data:n("#wsform").serialize(),dataType:"json",success:function(t){var i,r,e,o,s,u;n("body").css({cursor:"auto"});var f=t.Msg,h=t.ResvID,v=t.LangID,c=t.LangCode,l=t.HotelID,a=t.resvKey;if(f.length>0)n("#dvCancelMsg").html(f);else{for(i=null,r=0;r<WsVars.CartItems.length;r++)if(WsVars.CartItems[r].CrsID===n("#inCancelCrsID").val()){e=WsVars.CartItems[r];i=jQuery.extend(!0,{},e);break}i!==null&&(o=new Date,s=Utils.GetIndexFromY2K(o),i.DayIn=Utils.ToMDYYYYFromIndex(i.Dt1,1),i.DayOut=Utils.ToMDYYYYFromIndex(i.Dt1+i.Nights,1),i.LeadTime=i.Dt1-s,i.AmtPerRmNght=Number(i.Amt)/Number(i.Nights),i.ResStatus="C",WsIbeTracking.TrackCancellation(i));u=Utils.Format("confirm.aspx?ret=1&hotelid={0}&lang={1}&crsid={2}&resvKey={3}&currID={4}",l,c,h,a,WsVars.CurrencyId);WsVars.HgID!=="0"&&(u=u+"&hgID="+WsVars.HgID);location.replace(u)}},error:function(){n("body").css({cursor:"auto"})}}),!1});n("#txPhone,#txMobile,#txZip").keyup(function(){var t;n("#cbCountry").val()==="US"?(t=n("#txZip").val().replace(/\D/g,"").substr(0,5),n("#txZip").val(t),n("#txZip").attr("maxlength","5")):n("#txZip").attr("maxlength","10")});n(document).on("keyup","#wsform #dvAdditionalGuests input[type=text]",function(){var n=this.attributes.ref.value;WSMAIN.ValidateAdditionalGuest(n)});n(document).on("keyup","#wsform #dvActiveGuestPrograms input[type=text]",function(){if(WsVars&&typeof WsVars.ActiveMembershipAndRegEx!=undefined&&WsVars.ActiveMembershipAndRegEx!=null){var n=this.attributes.ref.value;WSMAIN.GetRegexFromProgramCode(n)}});n("#field-guests input,#field-guests select").not("#dvWsGuestMerbershipProgram input").blur(function(){var u,i=document.querySelector("#error-msg"),r=document.querySelector("#error-msg1");return(n("#cbCountry").val()==="US"?(u=n("#txZip").val().replace(/\D/g,"").substr(0,5),n("#txZip").val(u),n("#txZip").attr("maxlength","5")):n("#txZip").attr("maxlength","10"),n(this).val(Utils.TrimSpaces(n(this).val())),n("#field-guests input,#field-guests select,#field-guests a").removeClass("ws-error-form"),rqWsSalutation&&n("#cbSalutation").val().length==0)?(n("#dvWsSalutation p.ws-error").html(WsMsgFmSalute),n("#cbSalutation").addClass("ws-error-form"),!1):rqWsFirstName&&n("#txFirstName").val().length==0?(n("#txFirstName + p.ws-error").html(WsMsgFmFirst),n("#txFirstName").addClass("ws-error-form"),!1):rqWsFirstName&&!Utils.IsInput(n("#txFirstName").val())?(n("#txFirstName + p.ws-error").html(WsMsgFmLatinChars),n("#txFirstName").addClass("ws-error-form"),!1):rqWsMiddleInit&&n("#txMiddleInit").val().length==0?(n("#txMiddleInit + p.ws-error").html(WsMsgFmMiddle),n("#txMiddleInit").addClass("ws-error-form"),!1):rqWsMiddleInit&&!Utils.IsInput(n("#txMiddleInit").val())?(n("#txMiddleInit + p.ws-error").html(WsMsgFmLatinChars),n("#txMiddleInit").addClass("ws-error-form"),!1):rqWsLastName&&n("#txLastName").val().length==0?(n("#txLastName + p.ws-error").html(WsMsgFmLast),n("#txLastName").addClass("ws-error-form"),!1):rqWsLastName&&!Utils.IsInput(n("#txLastName").val())?(n("#txLastName + p.ws-error").html(WsMsgFmLatinChars),n("#txLastName").addClass("ws-error-form"),!1):rqWsAddress1&&n("#txAddress1").val().length==0?(n("#txAddress1 + p.ws-error").html(WsMsgFmAddress),n("#txAddress1").addClass("ws-error-form"),!1):rqWsAddress1&&!Utils.IsInput(n("#txAddress1").val())?(n("#txAddress1 + p.ws-error").html(WsMsgFmLatinChars),n("#txAddress1").addClass("ws-error-form"),!1):rqWsCity&&n("#txCity").val().length==0?(n("#txCity + p.ws-error").html(WsMsgFmCity),n("#txCity").addClass("ws-error-form"),!1):rqWsCity&&!Utils.IsInput(n("#txCity").val())?(n("#txCity + p.ws-error").html(WsMsgFmLatinChars),n("#txCity").addClass("ws-error-form"),!1):rqWsZip&&n("#txZip").val().length==0?(n("#txZip + p.ws-error").html(WsMsgFmZip),n("#txZip").addClass("ws-error-form"),!1):rqWsZip&&!Utils.IsInput(n("#txZip").val())?(n("#txZip + p.ws-error").html(WsMsgFmLatinChars),n("#txZip").addClass("ws-error-form"),!1):n("#cbState option").length>1&&n("#cbState").val().length==0?(n("#dvState p.ws-error").html(WsMsgFmState),n("#cbState").addClass("ws-error-form"),!1):rqWsCompany&&n("#txCompany").val().length==0?(n("#txCompany + p.ws-error").html(WsMsgFmCompany),n("#txCompany").addClass("ws-error-form"),!1):rqWsCompany&&!Utils.IsInput(n("#txCompany").val())?(n("#txCompany + p.ws-error").html(WsMsgFmLatinChars),n("#txCompany").addClass("ws-error-form"),!1):rqWsGender&&n("#cbGender").val().length==0?(n("#dvWsGender p.ws-error").html(WsMsgFmGender),n("#cbGender").addClass("ws-error-form"),!1):rqWsDob&&n("#cbBirthMM").val().length===0?(n("#dvWsDob p.ws-error").html(WsMsgFmDob),n("#cbBirthMM").addClass("ws-error-form"),!1):rqWsDob&&n("#cbBirthDD").val().length===0?(n("#dvWsDob p.ws-error").html(WsMsgFmDob),n("#cbBirthDD").addClass("ws-error-form"),!1):rqWsDob&&n("#cbBirthYY").val().length===0?(n("#dvWsDob p.ws-error").html(WsMsgFmDob),n("#cbBirthYY").addClass("ws-error-form"),!1):rqWsMemberID&&n("#txMemberID").val().length==0&&!n("#txMemberID").is("[readonly]")?(n("#txMemberID + p.ws-error").html(WsMsgFmLoyalty),n("#txMemberID").addClass("ws-error-form"),!1):rqWsMemberID&&!Utils.IsInput(n("#txMemberID").val())?(n("#txMemberID + p.ws-error").html(WsMsgFmLatinChars),n("#txMemberID").addClass("ws-error-form"),!1):n("#txMemberID").val().length>0&&!n("#txMemberID").val().match(t)&&!n("#txMemberID").is("[readonly]")?(n("#txMemberID + p.ws-error").html(WsMsgFmLoyalty),n("#txMemberID").addClass("ws-error-form"),!1):rqWsPhone&&n("#txPhone").val().length==0?(n("#txPhone + p.ws-error").html(WsMsgFmPhone),n("#txPhone").addClass("ws-error-form"),!1):rqWsPhone&&!Utils.IsValidPhone(n("#txPhone").val())?(n("#txPhone + p.ws-error").html(WsMsgFmInvalidPhone),n("#txPhone").addClass("ws-error-form"),!1):rqWsMobile&&n("#txMobile").val().length==0?(n("#txMobile + p.ws-error").html(WsMsgFmMobile),n("#txMobile").addClass("ws-error-form"),!1):rqWsMobile&&!Utils.IsValidPhone(n("#txMobile").val())?(n("#txMobile + p.ws-error").html(WsMsgFmInvalidMobile),n("#txMobile").addClass("ws-error-form"),!1):rqCountryDialCode&&typeof i!="undefined"&&i.innerHTML!="undefined"&&i.innerHTML!=""?(n("#txPhone + p.ws-error").html(WsMsgFmInvalidMobile),n("#txPhone").addClass("ws-error-form"),!1):rqCountryDialCode&&typeof r!="undefined"&&r.innerHTML!="undefined"&&r.innerHTML!=""?(n("#txMobile + p.ws-error").html(WsMsgFmInvalidMobile),n("#txMobile").addClass("ws-error-form"),!1):rqWsEmail&&!Utils.IsValidEmail(n("#txEmail").val())?(n("#txEmail + p.ws-error").html(WsMsgFmEmail),n("#txEmail").addClass("ws-error-form"),!1):n("#dvWsEmail").is(":visible")&&n("#dvWsRetypeEmail").is(":visible")&&n("#txEmail").val()!==n("#txRetypeEmail").val()?(n("#txRetypeEmail + p.ws-error").html(WsMsgFmRetypeEmail),n("#txRetypeEmail").addClass("ws-error-form"),!1):rqWsEmailAlt&&!Utils.IsValidEmail(n("#txEmailAlt").val())?(n("#txEmailAlt + p.ws-error").html(WsMsgFmEmailAlt),n("#txEmailAlt").addClass("ws-error-form"),!1):rqWsBookedBy&&n("#txBooked").val().length==0?(n("#txBooked + p.ws-error").html(WsMsgFmBookedBy),n("#txBooked").addClass("ws-error-form"),!1):rqWsBookedBy&&!Utils.IsInput(n("#txBooked").val())?(n("#txBooked + p.ws-error").html(WsMsgFmLatinChars),n("#txBooked").addClass("ws-error-form"),!1):rqWsTripPurpose&&n("#cbTripPurpose").val().length==0?(n("#dvWsTripPurpose p.ws-error").html(WsMsgFmTripPurpose),n("#cbTripPurpose").addClass("ws-error-form"),!1):rqWsTravelProgram&&n("#cbTravelProgram option").length>0&&n("#cbTravelProgram").val().length===0?(n("#dvWsTravelProgram p.ws-error").html(WsMsgFmTravelProgram),n("#cbTravelProgram").addClass("ws-error-form"),!1):rqWsTravelMember&&n("#txTravelMember").val().length===0?(n("#txTravelMember + p.ws-error").html(WsMsgFmTravelMember),n("#txTravelMember").addClass("ws-error-form"),!1):rqWsTravelMember&&!Utils.IsInput(n("#txTravelMember").val())?(n("#txTravelMember + p.ws-error").html(WsMsgFmLatinChars),n("#txTravelMember").addClass("ws-error-form"),!1):rqWsArrFlight&&n("#txArrFlight").val().length==0?(n("#txArrFlight + p.ws-error").html(WsMsgFmArrFlight),n("#txArrFlight").addClass("ws-error-form"),!1):rqWsArrFlight&&!Utils.IsInput(n("#txArrFlight").val())?(n("#txArrFlight + p.ws-error").html(WsMsgFmLatinChars),n("#txArrFlight").addClass("ws-error-form"),!1):rqWsArrTime&&n("#txArrTime").length>0&&n("#txArrTime").val().length==0?(n("#txArrTime + p.ws-error").html(WsMsgFmArrTime),n("#txArrTime").addClass("ws-error-form"),!1):rqWsArrTime&&n("#txArrTime").length>0&&!Utils.IsInput(n("#txArrTime").val())?(n("#txArrTime + p.ws-error").html(WsMsgFmLatinChars),n("#txArrTime").addClass("ws-error-form"),!1):rqWsArrTime&&n("#cbArrTime").length>0&&n("#cbArrTime").val().length==0?(n("#cbArrTime + p.ws-error").html(WsMsgFmArrTime),n("#cbArrTime").addClass("ws-error-form"),!1):rqWsGuestPref&&n("#txComments").val().length===0?(n("#txComments + p.ws-error").html(WsMsgFmComment),n("#txComments").addClass("ws-error-form"),!1):rqWsGuestPref&&!Utils.IsInput(n("#txComments").val())?(n("#txComments + p.ws-error").html(WsMsgFmLatinChars),n("#txComments").addClass("ws-error-form"),!1):rqWsTAIataNumber&&n("#dvWsTAIataNumber").is(":visible")&&n("#txTAIataNumber").val().length===0?(n("#txTAIataNumber + p.ws-error").html(WsMsgFmIataNumber),n("#txTAIataNumber").addClass("ws-error-form"),"txTAIataNumber"):void 0});n("#field-billing input,#field-billing select").blur(function(){var t,f,i,r,u;if(n(this).val(Utils.TrimSpaces(n(this).val())),t=!0,n("#buBillingSave").addClass("ws-disabled"),WsVars.IsAdyenV2==1&&n("input:radio[name='WsPaymentMethod$rdPayMethodType']").length>0)if(n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="klarna"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="klarna_account"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="klarna_paynow"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="swish"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="googlepay"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="applepay"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="alipay"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="wechatpayWeb")t=!1;else if(n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="giftcard"&&(t=!1,n("#txGiftCardNumber").length>0&&n("#txGiftCardNumber").val().length===0))return n("#txGiftCardNumber + p.ws-error").html(WsMsgFmGiftCardNumber),n("#txGiftCardNumber").addClass("ws-error-form"),!1;if(n("#field-billing input,#field-billing select,#field-billing a").removeClass("ws-error-form"),t){if(f=n("#txCardHolder").val().replace(/\s+/g,""),f.length===0||/^\d{12,16}$/.test(f))return n("#txCardHolder + p.ws-error").html(WsMsgFmCardHolder),n("#txCardHolder").addClass("ws-error-form"),!1;if(Utils.IsInput(n("#txCardHolder").val())){if(n("#txCardNumber").val().length<=10)return n("#txCardNumber + p.ws-error").html(WsMsgFmCardNumber),n("#txCardNumber").addClass("ws-error-form"),!1;if(n("#txCardCvv").length>0&&n("#txCardCvv").val().length==0)return n("#txCardCvv + p.ws-error").html(WsMsgFmCardCvv),n("#txCardCvv").addClass("ws-error-form"),!1;if(n("#txCardCvv").length>0&&!Utils.IsInput(n("#txCardCvv").val()))return n("#txCardCvv + p.ws-error").html(WsMsgFmLatinChars),n("#txCardCvv").addClass("ws-error-form"),!1}else return n("#txCardHolder + p.ws-error").html(WsMsgFmLatinChars),n("#txCardHolder").addClass("ws-error-form"),!1;if(n("#field-billing").is(":visible"))for(i=new Date(parseInt(n("#cbCardYY").val()),parseInt(n("#cbCardMM").val()),1),i.setDate(i.getDate()+-1),r=0;r<WSMAIN.items.length;r++)u=new Date(2e3,0,1),u.setDate(u.getDate()+WSMAIN.items[r].Dt1),i<u?(n("#dvWsCardExpiry p.ws-error").html(WsMsgFmCardExpiry),n("#cbCardMM").addClass("ws-error-form")):n("#buBillingSave").removeClass("ws-disabled")}!t&&n("#field-billing").is(":visible")&&n("#buBillingSave").removeClass("ws-disabled")});n("#buGuestSave").click(function(){var e,r,u,f,o;if(n("#wsform input,#wsform select,#wsform a").removeClass("ws-error-form"),n("#wsform input[type=text]").each(function(){n(this).val(Utils.TrimSpaces(n(this).val()))}),r=document.querySelector("#error-msg"),u=document.querySelector("#error-msg1"),n("#cbCountry").val()==="US"?(e=n("#txZip").val().replace(/\D/g,"").substr(0,5),n("#txZip").val(e),n("#txZip").attr("maxlength","5")):n("#txZip").attr("maxlength","10"),rqWsSalutation&&n("#cbSalutation").val().length==0)return n("#dvWsSalutation p.ws-error").html(WsMsgFmSalute),n("#cbSalutation").addClass("ws-error-form").focus(),!1;if(rqWsFirstName&&n("#txFirstName").val().length==0)return n("#txFirstName + p.ws-error").html(WsMsgFmFirst),n("#txFirstName").addClass("ws-error-form").focus(),!1;if(rqWsFirstName&&!Utils.IsInput(n("#txFirstName").val()))return n("#txFirstName + p.ws-error").html(WsMsgFmLatinChars),n("#txFirstName").addClass("ws-error-form").focus(),!1;if(rqWsMiddleInit&&n("#txMiddleInit").val().length==0)return n("#txMiddleInit + p.ws-error").html(WsMsgFmMiddle),n("#txMiddleInit").addClass("ws-error-form").focus(),!1;if(rqWsMiddleInit&&!Utils.IsInput(n("#txMiddleInit").val()))return n("#txMiddleInit + p.ws-error").html(WsMsgFmLatinChars),n("#txMiddleInit").addClass("ws-error-form").focus(),!1;if(rqWsLastName&&n("#txLastName").val().length==0)return n("#txLastName + p.ws-error").html(WsMsgFmLast),n("#txLastName").addClass("ws-error-form").focus(),!1;if(rqWsLastName&&!Utils.IsInput(n("#txLastName").val()))return n("#txLastName + p.ws-error").html(WsMsgFmLatinChars),n("#txLastName").addClass("ws-error-form").focus(),!1;if(rqWsAddress1&&n("#txAddress1").val().length==0)return n("#txAddress1 + p.ws-error").html(WsMsgFmAddress),n("#txAddress1").addClass("ws-error-form").focus(),!1;if(rqWsAddress1&&!Utils.IsInput(n("#txAddress1").val()))return n("#txAddress1 + p.ws-error").html(WsMsgFmLatinChars),n("#txAddress1").addClass("ws-error-form").focus(),!1;if(rqWsCity&&n("#txCity").val().length==0)return n("#txCity + p.ws-error").html(WsMsgFmCity),n("#txCity").addClass("ws-error-form").focus(),!1;if(rqWsCity&&!Utils.IsInput(n("#txCity").val()))return n("#txCity + p.ws-error").html(WsMsgFmLatinChars),n("#txCity").addClass("ws-error-form").focus(),!1;if(rqWsZip&&n("#txZip").val().length==0)return n("#txZip + p.ws-error").html(WsMsgFmZip),n("#txZip").addClass("ws-error-form").focus(),!1;if(rqWsZip&&!Utils.IsInput(n("#txZip").val()))return n("#txZip + p.ws-error").html(WsMsgFmLatinChars),n("#txZip").addClass("ws-error-form").focus(),!1;if(n("#cbState option").length>1&&n("#cbState").val().length==0)return n("#dvState p.ws-error").html(WsMsgFmState),n("#cbState").addClass("ws-error-form").focus(),!1;if(rqWsCompany&&n("#txCompany").val().length==0)return n("#txCompany + p.ws-error").html(WsMsgFmCompany),n("#txCompany").addClass("ws-error-form").focus(),!1;if(rqWsCompany&&!Utils.IsInput(n("#txCompany").val()))return n("#txCompany + p.ws-error").html(WsMsgFmLatinChars),n("#txCompany").addClass("ws-error-form").focus(),!1;if(rqWsGender&&n("#cbGender").val().length==0)return n("#dvWsGender p.ws-error").html(WsMsgFmGender),n("#cbGender").addClass("ws-error-form").focus(),!1;if(rqWsDob&&n("#cbBirthMM").val().length===0)return n("#dvWsDob p.ws-error").html(WsMsgFmDob),n("#cbBirthMM").addClass("ws-error-form").focus(),!1;if(rqWsDob&&n("#cbBirthDD").val().length===0)return n("#dvWsDob p.ws-error").html(WsMsgFmDob),n("#cbBirthDD").addClass("ws-error-form").focus(),!1;if(rqWsDob&&n("#cbBirthYY").val().length===0)return n("#dvWsDob p.ws-error").html(WsMsgFmDob),n("#cbBirthYY").addClass("ws-error-form").focus(),!1;if(rqWsMemberID&&n("#txMemberID").val().length==0&&!n("#txMemberID").is("[readonly]"))return n("#txMemberID + p.ws-error").html(WsMsgFmLoyalty),n("#txMemberID").addClass("ws-error-form").focus(),!1;if(rqWsMemberID&&!Utils.IsInput(n("#txMemberID").val()))return n("#txMemberID + p.ws-error").html(WsMsgFmLatinChars),n("#txMemberID").addClass("ws-error-form").focus(),!1;if(n("#txMemberID").val().length>0&&!n("#txMemberID").val().match(t)&&!n("#txMemberID").is("[readonly]"))return n("#txMemberID + p.ws-error").html(WsMsgFmLoyalty),n("#txMemberID").addClass("ws-error-form").focus(),!1;if(rqWsPhone&&n("#txPhone").val().length==0)return n("#txPhone + p.ws-error").html(WsMsgFmPhone),n("#txPhone").addClass("ws-error-form").focus(),!1;if(rqWsPhone&&!Utils.IsValidPhone(n("#txPhone").val()))return n("#txPhone + p.ws-error").html(WsMsgFmInvalidPhone),n("#txPhone").addClass("ws-error-form").focus(),!1;if(rqWsMobile&&n("#txMobile").val().length==0)return n("#txMobile + p.ws-error").html(WsMsgFmMobile),n("#txMobile").addClass("ws-error-form").focus(),!1;if(rqWsMobile&&!Utils.IsValidPhone(n("#txMobile").val()))return n("#txMobile + p.ws-error").html(WsMsgFmInvalidMobile),n("#txMobile").addClass("ws-error-form").focus(),!1;if(rqCountryDialCode&&typeof r!="undefined"&&r.innerHTML!="undefined"&&r.innerHTML!="")return n("#txPhone + p.ws-error").html(WsMsgFmInvalidMobile),n("#txPhone").addClass("ws-error-form").focus(),!1;if(rqCountryDialCode&&typeof u!="undefined"&&u.innerHTML!="undefined"&&u.innerHTML!="")return n("#txMobile + p.ws-error").html(WsMsgFmInvalidMobile),n("#txMobile").addClass("ws-error-form").focus(),!1;if(rqWsEmail&&!Utils.IsValidEmail(n("#txEmail").val()))return n("#txEmail + p.ws-error").html(WsMsgFmEmail),n("#txEmail").addClass("ws-error-form").focus(),!1;if(n("#dvWsEmail").is(":visible")&&n("#dvWsRetypeEmail").is(":visible")&&n("#txEmail").val()!==n("#txRetypeEmail").val())return n("#txRetypeEmail + p.ws-error").html(WsMsgFmRetypeEmail),n("#txRetypeEmail").addClass("ws-error-form").focus(),!1;if(rqWsEmailAlt&&!Utils.IsValidEmail(n("#txEmailAlt").val()))return n("#txEmailAlt + p.ws-error").html(WsMsgFmEmailAlt),n("#txEmailAlt").addClass("ws-error-form").focus(),!1;if(rqWsBookedBy&&n("#txBooked").val().length==0)return n("#txBooked + p.ws-error").html(WsMsgFmBookedBy),n("#txBooked").addClass("ws-error-form").focus(),!1;if(rqWsBookedBy&&!Utils.IsInput(n("#txBooked").val()))return n("#txBooked + p.ws-error").html(WsMsgFmLatinChars),n("#txBooked").addClass("ws-error-form").focus(),!1;if(rqWsTripPurpose&&n("#cbTripPurpose").val().length==0)return n("#dvWsTripPurpose p.ws-error").html(WsMsgFmTripPurpose),n("#cbTripPurpose").addClass("ws-error-form").focus(),!1;if(rqWsTravelProgram&&n("#cbTravelProgram option").length>0&&n("#cbTravelProgram").val().length===0)return n("#dvWsTravelProgram p.ws-error").html(WsMsgFmTravelProgram),n("#cbTravelProgram").addClass("ws-error-form").focus(),!1;if(rqWsTravelMember&&n("#txTravelMember").val().length===0)return n("#txTravelMember + p.ws-error").html(WsMsgFmTravelMember),n("#txTravelMember").addClass("ws-error-form").focus(),!1;if(rqWsTravelMember&&!Utils.IsInput(n("#txTravelMember").val()))return n("#txTravelMember + p.ws-error").html(WsMsgFmLatinChars),n("#txTravelMember").addClass("ws-error-form").focus(),!1;if(rqWsArrFlight&&n("#txArrFlight").val().length==0)return n("#txArrFlight + p.ws-error").html(WsMsgFmArrFlight),n("#txArrFlight").addClass("ws-error-form").focus(),!1;if(rqWsArrFlight&&!Utils.IsInput(n("#txArrFlight").val()))return n("#txArrFlight + p.ws-error").html(WsMsgFmLatinChars),n("#txArrFlight").addClass("ws-error-form").focus(),!1;if(rqWsArrTime&&n("#txArrTime").length>0&&n("#txArrTime").val().length==0)return n("#txArrTime + p.ws-error").html(WsMsgFmArrTime),n("#txArrTime").addClass("ws-error-form").focus(),!1;if(rqWsArrTime&&n("#txArrTime").length>0&&!Utils.IsInput(n("#txArrTime").val()))return n("#txArrTime + p.ws-error").html(WsMsgFmLatinChars),n("#txArrTime").addClass("ws-error-form").focus(),!1;if(rqWsArrTime&&n("#cbArrTime").length>0&&n("#cbArrTime").val().length==0)return n("#cbArrTime + p.ws-error").html(WsMsgFmArrTime),n("#cbArrTime").addClass("ws-error-form").focus(),!1;if(rqWsGuestPref&&n("#txComments").val().length===0)return n("#txComments + p.ws-error").html(WsMsgFmComment),n("#txComments").addClass("ws-error-form").focus(),!1;if(rqWsGuestPref&&!Utils.IsInput(n("#txComments").val()))return n("#txComments + p.ws-error").html(WsMsgFmLatinChars),n("#txComments").addClass("ws-error-form").focus(),!1;if(n("div#dvActiveGuestPrograms p").length>0){for(f=n("div#dvActiveGuestPrograms p"),i=0;i<f.length;i++)if(i>0&&f[i].innerHTML!="")return n(f[i]).prev("input").addClass("ws-error-form"),!1}else if(rqWsTAIataNumber&&n("#dvWsTAIataNumber").is(":visible")&&n("#txTAIataNumber").val().length===0)return n("#txTAIataNumber + p.ws-error").html(WsMsgFmIataNumber),n("#txTAIataNumber").addClass("ws-error-form"),"txTAIataNumber";return SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramID==21&&n("#cbBirthDD").val().length>0&&n("#cbBirthMM").val().length>0&&n("#cbBirthYY").val().length>0&&(o=CheckAge(n("#cbBirthDD").val()+"-"+n("#cbBirthMM").val()+"-"+n("#cbBirthYY").val()),o<21)?(n("#dvWsDob p.ws-error").html(WsMulti.CheckAge),n("#cbBirthDD").addClass("ws-error-form"),n("#cbBirthMM").addClass("ws-error-form"),n("#cbBirthYY").addClass("ws-error-form"),!1):(n("#inAction").val("buGuestSave"),n("body").css({cursor:"wait"}),n.ajax({type:"POST",url:"confirm.aspx",data:n("#wsform").serialize(),dataType:"json",success:function(t){var i;n("body").css({cursor:"auto"});var r=t.Msg,u=t.ResvID,e=t.resvKey,h=t.LangID,o=t.LangCode,s=t.HotelID;let f=Utils.GetParam("crsid");WsVars.ResExternalConfirmation=="1"&&f.includes("-")&&(u=f);r.length>0?(n("#buGuestSave + p.ws-error").html(r),n("#buGuestSave").addClass("ws-error-form")):(i=Utils.Format("confirm.aspx?ret=1&hotelid={0}&lang={1}&crsid={2}&resvKey={3}&currID={4}",s,o,u,e,WsVars.CurrencyId),WsVars.HgID!=="0"&&(i=i+"&hgID="+WsVars.HgID),location.replace(i))},error:function(){n("body").css({cursor:"auto"})}}),!1)});n("#buGuestPrefSave").click(function(){return n("#wsform input,#wsform select,#wsform a").removeClass("ws-error-form"),n("#inAction").val("buGuestPrefSave"),n("body").css({cursor:"wait"}),n.ajax({type:"POST",url:"confirm.aspx",data:n("#wsform").serialize(),dataType:"json",success:function(t){var i;n("body").css({cursor:"auto"});var r=t.Msg,u=t.ResvID,f=t.resvKey,s=t.LangID,e=t.LangCode,o=t.HotelID;r.length>0?(n("#buGuestPrefSave + p.ws-error").html(r),n("#buGuestPrefSave").addClass("ws-error-form")):(i=Utils.Format("confirm.aspx?ret=1&hotelid={0}&lang={1}&crsid={2}&resvKey={3}&currID={4}",o,e,u,f,WsVars.CurrencyId),WsVars.HgID!=="0"&&(i=i+"&hgID="+WsVars.HgID),location.replace(i))},error:function(){n("body").css({cursor:"auto"})}}),!1});n("#buBillingSave").click(function(){var t=!0,i,r,u;if((WsVars.IsIPGProp==1||WsVars.IsAdyenV2==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsPaymentGatewayV1==1)&&n("#inCustomerBrowser").val(getBrowserInfo()),n("#dvPayFullPrePayment").is(":visible")&&n("input:radio[name='rblPayFullPrePayment']").length>0&&(n("input:radio[name='rblPayFullPrePayment']:checked").val()=="PayAtHotel"?(t=!1,n("#inPaymentOption").val("PayAtHotel")):n("input:radio[name='rblPayFullPrePayment']:checked").val()=="OptFullPrePayment"?n("#inPaymentOption").val("OptFullPrePayment"):n("input:radio[name='rblPayFullPrePayment']:checked").val()=="PayDeposit"&&n("#inPaymentOption").val("PayDeposit")),WsVars.IsAdyenV2==1&&n("input:radio[name='WsPaymentMethod$rdPayMethodType']").length>0)if(n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="klarna"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="klarna_account"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="klarna_paynow"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="swish"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="googlepay"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="applepay"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="alipay"||n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="wechatpayWeb")t=!1;else if(n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val()=="giftcard"&&(t=!1,n("#txGiftCardNumber").length>0&&n("#txGiftCardNumber").val().length===0))return n("#txGiftCardNumber + p.ws-error").html(WsMsgFmGiftCardNumber),n("#txGiftCardNumber").addClass("ws-error-form"),!1;if(n("#wsform input,#wsform select,#wsform a").removeClass("ws-error-form"),t){if(i=n("#txCardHolder").val().replace(/\s+/g,""),i.length===0||/^\d{12,16}$/.test(i))return n("#txCardHolder + p.ws-error").html(WsMsgFmCardHolder),n("#txCardHolder").addClass("ws-error-form").focus(),!1;if(Utils.IsInput(n("#txCardHolder").val())){if(n("#txCardNumber").val().length<=10)return n("#txCardNumber + p.ws-error").html(WsMsgFmCardNumber),n("#txCardNumber").addClass("ws-error-form").focus(),!1;if(n("#txCardCvv").length>0&&n("#txCardCvv").val().length==0)return n("#txCardCvv + p.ws-error").html(WsMsgFmCardCvv),n("#txCardCvv").addClass("ws-error-form").focus(),!1;if(n("#txCardCvv").length>0&&!Utils.IsInput(n("#txCardCvv").val()))return n("#txCardCvv + p.ws-error").html(WsMsgFmLatinChars),n("#txCardCvv").addClass("ws-error-form").focus(),!1}else return n("#txCardHolder + p.ws-error").html(WsMsgFmLatinChars),n("#txCardHolder").addClass("ws-error-form").focus(),!1;if(n("#txCardNumber").val().substr(0,6)!=="******"){if(r=!1,u=Utils.GetCards(n("#txCardNumber").val()),u.length>0&&n("#dvCardType .cc-icon").each(function(){var t=Number(n(this).attr("ref"));if(Utils.ArrayFind(u,t)>=0)return r=!0,!1}),r===!1)return n("#txCardNumber + p.ws-error").html(WsMsgFmCardNumber),n("#txCardNumber").addClass("ws-error-form").focus(),!1}else return n("#txCardNumber + p.ws-error").html(WsMsgFmCardDetails),n("#txCardNumber").addClass("ws-error-form").focus(),!1}return n("#inAction").val("buBillingSave"),n("body").css({cursor:"wait"}),n.ajax({type:"POST",url:"confirm.aspx",data:n("#wsform").serialize(),dataType:"json",success:function(t){var i;n("body").css({cursor:"auto"});var r=t.Msg,u=t.ResvID,e=t.resvKey,h=t.LangID,o=t.LangCode,s=t.HotelID;n("#hpmsResvId").val(t.PmsResvId);let f=Utils.GetParam("crsid");WsVars.ResExternalConfirmation=="1"&&f.includes("-")&&(u=f);r.length>0?(n("#buBillingSave + p.ws-error").html(r),n("#buBillingSave").addClass("ws-error-form")):(i=Utils.Format("confirm.aspx?ret=1&hotelid={0}&lang={1}&crsid={2}&resvKey={3}&currID={4}",s,o,u,e,WsVars.CurrencyId),WsVars.HgID!=="0"&&(i=i+"&hgID="+WsVars.HgID),location.replace(i))},error:function(){n("body").css({cursor:"auto"})}}),!1});n("#buModifyResv").click(function(){var r,u,f,i,e,t;if(n("#wsform a").removeClass("ws-error-form"),rqWsTAIataNumber&&n("#dvWsTAIataNumber").is(":visible")&&n("#txTAIataNumber").val().length===0)return n("#txTAIataNumber + p.ws-error").html(WsMsgFmIataNumber),n("#txTAIataNumber").addClass("ws-error-form"),"txTAIataNumber";if((n("#dvPayFullPrePayment").is(":visible")&&n("input:radio[name='rblPayFullPrePayment']").length>0&&(n("input:radio[name='rblPayFullPrePayment']:checked").val()=="PayAtHotel"?n("#inPaymentOption").val("PayAtHotel"):n("input:radio[name='rblPayFullPrePayment']:checked").val()=="OptFullPrePayment"?n("#inPaymentOption").val("OptFullPrePayment"):n("input:radio[name='rblPayFullPrePayment']:checked").val()=="PayDeposit"&&n("#inPaymentOption").val("PayDeposit")),WSMAIN.IsChanged()===!1&&!IsAddonPriorModStart)||(r=WSMAIN.GetUpdates(),r.length===0))return n("#buModifyResv + p.ws-error").html(WsMulti.NoModToModify),n("#buModifyResv").addClass("ws-error-form"),!1;if(WSMAIN.SelectedRs()===null)return n("#buModifyResv + p.ws-error").html(WsMulti.SelectedRoomRateNotAvail),n("#buModifyResv").addClass("ws-error-form"),!1;for(u=0;u<r.length;u++){if(r[u].GetIsOLResVal&&r[u].Nights>0)return n("#buModifyResv + p.ws-error").html(WsMulti.COMP7dayValidation),n("#buModifyResv").addClass("ws-error-form"),!1;if(r[u].MaxCompNights>0&&compCounts>r[u].MaxCompNights)return n("#buModifyResv + p.ws-error").html(WsMulti.MaxCompNightsPerRoom),n("#buModifyResv").addClass("ws-error-form"),!1;if(r[u].OfferMinLOS>0&&r[u].Nights<r[u].OfferMinLOS)return n("#buModifyResv + p.ws-error").html(WsMulti.CompOfferMinLOS),n("#buModifyResv").addClass("ws-error-form"),!1;if(WSMAIN.IsLoggedIn()&&(Number(SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2)&SHRWindsurfer.WsLoyaltyHandler.LoyaltyProgramConfig2Enum.SuppLoyaltyPoints)>0&&WsVars.EnablePayByPoints=="1"&&WsLoyaltyPointsInfo!=null&&WsLoyaltyPointsInfo.length>0)for(f=0;f<WsLoyaltyPointsInfo.length;f++)r[u].CrsID==WsLoyaltyPointsInfo[f].CrsID&&(r[u].LoyaltyPointsInfo.LoyaltyRedeemPoints=WsLoyaltyPointsInfo[f].RedeemPoints,r[u].LoyaltyPointsInfo.LoyaltyRedeemAmount=WsLoyaltyPointsInfo[f].RedeemAmount*100)}n("#inModifyCrsID").val(r[0].CrsID);i={inHotelID:n("#inHotelID").val(),inHgID:n("#inHgID").val(),inLangID:n("#inLangID").val(),inCrsID:n("#inCrsID").val(),inLname:n("#inLname").val(),inAction:"buModifyResv",wsitems:JSON.stringify(r)};try{if(WsVars.IsFreedomPayProp==1&&n("#txCardNumber").length>0&&n("#txCardNumber").val().length>0&&n("#txCardNumber").val().substr(0,6)!=="******"&&window.wsFreedompay!=undefined&&window.wsFreedompay.Options!=undefined&&window.wsFreedompay.Enabled()&&window.wsFreedompay.Events!=undefined){if(window.wsFreedompay.Options.LookupResponse==null||window.wsFreedompay.Options.LookupResponse==undefined)return window.wsFreedompay.Events.Auth3dsPerformLookup(),!1;window.wsFreedompay.Options.LookupResponse!=null&&window.wsFreedompay.Options.LookupResponse!=undefined&&wsFreedompay.Valid()&&(e=JSON.stringify(window.wsFreedompay.Options.LookupResponse),t=JSON.parse(e),(typeof t.Payment!="undefined"&&t.Payment!=""||t.eciFlag!="00"&&t.eciFlag!="07"&&t.issueChallenge==!1)&&(typeof t.transactionId!="undefined"&&t.transactionId!=""?i.transID=t.transactionId:typeof t.Payment!="undefined"&&typeof t.Payment.ProcessorTransactionId!="undefined"&&t.Payment.ProcessorTransactionId!=""&&(i.transID=t.Payment.ProcessorTransactionId),typeof t.paResStatus!="undefined"&&t.paResStatus!=""?i.status=t.paResStatus=="Y"?"SUCCESS":"FAILURE":typeof t.Payment!="undefined"&&typeof t.Payment.ExtendedData!="undefined"&&t.Payment.ExtendedData.PAResStatus!=""&&(i.status=t.Payment.ExtendedData.PAResStatus=="Y"?"SUCCESS":"FAILURE"),i.auth3dsjson=e,i.auth3dsformat="cardinal",typeof t.Payment!="undefined"&&typeof t.Payment.ExtendedData!="undefined"&&typeof t.Payment.ExtendedData.ThreeDSVersion!="undefined"&&t.Payment.ExtendedData.ThreeDSVersion!=""&&(i.auth3dsformat=t.Payment.ExtendedData.ThreeDSVersion==""?"cardinal":"cardinalAuth"),i.txCardCvv=n("#txCardCvv").val()))}}catch(o){console.log(o)}return WsVars.IsAdyenV2==1&&(n("#inPayByMethodType").val()=="googlepay"||n("#inPayByMethodType").val()=="applepay")&&(WSMAIN.paygateWalletTransToken==undefined||WSMAIN.paygateWalletTransToken==null||WSMAIN.paygateWalletTransToken=="")?(n("#inPayByMethodType").val()=="googlepay"?WsWalletPay.OnGooglePayButtonClicked():n("#inPayByMethodType").val()=="applepay"&&WsWalletPay.OnApplePayButtonClicked(),!1):(i.txCardHolder=n("#txCardHolder").val(),i.txCardNumber=n("#txCardNumber").val(),i.cbCardMM=n("#cbCardMM").val(),i.cbCardYY=n("#cbCardYY").val(),i.hPmsResvId=n("#hpmsResvId").val(),n("#txCardCvv").length>0&&(i.txCardCvv=n("#txCardCvv").val()),i.nonce_id=n("#nonce_id").val(),n("#inPaymentOption").length>0&&(i.inPaygateOption=n("#inPaymentOption").val()),n("#inPayByMethodType").length>0&&(i.inPayByMethodType=n("#inPayByMethodType").val()),(WsVars.IsIPGProp==1||WsVars.IsAdyenV2==1||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsPaymentGatewayV1==1)&&(i.CustomerBrowser=getBrowserInfo()),(n("#inPayByMethodType").val()==="googlepay"||n("#inPayByMethodType").val()==="applepay")&&(i.paygateWalletTransToken=WSMAIN.paygateWalletTransToken),n("#txTAIataNumber").length>0&&(i.txTAIataNumber=n("#txTAIataNumber").val()),n("body").css({cursor:"wait"}),n.ajax({type:"POST",dataType:"json",url:"confirm.aspx",data:i,success:function(t){var u,f,h,e,l,v,i,b,k,a;n("body").css({cursor:"auto"});var s=t.Msg,y=t.ResvID,d=t.resvKey,tt=t.LangID,g=t.LangCode,nt=t.HotelID;n("#hpmsResvId").val(t.PmsResvId);let p=Utils.GetParam("crsid");if(WsVars.ResExternalConfirmation=="1"&&p.includes("-")&&(y=p),t!=null&&t.Status==="SUCCESS"&&(WsVars.IsIPGProp==1&&WsVars.TokenizeChargeRefund==1||WsVars.IsAdyenV2==="1"||WsVars.IsPlanetPayment==1||WsVars.IsRedDotPay==1||WsVars.IsNexiNetaxept==1||WsVars.IsNexiPayEngine==1||WsVars.IsPaymentGatewayV1==1))if(WsVars.IsAdyenV2==="1"&&t.Url!=undefined&&t.Url!=null&&t.Url!=""&&t.Url.toLowerCase().indexOf("qrcode")>=0&&t.Url2!=undefined&&t.Url2!=null&&t.Url2!="")if(Utils.IsMobile())location.replace(t.Url2);else{if(f=t.Url2.split("?"),typeof f!="undefined"&&f.length>0&&f[1]!=null&&(u=f[1].split("&")),typeof u!="undefined"&&u.length>0)for(h=0;h<u.length;h++)e=u[h].split("="),e[0].toLowerCase()==="merchanttxid"&&n("#inMerchantReference").val(e[1]),e[0].toLowerCase()=="cartinfo"&&n("#inCartInfo").val(e[1]);ShowQrCodeModal(t.Url,t.Url2)}else if(t.Url.indexOf("POST|")==0){var o=t.Url.substr(5),c=o.indexOf("?"),w="";c>0&&(w=o.substr(c),o=o.substr(0,c));l=n("<form>",{action:o,method:"POST",target:"_top"});c>0&&(v=new URLSearchParams(w),v!=undefined&&v.forEach(function(t,i){l.append(n("<input>",{name:i,value:t,type:"hidden"}))}));n(document.body).append(l);l.submit()}else location.href=t.Url;else s!==""&&s!==undefined&&s.length>0?(n("#buModifyResv + p.ws-error").html(s),n("#buModifyResv").addClass("ws-error-form")):(i=jQuery.extend(!0,{},r[0]),i!=null&&(b=new Date,k=Utils.GetIndexFromY2K(b),i.DayIn=Utils.ToMDYYYYFromIndex(i.Dt1,1),i.DayOut=Utils.ToMDYYYYFromIndex(i.Dt1+i.Nights,1),i.LeadTime=i.Dt1-k,i.AmtPerRmNght=Number(i.Amt)/Number(i.Nights),i.ResStatus="M",WsIbeTracking.TrackModification(i)),a=Utils.Format("confirm.aspx?ret=1&hotelid={0}&lang={1}&crsid={2}&resvKey={3}&currID={4}",nt,g,y,d,WsVars.CurrencyId),WsVars.HgID!=="0"&&(a=a+"&hgID="+WsVars.HgID),location.replace(a))},error:function(){n("body").css({cursor:"auto"})}}),!1)});n("#txCardNumber").change(function(){var i=Utils.GetCards(n(this).val()),t;for(n("#dvCardType .cc-icon").removeClass("ccselected"),t=0;t<i.length;t++)n('#dvCardType .cc-icon[ref="'+i[t]+'"]').addClass("ccselected");n("#txCardCvv").val().substr(0,1)==="*"&&n("#txCardCvv").val("")});n("#btnPaymentComplete").click(function(){CheckVerifyStatus()});n("#buResend").click(function(){if(n("#dvMsgSendEmail").html(""),n("#txResendEmail").removeClass("ws-error-form"),!Utils.IsValidEmail(n("#txResendEmail").val()))return n("#txResendEmail + p.ws-error").html(WsMsgFmEmail),n("#txResendEmail").addClass("ws-error-form"),!1;var t={inHotelID:n("#inHotelID").val(),inHgID:n("#inHgID").val(),inLangID:n("#inLangID").val(),inCrsID:n("#inCrsID").val(),inLname:n("#inLname").val(),inEmail:n("#txResendEmail").val(),inAction:"buResend"},i=Utils.Format("confirm.aspx?hotelID={0}&hgID={1}&crsresId={2}",n("#inHotelID").val(),n("#inHgID").val(),n("#inCrsID").val());return t.nonce_id=n("#nonce_id").val(),n("body").css({cursor:"wait"}),n.ajax({type:"POST",dataType:"json",url:i,data:t,success:function(t){n("body").css({cursor:"auto"});var i=t.Msg;i.length===0?n("#dvMsgSendEmail").html(WsMulti.SendEmailSuccess):n("#dvMsgSendEmail").html(i)},error:function(){n("body").css({cursor:"auto"});n("#dvMsgSendEmail").html(WsMulti.SendEmailError)}}),!1});n("#buResortFee").magnificPopup({type:"inline",midClick:!0,closeMarkup:'<button type="button" title="%title%" class="ws-mfp-custom-close mfp-close" aria-label="close">&#215;<span class="ws-custom-close-icon" aria-hidden="true"><\/span><\/button>'});n("#buGenModal").click(function(){return n.magnificPopup.close(),!1});WsVars.IBESkinVer=="3"&&(n(".txRoom").attr("tabIndex","0"),n(".txRate").attr("tabIndex","0"),n(".txTower").attr("tabIndex","0"),BypassAddressBarFocus());SetInputFieldRequired();n(".ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar .txtRangePoints").change(function(){var i=n(this).attr("ix"),r=n(this).attr("ref"),t=n(this).val();WSMAIN.IsEmpty(t)&&(t=0);n('.ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar .LoyaltyPointsRange[ix="'+i+'"]').val(t);WsVars.EnableFractionalCredits=="1"?WSMAIN.CalculateLoyaltyRedeemPoints(i,r,t,!0):n(".ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar .LoyaltyPointsRange").change()});n(".ws-loyaltyPoints-sliderSection .ws-loyaltyPoints-sliderBar .LoyaltyPointsRange").change(function(){var i=n(this).attr("ix"),r=n(this).attr("ref"),t=n(this).val();WsVars.EnableFractionalCredits=="1"&&(t=t/100);WSMAIN.IsEmpty(t)&&(t=0);WSMAIN.CalculateLoyaltyRedeemPoints(i,r,t,!0)});n("input:radio[name='rdPayMethodType']").change(function(){var t=n("input:radio[name='rdPayMethodType']:checked").val();ShowHidePaymentMethodDvSection(t);n("input:radio[name='rdPayMethodType']:checked").blur()});n("input:radio[name='WsPaymentMethod$rdPayMethodType']").change(function(){var t=n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").val();ShowHidePaymentMethodDvSection(t);n("input:radio[name='WsPaymentMethod$rdPayMethodType']:checked").blur()});let r=Utils.GetParam("crsid");WsVars.ResExternalConfirmation=="1"&&r.includes("-")&&n("#txModifyResv").addClass("ws-show-this");WsVars.EnableAddressAutoComplete=="1"&&initAddressAutocomplete();sessionStorage.clear()});
//# sourceMappingURL=wsconfirm.min.js.map